#include "color.c.h"
static struct rgb palette16[16] = { { 0, 0, 0, 0 }
, { 128, 0, 0, 0 }
, { 0, 128, 0, 0 }
, { 170, 'U', 0, 0 }
, { 0, 0, 128, 0 }
, { 128, 0, 128, 0 }
, { 0, 128, 128, 0 }
, { 170, 170, 170, 0 }
, { 'U', 'U', 'U', 0 }
, { 255, 'U', 'U', 0 }
, { 'U', 255, 'U', 0 }
, { 255, 255, 'U', 0 }
, { 'U', 'U', 255, 0 }
, { 255, 'U', 255, 0 }
, { 'U', 255, 255, 0 }
, { 255, 255, 255, 0 }
 };
static struct rgb palette88[88] = { { 0, 0, 0, 0 }
, { 128, 0, 0, 0 }
, { 0, 128, 0, 0 }
, { 170, 'U', 0, 0 }
, { 0, 0, 128, 0 }
, { 128, 0, 128, 0 }
, { 0, 128, 128, 0 }
, { 170, 170, 170, 0 }
, { 'U', 'U', 'U', 0 }
, { 255, 'U', 'U', 0 }
, { 'U', 255, 'U', 0 }
, { 255, 255, 'U', 0 }
, { 'U', 'U', 255, 0 }
, { 255, 'U', 255, 0 }
, { 'U', 255, 255, 0 }
, { 255, 255, 255, 0 }
, { 0, 0, 0, 0 }
, { 0, 0, 139, 0 }
, { 0, 0, 205, 0 }
, { 0, 0, 255, 0 }
, { 0, 139, 0, 0 }
, { 0, 139, 139, 0 }
, { 0, 139, 205, 0 }
, { 0, 139, 255, 0 }
, { 0, 205, 0, 0 }
, { 0, 205, 139, 0 }
, { 0, 205, 205, 0 }
, { 0, 205, 255, 0 }
, { 0, 255, 0, 0 }
, { 0, 255, 139, 0 }
, { 0, 255, 205, 0 }
, { 0, 255, 255, 0 }
, { 139, 0, 0, 0 }
, { 139, 0, 139, 0 }
, { 139, 0, 205, 0 }
, { 139, 0, 255, 0 }
, { 139, 139, 0, 0 }
, { 139, 139, 139, 0 }
, { 139, 139, 205, 0 }
, { 139, 139, 255, 0 }
, { 139, 205, 0, 0 }
, { 139, 205, 139, 0 }
, { 139, 205, 205, 0 }
, { 139, 205, 255, 0 }
, { 139, 255, 0, 0 }
, { 139, 255, 139, 0 }
, { 139, 255, 205, 0 }
, { 139, 255, 255, 0 }
, { 205, 0, 0, 0 }
, { 205, 0, 139, 0 }
, { 205, 0, 205, 0 }
, { 205, 0, 255, 0 }
, { 205, 139, 0, 0 }
, { 205, 139, 139, 0 }
, { 205, 139, 205, 0 }
, { 205, 139, 255, 0 }
, { 205, 205, 0, 0 }
, { 205, 205, 139, 0 }
, { 205, 205, 205, 0 }
, { 205, 205, 255, 0 }
, { 205, 255, 0, 0 }
, { 205, 255, 139, 0 }
, { 205, 255, 205, 0 }
, { 205, 255, 255, 0 }
, { 255, 0, 0, 0 }
, { 255, 0, 139, 0 }
, { 255, 0, 205, 0 }
, { 255, 0, 255, 0 }
, { 255, 139, 0, 0 }
, { 255, 139, 139, 0 }
, { 255, 139, 205, 0 }
, { 255, 139, 255, 0 }
, { 255, 205, 0, 0 }
, { 255, 205, 139, 0 }
, { 255, 205, 205, 0 }
, { 255, 205, 255, 0 }
, { 255, 255, 0, 0 }
, { 255, 255, 139, 0 }
, { 255, 255, 205, 0 }
, { 255, 255, 255, 0 }
, { '.', '.', '.', 0 }
, { '\\', '\\', '\\', 0 }
, { 's', 's', 's', 0 }
, { 139, 139, 139, 0 }
, { 162, 162, 162, 0 }
, { 185, 185, 185, 0 }
, { 208, 208, 208, 0 }
, { 231, 231, 231, 0 }
 };
static struct color_mode_info color_mode_16 = { palette16, { { 8, 16 }
, { 8, 8 }
 } };
static struct color_mode_info color_mode_88 = { palette88, { { 88, 88 }
, { 88, 44 }
 } };
static struct color_mode_info color_mode_256 = { palette256, { { 256, 256 }
, { 256, 128 }
 } };
static struct color_mode_info *color_modes[5] = { &color_mode_16, &color_mode_16, &color_mode_88, &color_mode_256, &color_mode_16 };
static unsigned char fg_color[16][8] = { { 7, 0, 0, 0, 7 }, { 1, 9, 1, 9, 9, 9, 1, 1 }, { 2, 2, 10, 2, 2, 2, 10, 10 }, { 3, 11, 3, 11, 3, 11, 3, 3 }, { 12, 12, 6, 4, 12, 6, 4, 4 }, { 5, 13, 5, 13, 13, 13, 5, 5 }, { 6, 6, 14, 6, 6, 6, 14, 14 }, { 7, 7, 0, 7, 7, 7 }, { 15, 15, 8, 15, 15, 15, 8, 8 }, { 9, 9, 1, 9, 9, 9, 1, 9 }, { 10, 10, 10, 10, 10, 10, 10, 10 }, { 11, 11, 11, 11, 11, 11, 11, 11 }, { 12, 12, 6, 4, 6, 6, 4, 12 }, { 13, 13, 5, 13, 13, 13, 5, 5 }, { 14, 14, 14, 14, 14, 14, 14, 14 }, { 15, 15, 15, 15, 15, 15, 15, 15 } };
static struct rgb palette256[256] = { { 0, 0, 0, 0 }
, { 205, 0, 0, 0 }
, { 0, 205, 0, 0 }
, { 205, 205, 0, 0 }
, { 0, 0, 238, 0 }
, { 205, 0, 205, 0 }
, { 0, 205, 205, 0 }
, { 229, 229, 229, 0 }
, { 127, 127, 127, 0 }
, { 255, 0, 0, 0 }
, { 0, 255, 0, 0 }
, { 255, 255, 0, 0 }
, { '\\', '\\', 255, 0 }
, { 255, 0, 255, 0 }
, { 0, 255, 255, 0 }
, { 255, 255, 255, 0 }
, { 0, 0, 0, 0 }
, { 0, 0, '_', 0 }
, { 0, 0, 135, 0 }
, { 0, 0, 175, 0 }
, { 0, 0, 215, 0 }
, { 0, 0, 255, 0 }
, { 0, '_', 0, 0 }
, { 0, '_', '_', 0 }
, { 0, '_', 135, 0 }
, { 0, '_', 175, 0 }
, { 0, '_', 215, 0 }
, { 0, '_', 255, 0 }
, { 0, 135, 0, 0 }
, { 0, 135, '_', 0 }
, { 0, 135, 135, 0 }
, { 0, 135, 175, 0 }
, { 0, 135, 215, 0 }
, { 0, 135, 255, 0 }
, { 0, 175, 0, 0 }
, { 0, 175, '_', 0 }
, { 0, 175, 135, 0 }
, { 0, 175, 175, 0 }
, { 0, 175, 215, 0 }
, { 0, 175, 255, 0 }
, { 0, 215, 0, 0 }
, { 0, 215, '_', 0 }
, { 0, 215, 135, 0 }
, { 0, 215, 175, 0 }
, { 0, 215, 215, 0 }
, { 0, 215, 255, 0 }
, { 0, 255, 0, 0 }
, { 0, 255, '_', 0 }
, { 0, 255, 135, 0 }
, { 0, 255, 175, 0 }
, { 0, 255, 215, 0 }
, { 0, 255, 255, 0 }
, { '_', 0, 0, 0 }
, { '_', 0, '_', 0 }
, { '_', 0, 135, 0 }
, { '_', 0, 175, 0 }
, { '_', 0, 215, 0 }
, { '_', 0, 255, 0 }
, { '_', '_', 0, 0 }
, { '_', '_', '_', 0 }
, { '_', '_', 135, 0 }
, { '_', '_', 175, 0 }
, { '_', '_', 215, 0 }
, { '_', '_', 255, 0 }
, { '_', 135, 0, 0 }
, { '_', 135, '_', 0 }
, { '_', 135, 135, 0 }
, { '_', 135, 175, 0 }
, { '_', 135, 215, 0 }
, { '_', 135, 255, 0 }
, { '_', 175, 0, 0 }
, { '_', 175, '_', 0 }
, { '_', 175, 135, 0 }
, { '_', 175, 175, 0 }
, { '_', 175, 215, 0 }
, { '_', 175, 255, 0 }
, { '_', 215, 0, 0 }
, { '_', 215, '_', 0 }
, { '_', 215, 135, 0 }
, { '_', 215, 175, 0 }
, { '_', 215, 215, 0 }
, { '_', 215, 255, 0 }
, { '_', 255, 0, 0 }
, { '_', 255, '_', 0 }
, { '_', 255, 135, 0 }
, { '_', 255, 175, 0 }
, { '_', 255, 215, 0 }
, { '_', 255, 255, 0 }
, { 135, 0, 0, 0 }
, { 135, 0, '_', 0 }
, { 135, 0, 135, 0 }
, { 135, 0, 175, 0 }
, { 135, 0, 215, 0 }
, { 135, 0, 255, 0 }
, { 135, '_', 0, 0 }
, { 135, '_', '_', 0 }
, { 135, '_', 135, 0 }
, { 135, '_', 175, 0 }
, { 135, '_', 215, 0 }
, { 135, '_', 255, 0 }
, { 135, 135, 0, 0 }
, { 135, 135, '_', 0 }
, { 135, 135, 135, 0 }
, { 135, 135, 175, 0 }
, { 135, 135, 215, 0 }
, { 135, 135, 255, 0 }
, { 135, 175, 0, 0 }
, { 135, 175, '_', 0 }
, { 135, 175, 135, 0 }
, { 135, 175, 175, 0 }
, { 135, 175, 215, 0 }
, { 135, 175, 255, 0 }
, { 135, 215, 0, 0 }
, { 135, 215, '_', 0 }
, { 135, 215, 135, 0 }
, { 135, 215, 175, 0 }
, { 135, 215, 215, 0 }
, { 135, 215, 255, 0 }
, { 135, 255, 0, 0 }
, { 135, 255, '_', 0 }
, { 135, 255, 135, 0 }
, { 135, 255, 175, 0 }
, { 135, 255, 215, 0 }
, { 135, 255, 255, 0 }
, { 175, 0, 0, 0 }
, { 175, 0, '_', 0 }
, { 175, 0, 135, 0 }
, { 175, 0, 175, 0 }
, { 175, 0, 215, 0 }
, { 175, 0, 255, 0 }
, { 175, '_', 0, 0 }
, { 175, '_', '_', 0 }
, { 175, '_', 135, 0 }
, { 175, '_', 175, 0 }
, { 175, '_', 215, 0 }
, { 175, '_', 255, 0 }
, { 175, 135, 0, 0 }
, { 175, 135, '_', 0 }
, { 175, 135, 135, 0 }
, { 175, 135, 175, 0 }
, { 175, 135, 215, 0 }
, { 175, 135, 255, 0 }
, { 175, 175, 0, 0 }
, { 175, 175, '_', 0 }
, { 175, 175, 135, 0 }
, { 175, 175, 175, 0 }
, { 175, 175, 215, 0 }
, { 175, 175, 255, 0 }
, { 175, 215, 0, 0 }
, { 175, 215, '_', 0 }
, { 175, 215, 135, 0 }
, { 175, 215, 175, 0 }
, { 175, 215, 215, 0 }
, { 175, 215, 255, 0 }
, { 175, 255, 0, 0 }
, { 175, 255, '_', 0 }
, { 175, 255, 135, 0 }
, { 175, 255, 175, 0 }
, { 175, 255, 215, 0 }
, { 175, 255, 255, 0 }
, { 215, 0, 0, 0 }
, { 215, 0, '_', 0 }
, { 215, 0, 135, 0 }
, { 215, 0, 175, 0 }
, { 215, 0, 215, 0 }
, { 215, 0, 255, 0 }
, { 215, '_', 0, 0 }
, { 215, '_', '_', 0 }
, { 215, '_', 135, 0 }
, { 215, '_', 175, 0 }
, { 215, '_', 215, 0 }
, { 215, '_', 255, 0 }
, { 215, 135, 0, 0 }
, { 215, 135, '_', 0 }
, { 215, 135, 135, 0 }
, { 215, 135, 175, 0 }
, { 215, 135, 215, 0 }
, { 215, 135, 255, 0 }
, { 215, 175, 0, 0 }
, { 215, 175, '_', 0 }
, { 215, 175, 135, 0 }
, { 215, 175, 175, 0 }
, { 215, 175, 215, 0 }
, { 215, 175, 255, 0 }
, { 215, 215, 0, 0 }
, { 215, 215, '_', 0 }
, { 215, 215, 135, 0 }
, { 215, 215, 175, 0 }
, { 215, 215, 215, 0 }
, { 215, 215, 255, 0 }
, { 215, 255, 0, 0 }
, { 215, 255, '_', 0 }
, { 215, 255, 135, 0 }
, { 215, 255, 175, 0 }
, { 215, 255, 215, 0 }
, { 215, 255, 255, 0 }
, { 255, 0, 0, 0 }
, { 255, 0, '_', 0 }
, { 255, 0, 135, 0 }
, { 255, 0, 175, 0 }
, { 255, 0, 215, 0 }
, { 255, 0, 255, 0 }
, { 255, '_', 0, 0 }
, { 255, '_', '_', 0 }
, { 255, '_', 135, 0 }
, { 255, '_', 175, 0 }
, { 255, '_', 215, 0 }
, { 255, '_', 255, 0 }
, { 255, 135, 0, 0 }
, { 255, 135, '_', 0 }
, { 255, 135, 135, 0 }
, { 255, 135, 175, 0 }
, { 255, 135, 215, 0 }
, { 255, 135, 255, 0 }
, { 255, 175, 0, 0 }
, { 255, 175, '_', 0 }
, { 255, 175, 135, 0 }
, { 255, 175, 175, 0 }
, { 255, 175, 215, 0 }
, { 255, 175, 255, 0 }
, { 255, 215, 0, 0 }
, { 255, 215, '_', 0 }
, { 255, 215, 135, 0 }
, { 255, 215, 175, 0 }
, { 255, 215, 215, 0 }
, { 255, 215, 255, 0 }
, { 255, 255, 0, 0 }
, { 255, 255, '_', 0 }
, { 255, 255, 135, 0 }
, { 255, 255, 175, 0 }
, { 255, 255, 215, 0 }
, { 255, 255, 255, 0 }
, { 8, 8, 8, 0 }
, { 18, 18, 18, 0 }
, { 28, 28, 28, 0 }
, { '&', '&', '&', 0 }
, { '0', '0', '0', 0 }
, { ':', ':', ':', 0 }
, { 'D', 'D', 'D', 0 }
, { 'N', 'N', 'N', 0 }
, { 'X', 'X', 'X', 0 }
, { 'b', 'b', 'b', 0 }
, { 'l', 'l', 'l', 0 }
, { 'v', 'v', 'v', 0 }
, { 128, 128, 128, 0 }
, { 138, 138, 138, 0 }
, { 148, 148, 148, 0 }
, { 158, 158, 158, 0 }
, { 168, 168, 168, 0 }
, { 178, 178, 178, 0 }
, { 188, 188, 188, 0 }
, { 198, 198, 198, 0 }
, { 208, 208, 208, 0 }
, { 218, 218, 218, 0 }
, { 228, 228, 228, 0 }
, { 238, 238, 238, 0 }
 };
void set_term_color16( struct screen_char *schar, enum color_flags  flags, unsigned char fg, unsigned char bg )
{
  int eax;
  int edx;
  if ( schar->attr && ( ( flags & 2 ) & 255 ) )
    fg = ( fg | 8 ) ^ 4;
  if ( ( flags & 4 ) == 0 )
  {
    if ( fg != bg )
    {
      if ( ( fg & 8 ) & 255 )
        schar->attr = schar->attr | 8;
      if ( ( ( ( ( fg & 7 ) >> 2 ) | ( ( fg & 7 ) * 2 ) ) & 7 ) < ( ( ( (unsigned char)( bg >> 2 ) >> 2 ) | ( bg * 2 ) ) & 7 ) )
      {
        schar->attr |= 64;
      }
      schar->color[0] = fg | ( bg << 4 ) | ( bg << 4 );
      return;
    }
    else
    if ( ( ( flags & 8 ) & 255 ) == 0 )
      fg = bg;
  }
  if ( ( flags & 16 ) & 255 )
  {
    unsigned char contrastbg = fg_color[ fg ][ bg ];
    fg = bg;
    bg = fg_color[ fg ][ bg ];
  }
  else
  {
    fg = fg_color[ fg ][ bg ];
    fg = fg_color[ fg ][ bg ];
  }
}
void set_term_color( struct screen_char *schar, struct color_pair *pair, enum color_flags  flags, enum color_mode  color_mode )
{
  int eax;
  int ecx;
  struct color_mode_info *mode;
  enum palette_range  palette_range;
  unsigned char fg, bg;
  if ( assert_failed == 0 )
  {
    assert_failed = color_mode + 1 > 5;
    if ( color_mode + 1 > 5 )
    {
      errfile = "/home/naftali/source/elinks-0.12~pre5/src/terminal/color.c";
      errline = 299;
      elinks_internal( "assertion color_mode &gt;= COLOR_MODE_DUMP && color_mode &lt; COLOR_MODES failed!" );
    }
  }
  switch ( color_mode + 1 )
  {
  case 1:
    if ( ( flags & 1 ) & 255 )
    {
      schar->attr |= 64;
      palette_range = PALETTE_HALF;
      if ( assert_failed == 0 )
      {
        assert_failed = schar == 0;
        if ( !(_Bool)( schar != 0 ) )
        {
          errfile = "/home/naftali/source/elinks-0.12~pre5/src/terminal/color.c";
          errline = 366;
          elinks_internal( "assertion schar failed!" );
        }
      }
    }
    else
  case 3:
  case 4:
    palette_range = PALETTE_FULL;
    if ( assert_failed == 0 )
    {
      assert_failed = schar == 0;
    }
    break;
  case 2:
  case 5:
    palette_range = PALETTE_HALF;
    if ( ( ( flags & 1 ) & 255 ) == 0 )
      continue;
    break;
  case 0:
  case 6:
    return;
    break;
  }
  mode = color_modes[ color_mode ];
  color_modes[ ebp_60 ]->palette = color_modes[ color_mode ][0].palette;
  if ( cache[ ( color_modes[ color_mode ]->palette_range[ palette_range ].fg + ( *(int*)(pair + 4) & 255 ) + ( ( ( *(int*)(pair + 4) & 0xff0000 ) >> 16 ) << 3 ) + ( bh << 2 ) ) & 4095 ].level == 0 || ebp_28 != color_mode + 1 || ebp_48 != *(int*)(esi + 8) )
  {
    if ( color_modes[ color_mode ]->palette_range[ palette_range ].fg > 1 )
    {
      while ( 1 )
      {
        if ( ebp_124 <= ( ( ( ebp_40 - *(char*)(eax + ( edx << 2 )) ) * ( ebp_40 - *(char*)(eax + ( edx << 2 )) ) ) * 3 ) + ( ( ( ebp_36 - *(char*)(eax + ( edx << 2 ) + 1) ) * ( ebp_36 - *(char*)(eax + ( edx << 2 ) + 1) ) ) << 2 ) + ( ( ( ebp_32 - *(char*)(eax + ( edx << 2 ) + 2) ) * ( ebp_32 - *(char*)(eax + ( edx << 2 ) + 2) ) ) * 2 ) )
        {
          *ebp_124 = bh;
          if ( color_modes[ color_mode ]->palette_range[ palette_range ].fg == 1 + 1 + 1 )
            break;
          else
          {
          }
        }
        else
        if ( color_modes[ color_mode ]->palette_range[ palette_range ].fg == 1 + 1 + 1 )
          break;
        else
        {
        }
      }
    }
    *(int*)(cache[ ( color_modes[ color_mode ]->palette_range[ palette_range ].fg + ( *(int*)(pair + 4) & 255 ) + ( ( ( *(int*)(pair + 4) & 0xff0000 ) >> 16 ) << 3 ) + ( bh << 2 ) ) & 4095 ].color + 4) = color_modes[ color_mode ]->palette_range[ palette_range ].fg;
    *(int*)(cache[ ( color_modes[ color_mode ]->palette_range[ palette_range ].fg + ( *(int*)(pair + 4) & 255 ) + ( ( ( *(int*)(pair + 4) & 0xff0000 ) >> 16 ) << 3 ) + ( bh << 2 ) ) & 4095 ].color + 8) = pair->foreground;
  }
  else
  {
  }
  mode = &cache[ ( mode->palette_range[ palette_range ].bg + ( *(int*)(pair) & 255 ) + ( ( ( *(int*)(pair) & 0xff0000 ) >> 16 ) << 3 ) + ( ch << 2 ) ) & 4095 ].color;
  if ( cache[ ( mode->palette_range[ palette_range ].bg + ( *(int*)(pair) & 255 ) + ( ( ( *(int*)(pair) & 0xff0000 ) >> 16 ) << 3 ) + ( ch << 2 ) ) & 4095 ].level == 0 || edi != ecx || ebp_48 != *(int*)(esi + 8) )
  {
    bg = 0;
    if ( mode->palette_range[ palette_range ].bg > 1 )
    {
      while ( 1 )
      {
        if ( ebp_92 <= ( ( ( ebp_40 - *(char*)(eax + ( edx << 2 )) ) * ( ebp_40 - *(char*)(eax + ( edx << 2 )) ) ) * 3 ) + ( ( ( ebp_36 - *(char*)(eax + ( edx << 2 ) + 1) ) * ( ebp_36 - *(char*)(eax + ( edx << 2 ) + 1) ) ) << 2 ) + ( ( ( ebp_32 - *(char*)(eax + ( edx << 2 ) + 2) ) * ( ebp_32 - *(char*)(eax + ( edx << 2 ) + 2) ) ) * 2 ) )
        {
          *ebp_92 = ebp_92;
          if ( mode->palette_range[ palette_range ].bg == 1 + 1 + 1 )
            break;
          else
          {
          }
        }
        else
        if ( mode->palette_range[ palette_range ].bg == 1 + 1 + 1 )
          break;
        else
        {
        }
      }
      bg = ebp_41;
    }
    mode->palette_range->bg = mode->palette_range[ palette_range ].bg;
    mode->palette_range->fg = ebp_48;
  }
  else
    bg = *(char*)(cache[0].color + ebp_56);
  switch ( color_mode )
  {
  case COLOR_MODE_DUMP:
    bg = bg;
    errfile = "/home/naftali/source/elinks-0.12~pre5/src/terminal/color.c";
    errline = 375;
    schar = "Bad color mode, it should _never_ occur here.";
    break;
  case COLOR_MODES:
    errfile = "/home/naftali/source/elinks-0.12~pre5/src/terminal/color.c";
    errline = 375;
    schar = "Bad color mode, it should _never_ occur here.";
    break;
  case COLOR_MODE_88:
  case COLOR_MODE_256:
    if ( ebp_88 == (unsigned char)( bg ) && ( ( flags & 8 ) & 255 ) )
    {
      if ( ( flags & 16 ) & 255 )
      {
        bg = ( 0 - ( ( ebp_88 < ( 1 & 255 ) ) & 1 ) ) & 15;
      }
      else
      if ( ebp_88 )
      {
        bg = ebp_88;
      }
      else
      {
        bg = ebp_88;
      }
    }
    schar->color[0] = 0;
    schar->color[1] = bg;
    return;
    break;
  default:
    bg = bg;
    if ( schar->attr )
    {
    }
    if ( ( flags & 4 ) == 0 )
    {
      if ( ebp_88 != (unsigned char)( bg ) )
      {
        if ( ( bg & 8 ) & 255 )
          schar->attr = schar->attr | 8;
        if ( ( ( ( ( bg & 7 ) >> 2 ) | ( ( bg & 7 ) * 2 ) ) & 7 ) < ( ( ( ( bg >> 2 ) & 255 ) | ( bg * 2 ) ) & 7 ) )
          schar->attr |= 64;
        schar->color[0] = (unsigned char)( bg ) | (unsigned char)( bg << 4 );
        return;
      }
      else
      if ( ( ( flags & 8 ) & 255 ) == 0 )
        bg = ebp_88;
    }
    if ( ( flags & 16 ) & 255 )
      bg = fg_color[ ebp_88 ][ ecx ];
    else
    {
    }
    break;
  }
}
#if 0
#endif
