//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ------------------------ Structures ------------------------

struct ProgramVars {
    int32_t e0;
};

struct _IO_FILE {
    int32_t e0;
};

struct stat {
    int32_t e0;
    int32_t e1;
    int32_t e2;
    int32_t e3;
    int32_t e4;
    int32_t e5;
    int32_t e6;
    int32_t e7;
    int32_t e8;
    int32_t e9;
    int32_t e10;
    int32_t e11;
    int32_t e12;
    int32_t e13;
    int32_t e14;
    int32_t e15;
    int32_t e16;
    int32_t e17;
    int32_t e18;
    int32_t e19;
};

// ------------------- Function Prototypes --------------------

void ___setfpucw(void);
int32_t __xstat(int32_t ver, char * filename, struct stat * stat_buf);
void _fini(void);
void _init(void);
int32_t entry_point(void);
void function_80484a8(void);
int32_t function_8048604(void);
void function_8048620(void);
int32_t function_8048647(int32_t a1);
int32_t function_8048660(int32_t a1, int32_t a2, int32_t a3);
int32_t function_80487f0(char * str);
int32_t function_80488da(int32_t a1);
int32_t function_80488e0(uint32_t a1, int32_t a2);
int32_t function_804894a(int32_t a1);
int32_t function_8048950(int32_t a1, int32_t a2, int32_t a3);
void function_8048980(void);
int32_t function_80489a7(int32_t a1);

// --------------------- Global Variables ---------------------

int32_t g1 = 0; // eax
int32_t g2 = 0; // ebx
int32_t g3 = 0; // esi
int32_t g4 = 0; // 0x80499e8
int32_t g5 = -1; // 0x80499ec
int32_t g6 = 0; // 0x80499f8
void (**g7)() = NULL; // 0x8049ac8

// ------------------------ Functions -------------------------

// Address range: 0x80484a0 - 0x80484a7
void _init(void) {
    // 0x80484a0
    function_8048980();
}

// Address range: 0x80484a8 - 0x80484e7
void function_80484a8(void) {
    // 0x80484a8
    return;
}

// Address range: 0x80484e8 - 0x8048577
int32_t __xstat(int32_t ver, char * filename, struct stat * stat_buf) {
    // 0x80484e8
    return g1;
}

// Address range: 0x8048578 - 0x8048597
void ___setfpucw(void) {
    // 0x8048578
    return;
}

// Address range: 0x80485a0 - 0x8048603
int32_t entry_point(void) {
    int32_t v1;
    int32_t v2 = &v1; // 0x80485a0_0
    int32_t v3;
    int32_t v4 = 4 * v3 + 4 + v2; // 0x80485b0
    g2 = 0;
    g4 = v4;
    uint16_t v5 = *(int16_t *)&g7; // 0x80485d2
    __setfpucw((int32_t)v5, v3, v2, v4);
    __libc_init((struct ProgramVars *)v3, (void (**)())&v1, (void (**)())v4, NULL, NULL);
    atexit((void (**)())_fini);
    _init();
    exit(function_80488e0(v3, v2));
    // UNREACHABLE
}

// Address range: 0x8048604 - 0x804861f
int32_t function_8048604(void) {
    // 0x8048604
    // branch -> 0x8048610
    while (true) {
        // 0x8048610
        // branch -> 0x8048610
    }
}

// Address range: 0x8048620 - 0x8048646
void function_8048620(void) {
    // 0x8048620
    g2 = &g6;
    if (g6 == 0) {
        // 0x8048640
        return;
    }
    int32_t v1 = g6;
    g1 = v1;
    ((int32_t (*)())v1)();
    int32_t v2 = g2 + 4; // 0x8048638
    g2 = v2;
    int32_t v3 = *(int32_t *)v2; // 0x804863b
    while (v3 != 0) {
        // 0x8048634
        v1 = v3;
        g1 = v1;
        ((int32_t (*)())v1)();
        v2 = g2 + 4;
        g2 = v2;
        v3 = *(int32_t *)v2;
        // continue -> 0x8048634
    }
}

// Address range: 0x8048647 - 0x804865f
int32_t function_8048647(int32_t a1) {
    // 0x8048647
    return g3;
}

// Address range: 0x8048660 - 0x80487ef
int32_t function_8048660(int32_t a1, int32_t a2, int32_t a3) {
    int32_t str;
    int32_t v1 = &str; // 0x8048670_0
    sprintf((char *)&str, "%08lX:", a2);
    int32_t v2 = a3 > 16 ? 16 : a3;
    int32_t v3; // 0x80486d3
    int32_t v4; // 0x804879d
    char * v5; // 0x804874f_0
    int32_t len; // 0x8048704
    int32_t str2;
    int32_t v6;
    char v7;
    if (v2 > 0) {
        // branch -> 0x80486a0
        for (int32_t i = 0; i < v2; i++) {
            unsigned char v8 = *(char *)(i + a1); // 0x80486a6
            sprintf((char *)(3 * i + v1 + 9), " %02lX", (int32_t)v8);
            // continue -> 0x80486a0
        }
        // 0x8048690
        if (-a3 > -16) {
            // 0x80486d0
            if (a3 < 16) {
                v3 = a3 + 1;
                strcat((char *)&str, "   ");
                while (v3 < 16) {
                    // 0x80486e0
                    v3++;
                    strcat((char *)&str, "   ");
                    // continue -> 0x80486e0
                }
                // 0x8048700
                len = strlen((char *)&str);
                strcpy((char *)&str2, "  |");
                if (v2 <= 0) {
                    a3 = 0;
                    *(char *)(a3 + len + v1) = 32;
                    v4 = a3 + 1;
                    while (v4 < 16) {
                        // 0x8048790
                        a3 = v4;
                        *(char *)(a3 + len + v1) = 32;
                        v4 = a3 + 1;
                        // continue -> 0x8048790
                    }
                    // 0x80487b0
                    strcpy((char *)(len + v1 + 16), "|");
                    return printf("%s\n", &str);
                }
                // 0x8048740
                v6 = 0;
                // branch -> 0x8048740
                while (true) {
                    // 0x8048740
                    v5 = (char *)(v6 + a1);
                    v7 = 46;
                    if (*v5 <= 126) {
                      lab_0x804875f_2:
                        // 0x804875f
                        v7 = *v5;
                        // branch -> 0x8048772
                    }
                  lab_0x8048772_2:
                    // 0x8048772
                    *(char *)(v6 + len + v1) = v7;
                    int32_t v9 = v6 + 1; // 0x8048775
                    if (v2 <= v9) {
                        // break -> 0x804872c
                        break;
                    }
                    v6 = v9;
                    // continue -> 0x8048740
                }
                // 0x804872c
                if (-a3 > -16) {
                    // 0x8048780
                    if (a3 < 16) {
                        *(char *)(a3 + len + v1) = 32;
                        v4 = a3 + 1;
                        while (v4 < 16) {
                            // 0x8048790
                            a3 = v4;
                            *(char *)(a3 + len + v1) = 32;
                            v4 = a3 + 1;
                            // continue -> 0x8048790
                        }
                        // 0x80487b0
                        strcpy((char *)(len + v1 + 16), "|");
                        return printf("%s\n", &str);
                    }
                } else {
                    a3 = 16;
                }
                // 0x80487b0
                strcpy((char *)(len + v1 + a3), "|");
                return printf("%s\n", &str);
            }
        }
        // 0x8048700
        len = strlen((char *)&str);
        strcpy((char *)&str2, "  |");
        if (v2 <= 0) {
            a3 = 0;
            *(char *)(a3 + len + v1) = 32;
            v4 = a3 + 1;
            while (v4 < 16) {
                // 0x8048790
                a3 = v4;
                *(char *)(a3 + len + v1) = 32;
                v4 = a3 + 1;
                // continue -> 0x8048790
            }
            // 0x80487b0
            strcpy((char *)(len + v1 + 16), "|");
            return printf("%s\n", &str);
        }
        // 0x8048740
        v6 = 0;
        // branch -> 0x8048740
        while (true) {
            // 0x8048740
            v5 = (char *)(v6 + a1);
            if (*v5 > 126) {
                v7 = 46;
                goto lab_0x8048772_2;
            }
            goto lab_0x804875f_2;
        }
    } else {
        // 0x80486d0
        // branch -> 0x80486e0
    }
    v3 = 1;
    strcat((char *)&str, "   ");
    while (v3 < 16) {
        // 0x80486e0
        v3++;
        strcat((char *)&str, "   ");
        // continue -> 0x80486e0
    }
    // 0x8048700
    len = strlen((char *)&str);
    strcpy((char *)&str2, "  |");
    if (v2 <= 0) {
        a3 = 0;
        *(char *)(a3 + len + v1) = 32;
        v4 = a3 + 1;
        while (v4 < 16) {
            // 0x8048790
            a3 = v4;
            *(char *)(a3 + len + v1) = 32;
            v4 = a3 + 1;
            // continue -> 0x8048790
        }
        // 0x80487b0
        strcpy((char *)(len + v1 + 16), "|");
        return printf("%s\n", &str);
    }
    // 0x8048740
    v6 = 0;
    // branch -> 0x8048740
    while (true) {
        // 0x8048740
        v5 = (char *)(v6 + a1);
        if (*v5 > 126) {
            v7 = 46;
            goto lab_0x8048772_2;
        }
        goto lab_0x804875f_2;
    }
}

// Address range: 0x80487f0 - 0x80488d9
int32_t function_80487f0(char * str) {
    int32_t v1 = (int32_t)str;
    g1 = v1;
    int32_t v2;
    int32_t v3;
    if (function_8048950(v1, (int32_t)&v2, v3) == 0) {
        // 0x804880c
        perror(str);
        // branch -> 0x80488d0
        // 0x80488d0
        return 1;
    }
    struct _IO_FILE * file = fopen(str, "rb"); // 0x8048839
    int32_t result; // 0x80488d3_2
    if (file == NULL) {
        // 0x804884c
        perror(str);
        result = 1;
        // branch -> 0x80488d0
    } else {
        // 0x8048867
        uint32_t v4;
        if (v4 != 0) {
            int32_t v5 = 0;
            // branch -> 0x8048880
            while (true) {
                // 0x8048880
                int32_t data;
                int32_t items_read = fread((char *)&data, 1, 16, file); // 0x804888c
                if (items_read != 0) {
                    // 0x80488a0
                    function_8048660((int32_t)&data, v5, items_read);
                    int32_t v6 = items_read + v5; // 0x80488b7
                    if (v4 <= v6) {
                        // break -> 0x80488c0
                        break;
                    }
                    v5 = v6;
                    // continue -> 0x8048880
                    continue;
                }
            }
            // 0x80488c0
            fclose(file);
            // branch -> 0x80488d0
            // 0x80488d0
            return 0;
        }
        // 0x80488c0
        fclose(file);
        result = 0;
        // branch -> 0x80488d0
    }
    // 0x80488d0
    return result;
}

// Address range: 0x80488da - 0x80488df
int32_t function_80488da(int32_t a1) {
    // 0x80488da
    return 0;
}

// Address range: 0x80488e0 - 0x8048949
int32_t function_80488e0(uint32_t a1, int32_t a2) {
    // 0x80488e0
    if (a1 <= 1) {
        // 0x8048930
        return 0;
    }
    int32_t v1 = 1;
    int32_t result = function_80487f0((char *)*(int32_t *)(4 * v1 + a2)); // 0x804891d
    int32_t v2 = v1 + 1; // 0x8048920
    while (v2 < a1) {
        // 0x8048900
        v1 = v2;
        int32_t v3 = *(int32_t *)(4 * v1 + a2); // 0x804890f
        result += function_80487f0((char *)v3);
        v2 = v1 + 1;
        // continue -> 0x8048900
    }
    // 0x8048930
    return result;
}

// Address range: 0x804894a - 0x804894f
int32_t function_804894a(int32_t a1) {
    // 0x804894a
    return 0;
}

// Address range: 0x8048950 - 0x804897f
int32_t function_8048950(int32_t a1, int32_t a2, int32_t a3) {
    int32_t v1 = g3; // 0x8048953
    int32_t v2 = g2; // 0x8048954
    _xstat(1, a1, a2, v2, v1);
    g2 = v2;
    g3 = v1;
    return g1;
}

// Address range: 0x8048980 - 0x80489a6
void function_8048980(void) {
    int32_t v1 = g2; // 0x8048983
    g2 = &g5;
    int32_t v2 = g5;
    if (v2 == -1) {
        // 0x80489a0
        g2 = v1;
        return;
    }
    g1 = v2;
    ((int32_t (*)())v2)();
    int32_t v3 = g2 - 4; // 0x8048998
    g2 = v3;
    int32_t v4 = *(int32_t *)v3; // 0x804899b
    while (v4 != -1) {
        // 0x8048994
        v2 = v4;
        g1 = v2;
        ((int32_t (*)())v2)();
        v3 = g2 - 4;
        g2 = v3;
        v4 = *(int32_t *)v3;
        // continue -> 0x8048994
    }
    // 0x80489a0
    g2 = v1;
}

// Address range: 0x80489a7 - 0x80489b7
int32_t function_80489a7(int32_t a1) {
    // 0x80489a7
    return g3;
}

// Address range: 0x80489c0 - 0x80489c7
void _fini(void) {
    // 0x80489c0
    function_8048620();
}

// --------------- Dynamically Linked Functions ---------------

// void __libc_init(const struct ProgramVars * vars, void(* atfork_prepare)(void), void(* atfork_parent)(void), void(* atfork_child)(void), const char ** apple);
// void __setfpucw(int32_t a1, int32_t a2, int32_t a3, int32_t a4);
// void _xstat(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5);
// int atexit(void(* func)(void));
// void exit(int status);
// int fclose(FILE * stream);
// FILE * fopen(const char * restrict filename, const char * restrict modes);
// size_t fread(void * restrict ptr, size_t size, size_t n, FILE * restrict stream);
// void perror(const char * s);
// int printf(const char * restrict format, ...);
// int sprintf(char * restrict s, const char * restrict format, ...);
// char * strcat(char * restrict dest, const char * restrict src);
// char * strcpy(char * restrict dest, const char * restrict src);
// size_t strlen(const char * s);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (x86_64-unknown-linux-gnu) (4.7.2)
// Detected functions: 17
// Decompiler release: VERSION
// Decompilation date: DATE
