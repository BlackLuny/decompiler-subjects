//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/stat.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

struct stat {
    int32_t e0;
    int32_t e1;
    int32_t e2;
    int32_t e3;
    int32_t e4;
    int32_t e5;
    int32_t e6;
    int32_t e7;
    int32_t e8;
    int32_t e9;
    int32_t e10;
    int32_t e11;
    int32_t e12;
    int32_t e13;
    int32_t e14;
    int32_t e15;
    int32_t e16;
    int32_t e17;
    int32_t e18;
    int32_t e19;
};

// ------------------- Function Prototypes --------------------

int32_t dumpline(int32_t a1, int32_t a2, int32_t a3);
int32_t hexdump(char * path);

// ------------------------ Functions -------------------------

// Address range: 0x8048660 - 0x80487ef
int32_t dumpline(int32_t a1, int32_t a2, int32_t a3) {
    int32_t str;
    int32_t v1 = &str; // 0x8048670_0
    sprintf((char *)&str, "%08lX:", a2);
    int32_t v2 = a3 > 16 ? 16 : a3;
    int32_t v3; // 0x80486d3
    int32_t v4; // 0x804879d
    int32_t v5; // 0x8048743
    char * v6; // 0x804874f_0
    int32_t len; // 0x8048704
    int32_t str2;
    int32_t v7;
    int32_t v8;
    char v9;
    if (v2 > 0) {
        // branch -> 0x80486a0
        for (int32_t i = 0; i < v2; i++) {
            unsigned char v10 = *(char *)(i + a1); // 0x80486a6
            sprintf((char *)(v1 + 9 + 3 * i), " %02lX", (int32_t)v10);
            // continue -> 0x80486a0
        }
        // 0x8048690
        if (a3 >= 16 || -a3 <= -16) {
            // 0x8048700
            len = strlen((char *)&str);
            strcpy((char *)&str2, "  |");
            if (v2 <= 0) {
                // 0x8048700
                // branch -> 0x8048790
                // 0x8048790
                v7 = 0;
                *(char *)(len + v1 + v7) = 32;
                v4 = v7 + 1;
                // branch -> 0x8048790
                while (v4 < 16) {
                    // 0x8048790
                    v7 = v4;
                    *(char *)(len + v1 + v7) = 32;
                    v4 = v7 + 1;
                    // continue -> 0x8048790
                }
                // 0x80487b0
                strcpy((char *)(len + v1 + 16), "|");
                return printf("%s\n", &str);
            }
            // 0x8048740
            v5 = len + v1;
            v8 = 0;
            // branch -> 0x8048740
            while (true) {
                // 0x8048740
                v6 = (char *)(v8 + a1);
                v9 = 46;
                if (*v6 <= 126) {
                  lab_0x804875f_2:
                    // 0x804875f
                    v9 = *v6;
                    // branch -> 0x8048772
                }
              lab_0x8048772_2:
                // 0x8048772
                *(char *)(v5 + v8) = v9;
                int32_t v11 = v8 + 1; // 0x8048775
                if (v2 <= v11) {
                    // break -> 0x804872c
                    break;
                }
                v8 = v11;
                // continue -> 0x8048740
            }
            // 0x804872c
            int32_t v12;
            if (-a3 > -16) {
                // 0x8048780
                if (a3 < 16) {
                    // 0x8048790
                    v7 = a3;
                    *(char *)(v5 + v7) = 32;
                    v4 = v7 + 1;
                    // branch -> 0x8048790
                    while (v4 < 16) {
                        // 0x8048790
                        v7 = v4;
                        *(char *)(v5 + v7) = 32;
                        v4 = v7 + 1;
                        // continue -> 0x8048790
                    }
                    // 0x80487b0
                    strcpy((char *)(len + v1 + 16), "|");
                    return printf("%s\n", &str);
                }
                v12 = a3;
            } else {
                v12 = 16;
            }
            // 0x80487b0
            strcpy((char *)(len + v1 + v12), "|");
            return printf("%s\n", &str);
        }
        v3 = a3 + 1;
        strcat((char *)&str, "   ");
        while (v3 < 16) {
            // 0x80486e0
            v3++;
            strcat((char *)&str, "   ");
            // continue -> 0x80486e0
        }
        // 0x8048700
        len = strlen((char *)&str);
        strcpy((char *)&str2, "  |");
        if (v2 <= 0) {
            // 0x8048700
            // branch -> 0x8048790
            // 0x8048790
            v7 = 0;
            *(char *)(len + v1 + v7) = 32;
            v4 = v7 + 1;
            // branch -> 0x8048790
            while (v4 < 16) {
                // 0x8048790
                v7 = v4;
                *(char *)(len + v1 + v7) = 32;
                v4 = v7 + 1;
                // continue -> 0x8048790
            }
            // 0x80487b0
            strcpy((char *)(len + v1 + 16), "|");
            return printf("%s\n", &str);
        }
        // 0x8048740
        v5 = len + v1;
        v8 = 0;
        // branch -> 0x8048740
        while (true) {
            // 0x8048740
            v6 = (char *)(v8 + a1);
            if (*v6 > 126) {
                v9 = 46;
                goto lab_0x8048772_2;
            }
            goto lab_0x804875f_2;
        }
    }
    v3 = 1;
    strcat((char *)&str, "   ");
    while (v3 < 16) {
        // 0x80486e0
        v3++;
        strcat((char *)&str, "   ");
        // continue -> 0x80486e0
    }
    // 0x8048700
    len = strlen((char *)&str);
    strcpy((char *)&str2, "  |");
    if (v2 <= 0) {
        // 0x8048700
        // branch -> 0x8048790
        // 0x8048790
        v7 = 0;
        *(char *)(len + v1 + v7) = 32;
        v4 = v7 + 1;
        // branch -> 0x8048790
        while (v4 < 16) {
            // 0x8048790
            v7 = v4;
            *(char *)(len + v1 + v7) = 32;
            v4 = v7 + 1;
            // continue -> 0x8048790
        }
        // 0x80487b0
        strcpy((char *)(len + v1 + 16), "|");
        return printf("%s\n", &str);
    }
    // 0x8048740
    v5 = len + v1;
    v8 = 0;
    // branch -> 0x8048740
    while (true) {
        // 0x8048740
        v6 = (char *)(v8 + a1);
        if (*v6 > 126) {
            v9 = 46;
            goto lab_0x8048772_2;
        }
        goto lab_0x804875f_2;
    }
}

// Address range: 0x80487f0 - 0x80488d9
int32_t hexdump(char * path) {
    int32_t buf;
    if (stat(path, (struct stat *)&buf) == 0) {
        // 0x804880c
        perror(path);
        // branch -> 0x80488d0
        // 0x80488d0
        return 1;
    }
    struct _IO_FILE * file = fopen(path, "rb"); // 0x8048839
    int32_t result; // 0x80488d3_2
    if (file == NULL) {
        // 0x804884c
        perror(path);
        result = 1;
        // branch -> 0x80488d0
    } else {
        // 0x8048867
        uint32_t v1;
        if (v1 != 0) {
            int32_t v2 = 0;
            // branch -> 0x8048880
            while (true) {
                // 0x8048880
                int32_t data;
                int32_t items_read = fread((char *)&data, 1, 16, file); // 0x804888c
                if (items_read != 0) {
                    // 0x80488a0
                    dumpline((int32_t)&data, v2, items_read);
                    int32_t v3 = items_read + v2; // 0x80488b7
                    if (v1 <= v3) {
                        // break -> 0x80488c0
                        break;
                    }
                    v2 = v3;
                    // continue -> 0x8048880
                    continue;
                }
            }
            // 0x80488c0
            fclose(file);
            // branch -> 0x80488d0
            // 0x80488d0
            return 0;
        }
        // 0x80488c0
        fclose(file);
        result = 0;
        // branch -> 0x80488d0
    }
    // 0x80488d0
    return result;
}

// Address range: 0x80488e0 - 0x8048949
int main(int argc, char ** argv) {
    // 0x80488e0
    if (argc <= 1) {
        // 0x8048930
        return 0;
    }
    int32_t v1 = 1;
    int32_t v2 = *(int32_t *)(4 * v1 + (int32_t)argv); // 0x804890f
    int32_t result = hexdump((char *)v2); // 0x804891d
    int32_t v3 = v1 + 1; // 0x8048920
    // branch -> 0x8048900
    while (v3 < argc) {
        // 0x8048900
        v1 = v3;
        v2 = *(int32_t *)(4 * v1 + (int32_t)argv);
        result += hexdump((char *)v2);
        v3 = v1 + 1;
        // continue -> 0x8048900
    }
    // 0x8048930
    return result;
}

// --------------- Statically Linked Functions ----------------

// int stat(const char * restrict file, struct stat * restrict buf);

// --------------- Dynamically Linked Functions ---------------

// int fclose(FILE * stream);
// FILE * fopen(const char * restrict filename, const char * restrict modes);
// size_t fread(void * restrict ptr, size_t size, size_t n, FILE * restrict stream);
// void perror(const char * s);
// int printf(const char * restrict format, ...);
// int sprintf(char * restrict s, const char * restrict format, ...);
// char * strcat(char * restrict dest, const char * restrict src);
// char * strcpy(char * restrict dest, const char * restrict src);
// size_t strlen(const char * s);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (x86_64-unknown-linux-gnu) (4.7.2)
// Detected functions: 3
// Decompiler release: VERSION
// Decompilation date: DATE
