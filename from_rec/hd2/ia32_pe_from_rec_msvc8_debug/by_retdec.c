//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

struct _stat64i32 {
    int32_t e0;
    int16_t e1;
    int16_t e2;
    int16_t e3;
    int16_t e4;
    int16_t e5;
    int32_t e6;
    int32_t e7;
    int64_t e8;
    int64_t e9;
    int64_t e10;
};

// ------------------- Function Prototypes --------------------

int32_t function_411410(int32_t a1, int32_t a2, int32_t i);
int32_t function_4116a0(char * str);
int32_t function_411860(char * a1, struct _stat64i32 * a2);
void function_411970(int32_t a1);
int32_t function_4119c0(void);

// --------------------- Global Variables ---------------------

int32_t g1 = 0; // ebp
int32_t g2 = 0; // ecx
int32_t g3 = 0; // edi
int32_t g4 = 0; // edx
int32_t g5 = 0; // esi
int32_t g6 = 1; // 0x411600
int32_t g7 = 2; // 0x4117dc
int32_t g8 = -0x44bf19b2; // 0x417000

// ------------------------ Functions -------------------------

// Address range: 0x411410 - 0x4115fc
int32_t function_411410(int32_t a1, int32_t a2, int32_t i) {
    int32_t v1;
    g1 = &v1;
    int32_t v2 = g3; // bp-328
    int32_t v3 = &v2; // 0x41141b_0
    int32_t v4;
    g3 = &v4;
    memset((char *)&v4, -0x33333334, 78);
    int32_t v5;
    int32_t v6 = &v5; // 0x411433_2
    int32_t str;
    sprintf((char *)&str, "%08lX:", a2);
    __RTC_CheckEsp();
    int32_t v7 = i > 16 ? 16 : i;
    int32_t v8; // 0x411539
    int32_t v9; // 0x411570
    int32_t len; // 0x4114f3
    int32_t v10;
    int32_t v11;
    char * v12;
    int32_t chars_printed;
    if (v7 > 0) {
        // branch -> 0x41147e
        for (int32_t i = 0; i < v7; i++) {
            unsigned char v13 = *(char *)(i + a1); // 0x411484
            int32_t v14 = 3 * i; // 0x411492
            g4 = v14;
            sprintf((char *)(v14 - 79 + g1), " %02lX", (int32_t)v13);
            __RTC_CheckEsp();
            // continue -> 0x41147e
        }
        // 0x411476
        if (-i > -16) {
            // 0x4114ac
            v4 = (int32_t)(i > 15) ^ 1;
            if (i <= 15) {
                for (int32_t i = i + 1; i < 17; i++) {
                    // 0x4114dc
                    strcat((char *)&str, "   ");
                    v4 = (int32_t)(i > 15) ^ 1;
                    // continue -> 0x4114dc
                }
                // 0x4114ef
                len = strlen((char *)&str);
                strcpy((char *)(len - 88 + g1), "  |");
                if (v7 <= 0) {
                    // 0x4114ef
                    // branch -> 0x411585
                    // branch -> 0x411585
                    for (int32_t i = 0; i < 16; i++) {
                        // 0x411585
                        *(char *)(len - 85 + i + g1) = 32;
                        // continue -> 0x411585
                    }
                    // 0x41159b
                    strcpy((char *)(len - 69 + g1), "|");
                    g5 = v3;
                    chars_printed = printf("%s\n", (char *)(g1 - 88));
                    __RTC_CheckEsp();
                    g2 = g1;
                    g4 = &g6;
                    function_4119c0();
                    g3 = v2;
                    g2 = g1 ^ v6;
                    function_411970(v4);
                    __RTC_CheckEsp();
                    g1 = v1;
                    return chars_printed;
                }
                // 0x411536
                v9 = len - 85;
                v11 = 0;
                // branch -> 0x411536
                while (true) {
                    // 0x411536
                    v8 = v11 + a1;
                    v12 = (char *)v8;
                    v10 = 46;
                    if (*v12 >= 32) {
                      lab_0x411544_3:
                        // 0x411544
                        g4 = v8;
                        if (*v12 <= 126) {
                            int32_t v15 = (int32_t)*v12; // 0x411558
                            g4 = v15;
                            v10 = v15;
                            // branch -> 0x41156d
                        } else {
                            v10 = 46;
                        }
                    }
                  lab_0x41156d_3:
                    // 0x41156d
                    v4 = v10;
                    *(char *)(v9 + v11 + g1) = (char)v10;
                    int32_t v16 = v11 + 1; // 0x411528
                    if (v16 >= v7) {
                        // break -> 0x41152e
                        break;
                    }
                    v11 = v16;
                    // continue -> 0x411536
                }
                // 0x41152e
                if (-i > -16) {
                    // 0x41157f
                    if (i <= 15) {
                        *(char *)(v9 + i + g1) = 32;
                        // branch -> 0x411585
                        while (i <= 14) {
                            // 0x411585
                            i++;
                            *(char *)(v9 + i + g1) = 32;
                            // continue -> 0x411585
                        }
                        // 0x41159b
                        strcpy((char *)(len - 69 + g1), "|");
                        g5 = v3;
                        chars_printed = printf("%s\n", (char *)(g1 - 88));
                        __RTC_CheckEsp();
                        g2 = g1;
                        g4 = &g6;
                        function_4119c0();
                        g3 = v2;
                        g2 = g1 ^ v6;
                        function_411970(v4);
                        __RTC_CheckEsp();
                        g1 = v1;
                        return chars_printed;
                    }
                } else {
                    i = 16;
                }
                // 0x41159b
                strcpy((char *)(len - 85 + i + g1), "|");
                g5 = v3;
                chars_printed = printf("%s\n", (char *)(g1 - 88));
                __RTC_CheckEsp();
                g2 = g1;
                g4 = &g6;
                function_4119c0();
                g3 = v2;
                g2 = g1 ^ v6;
                function_411970(v4);
                __RTC_CheckEsp();
                g1 = v1;
                return chars_printed;
            }
        } else {
            // 0x4114ac
            v4 = 0;
            // branch -> 0x4114ef
        }
        // 0x4114ef
        len = strlen((char *)&str);
        strcpy((char *)(len - 88 + g1), "  |");
        if (v7 <= 0) {
            // 0x4114ef
            // branch -> 0x411585
            // branch -> 0x411585
            for (int32_t i = 0; i < 16; i++) {
                // 0x411585
                *(char *)(len - 85 + i + g1) = 32;
                // continue -> 0x411585
            }
            // 0x41159b
            strcpy((char *)(len - 69 + g1), "|");
            g5 = v3;
            chars_printed = printf("%s\n", (char *)(g1 - 88));
            __RTC_CheckEsp();
            g2 = g1;
            g4 = &g6;
            function_4119c0();
            g3 = v2;
            g2 = g1 ^ v6;
            function_411970(v4);
            __RTC_CheckEsp();
            g1 = v1;
            return chars_printed;
        }
        // 0x411536
        v9 = len - 85;
        v11 = 0;
        // branch -> 0x411536
        while (true) {
            // 0x411536
            v8 = v11 + a1;
            v12 = (char *)v8;
            if (*v12 < 32) {
                v10 = 46;
                goto lab_0x41156d_3;
            }
            goto lab_0x411544_3;
        }
    } else {
        // 0x4114ac
        v4 = 1;
        // branch -> 0x4114dc
        for (int32_t i = 1; i < 17; i++) {
            // 0x4114dc
            strcat((char *)&str, "   ");
            v4 = (int32_t)(i > 15) ^ 1;
            // continue -> 0x4114dc
        }
        // 0x4114ef
        len = strlen((char *)&str);
        strcpy((char *)(len - 88 + g1), "  |");
        if (v7 <= 0) {
            // 0x4114ef
            // branch -> 0x411585
            // branch -> 0x411585
            for (int32_t i = 0; i < 16; i++) {
                // 0x411585
                *(char *)(len - 85 + i + g1) = 32;
                // continue -> 0x411585
            }
            // 0x41159b
            strcpy((char *)(len - 69 + g1), "|");
            g5 = v3;
            chars_printed = printf("%s\n", (char *)(g1 - 88));
            __RTC_CheckEsp();
            g2 = g1;
            g4 = &g6;
            function_4119c0();
            g3 = v2;
            g2 = g1 ^ v6;
            function_411970(v4);
            __RTC_CheckEsp();
            g1 = v1;
            return chars_printed;
        }
        // 0x411536
        v9 = len - 85;
        v11 = 0;
        // branch -> 0x411536
        while (true) {
            // 0x411536
            v8 = v11 + a1;
            v12 = (char *)v8;
            if (*v12 < 32) {
                v10 = 46;
                goto lab_0x41156d_3;
            }
            goto lab_0x411544_3;
        }
    }
}

// Address range: 0x4116a0 - 0x4117db
int32_t function_4116a0(char * str) {
    int32_t v1;
    int32_t v2 = &v1; // 0x4116a0_0
    int32_t v3 = g5; // 0x4116aa
    int32_t v4 = g3; // bp-328
    int32_t v5 = &v4; // 0x4116ab_0
    int32_t v6;
    g3 = &v6;
    memset((char *)&v6, -0x33333334, 78);
    int32_t v7;
    int32_t v8 = &v7; // 0x4116c3_2
    int32_t v9;
    int32_t v10 = function_411860(str, (struct _stat64i32 *)&v9); // 0x4116d0
    g5 = v5;
    if (v10 != 0) {
        // 0x4116dc
        perror(str);
        __RTC_CheckEsp();
        // branch -> 0x4117ac
        // 0x4117ac
        g2 = v2;
        g4 = &g7;
        function_4119c0();
        g3 = v4;
        g5 = v3;
        g2 = g1 ^ v8;
        function_411970(v6);
        __RTC_CheckEsp();
        return (int32_t)(char *)1;
    }
    struct _IO_FILE * file = fopen(str, "rb"); // 0x411707
    __RTC_CheckEsp();
    char * v11; // 0x4117af
    if (file == NULL) {
        // 0x411720
        g5 = v5;
        perror(str);
        __RTC_CheckEsp();
        v11 = (char *)1;
        // branch -> 0x4117ac
    } else {
        // 0x411744
        uint32_t v12;
        if (v12 != 0) {
            // 0x41174c
            int32_t data;
            int32_t v13 = &data; // 0x411756_0
            int32_t v14 = 0;
            // branch -> 0x41174c
            while (true) {
                // 0x41174c
                g5 = v5;
                int32_t items_read = fread((char *)&data, 1, 16, file); // 0x41175a
                __RTC_CheckEsp();
                if (items_read != 0) {
                    // 0x411775
                    g4 = v13;
                    function_411410(v13, v14, items_read);
                    int32_t v15 = items_read + v14; // 0x41178c
                    if (v15 >= v12) {
                        // break -> 0x411794
                        break;
                    }
                    v14 = v15;
                    // continue -> 0x41174c
                    continue;
                }
            }
            // 0x411794
            g5 = v5;
            fclose(file);
            __RTC_CheckEsp();
            // branch -> 0x4117ac
            // 0x4117ac
            g2 = v2;
            g4 = &g7;
            function_4119c0();
            g3 = v4;
            g5 = v3;
            g2 = g1 ^ v8;
            function_411970(v6);
            __RTC_CheckEsp();
            return (int32_t)NULL;
        }
        // 0x411794
        g5 = v5;
        fclose(file);
        __RTC_CheckEsp();
        v11 = NULL;
        // branch -> 0x4117ac
    }
    // 0x4117ac
    g2 = v2;
    g4 = &g7;
    function_4119c0();
    g3 = v4;
    g5 = v3;
    g2 = g1 ^ v8;
    function_411970(v6);
    __RTC_CheckEsp();
    return (int32_t)v11;
}

// Address range: 0x411860 - 0x4118bf
int32_t function_411860(char * a1, struct _stat64i32 * a2) {
    int32_t v1;
    memset((char *)&v1, -0x33333334, 48);
    int32_t result = _stat64i32(a1, a2); // 0x411888
    __RTC_CheckEsp();
    __RTC_CheckEsp();
    int32_t v2;
    g1 = v2;
    return result;
}

// Address range: 0x4118c0 - 0x41194b
int main(int argc, char ** argv) {
    int32_t v1;
    g3 = &v1;
    memset((char *)&v1, -0x33333334, 54);
    if (argc <= 1) {
        // 0x411919
        __RTC_CheckEsp();
        return 0;
    }
    int32_t v2 = 1;
    int32_t v3 = *(int32_t *)(4 * v2 + (int32_t)argv); // 0x411905
    int32_t result = function_4116a0((char *)v3); // 0x411911
    // branch -> 0x4118ff
    while (v2 + 1 < argc) {
        // 0x4118ff
        v2++;
        v3 = *(int32_t *)(4 * v2 + (int32_t)argv);
        result += function_4116a0((char *)v3);
        // continue -> 0x4118ff
    }
    // 0x411919
    __RTC_CheckEsp();
    return result;
}

// Address range: 0x411970 - 0x41198f
void function_411970(int32_t a1) {
    // 0x411970
    if (g2 == g8) {
        // 0x411978
        return;
    }
    // 0x41197a
    __report_gsfailure();
}

// Address range: 0x4119c0 - 0x411a3f
int32_t function_4119c0(void) {
    int32_t v1 = g1; // bp-4
    int32_t v2 = 0; // edi
    int32_t v3 = g1; // 0x411a1d
    if (*(int32_t *)g4 > 0) {
        int32_t v4 = 0; // 0x411a0a13
        int32_t v5 = g2; // 0x4119ed
        int32_t v6 = 0; // 0x4119f9
        int32_t v7 = g4; // 0x4119f6
        while (true) {
            int32_t v8 = *(int32_t *)(v7 + 4) + v6; // 0x4119d9
            int32_t v9 = *(int32_t *)v8; // 0x4119d9
            int32_t v10; // 0x411a11
            int32_t v11; // 0x411a0e
            if (*(int32_t *)(v5 - 4 + v9) == -0x33333334) {
                int32_t v12 = *(int32_t *)(*(int32_t *)(v8 + 4) + v9 + v5); // 0x4119ed
                if (v12 != -0x33333334) {
                    // 0x4119f6
                    _qm__RTC_StackFailure__YAXPAXPBD_Z();
                    v10 = g4;
                    v11 = v2;
                    // branch -> 0x411a0a
                } else {
                    v10 = v7;
                    v11 = v6;
                }
            } else {
                // 0x4119f6
                _qm__RTC_StackFailure__YAXPAXPBD_Z();
                v10 = g4;
                v11 = v2;
                // branch -> 0x411a0a
            }
            int32_t result = v4 + 1; // 0x411a0d
            int32_t v13 = v11 + 12; // 0x411a0e
            v2 = v13;
            if (result >= *(int32_t *)v10) {
                // 0x411a18
                // branch -> 0x411a18
                // 0x411a18
                g1 = v1;
                return result;
            }
            // 0x411a0a
            v4 = result;
            v5 = g2;
            v6 = v13;
            v7 = v10;
            // branch -> 0x4119d6
        }
    }
    // 0x411a18
    g1 = v3;
    int32_t result2; // 0x411a119
    return result2;
}

// --------------- Statically Linked Functions ----------------

// void __cdecl __report_gsfailure(void);
// void __RTC_CheckEsp(void);
// void _qm__RTC_StackFailure__YAXPAXPBD_Z(void);

// --------------- Dynamically Linked Functions ---------------

// int __cdecl _stat64i32(_In_z_ char const * FileName, _Out_ struct _stat64i32 * Stat);
// int fclose(FILE * stream);
// FILE * fopen(const char * restrict filename, const char * restrict modes);
// size_t fread(void * restrict ptr, size_t size, size_t n, FILE * restrict stream);
// void perror(const char * s);
// int printf(const char * restrict format, ...);
// int sprintf(char * restrict s, const char * restrict format, ...);
// char * strcat(char * restrict dest, const char * restrict src);
// char * strcpy(char * restrict dest, const char * restrict src);
// size_t strlen(const char * s);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: visual studio 2005/2008/2010 visual c++ (14/15/16)
// Detected functions: 6
// Decompiler release: VERSION
// Decompilation date: DATE
