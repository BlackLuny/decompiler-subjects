//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

struct _stat64i32 {
    int32_t e0;
    int16_t e1;
    int16_t e2;
    int16_t e3;
    int16_t e4;
    int16_t e5;
    int32_t e6;
    int32_t e7;
    int64_t e8;
    int64_t e9;
    int64_t e10;
};

// ------------------- Function Prototypes --------------------

int32_t function_401000(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5, int32_t a6, int32_t a7);
int32_t function_401140(int32_t a1, int32_t a2, int32_t a3, int32_t a4);
int32_t function_40123b(int32_t a1, int32_t a2, int32_t a3);
int32_t function_401795(int32_t a1, uint32_t a2, int32_t a3);

// --------------------- Global Variables ---------------------

int32_t g1 = 0; // eax
int32_t g2 = 0; // ebp
int32_t g3 = 0; // ebx
int32_t g4 = 0; // ecx
int32_t g5 = 0; // edi
int32_t g6 = 0; // esi
int32_t g7 = -0x44bf19b2; // 0x403000

// ------------------------ Functions -------------------------

// Address range: 0x401000 - 0x40113f
int32_t function_401000(int32_t a1, int32_t a2, int32_t a3, int32_t a4, int32_t a5, int32_t a6, int32_t a7) {
    int32_t v1 = 0; // esp
    int32_t v2 = &a1; // 0x401000_3
    int32_t v3;
    int32_t v4 = &v3; // 0x401008_2
    int32_t v5 = g3; // 0x401012
    g3 = 0x2334;
    int32_t v6 = g2; // 0x401019
    g2 = a2;
    int32_t v7 = g6; // 0x40101e
    int32_t v8 = g5; // 0x40101f
    int32_t v9 = g4; // 0x401020
    char * v10 = (char *)v9; // bp-108
    int32_t v11 = (int32_t)&v10;
    int32_t str;
    int32_t v12 = &str; // 0x401021_0
    char * format = "%08lX:"; // bp-112
    int32_t v13 = (int32_t)&format;
    g1 = sprintf((char *)&str, "%08lX:", v9);
    int32_t v14 = g2; // 0x401034
    int32_t v15; // 0x4010a2
    int32_t v16; // 0x4010da
    int32_t v17; // 0x4010b3
    int32_t v18; // eax
    int32_t v19; // ebx
    int32_t v20; // esi
    int32_t v21;
    int32_t v22;
    int32_t v23;
    int32_t v24; // 0x4010a7
    int32_t v25; // 0x4010e9
    int32_t v26; // 0x401088
    int32_t v27; // 0x4010a2
    int32_t v28; // 0x40110a
    int32_t v29; // 0x4010b3
    int32_t v30; // 0x4010d7
    int32_t v31; // 0x4010ec
    int32_t v32; // 0x4010a0
    int32_t v33; // 0x4010bc
    int32_t v34; // 0x4010c4
    int32_t v35; // 0x401085
    if (v14 < 17) {
        // 0x40103e
        g6 = 0;
        if (v14 < 1) {
            // 0x401071
            g4 = 16;
            // branch -> 0x401080
            while (true) {
                // 0x401080
                v35 = g1;
                v26 = &v22;
                // branch -> 0x401085
              lab_0x401085:;
                int32_t v36; // 0x401085
                while (true) {
                    // 0x401085
                    v36 = v26 + 1;
                    int32_t v37 = (int32_t)*(char *)v36 | v35 & -256; // 0x401085
                    g1 = v37;
                    if (v37 == 0) {
                        // break -> 0x40108d
                        break;
                    }
                    v35 = v37;
                    v26 = v36;
                    // continue -> 0x401085
                }
                int32_t v38 = g4 - 1; // 0x40108d
                g4 = v38;
                *(int32_t *)v36 = 0x202020;
                if (v38 == 0) {
                    // break -> 0x401094
                    break;
                }
                // continue -> 0x401080
            }
            // 0x401094
            v27 = v12;
            v32 = (int32_t)*(char *)v27 | g4 & -256;
            v15 = v27 + 1;
            // branch -> 0x4010a0
            while (v32 != 0) {
                // 0x4010a0
                v27 = v15;
                v32 = (int32_t)*(char *)v27 | v32 & -256;
                v15 = v27 + 1;
                // continue -> 0x4010a0
            }
            // 0x4010a7
            v24 = v15 - (int32_t)&v21;
            v18 = v24;
            *(int32_t *)(v24 + 20 + v1) = 0x7c2020;
            v29 = v24;
            v17 = v29 + 3;
            v19 = v17;
            v20 = 0;
            if (g2 < 1) {
                v31 = 0;
                // 0x4010e4
                v25 = 16 - v31;
                v10 = (char *)v25;
                format = (char *)32;
                memset((char *)(v11 + 24 + v17 + v31), 32, v25);
                v28 = v25 + v20;
                // branch -> 0x401100
            } else {
                // 0x4010bc
                v33 = v29 + 23 + v1;
                v30 = 0;
                // branch -> 0x4010c0
                while (true) {
                    // 0x4010c0
                    v34 = (int32_t)*(char *)(a1 + v30);
                    v23 = (v18 & -256 | v34) < 127 ? v34 : 46;
                    v18 = v23;
                    *(char *)(v33 + v30) = (char)v23;
                    v16 = v20 + 1;
                    v20 = v16;
                    if (v16 >= g2) {
                        // 0x4010df
                        if (v16 > 15) {
                            // 0x401100
                            v10 = (char *)&str;
                            format = "%s\n";
                            *(int16_t *)(v13 + 28 + v19 + v16) = 124;
                            g1 = printf(format, v10);
                            g5 = v8;
                            g6 = v7;
                            g2 = v6;
                            g3 = v5;
                            g4 = v4 ^ v2;
                            return function_40123b(a1, str, 0);
                        }
                        // 0x4010df
                        v31 = v16;
                        // branch -> 0x4010e4
                        // 0x4010e4
                        v25 = 16 - v31;
                        v10 = (char *)v25;
                        format = (char *)32;
                        memset((char *)(v11 + 24 + v19 + v31), 32, v25);
                        v28 = v25 + v20;
                        // branch -> 0x401100
                        // 0x401100
                        v10 = (char *)&str;
                        format = "%s\n";
                        *(int16_t *)(v13 + 28 + v19 + v28) = 124;
                        g1 = printf(format, v10);
                        g5 = v8;
                        g6 = v7;
                        g2 = v6;
                        g3 = v5;
                        g4 = v4 ^ v2;
                        return function_40123b(a1, str, 0);
                    }
                  lab_0x4010c0:
                    // 0x4010c0
                    v30 = v16;
                    // branch -> 0x4010c0
                }
            }
            // 0x401100
            v10 = (char *)&str;
            format = "%s\n";
            *(int16_t *)(v13 + 28 + v19 + v28) = 124;
            g1 = printf(format, v10);
            g5 = v8;
            g6 = v7;
            g2 = v6;
            g3 = v5;
            g4 = v4 ^ v2;
            return function_40123b(a1, str, 0);
        }
    } else {
        // 0x40103e
        g2 = 16;
        g6 = 0;
        // branch -> 0x401044
    }
    // 0x401044
    int32_t v39;
    int32_t v40 = &v39; // 0x401044_0
    g5 = v40;
    int32_t v41 = a1; // 0x401050
    g1 = v41;
    int32_t v42 = (int32_t)*(char *)v41; // 0x401054
    g4 = v42;
    v10 = (char *)v42;
    format = " %02lX";
    ((int32_t (*)(int32_t, int32_t, int32_t))g3)(v40, (int32_t)" %02lX", v42);
    int32_t v43 = g6 + 1; // 0x401061
    g6 = v43;
    int32_t v44 = g5 + 3; // 0x401065
    g5 = v44;
    // branch -> 0x401050
    while (v43 < g2) {
        // 0x401050
        v41 = a1;
        g1 = v41;
        v42 = (int32_t)*(char *)(v41 + v43);
        g4 = v42;
        v10 = (char *)v42;
        format = " %02lX";
        ((int32_t (*)(int32_t, int32_t, int32_t))g3)(v44, (int32_t)" %02lX", v42);
        v43 = g6 + 1;
        g6 = v43;
        v44 = g5 + 3;
        g5 = v44;
        // continue -> 0x401050
    }
    // 0x40106c
    if (v43 <= 15) {
        // 0x401071
        g4 = 16 - v43;
        // branch -> 0x401080
        while (true) {
            // 0x401080
            v35 = g1;
            v26 = &v22;
            // branch -> 0x401085
            goto lab_0x401085;
        }
    }
    // 0x401094
    v27 = v12;
    v32 = (int32_t)*(char *)v27 | g4 & -256;
    v15 = v27 + 1;
    // branch -> 0x4010a0
    while (v32 != 0) {
        // 0x4010a0
        v27 = v15;
        v32 = (int32_t)*(char *)v27 | v32 & -256;
        v15 = v27 + 1;
        // continue -> 0x4010a0
    }
    // 0x4010a7
    v24 = v15 - (int32_t)&v21;
    *(int32_t *)(v24 + 20 + v1) = 0x7c2020;
    v29 = v24;
    v17 = v29 + 3;
    v19 = v17;
    v20 = 0;
    if (g2 < 1) {
        v31 = 0;
        // 0x4010e4
        v25 = 16 - v31;
        v10 = (char *)v25;
        format = (char *)32;
        memset((char *)(v11 + 24 + v17 + v31), 32, v25);
        v28 = v25 + v20;
        // branch -> 0x401100
    } else {
        // 0x4010bc
        v33 = v29 + 23 + v1;
        v30 = 0;
        // branch -> 0x4010c0
        while (true) {
            // 0x4010c0
            v34 = (int32_t)*(char *)(a1 + v30);
            v23 = (v24 & -256 | v34) < 127 ? v34 : 46;
            v18 = v23;
            *(char *)(v33 + v30) = (char)v23;
            v16 = v20 + 1;
            v20 = v16;
            if (v16 < g2) {
                goto lab_0x4010c0;
            }
            // 0x4010df
            if (v16 > 15) {
                // 0x401100
                v10 = (char *)&str;
                format = "%s\n";
                *(int16_t *)(v13 + 28 + v19 + v16) = 124;
                g1 = printf(format, v10);
                g5 = v8;
                g6 = v7;
                g2 = v6;
                g3 = v5;
                g4 = v4 ^ v2;
                return function_40123b(a1, str, 0);
            }
            // 0x4010df
            v31 = v16;
            // branch -> 0x4010e4
            // 0x4010e4
            v25 = 16 - v31;
            v10 = (char *)v25;
            format = (char *)32;
            memset((char *)(v11 + 24 + v19 + v31), 32, v25);
            v28 = v25 + v20;
            // branch -> 0x401100
            // 0x401100
            v10 = (char *)&str;
            format = "%s\n";
            *(int16_t *)(v13 + 28 + v19 + v28) = 124;
            g1 = printf(format, v10);
            g5 = v8;
            g6 = v7;
            g2 = v6;
            g3 = v5;
            g4 = v4 ^ v2;
            return function_40123b(a1, str, 0);
        }
    }
    // 0x401100
    v10 = (char *)&str;
    format = "%s\n";
    *(int16_t *)(v13 + 28 + v19 + v28) = 124;
    g1 = printf(format, v10);
    g5 = v8;
    g6 = v7;
    g2 = v6;
    g3 = v5;
    g4 = v4 ^ v2;
    return function_40123b(a1, str, 0);
}

// Address range: 0x401140 - 0x4011ff
int32_t function_401140(int32_t a1, int32_t a2, int32_t a3, int32_t a4) {
    int32_t v1;
    int32_t v2 = &v1; // 0x401140_3
    int32_t v3;
    int32_t v4 = &v3; // 0x401148_2
    int32_t v5 = g3; // 0x40114e
    int32_t v6 = g2; // 0x40114f
    int32_t v7 = g6; // 0x401150
    int32_t v8 = g5; // 0x401151
    int32_t v9 = g4; // 0x401156
    g6 = v9;
    int32_t result; // 0x401180
    if (_stat64i32((char *)v9, (struct _stat64i32 *)&v1) != 0) {
        // 0x401167
        perror((char *)g6);
        g1 = 1;
        g5 = v8;
        g6 = v7;
        g2 = v6;
        g3 = v5;
        g4 = v4 ^ v2;
        result = function_40123b(v1, 0, 0);
        g1 = result;
        return result;
    }
    struct _IO_FILE * file = fopen((char *)g6, "rb"); // 0x40118f
    int32_t file2 = (int32_t)file; // 0x40118f_6
    g1 = file2;
    g5 = file2;
    if (file != NULL) {
        // 0x40119e
        g2 = 0;
        int32_t result2; // 0x4011f3
        uint32_t v10;
        if (v10 == 0) {
            // 0x4011dd
            fclose((struct _IO_FILE *)file2);
            g5 = v8;
            g6 = v7;
            g2 = v6;
            g3 = v5;
            g4 = v4 ^ v2;
            g1 = 0;
            result2 = function_40123b(v1, 0, 0);
            g1 = result2;
            return result2;
        }
        // 0x4011a6
        g3 = 0x235a;
        int32_t v11;
        int32_t v12 = &v11; // 0x4011b3_0
        int32_t v13 = 0x235a; // 0x4011ba
        // branch -> 0x4011b0
        while (true) {
            // 0x4011b0
            g4 = v12;
            ((int32_t (*)(int32_t, int32_t, int32_t, int32_t))v13)(v12, 1, 16, file2);
            int32_t v14 = g1; // 0x4011bc
            g6 = v14;
            if (v14 != 0) {
                // 0x4011c5
                g4 = g2;
                g1 = function_401000(v12, v14, v8, v7, v6, v5, v1);
                int32_t v15 = g6 + g2; // 0x4011d2
                g2 = v15;
                if (v15 < v10) {
                    // 0x4011c5
                    v13 = g3;
                    file2 = g5;
                    // branch -> 0x4011b0
                    continue;
                }
            }
            // 0x4011dd
            // branch -> 0x4011dd
            // 0x4011dd
            fclose((struct _IO_FILE *)g5);
            g5 = v8;
            g6 = v7;
            g2 = v6;
            g3 = v5;
            g4 = v4 ^ v2;
            g1 = 0;
            result2 = function_40123b(v1, 0, 0);
            g1 = result2;
            return result2;
        }
    }
    // 0x401167
    perror((char *)g6);
    g1 = 1;
    g5 = v8;
    g6 = v7;
    g2 = v6;
    g3 = v5;
    g4 = v4 ^ v2;
    result = function_40123b(v1, 0, 0);
    g1 = result;
    return result;
}

// Address range: 0x401200 - 0x40123a
int main(int argc, char ** argv) {
    int32_t v1;
    g2 = &v1;
    int32_t v2 = g4; // 0x401206
    int32_t v3 = g3; // 0x401207
    g3 = argc;
    int32_t v4 = g6; // 0x40120b
    g5 = 0;
    g6 = 1;
    int32_t result = 0; // 0x401232
    if (argc > 1) {
        // 0x401220
        g4 = *(int32_t *)(4 + (int32_t)argv);
        int32_t v5;
        int32_t v6 = function_401140(v4, v3, v2, v5); // 0x401226
        int32_t v7 = g6 + 1; // 0x40122b
        g6 = v7;
        int32_t v8 = g5 + v6; // 0x40122c
        g5 = v8;
        // branch -> 0x401220
        while (v7 < g3) {
            // 0x401220
            g4 = *(int32_t *)(4 * v7 + (int32_t)argv);
            v6 = function_401140(v4, v3, v2, v5);
            v7 = g6 + 1;
            g6 = v7;
            v8 = g5 + v6;
            g5 = v8;
            // continue -> 0x401220
        }
        // 0x401232
        result = v8;
        // branch -> 0x401232
    }
    // 0x401232
    return result;
}

// Address range: 0x40123b - 0x401294
int32_t function_40123b(int32_t a1, int32_t a2, int32_t a3) {
    // 0x40123b
    if (g4 == g7) {
        // 0x401243
        return g1;
    }
    // 0x401245
    __report_gsfailure();
    return g1;
}

// Address range: 0x401795 - 0x4017ef
int32_t function_401795(int32_t a1, uint32_t a2, int32_t a3) {
    int32_t v1 = g2; // 0x4017a2
    int32_t v2 = *(int32_t *)(a1 + 60) + a1; // 0x4017ab
    g4 = v2;
    uint16_t v3 = *(int16_t *)(v2 + 6); // 0x4017b3
    int32_t result = v2 + 24 + (int32_t)*(int16_t *)(v2 + 20); // 0x4017ba
    g1 = result;
    if (v3 == 0) {
        // 0x4017dd
        g1 = 0;
        // branch -> 0x4017df
        // 0x4017df
        g2 = v1;
        return 0;
    }
    int32_t v4 = 0; // 0x4017d5
    // branch -> 0x4017c5
    while (true) {
        uint32_t v5 = *(int32_t *)(result + 12); // 0x4017c5
        g4 = v5;
        if (v5 <= a2) {
            // 0x4017cc
            if (*(int32_t *)(result + 8) + v5 <= a2) {
                goto lab_0x4017d5;
            }
            // 0x4017df
            g2 = v1;
            return result;
        }
      lab_0x4017d5:;
        int32_t v6 = v4 + 1; // 0x4017d5
        int32_t v7 = result + 40; // 0x4017d6
        g1 = v7;
        if (v6 >= (int32_t)v3) {
            // break -> 0x4017dd
            break;
        }
        v4 = v6;
        result = v7;
        // continue -> 0x4017c5
    }
    // 0x4017dd
    g1 = 0;
    // branch -> 0x4017df
    // 0x4017df
    g2 = v1;
    return 0;
}

// --------------- Statically Linked Functions ----------------

// void __cdecl __report_gsfailure(void);

// --------------- Dynamically Linked Functions ---------------

// int __cdecl _stat64i32(_In_z_ char const * FileName, _Out_ struct _stat64i32 * Stat);
// int fclose(FILE * stream);
// FILE * fopen(const char * restrict filename, const char * restrict modes);
// void * memset(void * s, int c, size_t n);
// void perror(const char * s);
// int printf(const char * restrict format, ...);
// int sprintf(char * restrict s, const char * restrict format, ...);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: visual studio 2008 visual c++ (15.00.21022.08)
// Detected functions: 5
// Decompiler release: VERSION
// Decompilation date: DATE
