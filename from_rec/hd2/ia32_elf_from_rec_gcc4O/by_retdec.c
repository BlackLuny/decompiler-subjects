//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/stat.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

struct stat {
    int32_t e0;
    int32_t e1;
    int32_t e2;
    int32_t e3;
    int32_t e4;
    int32_t e5;
    int32_t e6;
    int32_t e7;
    int32_t e8;
    int32_t e9;
    int32_t e10;
    int32_t e11;
    int32_t e12;
    int32_t e13;
    int32_t e14;
    int32_t e15;
    int32_t e16;
    int32_t e17;
    int32_t e18;
    int32_t e19;
};

// ------------------- Function Prototypes --------------------

int32_t dumpline(int32_t a1, int32_t a2, int32_t a3);
int32_t hexdump(struct _IO_FILE * a1);

// --------------------- Global Variables ---------------------

int32_t g1 = 0; // ebx
int32_t g2 = 0; // edi
int32_t g3 = 0; // esi

// ------------------------ Functions -------------------------

// Address range: 0x8048600 - 0x80487ae
int32_t dumpline(int32_t a1, int32_t a2, int32_t a3) {
    int32_t v1;
    int32_t v2 = &v1; // ebp
    int32_t v3 = *(int32_t *)20; // 0x8048610
    int32_t str;
    int32_t v4 = &str; // 0x8048639_0
    __sprintf_chk((char *)&str, 1, 80, "%08lX:", a2);
    int32_t v5 = a3 > 16 ? 16 : a3;
    int32_t v6 = v5; // esi
    int32_t v7; // 0x80486ed
    int32_t v8; // 0x8048728
    int32_t v9; // 0x804872b
    int32_t v10; // 0x804873c
    int32_t v11; // 0x804873f
    int32_t v12; // eax
    int32_t v13; // edx
    int32_t v14; // 0x8048713
    uint32_t v15; // 0x80486c7
    int32_t v16; // 0x8048728
    int32_t v17; // 0x804876f
    unsigned char v18; // 0x8048715
    char v19;
    int32_t v20; // 0x8048701
    int32_t v21; // 0x804870a
    int32_t v22; // 0x8048732
    int32_t v23; // 0x804879425
    int32_t v24; // 0x804879426
    if (v5 < 1) {
        __strcat_chk((char *)&str, "   ", 80);
        v15 = 1;
        while (v15 < 16) {
            // 0x80486ac
            __strcat_chk((char *)&str, "   ", 80);
            v15++;
            // continue -> 0x80486ac
        }
        // 0x80486d2
        v7 = strlen((char *)&str) + 3;
        if (v6 < 1) {
            // 0x80486f7
            v23 = v7;
            // branch -> 0x80486fc
            // 0x80486fc
            v20 = v23 - 108 + v2;
            *(char *)v20 = 32;
            v10 = 1;
            v11 = v20 + 1;
            // branch -> 0x8048739
            while (v10 < 16) {
                // 0x8048739
                *(char *)v11 = 32;
                v10++;
                v11++;
                // continue -> 0x8048739
            }
            // 0x8048747
            *(int16_t *)(v23 + v10 + v4) = 124;
            __printf_chk(1, "%s\n", (char *)v4);
            v17 = *(int32_t *)20;
            if (v17 != v3) {
                // 0x804879f
                __stack_chk_fail();
                // branch -> 0x80487a4
            }
            // 0x80487a4
            return v17 ^ v3;
        }
        v24 = v7;
    } else {
        // 0x804865a
        int32_t v25;
        int32_t v26 = &v25; // 0x804865a_0
        int32_t v27 = a1; // 0x8048664
        unsigned char v28 = *(char *)v27; // 0x8048668
        __sprintf_chk((char *)v26, 1, -1, " %02lX", (int32_t)v28);
        int32_t v29 = 1; // 0x8048690
        int32_t v30 = v26 + 3; // 0x8048693
        // branch -> 0x8048668
        while (v29 < v5) {
            // 0x8048668
            v28 = *(char *)(v27 + v29);
            __sprintf_chk((char *)v30, 1, -1, " %02lX", (int32_t)v28);
            v29++;
            v30 += 3;
            // continue -> 0x8048668
        }
        // 0x804869b
        v6 = v5;
        if (v5 > 15) {
            // 0x8048779
            v24 = strlen((char *)&str) + 3;
            // branch -> 0x8048707
        } else {
            // 0x80486a9
            __strcat_chk((char *)&str, "   ", 80);
            v15 = v5 + 1;
            // branch -> 0x80486ac
            while (v15 < 16) {
                // 0x80486ac
                __strcat_chk((char *)&str, "   ", 80);
                v15++;
                // continue -> 0x80486ac
            }
            // 0x80486d2
            v7 = strlen((char *)&str) + 3;
            if (v6 < 1) {
                // 0x80486f7
                v23 = v7;
                // branch -> 0x80486fc
                // 0x80486fc
                v20 = v23 - 108 + v2;
                *(char *)v20 = 32;
                v10 = 1;
                v11 = v20 + 1;
                // branch -> 0x8048739
                while (v10 < 16) {
                    // 0x8048739
                    *(char *)v11 = 32;
                    v10++;
                    v11++;
                    // continue -> 0x8048739
                }
                // 0x8048747
                *(int16_t *)(v23 + v10 + v4) = 124;
                __printf_chk(1, "%s\n", (char *)v4);
                v17 = *(int32_t *)20;
                if (v17 != v3) {
                    // 0x804879f
                    __stack_chk_fail();
                    // branch -> 0x80487a4
                }
                // 0x80487a4
                return v17 ^ v3;
            }
            v24 = v7;
        }
        // 0x8048707
        v21 = v24 - 108 + v2;
        v13 = v21;
        v12 = 0;
        v14 = v27;
        int32_t v31 = v21; // 0x8048726
        int32_t v32 = 0; // 0x8048715
        // branch -> 0x8048715
        while (true) {
            // 0x8048715
            v18 = *(char *)(v14 + v32);
            v19 = (char)((int32_t)v18 - 32) < 95 ? v18 : 46;
            *(char *)v31 = v19;
            v16 = v12;
            v8 = v16 + 1;
            v12 = v8;
            v9 = v13 + 1;
            v13 = v9;
            if (v8 == v6) {
                // 0x8048732
                v22 = v16 - 14;
                if (v22 == 0 || v22 < 0 ^ (13 - v16 & v8) < 0) {
                    v23 = v24;
                    // 0x80486fc
                    v20 = v8 - 108 + v23 + v2;
                    *(char *)v20 = 32;
                    v10 = v6 + 1;
                    v11 = v20 + 1;
                    // branch -> 0x8048739
                    while (v10 < 16) {
                        // 0x8048739
                        *(char *)v11 = 32;
                        v10++;
                        v11++;
                        // continue -> 0x8048739
                    }
                    // 0x8048747
                    *(int16_t *)(v23 + v10 + v4) = 124;
                    __printf_chk(1, "%s\n", (char *)v4);
                    v17 = *(int32_t *)20;
                    if (v17 != v3) {
                        // 0x804879f
                        __stack_chk_fail();
                        // branch -> 0x80487a4
                    }
                    // 0x80487a4
                    return v17 ^ v3;
                }
                // 0x8048747
                *(int16_t *)(v24 + v8 + v4) = 124;
                __printf_chk(1, "%s\n", (char *)v4);
                v17 = *(int32_t *)20;
                if (v17 != v3) {
                    // 0x804879f
                    __stack_chk_fail();
                    // branch -> 0x80487a4
                }
                // 0x80487a4
                return v17 ^ v3;
            }
          lab_0x8048726:
            // 0x8048726
            v31 = v9;
            v32 = v8;
            // branch -> 0x8048715
        }
    }
    // 0x8048707
    v21 = v24 - 108 + v2;
    v14 = a1;
    // branch -> 0x8048715
    while (true) {
        // 0x8048715
        v18 = *(char *)v14;
        v19 = (char)((int32_t)v18 - 32) < 95 ? v18 : 46;
        *(char *)v21 = v19;
        v16 = 0;
        v8 = v16 + 1;
        v12 = v8;
        v9 = v21 + 1;
        v13 = v9;
        if (v8 != v6) {
            goto lab_0x8048726;
        }
        // 0x8048732
        v22 = v16 - 14;
        if (v22 == 0 || v22 < 0 ^ (13 - v16 & v8) < 0) {
            v23 = v24;
            // 0x80486fc
            v20 = v8 - 108 + v23 + v2;
            *(char *)v20 = 32;
            v10 = v6 + 1;
            v11 = v20 + 1;
            // branch -> 0x8048739
            while (v10 < 16) {
                // 0x8048739
                *(char *)v11 = 32;
                v10++;
                v11++;
                // continue -> 0x8048739
            }
            // 0x8048747
            *(int16_t *)(v23 + v10 + v4) = 124;
            __printf_chk(1, "%s\n", (char *)v4);
            v17 = *(int32_t *)20;
            if (v17 != v3) {
                // 0x804879f
                __stack_chk_fail();
                // branch -> 0x80487a4
            }
            // 0x80487a4
            return v17 ^ v3;
        }
        // 0x8048747
        *(int16_t *)(v24 + v8 + v4) = 124;
        __printf_chk(1, "%s\n", (char *)v4);
        v17 = *(int32_t *)20;
        if (v17 != v3) {
            // 0x804879f
            __stack_chk_fail();
            // branch -> 0x80487a4
        }
        // 0x80487a4
        return v17 ^ v3;
    }
}

// Address range: 0x80487af - 0x804889f
int32_t hexdump(struct _IO_FILE * a1) {
    int32_t v1 = g2; // 0x80487b2
    int32_t v2 = g3; // 0x80487b3
    int32_t v3 = g1; // 0x80487b4
    int32_t str2 = (int32_t)a1; // ebx
    int32_t v4 = *(int32_t *)20; // 0x80487bf
    int32_t v5;
    int32_t v6 = __xstat(3, (char *)a1, (struct stat *)&v5); // 0x80487de
    char * str = (char *)str2;
    if (v6 != 0) {
        // 0x80487e7
        perror(str);
        // branch -> 0x8048884
        // 0x8048884
        if (*(int32_t *)20 != v4) {
            // 0x8048890
            __stack_chk_fail();
            // branch -> 0x8048895
        }
        // 0x8048895
        g1 = v3;
        g3 = v2;
        g2 = v1;
        return 1;
    }
    struct _IO_FILE * file = fopen(str, "rb"); // 0x8048804
    int32_t v7; // eax
    int32_t v8; // bp+211
    if (file == NULL) {
        // 0x8048823
        perror((char *)str2);
        v7 = 1;
        v8 = 1;
        // branch -> 0x8048884
    } else {
        // 0x8048813
        g3 = 0;
        int32_t data;
        g2 = &data;
        uint32_t v9;
        if (v9 != 0) {
            int32_t items_read = fread((char *)&data, 1, 16, file); // 0x804884f26
            g1 = items_read;
            if (items_read != 0) {
                while (true) {
                    // 0x804885a
                    dumpline(g2, g3, items_read);
                    int32_t v10 = g1 + g3; // 0x804886a
                    g3 = v10;
                    if (v9 > v10) {
                        int32_t items_read2 = fread((char *)g2, 1, 16, file); // 0x804884f
                        g1 = items_read2;
                        if (items_read2 == 0) {
                            // break -> 0x8048871
                            break;
                        }
                        items_read = items_read2;
                        // continue -> 0x804885a
                        continue;
                    }
                }
                // 0x8048871
                fclose(file);
                // branch -> 0x8048884
                // 0x8048884
                if (*(int32_t *)20 != v4) {
                    // 0x8048890
                    __stack_chk_fail();
                    // branch -> 0x8048895
                }
                // 0x8048895
                g1 = v3;
                g3 = v2;
                g2 = v1;
                return 0;
            }
        }
        // 0x8048871
        fclose(file);
        v7 = 0;
        v8 = 0;
        // branch -> 0x8048884
    }
    // 0x8048884
    int32_t result; // 0x804889f_2
    if (*(int32_t *)20 != v4) {
        // 0x8048890
        __stack_chk_fail();
        result = v7;
        // branch -> 0x8048895
    } else {
        result = v8;
    }
    // 0x8048895
    g1 = v3;
    g3 = v2;
    g2 = v1;
    return result;
}

// Address range: 0x80488a0 - 0x80488df
int main(int argc, char ** argv) {
    int32_t v1 = (int32_t)argv; // 0x80488ac_0
    g3 = v1;
    g1 = 1;
    g2 = 0;
    if (argc < 2) {
        // 0x80488d4
        return 0;
    }
    int32_t v2 = hexdump((struct _IO_FILE *)*(int32_t *)(4 + v1)); // 0x80488c5
    int32_t result = g2 + v2; // 0x80488ca
    g2 = result;
    int32_t v3 = g1 + 1; // 0x80488cc
    g1 = v3;
    while (argc > v3) {
        // 0x80488bf
        // 0x80488bf
        v2 = hexdump((struct _IO_FILE *)*(int32_t *)(4 * v3 + g3));
        result = g2 + v2;
        g2 = result;
        v3 = g1 + 1;
        g1 = v3;
        // branch -> 0x80488bf
    }
    // 0x80488d4
    return result;
}

// --------------- Dynamically Linked Functions ---------------

// int __printf_chk(int flag, const char * restrict format, ...);
// int __sprintf_chk(char * restrict s, int flag, size_t slen, const char * restrict format, ...);
// void __stack_chk_fail(void);
// char * __strcat_chk(char * restrict s, const char * restrict append, size_t slen);
// int __xstat(int ver, const char * filename, struct stat * stat_buf);
// int fclose(FILE * stream);
// FILE * fopen(const char * restrict filename, const char * restrict modes);
// size_t fread(void * restrict ptr, size_t size, size_t n, FILE * restrict stream);
// void perror(const char * s);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (i686-linux-gcc) (4.5)
// Detected functions: 3
// Decompiler release: VERSION
// Decompilation date: DATE
