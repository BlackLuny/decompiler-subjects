// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401024: void fn00401024(Register byte al, Register word32 ecx, Register word32 edx, Register word32 ebx, Register word32 ebp, Register word32 esi, Register word32 edi)
void fn00401024(byte al, word32 ecx, word32 edx, word32 ebx, word32 ebp, word32 esi, word32 edi)
{
	__outb(dx, al);
	byte al_14;
	byte SZO_17;
	bool S_18;
	byte SCZO_19;
	byte C_22;
	byte ah_23;
	byte FPUF_24;
	word32 ebx_25;
	byte dh_27;
	word16 ax_28;
	byte bl_30;
	struct Eq_24 * ss_31;
	Eq_25 ecx_32;
	struct Eq_26 * es_33;
	byte SO_34;
	byte Z_35;
	struct Eq_29 * cs_36;
	byte ch_37;
	byte dl_38;
	struct Eq_32 * ds_39;
	struct Eq_33 * ebp_21;
	word16 dx_13;
	struct Eq_35 * esi_16;
	struct Eq_36 * edi_20;
	Eq_37 edx_26;
	ptr32 esp_12;
	ui32 eax_15;
	byte cl_149;
	fn00400FB3();
	return;
}

// 004123A7: Register Eq_360 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetProcessHeap();
	GetProcessHeap();
	Eq_366 eax_11 = GetModuleHandleA(&globals->t433D5D);
	Eq_363 eax_28 = CreateFileA(&globals->t433D45, 0x40000000, 0x03, null, 0x03, 0x0127, null);
	GetACP();
	Eq_393 eax_37 = GetProcAddress(eax_11, &globals->t433D33);
	GetProcessHeap();
	GetProcessHeap();
	GetCurrentThreadId();
	GetProcessHeap();
	Eq_363 eax_64 = CreateFileA(&globals->t433D1A, 0x00, 0x06, null, 0x03, 131, null);
	ptr32 esp_199 = fp - 0x48;
	if (eax_64 == (void *) ~0x00)
	{
		Eq_460 eax_115 = eax_37();
		GetVersion();
		Eq_360 eax_130 = GetVersion();
		ptr32 esp_132;
		word32 ebp_133;
		byte SCZO_134;
		word32 eax_135;
		byte Z_136;
		byte SZO_137;
		byte C_138;
		(*((word32) (eax_115 ^ 0xC0000005) + 0x0041249F))();
		*(esp_132 - 0x04) = 0x00;
		*(esp_132 - 0x08) = (HANDLE *) eax_64;
		GetFileSize(*(esp_132 - 0x08), *(esp_132 - 0x04));
		GetVersion();
		*(esp_132 - 0x04) = fp - 0x08;
		GetCurrentProcessId();
		*(esp_132 - 0x08) = 0x40;
		*(esp_132 - 0x0C) = (HANDLE *) eax_28;
		*(esp_132 - 0x10) = 0x00;
		SizeofResource(*(esp_132 - 0x10), *(esp_132 - 0x0C));
		*(esp_132 - 0x0C) = 0x00011084;
		*(esp_132 - 0x10) = 0x00401000;
		GetCommandLineA();
		VirtualProtect(*(esp_132 - 0x10), *(esp_132 - 0x0C), *(esp_132 - 0x08), *(esp_132 - 0x04));
		GetProcessHeap();
		*(esp_132 - 0x04) = (union Eq_460 *) eax_115;
		*(esp_132 - 0x08) = 0x00;
		*(esp_132 - 0x0C) = 0x0121;
		*(esp_132 - 0x10) = 0x03;
		*(esp_132 - 0x14) = 0x00;
		*(esp_132 - 0x18) = 0x07;
		*(esp_132 - 0x1C) = 0x80000000;
		*(esp_132 - 0x20) = 4406631;
		CreateFileA(*(esp_132 - 0x20), *(esp_132 - 0x1C), *(esp_132 - 0x18), *(esp_132 - 0x14), *(esp_132 - 0x10), *(esp_132 - 0x0C), *(esp_132 - 0x08));
		*(esp_132 - 0x08) = 0x00011084;
		*(esp_132 - 0x0C) = 0x00;
		*(esp_132 - 0x10) = (FARPROC *) eax_37;
		GetFileSize(*(esp_132 - 0x10), *(esp_132 - 0x0C));
		*(esp_132 - 0x0C) = 0x00401000;
		GetCurrentProcessId();
		esp_199 = esp_132 - 0x0C;
		dwLoc1C = eax_115;
	}
	GetOEMCP();
	LPDWORD * esp_90 = esp_199 - 0x04;
	*esp_90 = (LPDWORD *) null;
	*(esp_90 - 0x04) = (FARPROC *) eax_37;
	Eq_360 eax_95 = GetFileSize(*(esp_90 - 0x04), *esp_90);
	word32 esp_97;
	word32 ebp_98;
	byte SCZO_99;
	word32 eax_100;
	byte Z_101;
	byte SZO_102;
	byte C_103;
	(dwLoc1C - ~0x4041235D)();
	GetVersion();
	GetVersion();
}

