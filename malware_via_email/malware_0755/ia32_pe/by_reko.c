// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401040: void fn00401040(Stack word32 dwArg04, Stack (ptr Eq_3) dwArg08, Stack (ptr Eq_4) dwArg0C)
void fn00401040(word32 dwArg04, Eq_3 * dwArg08, Eq_4 * dwArg0C)
{
	globals->dw406708 = 0x00;
	while (globals->dw406708 < dwArg0C)
	{
		dwArg04 + globals->dw406708 = dwArg08 + globals->dw406708;
		globals->dw406708 = globals->dw406708 + 0x01;
	}
	return;
}

// 004010E0: Register Eq_28 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	Eq_29 eax_18 = GetModuleHandleA(null);
	LoadIconA(null, (CHAR *) 0x7F00);
	GetWindowsDirectoryA(fp - 332, 300);
	if ((word32) bLoc014B != 0x3A)
		int3();
	lstrcatA(fp - 332, &globals->t4065B4);
	if (CreateFileA(fp - 332, 0x01, 0x03, null, 0x03, 0x80, 0x00) != ~0x00)
	{
		GetWindowsDirectoryA(fp - 332, 300);
		if ((word32) bLoc014B != 0x3A)
			int3();
		lstrcatA(fp - 332, &globals->t4065BC);
		if (CreateFileA(fp - 332, 0x01, 0x03, null, 0x03, 0x80, 0x00) == ~0x00)
		{
			struct Eq_114 * eax_164 = globals->ptr402333;
			word32 edx_167 = globals->dw402337;
			struct Eq_114 * dwLoc08_169 = null;
			while (dwLoc08_169 < eax_164)
			{
				GetModuleHandleA(null);
				dwLoc08_169->dw40233B = dwLoc08_169->dw40233B ^ 22;
				dwLoc08_169 = dwLoc08_169 + 0x01;
			}
			globals->dw406718 = fn00401730(edx_167);
			fn004018F0(4203323, globals->dw406718, eax_164);
			globals->dw40670C = edi;
			globals->dw406704 = esi;
			globals->dw406714 = ebx;
			globals->ptr40671C = fs->ptr0018;
			globals->ptr406710 = fp - 0x04;
			word32 ecx_226 = 4199055 - eax_18;
			word32 ebp_230 = fn00401760(fp - 0x04, ecx_226, eax_18);
			word32 edx_233 = globals->dw406718;
			*(fp - 0x0164) = edx_233;
			word32 eax_237 = fn004012F0(ebp_230, dwArg00);
			word32 esp_245;
			word32 ebp_246;
			byte SCZO_247;
			word32 ebx_248;
			word32 esi_249;
			word32 edi_250;
			Eq_28 eax_251;
			word32 ecx_252;
			byte Z_253;
			word32 edx_254;
			byte SZO_255;
			byte C_256;
			struct Eq_194 * fs_257;
			globals->ptr406720();
			return eax_251;
		}
	}
	return 0x00;
}

// 004012D0: Register Eq_210 fn004012D0(Stack word32 dwArg04, Stack (ptr Eq_3) dwArg08)
FARPROC fn004012D0(word32 dwArg04, Eq_3 * dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

// 004012F0: Register word32 fn004012F0(Register word32 ebp, Stack word32 dwArg04)
word32 fn004012F0(word32 ebp, word32 dwArg04)
{
	Eq_29 eax_9 = GetModuleHandleA(&globals->t4065D4);
	lstrcpyA(fp - 188, &globals->t4065E4);
	Eq_210 eax_24 = GetProcAddress(eax_9, &globals->t4065F8);
	lstrcpyA(fp - 188, &globals->t406608);
	GetProcAddress(eax_9, &globals->t40661C);
	lstrcpyA(fp - 188, &globals->t40662C);
	Eq_210 eax_54 = GetProcAddress(eax_9, &globals->t406634);
	lstrcpyA(fp - 188, &globals->t406648);
	Eq_210 eax_69 = GetProcAddress(eax_9, &globals->t40665C);
	lstrcpyA(fp - 188, &globals->t40666C);
	Eq_210 eax_84 = GetProcAddress(eax_9, &globals->t40667C);
	lstrcpyA(fp - 188, &globals->t40668C);
	GetProcAddress(eax_9, &globals->t4066A4);
	struct Eq_281 * edx_108 = dwArg04 + dwArg04->dw003C / 0x0040;
	struct Eq_287 * dwLoc30_115 = &edx_108->w0014 + 0x02 + (word32) edx_108->w0014 / 22;
	struct Eq_295 * eax_129 = eax_69();
	fn00401040(dwArg00, dwArg04, dwArg08);
	uint32 dwLoc10_155 = 0x00;
	while (dwLoc10_155 < (word32) edx_108->w0006)
	{
		if (dwLoc30_115->dw0014 != 0x00 && dwLoc30_115->dw0010 != 0x00)
			fn00401040(dwArg00, dwArg04, dwArg08);
		dwLoc30_115 = dwLoc30_115 + 0x01;
		dwLoc10_155 = dwLoc10_155 + 0x01;
	}
	struct Eq_309 * ecx_218 = eax_129 + eax_129->dw003C / 0x0040;
	Eq_71 eax_238 = eax_54();
	ptr32 * esp_235 = fp - 244;
	struct Eq_319 * dwLocCC_249 = eax_129 + ecx_218->dw0080 / 0x0040;
	while (dwLocCC_249->dw0010 != 0x00)
	{
		word32 * dwLoc3C_289;
		ui32 * dwLoc2C_288;
		ptr32 * esp_273 = esp_235 - 0x04;
		*esp_273 = eax_129 + dwLocCC_249->dw000C / 0x0040;
		int32 eax_278 = eax_84();
		if (dwLocCC_249->dw0000 != 0x00)
		{
			dwLoc2C_288 = (ui32 *) (eax_129 + dwLocCC_249->dw0000 / 0x0040);
			dwLoc3C_289 = (word32 *) (eax_129 + dwLocCC_249->dw0010 / 0x0040);
		}
		else
		{
			dwLoc2C_288 = (ui32 *) (eax_129 + dwLocCC_249->dw0010 / 0x0040);
			dwLoc3C_289 = (word32 *) (eax_129 + dwLocCC_249->dw0000 / 0x0040);
		}
		word32 dwLoc1C_292 = 0x00;
		if (dwLocCC_249->dw0010 != 0x00 && dwLocCC_249->dw0000 != 0x00)
			dwLoc1C_292 = 0x01;
		while (true)
		{
			esp_235 = esp_273;
			if (*dwLoc2C_288 == 0x00)
				break;
			if ((*dwLoc2C_288 & 0x80000000) != 0x00)
			{
				*(esp_273 - 0x04) = *dwLoc2C_288 & 0x7FFFFFFF;
				*(esp_273 - 0x08) = eax_278;
				*dwLoc2C_288 = fn004012D0(dwArg00, dwArg04);
			}
			else
			{
				*(esp_273 - 0x04) = eax_129 + (*dwLoc2C_288 + 0x02) / 0x0040;
				*(esp_273 - 0x08) = eax_278;
				*dwLoc2C_288 = fn004012D0(dwArg00, dwArg04);
			}
			if (dwLoc1C_292 != 0x00)
				*dwLoc3C_289 = *dwLoc2C_288;
			dwLoc2C_288 = dwLoc2C_288 + 0x01;
			dwLoc3C_289 = dwLoc3C_289 + 0x01;
		}
		dwLocCC_249 = dwLocCC_249 + 0x01;
	}
	word32 eax_420;
	word32 * esp_390 = esp_235 - 0x04;
	*esp_390 = ecx_218->dw0034;
	*(esp_390 - 0x04) = 0x00;
	*(esp_390 - 0x08) = 0x00;
	*(esp_390 - 0x0C) = 0x00;
	*(esp_390 - 0x10) = 0x22;
	*(esp_390 - 0x14) = (union Eq_71 *) eax_238;
	globals->t406700 = eax_24();
	ptr32 esp_403 = esp_390 - 0x14;
	if (globals->t406700 == 0x00)
	{
		*(esp_390 - 0x18) = ecx_218->dw0034;
		if (UnmapViewOfFile(*(esp_390 - 0x18)) == 0x00)
		{
			*(esp_390 - 0x18) = 0x8000;
			*(esp_390 - 0x1C) = 0x00;
			*(esp_390 - 0x20) = ecx_218->dw0034;
			if (VirtualFree(*(esp_390 - 0x20), *(esp_390 - 0x1C), *(esp_390 - 0x18)) == 0x00)
			{
				eax_420 = 0x00;
				return eax_420;
			}
		}
		ptr32 esp_472 = esp_235 - 0x18;
		*(esp_472 - 0x04) = ecx_218->dw0034;
		*(esp_472 - 0x08) = 0x00;
		*(esp_472 - 0x0C) = 0x00;
		*(esp_472 - 0x10) = 0x00;
		*(esp_472 - 0x14) = 0x22;
		*(esp_472 - 0x18) = (union Eq_71 *) eax_238;
		globals->t406700 = MapViewOfFileEx(*(esp_472 - 0x18), *(esp_472 - 0x14), *(esp_472 - 0x10), *(esp_472 - 0x0C), *(esp_472 - 0x08), *(esp_472 - 0x04));
		esp_403 = esp_472;
		if (globals->t406700 == 0x00)
		{
			*(esp_472 - 0x04) = 0x40;
			*(esp_472 - 0x08) = 0x3000;
			*(esp_472 - 0x0C) = (union Eq_71 *) ecx_218->t0050;
			*(esp_472 - 0x10) = ecx_218->dw0034;
			globals->t406700 = VirtualAlloc(*(esp_472 - 0x10), *(esp_472 - 0x0C), *(esp_472 - 0x08), *(esp_472 - 0x04));
			esp_403 = esp_472;
		}
	}
	union Eq_71 * esp_431 = esp_403 - 0x04;
	*esp_431 = (union Eq_71 *) eax_238;
	CloseHandle(*esp_431);
	*esp_431 = (union Eq_71 *) ecx_218->t0050;
	*(esp_431 - 0x04) = (struct Eq_295 **) eax_129;
	*(esp_431 - 0x08) = (union Eq_71 *) globals->t406700;
	fn00401040(dwArg00, dwArg04, dwArg08);
	*esp_431 = (union Eq_71 *) globals->t406700;
	fn004018C0(dwArg00);
	Mem455[4220704:word32] = Mem449[0x00406700:word32] + Mem449[ecx_218 + 0x28:word32];
	ecx_218->ptr0028 = globals->ptr406720;
	eax_420 = 0x01;
	return eax_420;
}

// 00401730: Register Eq_71 fn00401730(Stack word32 dwArg04)
Eq_71 fn00401730(word32 dwArg04)
{
	return VirtualAlloc(0x00, dwArg04, 0x3000, 0x04);
}

// 00401760: Register ptr32 fn00401760(Register ptr32 ebp, Stack word32 dwArg04, Stack Eq_29 dwArg08)
ptr32 fn00401760(ptr32 ebp, word32 dwArg04, HMODULE dwArg08)
{
	struct Eq_772 * edx_16 = dwArg08 + dwArg08->dw003C / 0x0040;
	globals->t406700 = GetProcAddress(GetModuleHandleA(&globals->t4066C0), &globals->t4066B0)();
	if (globals->t406700 != 0x00)
	{
		fn00401040(dwArg00, dwArg04, dwArg08);
		ui32 eax_92 = globals->t406700 - dwArg08;
		if (edx_16->dw00A4 != 0x00)
		{
			struct Eq_818 * dwLoc0C_119 = dwArg08 + edx_16->dw00A0 / 0x0040;
			while (dwLoc0C_119->t0004 != 0x00)
			{
				uint32 eax_134 = dwLoc0C_119->t0004 - 0x08 >> 0x01;
				word16 ecx_137[] = (char *) &dwLoc0C_119->t0004 + 0x04;
				uint32 dwLoc08_140 = 0x00;
				while (dwLoc08_140 < eax_134)
				{
					if ((word32) ecx_137[dwLoc08_140] >> 0x0C == 0x03)
						(word32) globals->t406700 + dwLoc0C_119->dw0000 + ((word32) ecx_137[dwLoc08_140] & 0x0FFF) = (struct Eq_863 *) ((word32) globals->t406700 + dwLoc0C_119->dw0000 + ((word32) ecx_137[dwLoc08_140] & 0x0FFF) + eax_92);
					dwLoc08_140 = dwLoc08_140 + 0x01;
				}
				dwLoc0C_119 = dwLoc0C_119 + Mem87[dwLoc0C_119 + 0x04:word32];
			}
		}
		word32 edx_103 = dwArg04 + Mem87[0x00406700:word32];
		word32 esp_105;
		ptr32 ebp_106;
		byte SCZO_107;
		word32 esi_108;
		word32 eax_109;
		word32 ecx_110;
		word32 edx_111;
		byte Z_112;
		byte C_113;
		byte SZO_114;
		edx_103();
		return ebp_106;
	}
	else
		return ebp;
}

// 004018C0: void fn004018C0(Stack word32 dwArg04)
void fn004018C0(word32 dwArg04)
{
	globals->ptr40671C->ptr0030->dw0008 = dwArg04;
	return;
}

// 004018F0: void fn004018F0(Stack word32 dwArg04, Stack word32 dwArg08, Stack (ptr Eq_114) dwArg0C)
void fn004018F0(word32 dwArg04, word32 dwArg08, Eq_114 * dwArg0C)
{
	Eq_894 cl_12 = (&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&dwArg04->a0000[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00];
	lstrcpyA(fp - 0x94, &globals->t4066DC);
	Eq_905 dwLoc0C_118 = 0x01;
	int32 dwLoc18_124 = 0x00;
	do
	{
		Eq_905 edx_40 = (word32) dwLoc0C_118 + 0x01;
		byte cl_37 = Mem0[dwArg04 + dwLoc0C_118:byte];
		dwLoc0C_118 = edx_40;
		if ((word32) cl_37 == (word32) cl_12)
		{
			if ((word32) Mem0[dwArg04 + edx_40:byte] == 0x00)
			{
				(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&dwArg08[dwLoc18_124].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00] = cl_12;
				dwLoc18_124 = dwLoc18_124 + 0x01;
				dwLoc0C_118 = (word32) edx_40.u0 + 0x01;
			}
			else
			{
				word32 eax_104 = fn00401A10(fp - 0x10, dwArg04 + edx_40) + edx_40;
				dwLoc0C_118 = fn00401A10(fp - 0x20, dwArg04 + eax_104) + eax_104;
				uint32 dwLoc1C_119 = 0x00;
				while (dwLoc1C_119 < dwLoc10)
				{
					(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&dwArg08[dwLoc18_124].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00] = (&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&dwArg08[dwLoc18_124 - dwLoc20].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00];
					dwLoc18_124 = dwLoc18_124 + 0x01;
					dwLoc1C_119 = dwLoc1C_119 + 0x01;
				}
			}
		}
		else
		{
			(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&dwArg08[dwLoc18_124].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00] = (Eq_894) cl_37;
			dwLoc18_124 = dwLoc18_124 + 0x01;
		}
	} while (dwLoc0C_118 < dwArg0C);
	return;
}

// 00401A10: Register word32 fn00401A10(Stack ptr32 dwArg04, Stack ptr32 dwArg08)
word32 fn00401A10(ptr32 dwArg04, ptr32 dwArg08)
{
	lstrcpyA(fp - 0x84, &globals->t4066D0);
	ui32 dwLoc08_19 = 0x00;
	word32 dwLoc10_20 = 0x00;
	do
	{
		ui32 edx_23 = (word32) *dwArg08;
		ui32 edx_33 = edx_23 & 0x7F | dwLoc08_19 << 0x07;
		word32 eax_36 = dwLoc10_20 + 0x01;
		dwArg08 = dwArg08 + 0x01;
		dwLoc08_19 = edx_33;
		dwLoc10_20 = eax_36;
	} while ((edx_23 & 0x80) != 0x00);
	*dwArg04 = edx_33;
	return eax_36;
}

