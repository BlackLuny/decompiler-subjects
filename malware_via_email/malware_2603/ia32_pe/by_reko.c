// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401027: void fn00401027(Register byte al, Register word32 ecx, Register word32 edx, Register word32 ebx, Register word32 ebp, Register word32 edi)
void fn00401027(byte al, word32 ecx, word32 edx, word32 ebx, word32 ebp, word32 edi)
{
fn00401027_entry:
	def esp
	def ebx
	def SZO
	def Mem0
	def edi
	goto l00401027
l0040101A:
	edx_106 = Mem0[esp_20 + 0x00:word32]
	esp_108 = esp_20 + 0x04
	SZO_111 = cond(SLICE(edx_106, byte, 8) & Mem0[edx_106 + 0x00:byte])
	Mem117[esp_108 - 0x04 + 0x00:word32] = edi
	Mem119[esp_108 - 0x08 + 0x00:word32] = ebx_24
	__cli()
	Mem125[esp_108 - 0x0C + 0x00:word32] = 0x17
	ebx_121 = DPB(ebx_24, 0x04, 8) (alias)
	esp_124 = esp_108 - 0x0C
l00401027:
	esp_20 = PHI(esp, esp_124)
	ebx_24 = PHI(ebx, ebx_121)
	SZO_25 = PHI(SZO, SZO_111)
	branch SZO_25 l0040101A
l00401029:
	SCZDOP_30 = Mem0[esp_20 + 0x00:word32]
	branch SCZDOP_30 l0040102C_then
	call fn00400FCB (retsize: 4; depth: 4)
		uses: ah_17,al_27,bh_14,C_34,D_35,dh_15,eax_28,ebx_24,edx_16,esp_36,O_33,SCZDOP_30,SCZO_32,SZO_31
		defs: ah_48,al_39,bh_52,bl_45,C_43,ch_54,cl_56,D_53,dh_50,eax_46,ebp_44,ebx_47,ecx_55,edi_51,edx_49,esi_57,esp_37,O_42,SCZDOP_41,SCZO_40,SZO_38
	return
l0040102C_then:
l0040102E:
	Mem59[esp_37 - 0x04 + 0x00:word32] = ~0x07
	esp_58 = esp_37 - 0x04
	branch O_42 l0040104F
l00401032:
	Mem61[ebp_44 + 0xCCC81D71:byte] = Mem59[ebp_44 + 0xCCC81D71:byte] - bl_45 - C_43
l0040104C:
	(ds_esi_82 + 0x66)[ds_esi_82 * 0x02] = edi_51
	goto l00401050
l0040104F:
	SCZO_68 = cond(ch_54 - 0x00[edx_49 * 0x09])
	O_71 = SCZO_68 (alias)
	C_72 = SCZO_68 (alias)
l00401050:
	al_73 = PHI(al_39, al_84)
	O_75 = PHI(O_71, O_89)
	ebp_76 = PHI(ebp_44, ebp_93)
	esp_77 = PHI(esp_58, esp_94)
	C_80 = PHI(C_72, C_90)
	ds_esi_82 = Mem59[ecx_55 + 0x00:segptr32]
	branch O_75 l00401056
l00401055_1:
l00401056:
	__lock()
	al_84 = al_73 + 0x3A + C_80
	SCZO_86 = cond(al_84)
	esp_91 = esp_77 - 0x04
	Mem92[esp_91 + 0x00:word32] = ebp_76
	O_89 = SCZO_86 (alias)
	C_90 = SCZO_86 (alias)
	ebp_93 = esp_91
	esp_94 = esp_91 - ~0x37BF
	branch ecx_55 == 0x00 l0040104C
l0040105F:
	Mem96[ecx_55 + 1939262115:byte] = __rol(Mem92[ecx_55 + 1939262115:byte], 0x01)
	return
fn00401027_exit:
}

// 004117BE: Register DWORD Win32CrtStartup()
DWORD Win32CrtStartup()
{
	word32 eax_21 = CreateFileA(4397538, 0x40000000, 0x02, 0x00, 0x03, 133, 0x00);
	if (eax_21 == ~0x00)
	{
		GetLastError();
		dwLoc20 = CreateFileW(0x00431A3E, 0x40000000, 0x01, 0x00, 0x03, 0xA2, 0x00);
		GetLastError();
	}
	do
	{
		word32 esp_150;
		word32 esp_196;
		CloseHandle(eax_21);
		GetCommandLineA();
		word32 eax_50 = CreateFileW(0x00431A31, 0x80000000, 0x03, 0x00, 0x03, 0x0122, 0x00);
		word32 esp_335 = fp + ~0x43;
		if (eax_50 != ~0x00)
			goto l004119C5;
		GetCommandLineA();
		GetFileType(dwLoc20);
		word32 eax_393 = CreateFileA(4397579, 0x80000000, 0x00, 0x00, 0x03, 0x82, 0x00);
		dwLoc44 = eax_393;
	} while (eax_393 != ~0x00);
	CloseHandle(dwLoc20);
	GetFileSize(eax_50, 0x00);
	GetFileType(dwLoc20);
	GetFileSize(eax_21, 0x00);
	GetLastError();
	GetFileType(dwLoc20);
	esp_150 = fp + ~0x43;
	dwLoc3C = GetModuleHandleA(4397557);
l00411910:
	word32 esp_366 = esp_150 - 0x04;
	Mem367[esp_366 + 0x00:word32] = 0x00;
	Mem370[esp_366 - 0x04 + 0x00:word32] = eax_50;
	GetFileSize(Mem370[esp_366 - 0x04 + 0x00:HANDLE], Mem370[esp_366 + 0x00:LPDWORD]);
	esp_196 = esp_366 + 0x04;
	do
	{
		word32 esp_274 = esp_196 - 0x04;
		Mem275[esp_274 + 0x00:word32] = 4397661;
		GetLastError();
		GetLastError();
		Mem280[esp_274 - 0x04 + 0x00:word32] = dwLoc3C;
		Mem282[esp_274 - 0x08 + 0x00:word32] = 0x00;
		Mem285[esp_274 - 0x0C + 0x00:word32] = dwLoc44;
		GetFileSize(Mem285[esp_274 - 0x0C + 0x00:HANDLE], Mem285[esp_274 - 0x08 + 0x00:LPDWORD]);
		word32 eax_288 = GetProcAddress(Mem285[esp_274 - 0x04 + 0x00:HMODULE], Mem285[esp_274 + 0x00:LPCSTR]);
		Mem293[esp_274 + 0x00:word32] = dwLoc44;
		CloseHandle(Mem293[esp_274 + 0x00:HANDLE]);
		Mem298[esp_274 + 0x00:word32] = dwLoc20;
		CloseHandle(Mem298[esp_274 + 0x00:HANDLE]);
		Mem302[esp_274 + 0x00:word32] = 0x00;
		Mem304[esp_274 - 0x04 + 0x00:word32] = 0x87;
		Mem306[esp_274 - 0x08 + 0x00:word32] = 0x03;
		Mem308[esp_274 - 0x0C + 0x00:word32] = 0x00;
		Mem310[esp_274 - 0x10 + 0x00:word32] = 0x05;
		Mem312[esp_274 - 0x14 + 0x00:word32] = 0x60000000;
		Mem314[esp_274 - 0x18 + 0x00:word32] = 0x004319C8;
		word32 eax_315 = CreateFileA(Mem314[esp_274 - 0x18 + 0x00:LPCSTR], Mem314[esp_274 - 0x14 + 0x00:DWORD], Mem314[esp_274 - 0x10 + 0x00:DWORD], Mem314[esp_274 - 0x0C + 0x00:LPSECURITY_ATTRIBUTES], Mem314[esp_274 - 0x08 + 0x00:DWORD], Mem314[esp_274 - 0x04 + 0x00:DWORD], Mem314[esp_274 + 0x00:HANDLE]);
		dwLoc38 = eax_315;
		if (eax_315 != ~0x00)
			;
		GetCommandLineA();
		Mem322[esp_274 + 0x00:word32] = 0x00;
		Mem325[esp_274 - 0x04 + 0x00:word32] = dwLoc20;
		GetFileSize(Mem325[esp_274 - 0x04 + 0x00:HANDLE], Mem325[esp_274 + 0x00:LPDWORD]);
		Mem329[esp_274 + 0x00:word32] = 0x00;
		GetLastError();
		Mem332[esp_274 - 0x04 + 0x00:word32] = 0x00;
		esp_335 = esp_274 - 0x04;
		dwLoc2C = eax_288();
l004119C5:
		word32 esp_80 = esp_335 - 0x04;
		Mem81[esp_80 + 0x00:word32] = eax_21;
		GetFileType(Mem81[esp_80 + 0x00:HANDLE]);
		Mem88[esp_80 + 0x00:word32] = 0x00;
		Mem90[esp_80 - 0x04 + 0x00:word32] = 161;
		Mem92[esp_80 - 0x08 + 0x00:word32] = 0x03;
		Mem94[esp_80 - 0x0C + 0x00:word32] = 0x00;
		Mem96[esp_80 - 0x10 + 0x00:word32] = 0x00;
		Mem98[esp_80 - 0x14 + 0x00:word32] = 0x80000000;
		Mem100[esp_80 - 0x18 + 0x00:word32] = 4397489;
		word32 eax_101 = CreateFileW(Mem100[esp_80 - 0x18 + 0x00:LPCWSTR], Mem100[esp_80 - 0x14 + 0x00:DWORD], Mem100[esp_80 - 0x10 + 0x00:DWORD], Mem100[esp_80 - 0x0C + 0x00:LPSECURITY_ATTRIBUTES], Mem100[esp_80 - 0x08 + 0x00:DWORD], Mem100[esp_80 - 0x04 + 0x00:DWORD], Mem100[esp_80 + 0x00:HANDLE]);
		word32 esp_104;
		word32 ebp_105;
		byte SCZO_106;
		word32 eax_107;
		byte Z_108;
		byte SZO_109;
		byte C_110;
		((dwLoc2C ^ 0xC0000008) + 0x00411A20)();
		Mem112[esp_104 - 0x04 + 0x00:word32] = 0x00;
		Mem114[esp_104 - 0x08 + 0x00:word32] = 0x0103;
		Mem116[esp_104 - 0x0C + 0x00:word32] = 0x03;
		Mem118[esp_104 - 0x10 + 0x00:word32] = 0x00;
		Mem120[esp_104 - 0x14 + 0x00:word32] = 0x01;
		Mem122[esp_104 - 0x18 + 0x00:word32] = 0x20000000;
		Mem124[esp_104 - 0x1C + 0x00:word32] = 4397500;
		word32 eax_125 = CreateFileA(Mem124[esp_104 - 0x1C + 0x00:LPCSTR], Mem124[esp_104 - 0x18 + 0x00:DWORD], Mem124[esp_104 - 0x14 + 0x00:DWORD], Mem124[esp_104 - 0x10 + 0x00:LPSECURITY_ATTRIBUTES], Mem124[esp_104 - 0x0C + 0x00:DWORD], Mem124[esp_104 - 0x08 + 0x00:DWORD], Mem124[esp_104 - 0x04 + 0x00:HANDLE]);
		Mem130[esp_104 - 0x04 + 0x00:word32] = fp - 0x08;
		GetLastError();
		Mem133[esp_104 - 0x08 + 0x00:word32] = 0x40;
		GetLastError();
		Mem136[esp_104 - 0x0C + 0x00:word32] = 0x00;
		Mem138[esp_104 - 0x10 + 0x00:word32] = 0x27;
		Mem140[esp_104 - 0x14 + 0x00:word32] = 0x03;
		Mem142[esp_104 - 0x18 + 0x00:word32] = 0x00;
		Mem144[esp_104 - 0x1C + 0x00:word32] = 0x04;
		Mem146[esp_104 - 0x20 + 0x00:word32] = 0xA0000000;
		Mem148[esp_104 - 0x24 + 0x00:word32] = 0x004319A9;
		esp_150 = esp_104 - 0x08;
		if (CreateFileW(Mem148[esp_104 - 0x24 + 0x00:LPCWSTR], Mem148[esp_104 - 0x20 + 0x00:DWORD], Mem148[esp_104 - 0x1C + 0x00:DWORD], Mem148[esp_104 - 0x18 + 0x00:LPSECURITY_ATTRIBUTES], Mem148[esp_104 - 0x14 + 0x00:DWORD], Mem148[esp_104 - 0x10 + 0x00:DWORD], Mem148[esp_104 - 0x0C + 0x00:HANDLE]) != ~0x00)
			goto l00411910;
		Mem155[esp_104 - 0x0C + 0x00:word32] = 67500;
		Mem157[esp_104 - 0x10 + 0x00:word32] = 0x00401000;
		Mem159[esp_104 - 0x14 + 0x00:word32] = 0x00;
		Mem162[esp_104 - 0x18 + 0x00:word32] = dwLoc44;
		GetFileSize(Mem162[esp_104 - 0x18 + 0x00:HANDLE], Mem162[esp_104 - 0x14 + 0x00:LPDWORD]);
		Mem166[esp_104 - 0x14 + 0x00:word32] = 0x00;
		Mem169[esp_104 - 0x18 + 0x00:word32] = dwLoc38;
		GetFileSize(Mem169[esp_104 - 0x18 + 0x00:HANDLE], Mem169[esp_104 - 0x14 + 0x00:LPDWORD]);
		VirtualProtect(Mem169[esp_104 - 0x10 + 0x00:LPVOID], Mem169[esp_104 - 0x0C + 0x00:SIZE_T], Mem169[esp_104 - 0x08 + 0x00:DWORD], Mem169[esp_104 - 0x04 + 0x00:PDWORD]);
		Mem175[esp_104 - 0x04 + 0x00:word32] = 0x00401000;
		Mem178[esp_104 - 0x08 + 0x00:word32] = eax_125;
		CloseHandle(Mem178[esp_104 - 0x08 + 0x00:HANDLE]);
		Mem182[esp_104 - 0x08 + 0x00:word32] = 0x00;
		Mem184[esp_104 - 0x0C + 0x00:word32] = 0x0180;
		Mem186[esp_104 - 0x10 + 0x00:word32] = 0x03;
		Mem188[esp_104 - 0x14 + 0x00:word32] = 0x00;
		Mem190[esp_104 - 0x18 + 0x00:word32] = 0x06;
		Mem192[esp_104 - 0x1C + 0x00:word32] = 0x40000000;
		Mem194[esp_104 - 0x20 + 0x00:word32] = 0x00431A25;
		esp_196 = esp_104 - 0x04;
	} while (CreateFileA(Mem194[esp_104 - 0x20 + 0x00:LPCSTR], Mem194[esp_104 - 0x1C + 0x00:DWORD], Mem194[esp_104 - 0x18 + 0x00:DWORD], Mem194[esp_104 - 0x14 + 0x00:LPSECURITY_ATTRIBUTES], Mem194[esp_104 - 0x10 + 0x00:DWORD], Mem194[esp_104 - 0x0C + 0x00:DWORD], Mem194[esp_104 - 0x08 + 0x00:HANDLE]) != ~0x00);
	Mem202[esp_104 - 0x08 + 0x00:word32] = dwLoc2C;
	Mem204[esp_104 - 0x0C + 0x00:word32] = 67500;
	Mem206[esp_104 - 0x10 + 0x00:word32] = 0x00;
	Mem208[esp_104 - 0x14 + 0x00:word32] = 0x0103;
	Mem210[esp_104 - 0x18 + 0x00:word32] = 0x03;
	Mem212[esp_104 - 0x1C + 0x00:word32] = 0x00;
	Mem214[esp_104 - 0x20 + 0x00:word32] = 0x06;
	Mem216[esp_104 - 0x24 + 0x00:word32] = 0xA0000000;
	Mem218[esp_104 - 0x28 + 0x00:word32] = 4397451;
	CreateFileA(Mem218[esp_104 - 0x28 + 0x00:LPCSTR], Mem218[esp_104 - 0x24 + 0x00:DWORD], Mem218[esp_104 - 0x20 + 0x00:DWORD], Mem218[esp_104 - 0x1C + 0x00:LPSECURITY_ATTRIBUTES], Mem218[esp_104 - 0x18 + 0x00:DWORD], Mem218[esp_104 - 0x14 + 0x00:DWORD], Mem218[esp_104 - 0x10 + 0x00:HANDLE]);
	Mem223[esp_104 - 0x10 + 0x00:word32] = 0x00;
	Mem225[esp_104 - 0x14 + 0x00:word32] = 0x23;
	Mem227[esp_104 - 0x18 + 0x00:word32] = 0x03;
	Mem229[esp_104 - 0x1C + 0x00:word32] = 0x00;
	Mem231[esp_104 - 0x20 + 0x00:word32] = 0x06;
	Mem233[esp_104 - 0x24 + 0x00:word32] = 0x80000000;
	Mem235[esp_104 - 0x28 + 0x00:word32] = 0x004319FF;
	CreateFileW(Mem235[esp_104 - 0x28 + 0x00:LPCWSTR], Mem235[esp_104 - 0x24 + 0x00:DWORD], Mem235[esp_104 - 0x20 + 0x00:DWORD], Mem235[esp_104 - 0x1C + 0x00:LPSECURITY_ATTRIBUTES], Mem235[esp_104 - 0x18 + 0x00:DWORD], Mem235[esp_104 - 0x14 + 0x00:DWORD], Mem235[esp_104 - 0x10 + 0x00:HANDLE]);
	word32 eax_246 = GetCommandLineA();
	word32 esp_247;
	word32 ebp_248;
	byte SCZO_249;
	word32 eax_250;
	byte Z_251;
	byte SZO_252;
	byte C_253;
	(dwLoc2C - ~0x40411B98)();
	GetCommandLineA();
}

