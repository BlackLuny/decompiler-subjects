// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401028: void fn00401028(Register word16 dx, Register word32 ebp, Register word32 esi, Register word32 edi, Register (ptr Eq_6) es)
void fn00401028(word16 dx, word32 ebp, word32 esi, word32 edi, Eq_6 * es)
{
fn00401028_entry:
	goto l0040102A
l00401028:
l0040102A:
	byte al_28 = __inb(dx_85)
l0040102B:
	word32 esp_30
	word32 ebx_32
	byte SCZO_33
	byte SZO_35
	byte C_36
	byte Z_37
	word32 edi_38
	byte CZ_39
	byte al_40
	struct Eq_71 * es_41
	word32 eax_42
	word16 dx_43
	ptr32 ebp_31
	Eq_7 esi_34
	fnBC438550()
l00401030:
	*(ebp_31 - 0x15) = *(ebp_31 - 0x15) & esi_34
	struct Eq_55 ** esp_51
	word32 ebx_53
	byte SCZO_54
	Eq_7 esi_55
	byte SZO_56
	byte C_57
	bool Z_58
	cu8 * edi_59
	byte CZ_60
	byte al_61
	Eq_51 es_62
	word32 eax_63
	fn662B8558()
	struct Eq_55 * esp_65 = *esp_51
	branch Z_58 l00401026
l0040103B:
	esi_34 = esi_55
	word16 dx_85 = dx
	branch *(esi_55 - 0x01) >= *edi_59 l0040102A
l0040103F:
	branch *(esi_55 - 0x01) > *edi_59 l00401030
l00401042:
	esp_65->t0004 = es_62
fn00401028_exit:
}

// 00410A65: Register Eq_76 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetCommandLineA();
	GetOEMCP();
	GetACP();
	Eq_86 eax_14 = GetModuleHandleA(&globals->t433E06);
	SizeofResource(null, dwLoc20);
	GetACP();
	GetFileType(dwLoc20);
	Eq_105 eax_36 = GetProcAddress(eax_14, &globals->t433E27);
	GetVersion();
	GetACP();
	GetCurrentProcessId();
	GetCommandLineW();
	GetVersion();
	Eq_125 eax_53 = eax_36();
	ptr32 esp_122 = fp - 0x50;
	do
	{
		struct Eq_131 * esp_73 = esp_122 - 0x04;
		esp_73->t0000 = 0x40000000;
		*(esp_73 - 0x04) = 0x00433E34;
		<anonymous> * eax_82 = (eax_53 ^ 0xC0000005) + 0x00410B3F;
		ptr32 esp_84;
		word32 ebp_85;
		byte SCZO_86;
		word32 eax_87;
		byte SZO_88;
		byte C_89;
		byte Z_90;
		word16 dx_91;
		word32 esi_92;
		word32 edi_93;
		struct Eq_159 * es_94;
		eax_82();
		Eq_95 eax_77 = CreateFileA(*(esp_73 - 0x04), esp_73->t0000, esp_73->t0004, esp_73->t0008, esp_73->t000C, esp_73->t0010, esp_73->t0014);
		*(esp_84 - 0x04) = (FARPROC *) eax_36;
		GetFileType(*(esp_84 - 0x04));
		GetProcessHeap();
		GetCommandLineA();
		GetProcessHeap();
		*(esp_84 - 0x04) = fp - 0x08;
		*(esp_84 - 0x08) = 0x00;
		*(esp_84 - 0x0C) = 0x86;
		*(esp_84 - 0x10) = 0x03;
		*(esp_84 - 0x14) = 0x00;
		*(esp_84 - 0x18) = 0x01;
		*(esp_84 - 0x1C) = 0x80000000;
		*(esp_84 - 0x20) = 4406800;
		esp_122 = esp_84 - 0x04;
	} while (CreateFileA(*(esp_84 - 0x20), *(esp_84 - 0x1C), *(esp_84 - 0x18), *(esp_84 - 0x14), *(esp_84 - 0x10), *(esp_84 - 0x0C), *(esp_84 - 0x08)) != ~0x00);
	*(esp_84 - 0x08) = 0x40;
	GetVersion();
	GetCommandLineW();
	*(esp_84 - 0x0C) = 63277;
	GetOEMCP();
	*(esp_84 - 0x10) = 0x00401000;
	GetCurrentProcessId();
	VirtualProtect(*(esp_84 - 0x10), *(esp_84 - 0x0C), *(esp_84 - 0x08), *(esp_84 - 0x04));
	GetACP();
	*(esp_84 - 0x04) = (union Eq_125 *) eax_53;
	GetACP();
	*(esp_84 - 0x08) = 63277;
	*(esp_84 - 0x0C) = (union Eq_95 *) eax_77;
	GetFileType(*(esp_84 - 0x0C));
	GetCommandLineW();
	*(esp_84 - 0x0C) = 0x00401000;
	GetACP();
	word32 esp_159;
	word32 ebp_160;
	byte SCZO_161;
	word32 eax_162;
	byte SZO_163;
	byte C_164;
	byte Z_165;
	word16 dx_166;
	word32 esi_167;
	word32 edi_168;
	struct Eq_6 * es_169;
	(eax_53 - ~0x40410A14)();
	Eq_76 eax_170 = GetVersion();
	fn00401028(dx_166, ebp_160, esi_167, edi_168, es_169);
	return eax_170;
}

