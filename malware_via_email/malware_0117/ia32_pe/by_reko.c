// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	Eq_3 eax_26 = AddAce(null, 0x00, 0x00, null, 0x00);
	Eq_17 esi_15 = 0x00;
	word32 ebx_296 = eax_26 + 0x25;
	if (AreAllAccessesGranted(~0x00, ~0x00) == 0x00)
		ebx_296 = eax_26 + 0x03;
	CloseHandle((void *) 0x59);
	VirtualProtect(&globals->v401000, 0x3000, 0x40, fp - 0x0C);
	struct Eq_49 * eax_59 = null;
	do
	{
		if (esi_15 == ebx_296)
			esi_15.u0 = 0x00;
		eax_59[4199032] = (struct Eq_49) (eax_59[4199032] ^ *((word32) esi_15 + 0x00404000));
		eax_59 = eax_59 + 0x01;
		esi_15 = (word32) esi_15 + 0x01;
	} while (eax_59 < (struct Eq_49 *) 5152);
	struct Eq_71 * ecx_117 = &globals->t402558;
	uint32 dwLoc08_121 = 0x00;
	do
	{
		Eq_75 eax_98 = ecx_117->t0004;
		word16 * edx_103 = (char *) &ecx_117->t0004 + 0x04;
		if (eax_98 - 0x08 >> 0x01 > 0x00)
		{
			uint32 esi_274 = eax_98 - 0x08 >> 0x01;
			do
			{
				ui32 eax_277 = (word32) *edx_103;
				if ((eax_277 & 0xF000) == 0x3000)
				{
					struct Eq_107 * eax_288 = (eax_277 & 0x0FFF) + ecx_117->dw0000;
					eax_288->dw400FF8 = eax_288->dw400FF8 + 0xF0400FF8;
				}
				edx_103 = edx_103 + 0x01;
				esi_274 = esi_274 - 0x01;
			} while (esi_274 != 0x00);
		}
		Eq_75 eax_107 = ecx_117->t0004;
		uint32 edx_109 = (word32) eax_107.u0 + dwLoc08_121;
		word32 ecx_110 = ecx_117 + eax_107;
		int32 eax_114 = ecx_110->dw0004;
		uint32 edx_116 = edx_109 + eax_114;
		ecx_117 = (struct Eq_71 *) (ecx_110 + eax_114 / 0x08);
		dwLoc08_121 = edx_116;
	} while (edx_116 < 228);
	struct Eq_135 * esi_128 = &globals->t401D54;
	struct Eq_135 * dwLoc08_129 = &globals->t401D54;
	esi_157 = esi_128;
	if (globals->dw401D64 != 0x00)
	{
		do
		{
			struct Eq_135 * esi_157;
			Eq_181 eax_174 = LoadLibraryA(esi_157->dw000C + 0x00400FF8);
			Eq_181 edi_176 = eax_174;
			if (eax_174 != null)
			{
				word32 ebx_200 = esi_157->dw0000;
				if (ebx_200 == 0x00)
					ebx_200 = esi_157->dw0010;
				word32 * ebx_205 = ebx_200 + 0x00400FF8;
				word32 eax_208 = *ebx_205;
				word32 * esi_209 = esi_157->dw0010 + 0x00400FF8;
				bool S_212 = cond(eax_208);
				if (eax_208 != 0x00)
				{
					do
					{
						Eq_241 eax_245;
						if (!S_212)
						{
							eax_245 = GetProcAddress(edi_176, (word32) *ebx_205);
							edi_176 = eax_174;
						}
						else
							eax_245 = GetProcAddress(edi_176, eax_208 + 0x00400FFA);
						*esi_209 = (word32) eax_245;
						ebx_205 = ebx_205 + 0x01;
						eax_208 = *ebx_205;
						esi_209 = esi_209 + 0x01;
						S_212 = cond(eax_208);
					} while (eax_208 != 0x00);
				}
				esi_157 = dwLoc08_129;
			}
			esi_157 = esi_157 + 0x01;
			dwLoc08_129 = esi_157;
		} while (esi_157->dw0010 != 0x00);
	}
	ptr32 esp_137;
	byte SCZO_138;
	word32 ebx_139;
	word32 ebp_140;
	word32 esi_141;
	word32 edi_142;
	byte SZO_143;
	byte C_144;
	word32 eax_145;
	byte Z_146;
	word32 edx_147;
	byte cl_148;
	word32 ecx_149;
	byte S_150;
	globals->t401A48();
	*(esp_137 - 0x04) = 0x00;
	ExitProcess(*(esp_137 - 0x04));
}

