// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	struct Eq_3 * ebp_15 = null;
	struct Eq_3 * dwLoc08_17 = (struct Eq_3 *) 0x25;
	Eq_2 eax_22 = AddUsersToEncryptedFile(null, null);
	if (eax_22 != 0x00)
	{
		if (AreAllAccessesGranted(~0x00, ~0x00) == 0x00)
			dwLoc08_17 = (struct Eq_3 *) 0x2B;
		VirtualProtect(&globals->v401000, 0x3000, 0x40, fp - 0x0C);
		struct Eq_39 * eax_50 = null;
		do
		{
			if (ebp_15 == dwLoc08_17)
				ebp_15 = null;
			eax_50[4199880] = (struct Eq_39) (ebp_15[0x00404000] ^ eax_50[4199880] ^ 202);
			eax_50 = eax_50 + 0x01;
			ebp_15 = ebp_15 + 0x01;
		} while (eax_50 < (struct Eq_39 *) 0x1440);
		uint32 ecx_265 = 0x00;
		struct Eq_64 * edi_269 = &globals->t4028C8;
		uint32 dwLoc04_263 = 0x00;
		if (true)
		{
			do
			{
				Eq_84 eax_271 = edi_269->t0004;
				cui16 * esi_278 = (char *) &edi_269->t0004 + 0x04;
				if (eax_271 - 0x08 >> 0x01 > 0x00)
				{
					uint32 dwLoc08_293 = eax_271 - 0x08 >> 0x01;
					do
					{
						if ((*esi_278 & 0xF000) == 0x3000)
						{
							struct Eq_203 * eax_320 = ((word32) *esi_278 & 0x0FFF) + edi_269->dw0000;
							eax_320->dw401348 = eax_320->dw401348 + 0xF0401348;
						}
						uint32 v20_310 = dwLoc08_293 - 0x01;
						esi_278 = esi_278 + 0x01;
						dwLoc08_293 = v20_310;
					} while (v20_310 != 0x00);
					ecx_265 = dwLoc04_263;
				}
				ecx_265 = (word32) edi_269->t0004 + ecx_265;
				dwLoc04_263 = ecx_265;
				edi_269 = edi_269 + Mem74[edi_269 + 0x04:word32];
			} while (ecx_265 < 228);
		}
		struct Eq_73 * esi_108 = &globals->t4020B4;
		struct Eq_73 * dwLoc08_109 = &globals->t4020B4;
		esi_139 = esi_108;
		if (globals->dw4020C4 != 0x00)
		{
			do
			{
				struct Eq_73 * esi_139;
				Eq_145 eax_155 = LoadLibraryA(esi_139->dw000C + 0x00401348);
				if (eax_155 != null)
				{
					struct Eq_170 * edi_181 = esi_139->dw0000;
					if (edi_181 == null)
						edi_181 = esi_139->dw0010;
					Eq_176 eax_187 = edi_181->t401348;
					union Eq_180 * edi_188 = &edi_181->t401348;
					word32 * esi_189 = esi_139->dw0010 + 0x00401348;
					bool S_192 = cond(eax_187);
					if (eax_187 != 0x00)
					{
						do
						{
							Eq_230 eax_231;
							if (!S_192)
								eax_231 = GetProcAddress(eax_155, (word32) *edi_188);
							else
								eax_231 = GetProcAddress(eax_155, (word32) eax_187 + 4199242);
							*esi_189 = (word32) eax_231;
							edi_188 = (union Eq_180 *) ((char *) edi_188 + 0x04);
							eax_187 = *edi_188;
							esi_189 = esi_189 + 0x01;
							S_192 = cond(eax_187);
						} while (eax_187 != 0x00);
					}
					esi_139 = dwLoc08_109;
				}
				esi_139 = esi_139 + 0x01;
				dwLoc08_109 = esi_139;
			} while (esi_139->dw0010 != 0x00);
		}
		ptr32 esp_115;
		byte SCZO_116;
		word32 ebx_117;
		word32 ebp_118;
		word32 esi_119;
		word32 edi_120;
		byte SZO_121;
		byte C_122;
		word32 eax_123;
		byte Z_124;
		word32 edx_125;
		byte cl_126;
		word32 ecx_127;
		byte CZ_128;
		word16 dx_129;
		byte S_130;
		globals->t401DA8();
		*(esp_115 - 0x04) = 0x00;
		ExitProcess(*(esp_115 - 0x04));
	}
	else
		return eax_22;
}

