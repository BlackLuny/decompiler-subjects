// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401030: void fn00401030(Stack word32 dwArg04, Stack (ptr Eq_3) dwArg08, Stack (ptr Eq_4) dwArg0C)
void fn00401030(word32 dwArg04, Eq_3 * dwArg08, Eq_4 * dwArg0C)
{
	globals->dw40633C = 0x00;
	while (globals->dw40633C < dwArg0C)
	{
		dwArg04 + globals->dw40633C = dwArg08 + globals->dw40633C;
		globals->dw40633C = globals->dw40633C + 0x01;
	}
	return;
}

// 004010D0: Register Eq_28 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	do
		globals->dw406354 = 39821115;
	while (false);
	int32 dwLoc18_22 = 0x00;
	while (dwLoc18_22 < 0x01)
	{
		globals->dw406354 = 0x3799;
		dwLoc18_22 = dwLoc18_22 + 0x01;
	}
	int32 dwLoc1C_33 = 0x00;
	while (dwLoc1C_33 < 0x01)
	{
		globals->dw406354 = 0x22E3;
		dwLoc1C_33 = dwLoc1C_33 + 0x01;
	}
	Eq_46 eax_46 = GetModuleHandleA(null);
	if (RegOpenKeyA((struct HKEY__ *) 0x80000000, &globals->t406280, fp - 0x0C) != 0x00)
		null = (byte *) 0x00;
	struct Eq_70 * edx_65 = globals->ptr402001;
	word32 ecx_68 = globals->dw402005;
	struct Eq_70 * dwLoc08_113 = null;
	while (dwLoc08_113 < edx_65)
	{
		do
			globals->dw406354 = 0x8E831298;
		while (false);
		do
			globals->dw406354 = 3552175835;
		while (false);
		int32 dwLoc28_101 = 0x00;
		while (dwLoc28_101 < 0x01)
		{
			globals->dw406354 = 336278;
			dwLoc28_101 = dwLoc28_101 + 0x01;
		}
		dwLoc08_113->dw402009 = dwLoc08_113->dw402009 ^ 0x3ADE68B1;
		dwLoc08_113 = dwLoc08_113 + 0x01;
	}
	globals->dw40634C = fn00401630(ecx_68);
	fn004017F0(0x00402009, globals->dw40634C, edx_65);
	globals->dw406340 = edi;
	globals->dw406338 = esi;
	globals->dw406348 = ebx;
	globals->ptr406350 = fs->ptr0018;
	globals->ptr406344 = fp - 0x04;
	word32 ebp_151 = fn00401660(fp - 0x04, 4198995 - eax_46, eax_46);
	word32 ecx_154 = globals->dw40634C;
	*(fp - 0x38) = ecx_154;
	word32 eax_158 = fn004012B0(ebp_151, dwArg00);
	word32 esp_165;
	word32 ebp_166;
	byte SCZO_167;
	word32 ebx_168;
	word32 esi_169;
	word32 edi_170;
	Eq_28 eax_171;
	byte SZO_172;
	byte C_173;
	byte Z_174;
	byte SO_175;
	word32 ecx_176;
	word32 edx_177;
	struct Eq_153 * fs_178;
	globals->ptr406358();
	return eax_171;
}

// 00401290: Register Eq_183 fn00401290(Stack word32 dwArg04, Stack (ptr Eq_3) dwArg08)
FARPROC fn00401290(word32 dwArg04, Eq_3 * dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

// 004012B0: Register word32 fn004012B0(Register word32 ebp, Stack word32 dwArg04)
word32 fn004012B0(word32 ebp, word32 dwArg04)
{
	Eq_46 eax_9 = GetModuleHandleA(&globals->t406288);
	Eq_183 eax_17 = GetProcAddress(eax_9, &globals->t406298);
	GetProcAddress(eax_9, &globals->t4062A8);
	Eq_183 eax_33 = GetProcAddress(eax_9, &globals->t4062B8);
	Eq_183 eax_41 = GetProcAddress(eax_9, &globals->t4062CC);
	Eq_183 eax_49 = GetProcAddress(eax_9, &globals->t4062DC);
	GetProcAddress(eax_9, &globals->t4062EC);
	struct Eq_220 * edx_66 = dwArg04 + dwArg04->dw003C / 0x0040;
	struct Eq_226 * dwLoc30_118 = &edx_66->w0014 + 0x02 + (word32) edx_66->w0014 / 22;
	struct Eq_234 * eax_87 = eax_41();
	fn00401030(dwArg00, dwArg04, dwArg08);
	uint32 dwLoc10_113 = 0x00;
	while (dwLoc10_113 < (word32) edx_66->w0006)
	{
		if (dwLoc30_118->dw0014 != 0x00 && dwLoc30_118->dw0010 != 0x00)
			fn00401030(dwArg00, dwArg04, dwArg08);
		dwLoc30_118 = dwLoc30_118 + 0x01;
		dwLoc10_113 = dwLoc10_113 + 0x01;
	}
	struct Eq_248 * ecx_176 = eax_87 + eax_87->dw003C / 0x0040;
	Eq_253 eax_196 = eax_33();
	ptr32 * esp_193 = fp - 0x84;
	struct Eq_259 * dwLoc5C_207 = eax_87 + ecx_176->dw0080 / 0x0040;
	while (dwLoc5C_207->dw0010 != 0x00)
	{
		word32 * dwLoc3C_247;
		ui32 * dwLoc2C_246;
		ptr32 * esp_231 = esp_193 - 0x04;
		*esp_231 = eax_87 + dwLoc5C_207->dw000C / 0x0040;
		int32 eax_236 = eax_49();
		if (dwLoc5C_207->dw0000 != 0x00)
		{
			dwLoc2C_246 = (ui32 *) (eax_87 + dwLoc5C_207->dw0000 / 0x0040);
			dwLoc3C_247 = (word32 *) (eax_87 + dwLoc5C_207->dw0010 / 0x0040);
		}
		else
		{
			dwLoc2C_246 = (ui32 *) (eax_87 + dwLoc5C_207->dw0010 / 0x0040);
			dwLoc3C_247 = (word32 *) (eax_87 + dwLoc5C_207->dw0000 / 0x0040);
		}
		word32 dwLoc1C_250 = 0x00;
		if (dwLoc5C_207->dw0010 != 0x00 && dwLoc5C_207->dw0000 != 0x00)
			dwLoc1C_250 = 0x01;
		while (true)
		{
			esp_193 = esp_231;
			if (*dwLoc2C_246 == 0x00)
				break;
			if ((*dwLoc2C_246 & 0x80000000) != 0x00)
			{
				*(esp_231 - 0x04) = *dwLoc2C_246 & 0x7FFFFFFF;
				*(esp_231 - 0x08) = eax_236;
				*dwLoc2C_246 = fn00401290(dwArg00, dwArg04);
			}
			else
			{
				*(esp_231 - 0x04) = eax_87 + (*dwLoc2C_246 + 0x02) / 0x0040;
				*(esp_231 - 0x08) = eax_236;
				*dwLoc2C_246 = fn00401290(dwArg00, dwArg04);
			}
			if (dwLoc1C_250 != 0x00)
				*dwLoc3C_247 = *dwLoc2C_246;
			dwLoc2C_246 = dwLoc2C_246 + 0x01;
			dwLoc3C_247 = dwLoc3C_247 + 0x01;
		}
		dwLoc5C_207 = dwLoc5C_207 + 0x01;
	}
	word32 eax_378;
	word32 * esp_348 = esp_193 - 0x04;
	*esp_348 = ecx_176->dw0034;
	*(esp_348 - 0x04) = 0x00;
	*(esp_348 - 0x08) = 0x00;
	*(esp_348 - 0x0C) = 0x00;
	*(esp_348 - 0x10) = 0x22;
	*(esp_348 - 0x14) = (union Eq_253 *) eax_196;
	globals->t406334 = eax_17();
	ptr32 esp_361 = esp_348 - 0x14;
	if (globals->t406334 == 0x00)
	{
		*(esp_348 - 0x18) = ecx_176->dw0034;
		if (UnmapViewOfFile(*(esp_348 - 0x18)) == 0x00)
		{
			*(esp_348 - 0x18) = 0x8000;
			*(esp_348 - 0x1C) = 0x00;
			*(esp_348 - 0x20) = ecx_176->dw0034;
			if (VirtualFree(*(esp_348 - 0x20), *(esp_348 - 0x1C), *(esp_348 - 0x18)) == 0x00)
			{
				eax_378 = 0x00;
				return eax_378;
			}
		}
		ptr32 esp_430 = esp_193 - 0x18;
		*(esp_430 - 0x04) = ecx_176->dw0034;
		*(esp_430 - 0x08) = 0x00;
		*(esp_430 - 0x0C) = 0x00;
		*(esp_430 - 0x10) = 0x00;
		*(esp_430 - 0x14) = 0x22;
		*(esp_430 - 0x18) = (union Eq_253 *) eax_196;
		globals->t406334 = MapViewOfFileEx(*(esp_430 - 0x18), *(esp_430 - 0x14), *(esp_430 - 0x10), *(esp_430 - 0x0C), *(esp_430 - 0x08), *(esp_430 - 0x04));
		esp_361 = esp_430;
		if (globals->t406334 == 0x00)
		{
			*(esp_430 - 0x04) = 0x40;
			*(esp_430 - 0x08) = 0x3000;
			*(esp_430 - 0x0C) = (union Eq_253 *) ecx_176->t0050;
			*(esp_430 - 0x10) = ecx_176->dw0034;
			globals->t406334 = VirtualAlloc(*(esp_430 - 0x10), *(esp_430 - 0x0C), *(esp_430 - 0x08), *(esp_430 - 0x04));
			esp_361 = esp_430;
		}
	}
	union Eq_253 * esp_389 = esp_361 - 0x04;
	*esp_389 = (union Eq_253 *) eax_196;
	CloseHandle(*esp_389);
	*esp_389 = (union Eq_253 *) ecx_176->t0050;
	*(esp_389 - 0x04) = (struct Eq_234 **) eax_87;
	*(esp_389 - 0x08) = (union Eq_253 *) globals->t406334;
	fn00401030(dwArg00, dwArg04, dwArg08);
	*esp_389 = (union Eq_253 *) globals->t406334;
	fn004017C0(dwArg00);
	Mem413[0x00406358:word32] = Mem407[0x00406334:word32] + Mem407[ecx_176 + 0x28:word32];
	ecx_176->ptr0028 = globals->ptr406358;
	eax_378 = 0x01;
	return eax_378;
}

// 00401630: Register Eq_253 fn00401630(Stack word32 dwArg04)
Eq_253 fn00401630(word32 dwArg04)
{
	return VirtualAlloc(0x00, dwArg04, 0x3000, 0x04);
}

// 00401660: Register ptr32 fn00401660(Register ptr32 ebp, Stack word32 dwArg04, Stack Eq_46 dwArg08)
ptr32 fn00401660(ptr32 ebp, word32 dwArg04, HMODULE dwArg08)
{
	struct Eq_712 * edx_16 = dwArg08 + dwArg08->dw003C / 0x0040;
	globals->t406334 = GetProcAddress(GetModuleHandleA(&globals->t406308), &globals->t4062F8)();
	if (globals->t406334 != 0x00)
	{
		fn00401030(dwArg00, dwArg04, dwArg08);
		ui32 eax_92 = globals->t406334 - dwArg08;
		if (edx_16->dw00A4 != 0x00)
		{
			struct Eq_758 * dwLoc0C_118 = dwArg08 + edx_16->dw00A0 / 0x0040;
			while (dwLoc0C_118->t0004 != 0x00)
			{
				uint32 eax_133 = dwLoc0C_118->t0004 - 0x08 >> 0x01;
				word16 ecx_136[] = (char *) &dwLoc0C_118->t0004 + 0x04;
				uint32 dwLoc08_139 = 0x00;
				while (dwLoc08_139 < eax_133)
				{
					if ((word32) ecx_136[dwLoc08_139] >> 0x0C == 0x03)
						(word32) globals->t406334 + dwLoc0C_118->dw0000 + ((word32) ecx_136[dwLoc08_139] & 0x0FFF) = (struct Eq_803 *) ((word32) globals->t406334 + dwLoc0C_118->dw0000 + ((word32) ecx_136[dwLoc08_139] & 0x0FFF) + eax_92);
					dwLoc08_139 = dwLoc08_139 + 0x01;
				}
				dwLoc0C_118 = dwLoc0C_118 + Mem87[dwLoc0C_118 + 0x04:word32];
			}
		}
		word32 edx_102 = dwArg04 + Mem87[0x00406334:word32];
		word32 esp_104;
		ptr32 ebp_105;
		byte SCZO_106;
		word32 esi_107;
		word32 eax_108;
		word32 ecx_109;
		word32 edx_110;
		byte Z_111;
		byte C_112;
		byte SZO_113;
		edx_102();
		return ebp_105;
	}
	else
		return ebp;
}

// 004017C0: void fn004017C0(Stack word32 dwArg04)
void fn004017C0(word32 dwArg04)
{
	globals->ptr406350->ptr0030->dw0008 = dwArg04;
	return;
}

// 004017F0: void fn004017F0(Stack word32 dwArg04, Stack word32 dwArg08, Stack (ptr Eq_70) dwArg0C)
void fn004017F0(word32 dwArg04, word32 dwArg08, Eq_70 * dwArg0C)
{
	Eq_834 cl_12 = (&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&dwArg04->a0000[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00];
	lstrcpyA(fp - 0x94, &globals->t406328);
	Eq_848 dwLoc0C_118 = 0x01;
	int32 dwLoc18_124 = 0x00;
	do
	{
		Eq_848 edx_40 = (word32) dwLoc0C_118 + 0x01;
		byte cl_37 = Mem0[dwArg04 + dwLoc0C_118:byte];
		dwLoc0C_118 = edx_40;
		if ((word32) cl_37 == (word32) cl_12)
		{
			if ((word32) Mem0[dwArg04 + edx_40:byte] == 0x00)
			{
				(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&dwArg08[dwLoc18_124].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00] = cl_12;
				dwLoc18_124 = dwLoc18_124 + 0x01;
				dwLoc0C_118 = (word32) edx_40.u0 + 0x01;
			}
			else
			{
				word32 eax_104 = fn00401910(fp - 0x10, dwArg04 + edx_40) + edx_40;
				dwLoc0C_118 = fn00401910(fp - 0x20, dwArg04 + eax_104) + eax_104;
				uint32 dwLoc1C_119 = 0x00;
				while (dwLoc1C_119 < dwLoc10)
				{
					(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&dwArg08[dwLoc18_124].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00] = (&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&dwArg08[dwLoc18_124 - dwLoc20].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00];
					dwLoc18_124 = dwLoc18_124 + 0x01;
					dwLoc1C_119 = dwLoc1C_119 + 0x01;
				}
			}
		}
		else
		{
			(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&(&dwArg08[dwLoc18_124].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00].a0000)[0x00] = (Eq_834) cl_37;
			dwLoc18_124 = dwLoc18_124 + 0x01;
		}
	} while (dwLoc0C_118 < dwArg0C);
	return;
}

// 00401910: Register word32 fn00401910(Stack ptr32 dwArg04, Stack ptr32 dwArg08)
word32 fn00401910(ptr32 dwArg04, ptr32 dwArg08)
{
	lstrcpyA(fp - 0x84, &globals->t406318);
	ui32 dwLoc08_19 = 0x00;
	word32 dwLoc10_20 = 0x00;
	do
	{
		ui32 edx_23 = (word32) *dwArg08;
		ui32 edx_33 = edx_23 & 0x7F | dwLoc08_19 << 0x07;
		word32 eax_36 = dwLoc10_20 + 0x01;
		dwArg08 = dwArg08 + 0x01;
		dwLoc08_19 = edx_33;
		dwLoc10_20 = eax_36;
	} while ((edx_23 & 0x80) != 0x00);
	*dwArg04 = edx_33;
	return eax_36;
}

