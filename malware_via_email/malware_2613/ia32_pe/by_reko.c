// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00425597: Register Eq_2 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	GetOEMCP();
	GetACP();
	Eq_9 eax_27 = LoadLibraryA(&globals->t43400E);
	GetCommandLineA();
	GetOEMCP();
	GetProcAddress(eax_27, &globals->t43403B)();
	CreateFileA(&globals->t434018, 0xC0000000, 0x01, null, 0x03, 0xA3, null);
	CreateFileA(&globals->t434021, 0xE0000000, 0x06, null, 0x03, 0x26, null);
	GetCommandLineW();
	ptr32 * ebp_94;
	word32 edx_95 = fn004257CC(dwArg00, dwArg04, dwArg08, out ebp_94);
	*(ebp_94 - 0x20) = (LPSTR *) GetCommandLineA();
	SizeofResource(null, *(ebp_94 - 0x1C));
	CloseHandle(*(ebp_94 - 0x1C));
	GetCurrentProcessId();
	GetFileType(*(ebp_94 - 0x1C));
	GetCurrentProcessId();
	*(ebp_94 - 0x18) = (LPSTR *) GetCommandLineA();
	VirtualProtect(&globals->v42A000, 0x9401, 0x40, ebp_94 - 0x0C);
	GetOEMCP();
	GetFileSize(*(ebp_94 - 0x1C), null);
	SizeofResource(null, *(ebp_94 - 0x1C));
	GetOEMCP();
	GetCommandLineW();
	GetFileSize(*(ebp_94 - 0x10), null);
	ptr32 ebp_162 = *ebp_94;
	Eq_2 eax_164 = GetCurrentThreadId();
	word16 dx_96 = (word16) edx_95;
	byte al_165 = (byte) eax_164;
	byte al_166;
	__daa(al_165, &al_166);
	__outb(dx_96, al_166);
	null = __in(edx_95);
	(word32 *) 0x04 = __in(edx_95);
	__outb(edx_95, al_166);
	word32 esp_182;
	word32 ebp_183;
	byte SCZO_184;
	word32 ebx_185;
	word32 edi_186;
	word32 esi_187;
	Eq_2 eax_188;
	byte C_189;
	byte al_190;
	word16 dx_191;
	word32 edx_192;
	byte SZO_193;
	(*(ebp_162 - 0x52))();
	return eax_188;
}

// 004257CC: Register (ptr word32) fn004257CC(Stack word32 dwArg04, Stack word32 dwArg08, Stack word32 dwArg0C, Register out ptr32 ebpOut)
word32 * fn004257CC(word32 dwArg04, word32 dwArg08, word32 dwArg0C, ptr32 & ebpOut)
{
	word32 * edx_17 = dwArg04;
	uint32 esi_20 = dwArg08 >> 0x02;
	do
	{
		*edx_17 = *edx_17 - dwArg0C;
		*edx_17 = *edx_17 - ~0x323E3816;
		*edx_17 = __ror(*edx_17, 171);
		*edx_17 = __rol(*edx_17, 0x03);
		*edx_17 = -*edx_17;
		*edx_17 = __rol(*edx_17, 0xAA);
		*edx_17 = *edx_17 ^ 2140726636;
		edx_17 = edx_17 + 0x01;
		esi_20 = esi_20 - 0x01;
	} while (esi_20 != 0x00);
	word32 ebp_53;
	*ebpOut = ebp;
	return edx_17;
}

