// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 004011FF: void fn004011FF(Register cui16 ax, Register word32 ebp)
void fn004011FF(cui16 ax, word32 ebp)
{
fn004011FF_entry:
	ptr32 v9_13 = fs->ptr0000
	fs->ptr0000 = fp - 0x08
	struct Eq_13 * edi_19 = DPB(eax, ax & 0x1000, 0)
	goto l00401218
l004011FF:
l00401218:
	globals->ptr403748 = fp - 0x08
	globals->dw40374C = ebp
	globals->ptr403750 = edi_19
	branch edi_19->w0000 != 23117 l00401251
l00401233:
	edi_19 = edi_19 + edi_19->dw003C / 0x00001000
	branch edi_19->w0000 != 0x4550 l00401251
l00401241:
	fs->ptr0000 = v9_13
	return
l00401251:
	edi_19 = edi_19 - 0x1000
	goto l00401218
fn004011FF_exit:
}

// 0040126D: Register word32 fn0040126D(Register (ptr byte) esi, Register (ptr byte) edi)
word32 fn0040126D(byte * esi, byte * edi)
{
	word32 edx_15 = 0x00;
	while (true)
	{
		byte * esi_14 = esi;
		if (*esi_41 == 0x00)
			break;
		esi_14 = esi_41 + 0x01;
		edi = edi_40 + 0x01;
		byte * edi_40 = edi;
		byte * esi_41 = esi_14;
		if (*esi_41 == *edi_40)
			goto l00401272;
		do
		{
			edi = edi_42 + 0x01;
			byte * edi_42 = edi;
		} while (0x00 != *edi_42);
		edx_15 = edx_15 + 0x01;
	}
	return edx_15;
}

// 00401285: Register byte fn00401285(Register word32 eax, Register word32 ebx, Register out ptr32 ebpOut)
byte fn00401285(word32 eax, word32 ebx, ptr32 & ebpOut)
{
	word32 * esp_6;
	word32 ebp_7;
	word32 eax_8;
	byte SCZO_9;
	byte Z_10;
	word32 esi_12;
	word32 edi_13;
	word32 edx_14;
	word32 ecx_15;
	word16 ax_16;
	byte SZO_17;
	byte C_18;
	byte al_19;
	Eq_95 ebx_11;
	globals->t40818E();
	if (eax_8 == ~0x01)
		ebx_11 = globals->t4020F4;
	*(esp_6 - 0x04) = 0x004020F4;
	word32 ebp_30 = Mem26[ebx_11 + Mem26[ebx_11 + 0x3C:word32] + 0x78:word32] + ebx_11;
	word32 edi_34 = Mem26[Mem26[ebp_30 + 0x20:word32] + ebx_11:word32] + ebx_11;
	*(esp_6 - 0x04) = *(esp_6 - 0x04);
	word16 * eax_46 = (word32) ebx_11 + ebp_30->dw0024 + 0x02 + fn0040126D(&globals->t4020F4, edi_34) * 0x02 - ebp_30->dw0010 * 0x02;
	word32 eax_53 = (word32) ebx_11 + *((word32) ((word32) ebx_11 + ebp_30->dw001C) + (DPB(eax_46, *eax_46, 0) & 0xFFFF) * 0x04);
	**(esp_6 - 0x04) = eax_53;
	word32 ebp_60;
	*ebpOut = *esp_6;
	return (byte) eax_53;
}

// 004012E5: Register Eq_181 Win32CrtStartup()
DWORD Win32CrtStartup()
{
	globals->t4020F4 = LoadLibraryA(&globals->t402071);
	globals->t40818E = GetProcAddress(globals->t4020F4, &globals->t402047);
	Eq_95 eax_15 = globals->t40818E;
	cui16 ax_17 = (word16) eax_15;
	fn004011FF(ax_17, ebp);
	globals->t4020F4 = eax_15;
	ptr32 esp_20;
	word32 eax_21;
	byte SCZO_22;
	byte Z_23;
	word32 ecx_24;
	byte al_25;
	word32 ebp_26;
	byte SZO_27;
	byte C_28;
	word16 ax_29;
	word32 ebx_30;
	globals->t40818E();
	do
		;
	while (eax_21 != ~0x01);
	word32 ebp_35;
	fn00401285(eax_21, ebx_30, out ebp_35);
	*(esp_20 - 0x04) = 0x02;
	*(esp_20 - 0x08) = 0x11100011;
	*(esp_20 - 0x0C) = 0x00;
	*(esp_20 - 0x10) = 0x1FC7F0FE;
	__wait();
}

