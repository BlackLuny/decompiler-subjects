// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 0800:010D: void fn0800_010D()
void fn0800_010D()
{
	struct Eq_32 * ds_3 = seg0800->ptr01C7;
	byte al_4 = fn0800_0172(ds_3);
	struct Eq_40 Eq_46::* sp_7;
	struct Eq_41 * ds_8;
	struct Eq_42 * cs_9;
	word16 bp_10;
	byte ah_11;
	byte al_12;
	struct Eq_46 * ss_13;
	(cs->*ds_3->ptr0540)();
	msdos_terminate((ss_13->*sp_7).b0004);
}

// 0800:0172: Register byte fn0800_0172(Register (ptr Eq_32) ds)
byte fn0800_0172(Eq_32 * ds)
{
	msdos_set_interrupt_vector(0x00, ds->ptr005B);
	msdos_set_interrupt_vector(0x04, ds->ptr005F);
	msdos_set_interrupt_vector(0x05, ds->ptr0063);
	msdos_set_interrupt_vector(0x06, ds->ptr0067);
	return 0x06;
}

// 083C:0002: void main(Register word16 bp, Register Eq_93 ds)
void main(word16 bp, Eq_93 ds)
{
	word16 si_20;
	word16 di_21;
	word16 bx_22 = fn093D_000E(ds, 0x94, ds, out si_20, out di_21);
	fn09F1_0007(bx_22, di_21, ds, 177, ds);
	union Eq_93 Eq_93::* bp_46 = fp - 0x02;
	Eq_93 si_114 = 0x01;
	while (si_114 <= ss->*(bp_46 - 0x04))
	{
		ss->*(fp - 0x0C) = ds;
		(ss->*(fp - 0x0E)).u0 = 0xB4;
		word16 si_71;
		word16 di_72;
		word16 bx_73 = fn093D_000E(ds, wArg00, wArg02, out si_71, out di_72);
		ss->*(fp - 0x0C) = ss;
		ss->*(fp - 0x0E) = bp_46 - 0x02;
		ss->*(fp - 0x10) = ds;
		(ss->*(fp - 0x12)).u0 = 0xC3;
		fn09F1_0007(bx_73, di_72, ds, wArg00, wArg02);
		ss->*(fp - 0x0C) = ss->*(bp_46 - 0x02);
		word16 si_94;
		ss->*(fp - 0x0C) = fn083C_007C(bp_46, wArg00, out bp_46, out si_94);
		ss->*(fp - 0x0E) = ss->*(bp_46 - 0x02);
		ss->*(fp - 0x10) = ds;
		(ss->*(fp - 0x12)).u0 = 0xC6;
		word16 si_109;
		word16 di_110;
		fn093D_000E(ds, wArg00, wArg02, out si_109, out di_110);
		si_114 = si_109 + 0x01;
	}
	(ss->*(fp - 0x0C)).u0 = 0x00;
	fn084A_000A(ds, wArg00);
	return;
}

// 083C:007C: Register word16 fn083C_007C(Register (memptr Eq_93 Eq_93) bp, Stack ci16 wArg04, Register out Eq_188 bpOut, Register out ptr16 siOut)
word16 fn083C_007C(Eq_93 Eq_93::*bp, ci16 wArg04, Eq_188 & bpOut, ptr16 & siOut)
{
	word16 ax_17;
	struct Eq_239 Eq_257::* sp_19 = fp - 0x04;
	if (wArg04 > 0x02)
	{
		union Eq_93 Eq_93::* bp_34;
		word16 si_35;
		ss->*(fp - 0x08) = fn083C_007C(fp - 0x02, wArg04 - 0x01, out bp_34, out si_35);
		ss->*(fp - 0x0A) = si_35 + ~0x01;
		sp_19 = fp - 0x08;
		word16 bp_48;
		word16 si_49;
		ax_17 = Mem45[ss:fp - 0x0A + 0x00:word16] + fn083C_007C(bp_34, wArg02, out bp_48, out si_49);
	}
	else
		ax_17 = 0x01;
	word16 si_22;
	*siOut = (ss->*sp_19).t0000;
	word16 bp_24;
	*bpOut = (ss->*sp_19).w0002;
	return ax_17;
}

// 084A:000A: void fn084A_000A(Register Eq_93 ds, Stack ci16 wArg04)
void fn084A_000A(Eq_93 ds, ci16 wArg04)
{
	while (true)
	{
		ui16 ax_19 = *((word16) ds + 0x0144);
		*((word16) ds + 0x0144) = *((word16) ds + 0x0144) - 0x01;
		if (ax_19 == 0x00)
			break;
		word16 sp_71;
		word16 bp_72;
		struct Eq_307 * ss_73;
		word16 ax_74;
		byte SZO_76;
		byte C_77;
		byte Z_78;
		word16 cx_79;
		word16 bx_80;
		byte SCZO_81;
		SEQ(ds, 0x0554)[Mem21[ds:0x0144:word16] * 0x04]();
	}
	word16 sp_26;
	word16 bp_27;
	struct Eq_324 * ss_28;
	word16 ax_29;
	struct Eq_326 * ds_30;
	byte SZO_31;
	byte C_32;
	byte Z_33;
	word16 cx_34;
	word16 bx_35;
	byte SCZO_36;
	(*((word16) ds + 0x0136))();
	word16 sp_37;
	word16 bp_38;
	struct Eq_337 * ss_39;
	word16 ax_40;
	struct Eq_339 * ds_41;
	byte SZO_42;
	byte C_43;
	byte Z_44;
	word16 cx_45;
	word16 bx_46;
	byte SCZO_47;
	ds_30->ptr013A();
	word16 Eq_350::* sp_48;
	word16 bp_49;
	struct Eq_350 * ss_50;
	word16 ax_51;
	struct Eq_352 * ds_52;
	byte SZO_53;
	byte C_54;
	byte Z_55;
	word16 cx_56;
	word16 bx_57;
	byte SCZO_58;
	ds_41->ptr013E();
	ss_50->*(sp_48 - 0x02) = wArg04;
	fn0800_010D();
	return;
}

// 093D:000E: Register word16 fn093D_000E(Register Eq_93 ds, Stack ci16 wArg04, Stack Eq_93 wArg06, Register out ptr16 siOut, Register out ptr16 diOut)
word16 fn093D_000E(Eq_93 ds, ci16 wArg04, Eq_93 wArg06, ptr16 & siOut, ptr16 & diOut)
{
	word16 si_36;
	word16 di_37;
	word16 bx_38 = fn0967_0037(ds, DPB(ptrLoc12, fp + 0x08, 0), DPB(ptrLoc0E, wArg04, 0), wArg06, out si_36, out di_37);
	return bx_38;
}

// 0967:0037: Register word16 fn0967_0037(Register Eq_93 ds, Stack segptr32 ptrArg04, Stack segptr32 ptrArg08, Stack (ptr Eq_379) psegArg0A, Register out ptr16 siOut, Register out ptr16 diOut)
word16 fn0967_0037(Eq_93 ds, segptr32 ptrArg04, segptr32 ptrArg08, Eq_379 * psegArg0A, ptr16 & siOut, ptr16 & diOut)
{
	ci8 bLoc57_126 = 0x50;
	mp16 sp_17 = fp - 0xA0;
	byte Eq_422::* di_123 = fp - 0x56;
	struct Eq_404 * es_129 = SLICE(ptrArg08, selector, 16);
	byte Eq_93::* si_120 = (word16) ptrArg08;
l0967_00A6:
	byte al_45 = ds->*si_120;
	si_120 = si_120 + 0x01;
	byte al_116 = al_45;
	ax = DPB(ax, al_45, 0);
	if (al_45 == 0x00)
	{
		if (bLoc57_126 < 0x50)
		{
			byte Eq_422::* di_106;
			struct Eq_463 * es_107;
			fn0967_0066(fp - 0x02, di_123, out di_106, out es_107);
			word16 di_109;
			struct Eq_470 * es_110;
			bx = fn0967_0066(fp - 0x02, di_106, out di_109, out es_110);
		}
		struct Eq_456 Eq_422::* sp_90 = sp_17 + 0x02;
		word16 di_94;
		*diOut = (ss->*sp_90).w0000;
		word16 si_97;
		*siOut = (ss->*sp_90).w0002;
		return bx;
	}
	if (al_45 != 0x25)
	{
l0967_00B0:
		ss->*di_123 = al_116;
		ci8 v16_125 = bLoc57_126 - 0x01;
		di_123 = di_123 + 0x01;
		bLoc57_126 = v16_125;
		if (v16_125 <= 0x00)
			bx = fn0967_0066(fp - 0x02, di_123, out di_123, out es_129);
		goto l0967_00A6;
	}
	al_116 = ds->*si_120;
	ax = DPB(ax, al_116, 0);
	si_120 = si_120 + 0x01;
	if (al_116 == 0x25)
		goto l0967_00B0;
	cu8 ch_142 = 0x00;
	byte bLoc8F_147 = 0x00;
	Eq_480 wLoc94_148 = ~0x00;
	Eq_480 wLoc92_149 = ~0x00;
l0967_00EF:
	word16 ax_173 = DPB(ax, 0x00, 8);
	cu8 bl_177 = (byte) ax_173;
	byte dl_175 = (byte) ax_173;
	struct Eq_491 Eq_93::* bx_179 = DPB(ax_173, bl_177 - 0x20, 0);
	if (bl_177 < 0x80)
	{
		Eq_480 bx_226 = DPB(ax_173, (ds->*bx_179).b045D, 0);
		Eq_480 ax_227 = bx_226;
		if (bx_226 > 0x17)
			goto l0967_0546;
		switch (fp - 0xA0)
		{
		case 0x00:
			if (ch_142 <= 0x00)
				goto l0967_0164;
			goto l0967_0144;
		case 0x01:
			if (ch_142 > 0x00)
				goto l0967_0144;
			break;
		case 0x02:
			ss->*(fp - 0xA2) = es_129;
			ax_227 = *ptrArg04;
			es_129 = ss->*(fp - 0xA2);
			if (ch_142 < 0x02)
				goto l0967_01B1;
			goto l0967_01BA;
		case 0x03:
			if (ch_142 > 0x00)
				goto l0967_0144;
			break;
		case 0x04:
			if (ch_142 < 0x04)
				goto l0967_01CD;
			goto l0967_019D;
		case 0x05:
			Eq_480 ax_346 = (int16) ((byte) ax_173 - 0x30);
			if (ch_142 <= 0x02)
				goto l0967_01DB;
			goto l0967_01F6;
		case 0x06:
			ch_142 = 0x05;
			break;
		case 0x07:
			ch_142 = 0x05;
			break;
		}
l0967_00ED:
		ax = (word16) DPB(ax_227, ds->*si_120, 0);
		si_120 = si_120 + 0x01;
		goto l0967_00EF;
	}
l0967_0546:
	sp_17 = fp - 0xA0;
	byte Eq_93::* si_193 = si_120;
	byte al_199 = 0x25;
	do
	{
		bx = fn0967_005D(al_199, fp - 0x02, di_123, out di_123);
		byte al_210 = ds->*si_193;
		sp_17 = sp_17 + ~0x01;
		si_193 = si_193 + 0x01;
		al_199 = al_210;
	} while (al_210 != 0x00);
	break;
}

// 0967:005D: Register word16 fn0967_005D(Register byte al, Register (memptr (ptr Eq_422) Eq_443) bp, Register (memptr (ptr Eq_422) byte) di, Register out Eq_525 diOut)
word16 fn0967_005D(byte al, Eq_443 Eq_422::*bp, byte Eq_422::*di, Eq_525 & diOut)
{
	ss->*di = al;
	ci8 v8_8 = ss->*(bp - 0x55) - 0x01;
	ss->*(bp - 0x55) = v8_8;
	word16 di_6;
	*diOut = di + 0x01;
	if (v8_8 <= 0x00)
		return bx;
	else
	{
		byte Eq_422::* di_15;
		struct Eq_631 * es_16;
		return fn0967_0066(bp, di + 0x01, out di_15, out es_16);
	}
}

// 0967:0066: Register word16 fn0967_0066(Register (memptr (ptr Eq_422) Eq_443) bp, Register (memptr (ptr Eq_422) byte) di, Register out Eq_445 diOut, Register out (ptr Eq_446) esOut)
word16 fn0967_0066(Eq_443 Eq_422::*bp, byte Eq_422::*di, Eq_445 & diOut, Eq_446 * & esOut)
{
	struct Eq_644 Eq_646::* sp_34;
	word16 bx_35;
	struct Eq_646 * ss_36;
	word16 cx_37;
	word16 dx_38;
	struct Eq_649 * es_39;
	union Eq_663 Eq_646::* bp_40;
	word16 ax_41;
	word16 di_42;
	byte SCZO_43;
	byte SZO_44;
	byte C_45;
	byte Z_46;
	(ss->*bp).ptr0012();
	if (ax_41 == 0x00)
		(ss_36->*(bp_40 - 0x02)).u1 = 0x01;
	(ss_36->*(bp_40 - 0x55)).u0 = 0x50;
	(ss_36->*(bp_40 - 88)).u1 = (word16) (ss_36->*(bp_40 - 88)).u1 + di_42;
	word16 di_55;
	*diOut = bp_40 - 0x54;
	struct Eq_684 * es_56;
	*esOut = (ss_36->*sp_34).ptr0000;
	word16 bx_62 = (ss_36->*sp_34).w0006;
	return bx_62;
}

// 09F1:0007: void fn09F1_0007(Register word16 bx, Register word16 di, Register Eq_93 ds, Stack ci16 wArg04, Stack Eq_93 wArg06)
void fn09F1_0007(word16 bx, word16 di, Eq_93 ds, ci16 wArg04, Eq_93 wArg06)
{
	fn09F4_0005(bx, di, ds, DPB(ptrLoc16, 0xF3, 0), DPB(ptrLoc12, 0x0E, 0), 0x0256, ds, wArg04, wArg06);
	return;
}

// 09F4:0005: void fn09F4_0005(Register word16 bx, Register word16 di, Register Eq_93 ds, Stack ptr32 ptrArg04, Stack ptr32 ptrArg08, Stack word16 wArg0C, Stack Eq_93 wArg0E, Stack word16 wArg10, Stack (ptr Eq_709) psegArg12)
void fn09F4_0005(word16 bx, word16 di, Eq_93 ds, ptr32 ptrArg04, ptr32 ptrArg08, word16 wArg0C, Eq_93 wArg0E, word16 wArg10, Eq_709 * psegArg12)
{
	mp16 sp_16 = fp - 0x32;
	byte Eq_93::* si_159 = wArg10;
l09F4_003A:
	byte al_52 = ds->*si_159;
	byte Eq_93::* si_53 = si_159 + 0x01;
	if (al_52 == 0x00)
		return;
	if (al_52 != 0x25)
	{
		union Eq_740 Eq_741::* sp_147 = sp_16 - 0x02;
		ss->*sp_147 = wArg0E;
		ss->*(sp_147 - 0x02) = wArg0C;
		struct Eq_751 Eq_741::* sp_155;
		word16 bp_156;
		byte SCZO_158;
		Eq_740 di_160;
		struct Eq_755 * es_161;
		byte D_162;
		byte al_163;
		byte SZO_165;
		byte C_166;
		byte Z_167;
		Eq_740 ax_168;
		word16 cx_169;
		byte SO_170;
		byte S_171;
		byte bl_173;
		byte bh_174;
		byte CZ_175;
		ptrArg04();
		sp_16 = (char *) &sp_155->t0002 + 0x02;
		Eq_740 ax_180 = ax_168;
		if (ax_168 >= 0x00)
		{
			if (di_160 < 0x00 || ds->*((word16) di_160 + 1214) != 0x01)
			{
				if (ax_168 == di_160)
					goto l09F4_003A;
				(ss->*sp_155).t0002 = wArg0E;
				(ss->*sp_155).t0000 = wArg0C;
				(ss->*(sp_155 - 0x02)).t0000 = ax_168;
				word16 sp_221;
				word16 bp_222;
				struct Eq_921 * ss_223;
				byte SCZO_224;
				word16 si_225;
				word16 di_226;
				struct Eq_925 * es_227;
				byte D_228;
				byte al_229;
				struct Eq_928 * ds_230;
				byte SZO_231;
				byte C_232;
				byte Z_233;
				word16 ax_234;
				word16 cx_235;
				byte SO_236;
				byte S_237;
				word16 bx_238;
				byte bl_239;
				byte bh_240;
				byte CZ_241;
				ptrArg08();
				return;
			}
			do
			{
				ci8 bl_269 = (byte) ax_180;
				Eq_740 bx_272 = DPB(ax_180, bl_269, 0);
				if (bl_269 < 0x00 || ds->*((word16) bx_272 + 1214) != 0x01)
				{
					union Eq_740 Eq_741::* sp_277 = sp_16 - 0x02;
					ss->*sp_277 = wArg0E;
					ss->*(sp_277 - 0x02) = wArg0C;
					ss->*(sp_277 - 0x04) = bx_272;
					word16 sp_284;
					word16 bp_285;
					byte SCZO_287;
					word16 di_289;
					struct Eq_808 * es_290;
					byte D_291;
					byte al_292;
					byte SZO_294;
					byte C_295;
					byte Z_296;
					word16 ax_297;
					word16 cx_298;
					byte SO_299;
					byte S_300;
					byte bl_302;
					byte bh_303;
					byte CZ_304;
					ptrArg08();
					sp_16 = sp_284 + 0x06;
					goto l09F4_003A;
				}
				union Eq_740 Eq_741::* sp_316 = sp_16 - 0x02;
				ss->*sp_316 = wArg0E;
				ss->*(sp_316 - 0x02) = wArg0C;
				word16 sp_321;
				word16 bp_322;
				byte SCZO_324;
				word16 si_325;
				word16 di_326;
				struct Eq_845 * es_327;
				byte D_328;
				byte al_329;
				byte SZO_331;
				byte C_332;
				byte Z_333;
				Eq_740 ax_334;
				word16 cx_335;
				byte SO_336;
				byte S_337;
				word16 bx_338;
				byte bl_339;
				byte bh_340;
				byte CZ_341;
				ptrArg04();
				sp_16 = sp_321 + 0x04;
				ax_180 = ax_334;
			} while (ax_334 > 0x00);
		}
	}
	else
	{
		int16 ax_355 = (int16) (ds->*si_53);
		if (ax_355 < 0x00)
			goto l09F4_0112;
		if (DPB(bx, 0x00, 8) <= 0x15)
		{
			switch (ax_355)
			{
			case 0x00:
				break;
			}
			return;
		}
	}
	union Eq_740 Eq_741::* sp_102 = sp_16 - 0x02;
	ss->*sp_102 = wArg0E;
	ss->*(sp_102 - 0x02) = wArg0C;
	(ss->*(sp_102 - 0x04)).u0 = ~0x00;
	word16 sp_112;
	word16 bp_113;
	struct Eq_882 * ss_114;
	byte SCZO_115;
	word16 si_116;
	word16 di_117;
	struct Eq_886 * es_118;
	byte D_119;
	byte al_120;
	struct Eq_889 * ds_121;
	byte SZO_122;
	byte C_123;
	byte Z_124;
	word16 ax_125;
	word16 cx_126;
	byte SO_127;
	byte S_128;
	word16 bx_129;
	byte bl_130;
	byte bh_131;
	byte CZ_132;
	ptrArg08();
	return;
}

