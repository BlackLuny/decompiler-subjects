// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 087B:0004: void main(Register (ptr Eq_46) ds)
void main(Eq_46 * ds)
{
	wchar_t si_22 = fn0CFE_0002(ds, 0x98, ds);
	if (si_22 >= 0x06)
	{
		fn0CFE_0002(ds, 0x011C, ds);
		return;
	}
	else if (si_22 <= 0x05)
	{
		Eq_62 bx_53 = si_22 << 0x01;
		word16 sp_57;
		word16 bp_58;
		struct Eq_67 * ss_59;
		byte SCZO_60;
		word16 si_61;
		byte SZO_62;
		byte C_63;
		word16 ax_64;
		struct Eq_73 * ds_65;
		byte SO_66;
		byte CZ_67;
		word16 bx_68;
		(seg087B->*((word16) bx_53 + 0x0035))();
		return;
	}
	else
	{
		si_22 = si_22 + 0x01;
		goto l087B_01A6;
	}
}

// 0CFE:0002: Register word16 fn0CFE_0002(Register (ptr Eq_46) ds, Stack word16 wArg04, Stack (ptr Eq_46) wArg06)
word16 fn0CFE_0002(Eq_46 * ds, word16 wArg04, Eq_46 * wArg06)
{
	word16 si_36 = fn0D28_002B(ds, DPB(ptrLoc12, fp + 0x08, 0), DPB(ptrLoc0E, wArg04, 0), wArg06);
	return si_36;
}

// 0D28:002B: Register word16 fn0D28_002B(Register (ptr Eq_46) ds, Stack segptr32 ptrArg04, Stack segptr32 ptrArg08, Stack (ptr Eq_89) psegArg0A)
word16 fn0D28_002B(Eq_46 * ds, segptr32 ptrArg04, segptr32 ptrArg08, Eq_89 * psegArg0A)
{
	ci8 bLoc57_114 = 0x50;
	mp16 sp_17 = fp - 0xA0;
	byte Eq_128::* di_111 = fp - 0x56;
	struct Eq_110 * es_116 = SLICE(ptrArg08, selector, 16);
	byte Eq_46::* si_108 = (word16) ptrArg08;
l0D28_009A:
	byte al_41 = ds->*si_108;
	si_108 = si_108 + 0x01;
	byte al_104 = al_41;
	ax = DPB(ax, al_41, 0);
	if (al_41 == 0x00)
	{
		if (bLoc57_114 < 0x50)
		{
			struct Eq_166 * es_97;
			struct Eq_167 * es_99;
			fn0D28_005A(fp - 0x02, fn0D28_005A(fp - 0x02, di_111, out es_97), out es_99);
		}
		struct Eq_160 Eq_128::* sp_84 = sp_17 + 0x02;
		return (ss->*sp_84).w0002;
	}
	if (al_41 != 0x25)
	{
l0D28_00A4:
		ss->*di_111 = al_104;
		ci8 v16_113 = bLoc57_114 - 0x01;
		di_111 = di_111 + 0x01;
		bLoc57_114 = v16_113;
		if (v16_113 <= 0x00)
			di_111 = fn0D28_005A(fp - 0x02, di_111, out es_116);
		goto l0D28_009A;
	}
	al_104 = ds->*si_108;
	ax = DPB(ax, al_104, 0);
	si_108 = si_108 + 0x01;
	if (al_104 == 0x25)
		goto l0D28_00A4;
	cu8 ch_129 = 0x00;
	byte bLoc8F_134 = 0x00;
	Eq_180 wLoc94_135 = ~0x00;
	Eq_180 wLoc92_136 = ~0x00;
l0D28_00E3:
	word16 ax_160 = DPB(ax, 0x00, 8);
	cu8 bl_164 = (byte) ax_160;
	byte dl_162 = (byte) ax_160;
	struct Eq_191 Eq_46::* bx_166 = DPB(ax_160, bl_164 - 0x20, 0);
	if (bl_164 < 0x80)
	{
		Eq_180 bx_212 = DPB(ax_160, (ds->*bx_166).b059D, 0);
		Eq_180 ax_213 = bx_212;
		if (bx_212 > 0x17)
			goto l0D28_053A;
		switch (fp - 0xA0)
		{
		case 0x00:
			if (ch_129 <= 0x00)
				goto l0D28_0158;
			goto l0D28_0138;
		case 0x01:
			if (ch_129 > 0x00)
				goto l0D28_0138;
			break;
		case 0x02:
			ss->*(fp - 0xA2) = es_116;
			ax_213 = *ptrArg04;
			es_116 = ss->*(fp - 0xA2);
			if (ch_129 < 0x02)
				goto l0D28_01A5;
			goto l0D28_01AE;
		case 0x03:
			if (ch_129 > 0x00)
				goto l0D28_0138;
			break;
		case 0x04:
			if (ch_129 < 0x04)
				goto l0D28_01C1;
			goto l0D28_0191;
		case 0x05:
			Eq_180 ax_332 = (int16) ((byte) ax_160 - 0x30);
			if (ch_129 <= 0x02)
				goto l0D28_01CF;
			goto l0D28_01EA;
		case 0x06:
			ch_129 = 0x05;
			break;
		case 0x07:
			ch_129 = 0x05;
			break;
		}
l0D28_00E1:
		ax = (word16) DPB(ax_213, ds->*si_108, 0);
		si_108 = si_108 + 0x01;
		goto l0D28_00E3;
	}
l0D28_053A:
	sp_17 = fp - 0xA0;
	byte Eq_46::* si_180 = si_108;
	byte al_186 = 0x25;
	do
	{
		di_111 = fn0D28_0051(al_186, fp - 0x02, di_111);
		byte al_196 = ds->*si_180;
		sp_17 = sp_17 + ~0x01;
		si_180 = si_180 + 0x01;
		al_186 = al_196;
	} while (al_196 != 0x00);
	break;
}

// 0D28:0051: Register (memptr (ptr Eq_128) byte) fn0D28_0051(Register byte al, Register (memptr (ptr Eq_128) Eq_149) bp, Register (memptr (ptr Eq_128) byte) di)
byte Eq_128::*fn0D28_0051(byte al, Eq_149 Eq_128::*bp, byte Eq_128::*di)
{
	ss->*di = al;
	ci8 v8_8 = ss->*(bp - 0x55) - 0x01;
	ss->*(bp - 0x55) = v8_8;
	if (v8_8 <= 0x00)
		return di + 0x01;
	else
	{
		struct Eq_318 * es_13;
		byte Eq_128::* di_14 = fn0D28_005A(bp, di + 0x01, out es_13);
		return di_14;
	}
}

// 0D28:005A: Register (memptr (ptr Eq_128) byte) fn0D28_005A(Register (memptr (ptr Eq_128) Eq_149) bp, Register (memptr (ptr Eq_128) byte) di, Register out (ptr Eq_151) esOut)
byte Eq_128::*fn0D28_005A(Eq_149 Eq_128::*bp, byte Eq_128::*di, Eq_151 * & esOut)
{
	struct Eq_367 * Eq_128::* sp_34;
	word16 bx_35;
	struct Eq_128 * ss_36;
	word16 cx_37;
	word16 dx_38;
	struct Eq_333 * es_39;
	union Eq_347 Eq_128::* bp_40;
	word16 ax_41;
	word16 di_42;
	byte SCZO_43;
	byte SZO_44;
	byte C_45;
	byte Z_46;
	(ss->*bp).ptr0012();
	if (ax_41 == 0x00)
		(ss_36->*(bp_40 - 0x02)).u1 = 0x01;
	(ss_36->*(bp_40 - 0x55)).u0 = 0x50;
	(ss_36->*(bp_40 - 88)).u1 = (word16) (ss_36->*(bp_40 - 88)).u1 + di_42;
	struct Eq_364 * es_56;
	*esOut = ss_36->*sp_34;
	return bp_40 - 0x54;
}

