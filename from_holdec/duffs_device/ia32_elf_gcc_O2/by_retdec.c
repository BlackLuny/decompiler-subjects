//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2017 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>

// ------------------- Function Prototypes --------------------

void copy1_eight_times(int16_t * to, int16_t * from, int32_t count);
void copy1_four_times(int16_t * to, int16_t * from, int32_t count);
void copy2_eight_times(int16_t * to, int16_t * from, int32_t n);
void copy2_four_times(int16_t * to, int16_t * from, int32_t n);

// --------------------- Global Variables ---------------------

bool g1 = false; // cf
int32_t g2 = 0; // ebx
int32_t g3 = 0; // edx
bool g4 = false; // zf

// ------------------------ Functions -------------------------

// From module:   /tmp/a/decompiler-subjects/from_holdec/duffs_device/source.c
// Address range: 0x80483d0 - 0x804846f
// Line range:    4 - 7
void copy1_four_times(int16_t * to, int16_t * from, int32_t count) {
    int32_t v1 = (int32_t)to; // 0x80483d7_0
    int32_t v2 = v1; // ecx
    int32_t v3 = g2; // bp-12
    int32_t v4 = (int32_t)from; // 0x80483db_0
    int32_t v5 = v4; // edx
    int32_t v6 = count + 3; // 0x80483e0
    int32_t v7 = v6; // 0x80483f8
    if (v6 < 0) {
        // if_80483e6_0_true
        v7 = count + 6;
        // branch -> after_if_80483e6_0
    }
    int32_t v8 = count % 4; // 0x80483f6
    int32_t v9 = v7 / 4; // 0x80483f8
    int32_t v10; // 0x804842d
    int32_t v11; // 0x804844f
    int32_t v12; // 0x8048458
    int32_t v13; // 0x8048424
    int32_t v14; // 0x8048430
    int32_t v15; // 0x8048438
    int32_t v16; // 0x8048443
    int32_t v17; // 0x804844c
    if (v8 == 1) {
        v15 = v1;
        v14 = v4;
      lab_0x8048430_3:;
        int32_t v18 = v9 - 1; // 0x8048433
        v9 = v18;
        *(int16_t *)v15 = *(int16_t *)v14;
        if (v18 >= 1) {
            int32_t v19 = v2 + 2; // 0x804843d
            v16 = v5 + 2;
            // branch -> 0x8048443
            // 0x8048443
            *(int16_t *)v19 = *(int16_t *)v16;
            v17 = v16 + 2;
            v11 = v19 + 2;
            *(int16_t *)v11 = *(int16_t *)v17;
            v12 = v11 + 2;
            // branch -> 0x8048424
          lab_0x8048424:
            // 0x8048424
            v13 = v17 + 2;
            v5 = v13 + 2;
            *(int16_t *)v12 = *(int16_t *)v13;
            v10 = v12 + 2;
            v2 = v10;
            v15 = v10;
            v14 = v5;
            // branch -> 0x8048430
            goto lab_0x8048430_3;
        }
        // 0x8048430
        // branch -> 0x804840c
        // 0x804840c
        g2 = v3;
        return;
    }
    // 0x8048400
    int32_t v20; // 0x804840c
    if (v8 < 2) {
        // 0x8048460
        v20 = g2;
        // 0x804840c
        g2 = v20;
        return;
    }
    // 0x8048402
    if (v8 != 2) {
        // 0x8048407
        v20 = g2;
        if (v8 == 3) {
            // 0x8048418
            *to = *from;
            int32_t v21 = v2 + 2; // 0x8048421
            // branch -> 0x8048424
            // 0x8048424
            v13 = v4 + 2;
            v5 = v13 + 2;
            *(int16_t *)v21 = *(int16_t *)v13;
            v10 = v21 + 2;
            v2 = v10;
            v15 = v10;
            v14 = v5;
            // branch -> 0x8048430
            goto lab_0x8048430_3;
        }
        // 0x804840c
        g2 = v20;
        return;
    }
  lab_0x8048424_2:
    // 0x8048424
    v13 = v5;
    v5 = v13 + 2;
    *(int16_t *)v1 = *(int16_t *)v13;
    v10 = v2 + 2;
    v2 = v10;
    v15 = v10;
    v14 = v5;
    // branch -> 0x8048430
    goto lab_0x8048430_3;
}

// From module:   /tmp/a/decompiler-subjects/from_holdec/duffs_device/source.c
// Address range: 0x8048470 - 0x804851f
// Line range:    21 - 27
void copy1_eight_times(int16_t * to, int16_t * from, int32_t count) {
    int32_t v1 = (int32_t)to; // 0x8048477_0
    int32_t v2 = v1; // edx
    int32_t v3 = g2; // bp-12
    int32_t v4 = (int32_t)from; // 0x804847b_0
    int32_t v5 = count + 7; // 0x8048480
    int32_t v6 = v5; // 0x8048498
    if (v5 < 0) {
        // if_8048486_0_true
        v6 = count + 14;
        // branch -> after_if_8048486_0
    }
    int32_t v7 = g2; // 0x80484a0
    int32_t v8; // 0x80484c2
    int32_t v9; // 0x80484ce
    int32_t v10; // 0x80484da
    int32_t v11; // 0x80484e6
    int32_t v12; // 0x80484f2
    int32_t v13; // 0x8048500
    int32_t v14; // 0x8048511
    switch (count % 8) {
        case 0: {
            v14 = v1;
          lab_0x804850b:
            // 0x804850b
            *(int16_t *)v14 = *(int16_t *)v4;
            // branch -> 0x80484b0
            break;
        }
        case 1: {
            v13 = v1;
          lab_0x80484f8:
            // 0x80484f8
            *(int16_t *)v13 = *(int16_t *)v4;
            if (v6 / 8 >= 2) {
                // 0x8048505
                v14 = v2 + 2;
                v4 += 2;
                // branch -> 0x804850b
                goto lab_0x804850b;
            }
            // 0x80484f8
            // branch -> 0x80484a0
            // 0x80484a0
            g2 = v3;
            return;
        }
        case 2: {
            v12 = v1;
          lab_0x80484ec:
            // 0x80484ec
            v4 += 2;
            *(int16_t *)v12 = *(int16_t *)v4;
            int32_t v15 = v2 + 2; // 0x80484f5
            v2 = v15;
            v13 = v15;
            // branch -> 0x80484f8
            goto lab_0x80484f8;
            break;
        }
        case 3: {
            v11 = v1;
          lab_0x80484e0:
            // 0x80484e0
            *(int16_t *)v11 = *(int16_t *)v4;
            int32_t v16 = v2 + 2; // 0x80484e9
            v2 = v16;
            v12 = v16;
            v4 += 2;
            // branch -> 0x80484ec
            goto lab_0x80484ec;
            break;
        }
        case 4: {
            v10 = v1;
          lab_0x80484d4:
            // 0x80484d4
            *(int16_t *)v10 = *(int16_t *)v4;
            int32_t v17 = v2 + 2; // 0x80484dd
            v2 = v17;
            v11 = v17;
            v4 += 2;
            // branch -> 0x80484e0
            goto lab_0x80484e0;
            break;
        }
        case 5: {
            v9 = v1;
          lab_0x80484c8:
            // 0x80484c8
            *(int16_t *)v9 = *(int16_t *)v4;
            int32_t v18 = v2 + 2; // 0x80484d1
            v2 = v18;
            v10 = v18;
            v4 += 2;
            // branch -> 0x80484d4
            goto lab_0x80484d4;
            break;
        }
        case 6: {
            v8 = v1;
          lab_0x80484bc:
            // 0x80484bc
            *(int16_t *)v8 = *(int16_t *)v4;
            int32_t v19 = v2 + 2; // 0x80484c5
            v2 = v19;
            v9 = v19;
            v4 += 2;
            // branch -> 0x80484c8
            goto lab_0x80484c8;
            break;
        }
        case 7: {
            // 0x80484b0
            *(int16_t *)v1 = *(int16_t *)v4;
            int32_t v20 = v2 + 2; // 0x80484b9
            v2 = v20;
            v8 = v20;
            v4 += 2;
            // branch -> 0x80484bc
            goto lab_0x80484bc;
        }
    }
    // 0x80484a0
    g2 = v7;
}

// From module:   /tmp/a/decompiler-subjects/from_holdec/duffs_device/source.c
// Address range: 0x8048520 - 0x804859f
// Line range:    46 - 76
void copy2_four_times(int16_t * to, int16_t * from, int32_t n) {
    int32_t v1 = (int32_t)to; // 0x8048524_0
    int32_t v2 = g2; // 0x8048527
    int32_t v3 = (int32_t)from; // 0x804852b_0
    if (n < 1) {
        // 0x8048596
        g2 = v2;
        return;
    }
    int32_t v4 = 4 - n; // 0x804853e
    int32_t v5 = (n - 4 & -4) + 8 - n; // esi
    // branch -> 0x8048556
    while (true) {
        // 0x8048556
        int32_t v6; // 0x804857a
        int32_t v7; // 0x804858c
        int32_t v8; // 0x8048571
        int32_t v9; // 0x804857d
        int32_t v10; // 0x8048583
        switch (v4) {
            default: {
                // 0x8048565
                *(int16_t *)v1 = *(int16_t *)v3;
                int32_t v11 = v1 + 2; // 0x804856e
                v8 = v3 + 2;
                // branch -> 0x8048571
                // 0x8048571
                *(int16_t *)v11 = *(int16_t *)v8;
                v6 = v11 + 2;
                v10 = v6;
                v9 = v8 + 2;
                // branch -> 0x804857d
                // 0x804857d
                v3 = v9 + 2;
                *(int16_t *)v10 = *(int16_t *)v9;
                int32_t v12 = v6 + 2; // 0x8048586
                v1 = v12;
                // branch -> 0x8048589
                // 0x8048589
                v7 = v4 + 4;
                v4 = v7;
                *(int16_t *)v12 = *(int16_t *)v3;
                if (v7 == v5) {
                    // 0x8048596
                    // branch -> 0x8048596
                    // 0x8048596
                    g2 = v2;
                    return;
                }
                break;
            }
            case 2: {
              lab_0x804857d:
                // 0x804857d
                v3 = v9 + 2;
                *(int16_t *)v10 = *(int16_t *)v9;
                v1 += 2;
                // branch -> 0x8048589
            }
            case 3: {
                // 0x8048589
                v7 = 7;
                v4 = v7;
                *(int16_t *)v1 = *(int16_t *)v3;
                if (v7 == v5) {
                    // 0x8048596
                    // branch -> 0x8048596
                    // 0x8048596
                    g2 = v2;
                    return;
                }
                break;
            }
            case 1: {
                v8 = v3;
                // 0x8048571
                *(int16_t *)v1 = *(int16_t *)v8;
                v6 = v1 + 2;
                v1 = v6;
                v10 = v6;
                v9 = v8 + 2;
                // branch -> 0x804857d
                goto lab_0x804857d;
            }
        }
        // 0x8048550
        v1 += 2;
        v3 += 2;
        // branch -> 0x8048556
    }
}

// From module:   /tmp/a/decompiler-subjects/from_holdec/duffs_device/source.c
// Address range: 0x80485a0 - 0x804864f
// Line range:    79 - 113
void copy2_eight_times(int16_t * to, int16_t * from, int32_t n) {
    int32_t v1 = (int32_t)to; // 0x80485a4_0
    int32_t v2 = (int32_t)from; // 0x80485ab_0
    g3 = v2;
    g1 = false;
    if (n < 1) {
        // 0x8048648
        return;
    }
    int32_t v3 = 8 - n; // 0x804863c
    // branch -> 0x8048637
    while (true) {
        // 0x8048637
        int32_t v4; // 0x80485d9
        int32_t v5; // 0x80485e5
        int32_t v6; // 0x80485f1
        int32_t v7; // 0x80485fd
        int32_t v8; // 0x8048609
        int32_t v9; // 0x8048615
        int32_t v10; // 0x80485dc
        int32_t v11; // 0x80485e8
        int32_t v12; // 0x80485f4
        int32_t v13; // 0x8048600
        int32_t v14; // 0x804860c
        int32_t v15; // 0x8048618
        switch (v3) {
            default: {
                // 0x80485d0
                *(int16_t *)v1 = *(int16_t *)v2;
                v4 = v1 + 2;
                v1 = v4;
                // branch -> 0x80485dc
                v10 = v2 + 2;
            }
            case 1: {
                // 0x80485dc
                *(int16_t *)v4 = *(int16_t *)v10;
                v5 = v1 + 2;
                v1 = v5;
                // branch -> 0x80485e8
                v11 = v10 + 2;
            }
            case 2: {
                // 0x80485e8
                *(int16_t *)v5 = *(int16_t *)v11;
                v6 = v1 + 2;
                v1 = v6;
                // branch -> 0x80485f4
                v12 = v11 + 2;
            }
            case 3: {
                // 0x80485f4
                *(int16_t *)v6 = *(int16_t *)v12;
                v7 = v1 + 2;
                v1 = v7;
                // branch -> 0x8048600
                v13 = v12 + 2;
            }
            case 4: {
                // 0x8048600
                *(int16_t *)v7 = *(int16_t *)v13;
                v8 = v1 + 2;
                v1 = v8;
                // branch -> 0x804860c
                v14 = v13 + 2;
            }
            case 5: {
                // 0x804860c
                *(int16_t *)v8 = *(int16_t *)v14;
                v9 = v1 + 2;
                v1 = v9;
                // branch -> 0x8048618
                v15 = v14 + 2;
            }
            case 6: {
                // 0x8048618
                g3 = v15 + 2;
                *(int16_t *)v9 = *(int16_t *)v15;
                v1 += 2;
                // branch -> 0x8048624
            }
            case 7: {
                int32_t v16 = 15; // 0x8048627
                *(int16_t *)v1 = *(int16_t *)v2;
                if (v16 == (n - 8 & -8) + 16 - n) {
                    // 0x8048648
                    g1 = false;
                    // branch -> 0x8048648
                    // 0x8048648
                    return;
                }
                int32_t v17 = g3 + 2; // 0x8048634
                g3 = v17;
                v1 += 2;
                v2 = v17;
                v3 = v16;
                // branch -> 0x8048637
                continue;
            }
        }
    }
}

// From module:   /tmp/a/decompiler-subjects/from_holdec/duffs_device/source.c
// Address range: 0x8048650 - 0x80486ef
// Line range:    115 - 124
int main(int argc, char ** argv) {
    char * mem = malloc(200); // 0x8048662
    char * mem2 = malloc(200); // 0x8048670
    copy1_four_times((int16_t *)mem2, (int16_t *)mem, 100);
    copy1_eight_times((int16_t *)mem2, (int16_t *)mem, 100);
    copy2_four_times((int16_t *)mem2, (int16_t *)mem, 100);
    copy2_eight_times((int16_t *)mem2, (int16_t *)mem, 100);
    uint32_t strncmp_rc = strncmp(mem, mem2, 200);
    g4 = strncmp_rc % 2 == 0;
    return ((int32_t)(g1 | strncmp_rc % 2 == 0) ^ 1) - (int32_t)g1;
}

// --------------- Dynamically Linked Functions ---------------

// void * malloc(size_t size);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (4.4.5)
// Detected language: C
// Detected functions: 5
// Decompiler release: VERSION
// Decompilation date: DATE
