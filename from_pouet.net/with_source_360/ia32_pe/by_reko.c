// subject.c
// Generated by decompiling subject.exe
// using Reko decompiler version VERSION

#include "subject.h"

// 00401000: void fn00401000()
void fn00401000()
{
	Eq_2 edx_20 = globals->t402104;
	Eq_5 bl_21 = 0x00;
	do
	{
		if (bl_21 >= 0x80)
			*edx_20 = bl_21 << 0x01;
		struct Eq_7 * edx_15 = (word32) edx_20 + 0x01;
		edx_15->t0000 = bl_21 << 0x01;
		edx_15->t0001 = bl_21 << 0x01;
		edx_20 = (char *) &edx_15->t0001 + 0x02;
		bl_21 = (word32) bl_21 + 0x01;
	} while (bl_21 != 0x00);
	return;
}

// 00401020: void fn00401020(FpuStack real64 rArg0)
void fn00401020(real64 rArg0)
{
	globals->w40213C = globals->w40213C - 0x01;
	ptr32 esp_193 = fp - 0x20;
	word32 eax_125 = 0x00;
	word16 cx_116 = 0x00;
	word16 bx_155 = 0x00;
	ptr32 ebx_156 = 0x00;
	byte bl_157 = 0x00;
	byte bh_158 = 0x00;
	do
	{
		byte al_75 = bl_157;
		word32 eax_100 = DPB(eax_125, bl_157, 0);
		word16 dx_78 = 0xF400;
		do
		{
			int16 ax_90 = (int16) (al_75 - 0x80);
			globals->w40213E = ax_90;
			bi8 al_91 = (byte) ax_90;
			dx_78 = dx_78 - al_91 *s al_91;
			cu8 dh_96 = SLICE(dx_78, byte, 8);
			real64 rLoc1_98 = (real64) globals->w40213E;
			al_75 = bh_158;
			eax_100 = DPB(eax_526, bh_158, 0);
			word32 eax_526 = eax_100;
		} while (P);
		rArg0 = atan(rArg0, rLoc1_98) * (real64) globals->w40213A;
		globals->w40213E = (int16) rArg0;
		word16 ax_111 = globals->w40213E + globals->w40213B;
		cui16 ax_118 = DPB(ax_111, dh_96, 0);
		byte ah_112 = SLICE(ax_111, byte, 8);
		byte cl_114 = 0x00;
		cx_116 = DPB(cx_116, 0x00, 0);
		eax_125 = DPB(eax_526, dh_96, 0);
		byte dh_128 = (byte) (ax_118 & 0x0707) + SLICE(ax_118 & 0x0707, byte, 8) + dh_96;
		if (dh_96 >= ~0x10)
		{
			cl_114 = 0x50;
			cx_116 = DPB(cx_116, 0x50, 0);
		}
		if (dh_96 <= ~0x15)
		{
			cx_116 = DPB(cx_116, ah_112 & 0x1F, 8);
			if ((ah_112 & 0x1F) <= 0x03)
			{
				if (dh_96 >= 233)
				{
					dh_128 = __ror(dh_96, 0x03) + 155;
					cx_116 = cx_116 - 0x01;
					cl_114 = (byte) (cx_116 - 0x01);
				}
				dh_128 = dh_128 - 0x14;
			}
			if (dh_96 <= 0xB4)
			{
				cx_116 = cx_116 - 0x01;
				cl_114 = (byte) cx_116;
			}
		}
		*((char *) globals->t40211C + ebx_156) = (Eq_115) cl_114;
		Eq_118 ebp_153 = globals->t402120;
		*((char *) ebp_153 + ebx_156) = (Eq_118) (dh_128 + 0x80);
		bx_155 = bx_155 + 0x01;
		ebx_156 = DPB(ebx_156, bx_155, 0);
		bl_157 = (byte) bx_155;
		bh_158 = SLICE(bx_155, byte, 8);
	} while (bx_155 != 0x00);
	ptr32 edi_161 = 0x0003E800;
	word16 si_163 = ~0x63;
	do
	{
		word16 bp_194 = ~0x9F;
		ebp_153 = DPB(ebp_153, ~0x9F, 0);
		do
		{
			HGLOBAL * esp_211 = esp_193 - 0x04;
			*esp_211 = (HGLOBAL *) ebp_153;
			*(esp_211 - 0x04) = edi_161;
			int32 dx_ax_222 = (int32) (int16) (byte) (globals->w40213C << 0x01);
			bi8 al_226 = ((byte) dx_ax_222 & 0x7F) - 0x40;
			int16 ax_227 = al_226 *s al_226;
			int16 ax_230 = DPB(ax_227, SLICE(ax_227, byte, 8) - 0x10, 8);
			ui16 dx_231 = SLICE(dx_ax_222, word16, 16) ^ ax_230;
			word16 cx_215 = 0x7F40;
			ui16 dx_238 = DPB(dx_231, SLICE(dx_231, byte, 8) + 0x24, 8);
			ui32 eax_241 = DPB(eax_125, SLICE(ax_230 * 0x02, byte, 8) - 0x01, 8);
l00401106:
			struct Eq_168 * esp_259 = esp_193 - 0x08;
			*(esp_259 - 0x04) = (HGLOBAL *) ebp_153;
			cx_215 = cx_215 + bp_194;
			ebx_156 = DPB(ebx_156, SLICE(cx_215, byte, 8), 0);
			dx_238 = dx_238 + si_163;
			byte al_276 = *((char *) globals->t402120 + ebx_156);
			ebp_153 = (Eq_118) *(esp_259 - 0x04);
			char dh_265 = SLICE(dx_238, byte, 8);
			char ah_274 = *((char *) globals->t40211C + ebx_156);
			eax_241 = DPB(eax_527, al_276, 0);
			bp_194 = (word16) ebp_153;
			if (ah_274 >= 0x00)
			{
				if (ah_274 != 0x00)
				{
					ui32 eax_527 = eax_241;
					if (dh_265 < ah_274)
						continue;
					if (dh_265 >= ah_274)
						eax_241 = DPB(eax_527, al_276 + ah_274, 0);
				}
				if (dh_265 <= 0x46)
					goto l00401106;
			}
			ui32 eax_305 = *((word32) globals->t402104 + (eax_241 & 0xFF) * 0x04);
			Mem306[Mem272[esp_259 + 0x00:word32] + Mem272[0x00402100:word32]:word32] = eax_305;
			Eq_182 edi_314 = esp_259->t0008;
			eax_125 = (word32) *((word32) globals->t402104 + (eax_305 & 0xFF) * 0x04);
			Mem321[edi_314 + Mem306[0x00402100:word32]:word32] = eax_125;
			Eq_197 ebp_322 = esp_259->t000C;
			word16 bp_323 = (word16) ebp_322;
			esp_193 = &esp_259->dw0010;
			edi_161 = edi_314 - 0x04;
			bp_194 = bp_323 + 0x01;
			ebp_153 = (Eq_118) DPB(ebp_322, bp_323 + 0x01, 0);
		} while (bp_323 != ~0x9E);
		word16 si_331 = si_163 + 0x01;
		si_163 = si_331 + 0x01;
	} while (si_331 != ~0x62);
	esp_259->t002C.u0 = 0x004020F0;
	esp_259->t0028 = globals->t4020CC;
	GetClientRect(esp_259->t0028, esp_259->t002C);
	esp_259->t002C.u0 = 0x00CC0020;
	&esp_259->t0028.u0->unused = 0x00;
	esp_259->ptr0024 = &globals->t40206C;
	esp_259->t0020 = globals->t402100;
	esp_259->t001C = (struct HDC__ *) 200;
	esp_259->dw0018 = 0x0140;
	esp_259->dw0014 = 0x00;
	esp_259->dw0010 = 0x00;
	esp_259->t000C = globals->t4020FC;
	esp_259->t0008 = globals->t4020F8;
	esp_259->ptr0004 = null;
	esp_259->t0000.u0 = 0x00;
	*(esp_259 - 0x04) = (HDC *) globals->t4020D0;
	StretchDIBits(*(esp_259 - 0x04), esp_259->t0000, esp_259->ptr0004, esp_259->t0008, esp_259->t000C, esp_259->dw0010, esp_259->dw0014, esp_259->dw0018, esp_259->t001C, esp_259->t0020, esp_259->ptr0024, esp_259->t0028, esp_259->t002C);
	return;
	esp_259->t004C.u0 = 0x004020F0;
	esp_259->t0048 = globals->t4020CC;
	GetClientRect(esp_259->t0048, esp_259->t004C);
	esp_259->t004C.u0 = 0x00CC0020;
	&esp_259->t0048.u0->unused = 0x00;
	esp_259->ptr0044 = &globals->t40206C;
	esp_259->t0040 = globals->t402100;
	esp_259->t003C = (struct HDC__ *) 200;
	esp_259->dw0038 = 0x0140;
	esp_259->dw0034 = 0x00;
	esp_259->dw0030 = 0x00;
	esp_259->t002C = globals->t4020FC;
	esp_259->t0028 = globals->t4020F8;
	esp_259->ptr0024 = null;
	esp_259->t0020.u0 = 0x00;
	esp_259->t001C = globals->t4020D0;
	StretchDIBits(esp_259->t001C, esp_259->t0020, esp_259->ptr0024, esp_259->t0028, esp_259->t002C, esp_259->dw0030, esp_259->dw0034, esp_259->dw0038, esp_259->t003C, esp_259->t0040, esp_259->ptr0044, esp_259->t0048, esp_259->t004C);
	return;
}

// 004011C5: Register Eq_197 Win32CrtStartup()
Eq_197 Win32CrtStartup()
{
	Eq_2 eax_6 = GlobalAlloc(0x00, 1000000);
	if (eax_6 != 0x00)
	{
		globals->t40210C = eax_6;
		globals->t402104 = eax_6;
		Mem78[0x00402100:word32] = eax_6 + 2000;
		Mem80[0x0040211C:word32] = eax_6 + 402000;
		Mem82[0x00402120:word32] = eax_6 + 602000;
		globals->t4020B4 = GetModuleHandleW(null);
		globals->t4020B8 = LoadIconW(0x00, (WCHAR *) 0x7F00);
		Eq_618 eax_99 = LoadCursorW(0x00, (WCHAR *) 0x7F00);
		globals->t4020BC = eax_99;
		if (DPB(eax_99, RegisterClassW(&globals->t4020A4), 0) != null)
		{
			Eq_182 eax_134 = CreateWindowExW(0x00, &globals->t402000, &globals->t402012, 0x10CF0000, 0x8000, 0x8000, 0x021C, 400, 0x00, null, globals->t4020B4, null);
			if (eax_134 != 0x00)
			{
				globals->t4020CC = eax_134;
				globals->t4020D0 = GetDC(eax_134);
				fn00401000();
				fn00401020(rArg0);
				*(fp - 0x04) = 0x04;
				*(fp - 0x08) = (HDC *) globals->t4020D0;
				SetStretchBltMode(*(fp - 0x08), *(fp - 0x04));
				while (true)
				{
					*(fp - 0x04) = 0x01;
					*(fp - 0x08) = 0x00;
					*(fp - 0x0C) = 0x00;
					*(fp - 0x10) = 0x00;
					*(fp - 0x14) = 0x004020D4;
					PeekMessageW(*(fp - 0x14), *(fp - 0x10), *(fp - 0x0C), *(fp - 0x08), *(fp - 0x04));
					if (globals->dw4020D8 == 0x12)
						break;
					*(fp - 0x04) = 0x004020D4;
					TranslateMessage(*(fp - 0x04));
					*(fp - 0x04) = 0x004020D4;
					DispatchMessageW(*(fp - 0x04));
					fn00401020(rArg1);
					globals->dw402108 = globals->dw402108 + 0x01;
				}
l004012FA:
				*(fp - 0x04) = (HDC *) globals->t4020D0;
				*(fp - 0x08) = (union Eq_182 *) globals->t4020CC;
				ReleaseDC(*(fp - 0x08), *(fp - 0x04));
				*(fp - 0x04) = (union Eq_2 *) globals->t40210C;
				GlobalFree(*(fp - 0x04));
				*(fp - 0x04) = globals->dw4020DC;
				ExitProcess(*(fp - 0x04));
			}
		}
	}
	MessageBoxW(0x00, &globals->t40204C, null, 0x10);
	goto l004012FA;
}

